<!DOCTYPE html>
<html><head><meta charset='utf-8'><title>Documentation</title></head><body>
<section id="temp_readme">
<h1 id="classification-of-statistical-pearson-diagrams">Classification
of Statistical Pearson diagrams</h1>
<p><strong>Problem</strong>: There is a set of typical statistical
diagrams. How to sort them fast and automatically?</p>
<p>Image processing: 1. Feature extraction from an image by pretrained
CNN <a
href="https://openaccess.thecvf.com/content_cvpr_2016/html/He_Deep_Residual_Learning_CVPR_2016_paper.html">ResNet50</a>
without the last layer 2. Filtration of low informative features 3.
Smooth reduction of feature space dimension: PCA + UMAP 4. Clustering
and sorting images by HDBSCAN</p>
<p><img src="figures/processing.png" width="600"></p>
<p>Dependencies:</p>
<p>Python modules - <a
href="https://pytorch.org/get-started/locally/">torch, torchvision</a> -
<a
href="https://scikit-learn.org/stable/install.html#installation-instructions">sklearn</a>
- <a href="https://umap-learn.readthedocs.io/en/latest/">umap</a> - <a
href="https://pypi.org/project/hdbscan/">hdbscan</a> - pandas, numpy -
tqdm (progress bar) - matplotlib, seaborn</p>
<p>Pearson diagrams are obtained from Solar Orbiter RPW-TDS data. For
more details see</p>
<p><em>V.Annenkov, C.Krafft, A.Volokitin, and P.Savoini</em>
<em>Statistical properties of beam-driven upper-hybrid wave turbulence
in the solar wind</em>, submitted to <strong>A&amp;A</strong></p>
<p>The example of a diargam is below.</p>
<p><img src="figures/solo_L2_rpw-tds-surv-rswf-e_20200619_V05.png" width="600"></p>
<p>The example of results:</p>
<p><img src="figures/clusterization.png" width="600"></p>
</section><hr>
<section id="libfeatures">
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>libfeatures API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#ResNetFeatures">ResNetFeatures</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ResNetFeatures.__init__">ResNetFeatures</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResNetFeatures.path">path</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResNetFeatures.info_path">info_path</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResNetFeatures.flag">flag</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResNetFeatures.device">device</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResNetFeatures.filter_mixed">filter_mixed</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResNetFeatures.name_pattern">name_pattern</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResNetFeatures.extra_params">extra_params</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResNetFeatures.names">names</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResNetFeatures.img_path">img_path</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResNetFeatures.info">info</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResNetFeatures.database">database</a>
                        </li>
                        <li>
                                <a class="function" href="#ResNetFeatures.set_device">set_device</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResNetFeatures.model">model</a>
                        </li>
                        <li>
                                <a class="function" href="#ResNetFeatures.find_mixed_freq">find_mixed_freq</a>
                        </li>
                        <li>
                                <a class="function" href="#ResNetFeatures.filtering_imgs">filtering_imgs</a>
                        </li>
                        <li>
                                <a class="function" href="#ResNetFeatures.features">features</a>
                        </li>
                        <li>
                                <a class="function" href="#ResNetFeatures.create_database">create_database</a>
                        </li>
                        <li>
                                <a class="function" href="#ResNetFeatures.filtering_nonzerocolumns">filtering_nonzerocolumns</a>
                        </li>
                        <li>
                                <a class="function" href="#ResNetFeatures.filtering_by_variance">filtering_by_variance</a>
                        </li>
                        <li>
                                <a class="function" href="#ResNetFeatures.info_on_features">info_on_features</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
libfeatures    </h1>

                
                        <input id="mod-libfeatures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-libfeatures-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1">#Copyright (c) 2025 Evgeniia VOLCHOK</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1">#for contacts e.p.volchok@gmail.com</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="c1">#Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="c1">#you may not use this file except in compliance with the License.</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="c1">#You may obtain a copy of the License at</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="c1">#http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">torchvision</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">transforms</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.feature_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">VarianceThreshold</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">pairwise_distances</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">cached_property</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">libservice</span><span class="w"> </span><span class="kn">import</span> <span class="n">ServiceFuncs</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="nd">@dataclass</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ResNetFeatures</span><span class="p">:</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    Extracts deep features from image datasets using torchvision model ResNet50,</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">    merges them with metadata, and provides filtering and analysis tools.</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">    Attributes</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    ----------</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    path : str</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">        Path to the folder containing image files.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    info_path : str</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">        Path to the metadata text file with observation parameters.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    flag : str</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">        Mode of operation: &#39;read&#39; to load precomputed database, &#39;extract&#39; to generate it from images.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    device : str</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">        Computation device to use (&#39;cuda&#39; or &#39;cpu&#39;).</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    filter_mixed : bool</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">        Whether to filter out mixed-frequency datasets.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    name_pattern : str</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">        Regex pattern to extract dataset names from image filenames.</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    extra_params : dict</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">        Additional parameters for database loading/saving.</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>    <span class="n">info_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;./data/SOLO_info_rswf.txt&#39;</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>    <span class="n">flag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;read&#39;</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cuda&#39;</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>    <span class="n">filter_mixed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>    <span class="n">name_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(solo_L2_rpw-tds-surv-(?:r|t)swf-e_\d+\w+)&#39;</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="n">extra_params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>    <span class="c1"># inner filed, will be initialized later</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>    <span class="n">_device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>    <span class="n">names</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>    <span class="n">img_path</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>    <span class="n">info</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>    <span class="n">database</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">        Initializes internal fields, filters images, and loads or creates the feature database.</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_device</span><span class="p">()</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">check_extension</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">load_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_path</span><span class="p">)</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_mixed</span><span class="p">:</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filtering_imgs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_pattern</span><span class="p">)</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="s1">&#39;read&#39;</span><span class="p">:</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">read_database</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">extra_params</span><span class="p">)</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="s1">&#39;extract&#39;</span><span class="p">:</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_database</span><span class="p">()</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>            <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">save_database</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">extra_params</span><span class="p">)</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unknown flag: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        Sets torch.device according to a user wish self.device if it is available</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">        or CPU if it is not.</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cuda&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CUDA requested but not available. Falling back to CPU.&#39;</span><span class="p">)</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Using device: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    <span class="nd">@cached_property</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">        Loads and caches the model and input transformation.</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">        </span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">        Returns</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        -------</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">        tuple</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">            A tuple (model, transform) where model is a torch.nn.Module and transform is a torchvision transform pipeline.</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="n">transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>        <span class="n">transforms</span><span class="o">.</span><span class="n">Resize</span><span class="p">((</span><span class="mi">224</span><span class="p">)),</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">],</span> 
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="n">std</span><span class="o">=</span><span class="p">[</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">])</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>                                    <span class="p">])</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="n">model_resnet50</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">resnet50</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">ResNet50_Weights</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="n">model_resnet50</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">model_resnet50</span><span class="o">.</span><span class="n">children</span><span class="p">())[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># without the last layer</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="n">model_resnet50</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="p">)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>        <span class="k">return</span> <span class="n">model_resnet50</span><span class="p">,</span> <span class="n">transform</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_mixed_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">        Identifies dataset names with mixed sampling frequencies in the metadata.</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">        Returns</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">        -------</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">        pandas.Series</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">            Series of dataset names to exclude.</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>        <span class="n">high_freq</span> <span class="o">=</span> <span class="mi">524</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>        <span class="n">low_freq</span> <span class="o">=</span> <span class="mi">262</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="n">tgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;SAMPLING_RATE[kHz]&#39;</span><span class="p">]</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>            <span class="p">((</span><span class="n">tgt</span> <span class="o">&gt;=</span> <span class="n">low_freq</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tgt</span> <span class="o">&lt;=</span> <span class="n">low_freq</span> <span class="o">+</span> <span class="mi">5</span><span class="p">))</span> <span class="o">|</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>            <span class="p">((</span><span class="n">tgt</span> <span class="o">&gt;=</span> <span class="n">high_freq</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tgt</span> <span class="o">&lt;=</span> <span class="n">high_freq</span> <span class="o">+</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="p">)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="s1">&#39;dataset_name&#39;</span><span class="p">]</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="k">return</span> <span class="n">df</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>    
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filtering_imgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">        Filters out image paths (in self.img_path,self.names) corresponding to mixed-frequency datasets.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">        Parameters</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">        ----------</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">        path : str</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">            Directory containing images.</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">        name_pattern : str</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">            Regular expression to extract dataset names from filenames.</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>        <span class="n">mixed_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_mixed_freq</span><span class="p">()</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>        
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_path</span><span class="p">:</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>            <span class="n">dataset_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">name_pattern</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>            <span class="k">if</span> <span class="n">dataset_name</span> <span class="ow">in</span> <span class="n">mixed_freq</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dataset_name</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">img_path</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="n">dataset_name</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">        Extracts deep features from all images using ResNet50 model.</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">        Returns</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">        -------</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">        np.ndarray</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">            Array of feature vectors for all valid images.</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="n">model</span><span class="p">,</span> <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_path</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Extracting features&#39;</span><span class="p">):</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>                <span class="k">with</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">img</span><span class="p">:</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>                    <span class="n">img_tensor</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="p">)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>                <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>                    <span class="n">feat</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>                <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error while openning an image </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>    
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>    
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">        Extracts features, merges them with metadata, and constructs a full DataFrame.</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="sd">        Returns</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">        -------</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">            Feature database with metadata.</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">()</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>            <span class="n">df_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>                <span class="n">features</span><span class="p">,</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;feat_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>            <span class="p">)</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="n">df_features</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;oldpath&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_path</span><span class="p">)</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>            <span class="n">df_features</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;dataset_name&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>            
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>            
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>            <span class="n">df_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[[</span><span class="s1">&#39;dataset_name&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;dist_to_sun[au]&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLES_NUMBER&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLING_RATE[kHz]&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLE_LENGTH[ms]&#39;</span><span class="p">]],</span> 
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>                <span class="n">df_features</span><span class="p">,</span> 
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>                <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;dataset_name&#39;</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>            <span class="n">df_full</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Database with information about observation parameters and extracted features:&#39;</span><span class="p">)</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">df_full</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">df_full</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>            <span class="k">return</span> <span class="n">df_full</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error during the feature extraction or database creation: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>        
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>        
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filtering_nonzerocolumns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">        Removes columns in the feature matrix that contain only zeros.</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">        Returns</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">        -------</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">            Filtered DataFrame with non-zero feature columns.</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">excluded_part</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="n">non_zero_columns</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">df_features</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="n">filtered_features</span> <span class="o">=</span> <span class="n">df_features</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">non_zero_columns</span><span class="p">]</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>        <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">excluded_part</span><span class="p">,</span> <span class="n">filtered_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filtration of zero columns. Remaining size:&#39;</span><span class="p">)</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">final_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>        <span class="k">return</span> <span class="n">final_df</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>    
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filtering_by_variance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">5e-5</span><span class="p">):</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">        Removes low-variance features from the database.</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">        Parameters</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">        ----------</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">        threshold : float</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">            Minimum variance required for a feature to be retained.</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">        Returns</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">        -------</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">            Filtered DataFrame with high-variance features.</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">excluded_part</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="n">selector</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="n">filtered_features</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_features</span><span class="p">)</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="n">filtered_features</span><span class="p">,</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;feat_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">filtered_features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>        <span class="p">)</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filtration by the variance threshold. Remaining size:&#39;</span><span class="p">)</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>        <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">excluded_part</span><span class="p">,</span> <span class="n">df_filtered</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">final_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>        <span class="k">return</span> <span class="n">final_df</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>    
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">info_on_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">        Prints statistics on extracted features and optionally visualizes variance distribution.</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">        Parameters</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="sd">        ----------</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">        visualize : bool</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">            If True, show a histogram of feature variances.</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">        title : str</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">            Optional title for the plot.</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="n">distances</span> <span class="o">=</span> <span class="n">pairwise_distances</span><span class="p">(</span><span class="n">df_features</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="n">mean_dist</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average cosine distance between embeddings:&#39;</span><span class="p">,</span> <span class="n">mean_dist</span><span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>        <span class="n">variances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">df_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Average variance: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">variances</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">variances</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>            <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Variance&#39;</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="ResNetFeatures">
                            <input id="ResNetFeatures-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">ResNetFeatures</span>:

                <label class="view-source-button" for="ResNetFeatures-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResNetFeatures"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResNetFeatures-29"><a href="#ResNetFeatures-29"><span class="linenos"> 29</span></a><span class="nd">@dataclass</span>
</span><span id="ResNetFeatures-30"><a href="#ResNetFeatures-30"><span class="linenos"> 30</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ResNetFeatures</span><span class="p">:</span>
</span><span id="ResNetFeatures-31"><a href="#ResNetFeatures-31"><span class="linenos"> 31</span></a>
</span><span id="ResNetFeatures-32"><a href="#ResNetFeatures-32"><span class="linenos"> 32</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-33"><a href="#ResNetFeatures-33"><span class="linenos"> 33</span></a><span class="sd">    Extracts deep features from image datasets using torchvision model ResNet50,</span>
</span><span id="ResNetFeatures-34"><a href="#ResNetFeatures-34"><span class="linenos"> 34</span></a><span class="sd">    merges them with metadata, and provides filtering and analysis tools.</span>
</span><span id="ResNetFeatures-35"><a href="#ResNetFeatures-35"><span class="linenos"> 35</span></a>
</span><span id="ResNetFeatures-36"><a href="#ResNetFeatures-36"><span class="linenos"> 36</span></a><span class="sd">    Attributes</span>
</span><span id="ResNetFeatures-37"><a href="#ResNetFeatures-37"><span class="linenos"> 37</span></a><span class="sd">    ----------</span>
</span><span id="ResNetFeatures-38"><a href="#ResNetFeatures-38"><span class="linenos"> 38</span></a><span class="sd">    path : str</span>
</span><span id="ResNetFeatures-39"><a href="#ResNetFeatures-39"><span class="linenos"> 39</span></a><span class="sd">        Path to the folder containing image files.</span>
</span><span id="ResNetFeatures-40"><a href="#ResNetFeatures-40"><span class="linenos"> 40</span></a><span class="sd">    info_path : str</span>
</span><span id="ResNetFeatures-41"><a href="#ResNetFeatures-41"><span class="linenos"> 41</span></a><span class="sd">        Path to the metadata text file with observation parameters.</span>
</span><span id="ResNetFeatures-42"><a href="#ResNetFeatures-42"><span class="linenos"> 42</span></a><span class="sd">    flag : str</span>
</span><span id="ResNetFeatures-43"><a href="#ResNetFeatures-43"><span class="linenos"> 43</span></a><span class="sd">        Mode of operation: &#39;read&#39; to load precomputed database, &#39;extract&#39; to generate it from images.</span>
</span><span id="ResNetFeatures-44"><a href="#ResNetFeatures-44"><span class="linenos"> 44</span></a><span class="sd">    device : str</span>
</span><span id="ResNetFeatures-45"><a href="#ResNetFeatures-45"><span class="linenos"> 45</span></a><span class="sd">        Computation device to use (&#39;cuda&#39; or &#39;cpu&#39;).</span>
</span><span id="ResNetFeatures-46"><a href="#ResNetFeatures-46"><span class="linenos"> 46</span></a><span class="sd">    filter_mixed : bool</span>
</span><span id="ResNetFeatures-47"><a href="#ResNetFeatures-47"><span class="linenos"> 47</span></a><span class="sd">        Whether to filter out mixed-frequency datasets.</span>
</span><span id="ResNetFeatures-48"><a href="#ResNetFeatures-48"><span class="linenos"> 48</span></a><span class="sd">    name_pattern : str</span>
</span><span id="ResNetFeatures-49"><a href="#ResNetFeatures-49"><span class="linenos"> 49</span></a><span class="sd">        Regex pattern to extract dataset names from image filenames.</span>
</span><span id="ResNetFeatures-50"><a href="#ResNetFeatures-50"><span class="linenos"> 50</span></a><span class="sd">    extra_params : dict</span>
</span><span id="ResNetFeatures-51"><a href="#ResNetFeatures-51"><span class="linenos"> 51</span></a><span class="sd">        Additional parameters for database loading/saving.</span>
</span><span id="ResNetFeatures-52"><a href="#ResNetFeatures-52"><span class="linenos"> 52</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-53"><a href="#ResNetFeatures-53"><span class="linenos"> 53</span></a>
</span><span id="ResNetFeatures-54"><a href="#ResNetFeatures-54"><span class="linenos"> 54</span></a>    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="ResNetFeatures-55"><a href="#ResNetFeatures-55"><span class="linenos"> 55</span></a>    <span class="n">info_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;./data/SOLO_info_rswf.txt&#39;</span>
</span><span id="ResNetFeatures-56"><a href="#ResNetFeatures-56"><span class="linenos"> 56</span></a>    <span class="n">flag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;read&#39;</span>
</span><span id="ResNetFeatures-57"><a href="#ResNetFeatures-57"><span class="linenos"> 57</span></a>    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cuda&#39;</span>
</span><span id="ResNetFeatures-58"><a href="#ResNetFeatures-58"><span class="linenos"> 58</span></a>    <span class="n">filter_mixed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ResNetFeatures-59"><a href="#ResNetFeatures-59"><span class="linenos"> 59</span></a>    <span class="n">name_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(solo_L2_rpw-tds-surv-(?:r|t)swf-e_\d+\w+)&#39;</span>
</span><span id="ResNetFeatures-60"><a href="#ResNetFeatures-60"><span class="linenos"> 60</span></a>    <span class="n">extra_params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
</span><span id="ResNetFeatures-61"><a href="#ResNetFeatures-61"><span class="linenos"> 61</span></a>
</span><span id="ResNetFeatures-62"><a href="#ResNetFeatures-62"><span class="linenos"> 62</span></a>    <span class="c1"># inner filed, will be initialized later</span>
</span><span id="ResNetFeatures-63"><a href="#ResNetFeatures-63"><span class="linenos"> 63</span></a>    <span class="n">_device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ResNetFeatures-64"><a href="#ResNetFeatures-64"><span class="linenos"> 64</span></a>    <span class="n">names</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ResNetFeatures-65"><a href="#ResNetFeatures-65"><span class="linenos"> 65</span></a>    <span class="n">img_path</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ResNetFeatures-66"><a href="#ResNetFeatures-66"><span class="linenos"> 66</span></a>    <span class="n">info</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ResNetFeatures-67"><a href="#ResNetFeatures-67"><span class="linenos"> 67</span></a>    <span class="n">database</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ResNetFeatures-68"><a href="#ResNetFeatures-68"><span class="linenos"> 68</span></a>    
</span><span id="ResNetFeatures-69"><a href="#ResNetFeatures-69"><span class="linenos"> 69</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResNetFeatures-70"><a href="#ResNetFeatures-70"><span class="linenos"> 70</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-71"><a href="#ResNetFeatures-71"><span class="linenos"> 71</span></a><span class="sd">        Initializes internal fields, filters images, and loads or creates the feature database.</span>
</span><span id="ResNetFeatures-72"><a href="#ResNetFeatures-72"><span class="linenos"> 72</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-73"><a href="#ResNetFeatures-73"><span class="linenos"> 73</span></a>
</span><span id="ResNetFeatures-74"><a href="#ResNetFeatures-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_device</span><span class="p">()</span>
</span><span id="ResNetFeatures-75"><a href="#ResNetFeatures-75"><span class="linenos"> 75</span></a>
</span><span id="ResNetFeatures-76"><a href="#ResNetFeatures-76"><span class="linenos"> 76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">check_extension</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span>
</span><span id="ResNetFeatures-77"><a href="#ResNetFeatures-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
</span><span id="ResNetFeatures-78"><a href="#ResNetFeatures-78"><span class="linenos"> 78</span></a>
</span><span id="ResNetFeatures-79"><a href="#ResNetFeatures-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">load_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_path</span><span class="p">)</span>
</span><span id="ResNetFeatures-80"><a href="#ResNetFeatures-80"><span class="linenos"> 80</span></a>
</span><span id="ResNetFeatures-81"><a href="#ResNetFeatures-81"><span class="linenos"> 81</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_mixed</span><span class="p">:</span>
</span><span id="ResNetFeatures-82"><a href="#ResNetFeatures-82"><span class="linenos"> 82</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filtering_imgs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_pattern</span><span class="p">)</span>
</span><span id="ResNetFeatures-83"><a href="#ResNetFeatures-83"><span class="linenos"> 83</span></a>
</span><span id="ResNetFeatures-84"><a href="#ResNetFeatures-84"><span class="linenos"> 84</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="s1">&#39;read&#39;</span><span class="p">:</span>
</span><span id="ResNetFeatures-85"><a href="#ResNetFeatures-85"><span class="linenos"> 85</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">read_database</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">extra_params</span><span class="p">)</span>
</span><span id="ResNetFeatures-86"><a href="#ResNetFeatures-86"><span class="linenos"> 86</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="s1">&#39;extract&#39;</span><span class="p">:</span>
</span><span id="ResNetFeatures-87"><a href="#ResNetFeatures-87"><span class="linenos"> 87</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_database</span><span class="p">()</span>
</span><span id="ResNetFeatures-88"><a href="#ResNetFeatures-88"><span class="linenos"> 88</span></a>            <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">save_database</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">extra_params</span><span class="p">)</span>
</span><span id="ResNetFeatures-89"><a href="#ResNetFeatures-89"><span class="linenos"> 89</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ResNetFeatures-90"><a href="#ResNetFeatures-90"><span class="linenos"> 90</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unknown flag: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">flag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures-91"><a href="#ResNetFeatures-91"><span class="linenos"> 91</span></a>        
</span><span id="ResNetFeatures-92"><a href="#ResNetFeatures-92"><span class="linenos"> 92</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResNetFeatures-93"><a href="#ResNetFeatures-93"><span class="linenos"> 93</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-94"><a href="#ResNetFeatures-94"><span class="linenos"> 94</span></a><span class="sd">        Sets torch.device according to a user wish self.device if it is available</span>
</span><span id="ResNetFeatures-95"><a href="#ResNetFeatures-95"><span class="linenos"> 95</span></a><span class="sd">        or CPU if it is not.</span>
</span><span id="ResNetFeatures-96"><a href="#ResNetFeatures-96"><span class="linenos"> 96</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-97"><a href="#ResNetFeatures-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cuda&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
</span><span id="ResNetFeatures-98"><a href="#ResNetFeatures-98"><span class="linenos"> 98</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CUDA requested but not available. Falling back to CPU.&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures-99"><a href="#ResNetFeatures-99"><span class="linenos"> 99</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures-100"><a href="#ResNetFeatures-100"><span class="linenos">100</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ResNetFeatures-101"><a href="#ResNetFeatures-101"><span class="linenos">101</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="ResNetFeatures-102"><a href="#ResNetFeatures-102"><span class="linenos">102</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Using device: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures-103"><a href="#ResNetFeatures-103"><span class="linenos">103</span></a>
</span><span id="ResNetFeatures-104"><a href="#ResNetFeatures-104"><span class="linenos">104</span></a>    <span class="nd">@cached_property</span>
</span><span id="ResNetFeatures-105"><a href="#ResNetFeatures-105"><span class="linenos">105</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResNetFeatures-106"><a href="#ResNetFeatures-106"><span class="linenos">106</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-107"><a href="#ResNetFeatures-107"><span class="linenos">107</span></a><span class="sd">        Loads and caches the model and input transformation.</span>
</span><span id="ResNetFeatures-108"><a href="#ResNetFeatures-108"><span class="linenos">108</span></a><span class="sd">        </span>
</span><span id="ResNetFeatures-109"><a href="#ResNetFeatures-109"><span class="linenos">109</span></a><span class="sd">        Returns</span>
</span><span id="ResNetFeatures-110"><a href="#ResNetFeatures-110"><span class="linenos">110</span></a><span class="sd">        -------</span>
</span><span id="ResNetFeatures-111"><a href="#ResNetFeatures-111"><span class="linenos">111</span></a><span class="sd">        tuple</span>
</span><span id="ResNetFeatures-112"><a href="#ResNetFeatures-112"><span class="linenos">112</span></a><span class="sd">            A tuple (model, transform) where model is a torch.nn.Module and transform is a torchvision transform pipeline.</span>
</span><span id="ResNetFeatures-113"><a href="#ResNetFeatures-113"><span class="linenos">113</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-114"><a href="#ResNetFeatures-114"><span class="linenos">114</span></a>        <span class="n">transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
</span><span id="ResNetFeatures-115"><a href="#ResNetFeatures-115"><span class="linenos">115</span></a>        <span class="n">transforms</span><span class="o">.</span><span class="n">Resize</span><span class="p">((</span><span class="mi">224</span><span class="p">)),</span>
</span><span id="ResNetFeatures-116"><a href="#ResNetFeatures-116"><span class="linenos">116</span></a>        <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
</span><span id="ResNetFeatures-117"><a href="#ResNetFeatures-117"><span class="linenos">117</span></a>        <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span>
</span><span id="ResNetFeatures-118"><a href="#ResNetFeatures-118"><span class="linenos">118</span></a>        <span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">],</span> 
</span><span id="ResNetFeatures-119"><a href="#ResNetFeatures-119"><span class="linenos">119</span></a>        <span class="n">std</span><span class="o">=</span><span class="p">[</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">])</span>
</span><span id="ResNetFeatures-120"><a href="#ResNetFeatures-120"><span class="linenos">120</span></a>                                    <span class="p">])</span>
</span><span id="ResNetFeatures-121"><a href="#ResNetFeatures-121"><span class="linenos">121</span></a>
</span><span id="ResNetFeatures-122"><a href="#ResNetFeatures-122"><span class="linenos">122</span></a>        <span class="n">model_resnet50</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">resnet50</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">ResNet50_Weights</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">)</span>
</span><span id="ResNetFeatures-123"><a href="#ResNetFeatures-123"><span class="linenos">123</span></a>        <span class="n">model_resnet50</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">model_resnet50</span><span class="o">.</span><span class="n">children</span><span class="p">())[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># without the last layer</span>
</span><span id="ResNetFeatures-124"><a href="#ResNetFeatures-124"><span class="linenos">124</span></a>        <span class="n">model_resnet50</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="p">)</span>
</span><span id="ResNetFeatures-125"><a href="#ResNetFeatures-125"><span class="linenos">125</span></a>
</span><span id="ResNetFeatures-126"><a href="#ResNetFeatures-126"><span class="linenos">126</span></a>        <span class="k">return</span> <span class="n">model_resnet50</span><span class="p">,</span> <span class="n">transform</span>
</span><span id="ResNetFeatures-127"><a href="#ResNetFeatures-127"><span class="linenos">127</span></a>
</span><span id="ResNetFeatures-128"><a href="#ResNetFeatures-128"><span class="linenos">128</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_mixed_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResNetFeatures-129"><a href="#ResNetFeatures-129"><span class="linenos">129</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-130"><a href="#ResNetFeatures-130"><span class="linenos">130</span></a><span class="sd">        Identifies dataset names with mixed sampling frequencies in the metadata.</span>
</span><span id="ResNetFeatures-131"><a href="#ResNetFeatures-131"><span class="linenos">131</span></a>
</span><span id="ResNetFeatures-132"><a href="#ResNetFeatures-132"><span class="linenos">132</span></a><span class="sd">        Returns</span>
</span><span id="ResNetFeatures-133"><a href="#ResNetFeatures-133"><span class="linenos">133</span></a><span class="sd">        -------</span>
</span><span id="ResNetFeatures-134"><a href="#ResNetFeatures-134"><span class="linenos">134</span></a><span class="sd">        pandas.Series</span>
</span><span id="ResNetFeatures-135"><a href="#ResNetFeatures-135"><span class="linenos">135</span></a><span class="sd">            Series of dataset names to exclude.</span>
</span><span id="ResNetFeatures-136"><a href="#ResNetFeatures-136"><span class="linenos">136</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-137"><a href="#ResNetFeatures-137"><span class="linenos">137</span></a>        <span class="n">high_freq</span> <span class="o">=</span> <span class="mi">524</span>
</span><span id="ResNetFeatures-138"><a href="#ResNetFeatures-138"><span class="linenos">138</span></a>        <span class="n">low_freq</span> <span class="o">=</span> <span class="mi">262</span>
</span><span id="ResNetFeatures-139"><a href="#ResNetFeatures-139"><span class="linenos">139</span></a>
</span><span id="ResNetFeatures-140"><a href="#ResNetFeatures-140"><span class="linenos">140</span></a>        <span class="n">tgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;SAMPLING_RATE[kHz]&#39;</span><span class="p">]</span>
</span><span id="ResNetFeatures-141"><a href="#ResNetFeatures-141"><span class="linenos">141</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span>
</span><span id="ResNetFeatures-142"><a href="#ResNetFeatures-142"><span class="linenos">142</span></a>            <span class="p">((</span><span class="n">tgt</span> <span class="o">&gt;=</span> <span class="n">low_freq</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tgt</span> <span class="o">&lt;=</span> <span class="n">low_freq</span> <span class="o">+</span> <span class="mi">5</span><span class="p">))</span> <span class="o">|</span>
</span><span id="ResNetFeatures-143"><a href="#ResNetFeatures-143"><span class="linenos">143</span></a>            <span class="p">((</span><span class="n">tgt</span> <span class="o">&gt;=</span> <span class="n">high_freq</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tgt</span> <span class="o">&lt;=</span> <span class="n">high_freq</span> <span class="o">+</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="ResNetFeatures-144"><a href="#ResNetFeatures-144"><span class="linenos">144</span></a>        <span class="p">)</span>
</span><span id="ResNetFeatures-145"><a href="#ResNetFeatures-145"><span class="linenos">145</span></a>        
</span><span id="ResNetFeatures-146"><a href="#ResNetFeatures-146"><span class="linenos">146</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="s1">&#39;dataset_name&#39;</span><span class="p">]</span>
</span><span id="ResNetFeatures-147"><a href="#ResNetFeatures-147"><span class="linenos">147</span></a>        <span class="k">return</span> <span class="n">df</span>
</span><span id="ResNetFeatures-148"><a href="#ResNetFeatures-148"><span class="linenos">148</span></a>    
</span><span id="ResNetFeatures-149"><a href="#ResNetFeatures-149"><span class="linenos">149</span></a>
</span><span id="ResNetFeatures-150"><a href="#ResNetFeatures-150"><span class="linenos">150</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filtering_imgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ResNetFeatures-151"><a href="#ResNetFeatures-151"><span class="linenos">151</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-152"><a href="#ResNetFeatures-152"><span class="linenos">152</span></a><span class="sd">        Filters out image paths (in self.img_path,self.names) corresponding to mixed-frequency datasets.</span>
</span><span id="ResNetFeatures-153"><a href="#ResNetFeatures-153"><span class="linenos">153</span></a>
</span><span id="ResNetFeatures-154"><a href="#ResNetFeatures-154"><span class="linenos">154</span></a><span class="sd">        Parameters</span>
</span><span id="ResNetFeatures-155"><a href="#ResNetFeatures-155"><span class="linenos">155</span></a><span class="sd">        ----------</span>
</span><span id="ResNetFeatures-156"><a href="#ResNetFeatures-156"><span class="linenos">156</span></a><span class="sd">        path : str</span>
</span><span id="ResNetFeatures-157"><a href="#ResNetFeatures-157"><span class="linenos">157</span></a><span class="sd">            Directory containing images.</span>
</span><span id="ResNetFeatures-158"><a href="#ResNetFeatures-158"><span class="linenos">158</span></a><span class="sd">        name_pattern : str</span>
</span><span id="ResNetFeatures-159"><a href="#ResNetFeatures-159"><span class="linenos">159</span></a><span class="sd">            Regular expression to extract dataset names from filenames.</span>
</span><span id="ResNetFeatures-160"><a href="#ResNetFeatures-160"><span class="linenos">160</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-161"><a href="#ResNetFeatures-161"><span class="linenos">161</span></a>        <span class="n">mixed_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_mixed_freq</span><span class="p">()</span>
</span><span id="ResNetFeatures-162"><a href="#ResNetFeatures-162"><span class="linenos">162</span></a>        
</span><span id="ResNetFeatures-163"><a href="#ResNetFeatures-163"><span class="linenos">163</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_path</span><span class="p">:</span>
</span><span id="ResNetFeatures-164"><a href="#ResNetFeatures-164"><span class="linenos">164</span></a>            <span class="n">dataset_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">name_pattern</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="ResNetFeatures-165"><a href="#ResNetFeatures-165"><span class="linenos">165</span></a>            <span class="k">if</span> <span class="n">dataset_name</span> <span class="ow">in</span> <span class="n">mixed_freq</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
</span><span id="ResNetFeatures-166"><a href="#ResNetFeatures-166"><span class="linenos">166</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dataset_name</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures-167"><a href="#ResNetFeatures-167"><span class="linenos">167</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">img_path</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="n">dataset_name</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures-168"><a href="#ResNetFeatures-168"><span class="linenos">168</span></a>
</span><span id="ResNetFeatures-169"><a href="#ResNetFeatures-169"><span class="linenos">169</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResNetFeatures-170"><a href="#ResNetFeatures-170"><span class="linenos">170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-171"><a href="#ResNetFeatures-171"><span class="linenos">171</span></a><span class="sd">        Extracts deep features from all images using ResNet50 model.</span>
</span><span id="ResNetFeatures-172"><a href="#ResNetFeatures-172"><span class="linenos">172</span></a>
</span><span id="ResNetFeatures-173"><a href="#ResNetFeatures-173"><span class="linenos">173</span></a><span class="sd">        Returns</span>
</span><span id="ResNetFeatures-174"><a href="#ResNetFeatures-174"><span class="linenos">174</span></a><span class="sd">        -------</span>
</span><span id="ResNetFeatures-175"><a href="#ResNetFeatures-175"><span class="linenos">175</span></a><span class="sd">        np.ndarray</span>
</span><span id="ResNetFeatures-176"><a href="#ResNetFeatures-176"><span class="linenos">176</span></a><span class="sd">            Array of feature vectors for all valid images.</span>
</span><span id="ResNetFeatures-177"><a href="#ResNetFeatures-177"><span class="linenos">177</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-178"><a href="#ResNetFeatures-178"><span class="linenos">178</span></a>        <span class="n">model</span><span class="p">,</span> <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
</span><span id="ResNetFeatures-179"><a href="#ResNetFeatures-179"><span class="linenos">179</span></a>        <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span><span id="ResNetFeatures-180"><a href="#ResNetFeatures-180"><span class="linenos">180</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ResNetFeatures-181"><a href="#ResNetFeatures-181"><span class="linenos">181</span></a>        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_path</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Extracting features&#39;</span><span class="p">):</span>
</span><span id="ResNetFeatures-182"><a href="#ResNetFeatures-182"><span class="linenos">182</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ResNetFeatures-183"><a href="#ResNetFeatures-183"><span class="linenos">183</span></a>                <span class="k">with</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">img</span><span class="p">:</span>
</span><span id="ResNetFeatures-184"><a href="#ResNetFeatures-184"><span class="linenos">184</span></a>                    <span class="n">img_tensor</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="p">)</span>
</span><span id="ResNetFeatures-185"><a href="#ResNetFeatures-185"><span class="linenos">185</span></a>                <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span><span id="ResNetFeatures-186"><a href="#ResNetFeatures-186"><span class="linenos">186</span></a>                    <span class="n">feat</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span><span id="ResNetFeatures-187"><a href="#ResNetFeatures-187"><span class="linenos">187</span></a>                <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
</span><span id="ResNetFeatures-188"><a href="#ResNetFeatures-188"><span class="linenos">188</span></a>            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="ResNetFeatures-189"><a href="#ResNetFeatures-189"><span class="linenos">189</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error while openning an image </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures-190"><a href="#ResNetFeatures-190"><span class="linenos">190</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</span><span id="ResNetFeatures-191"><a href="#ResNetFeatures-191"><span class="linenos">191</span></a>    
</span><span id="ResNetFeatures-192"><a href="#ResNetFeatures-192"><span class="linenos">192</span></a>    
</span><span id="ResNetFeatures-193"><a href="#ResNetFeatures-193"><span class="linenos">193</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResNetFeatures-194"><a href="#ResNetFeatures-194"><span class="linenos">194</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-195"><a href="#ResNetFeatures-195"><span class="linenos">195</span></a><span class="sd">        Extracts features, merges them with metadata, and constructs a full DataFrame.</span>
</span><span id="ResNetFeatures-196"><a href="#ResNetFeatures-196"><span class="linenos">196</span></a>
</span><span id="ResNetFeatures-197"><a href="#ResNetFeatures-197"><span class="linenos">197</span></a><span class="sd">        Returns</span>
</span><span id="ResNetFeatures-198"><a href="#ResNetFeatures-198"><span class="linenos">198</span></a><span class="sd">        -------</span>
</span><span id="ResNetFeatures-199"><a href="#ResNetFeatures-199"><span class="linenos">199</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="ResNetFeatures-200"><a href="#ResNetFeatures-200"><span class="linenos">200</span></a><span class="sd">            Feature database with metadata.</span>
</span><span id="ResNetFeatures-201"><a href="#ResNetFeatures-201"><span class="linenos">201</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-202"><a href="#ResNetFeatures-202"><span class="linenos">202</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">()</span>
</span><span id="ResNetFeatures-203"><a href="#ResNetFeatures-203"><span class="linenos">203</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ResNetFeatures-204"><a href="#ResNetFeatures-204"><span class="linenos">204</span></a>            <span class="n">df_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="ResNetFeatures-205"><a href="#ResNetFeatures-205"><span class="linenos">205</span></a>                <span class="n">features</span><span class="p">,</span>
</span><span id="ResNetFeatures-206"><a href="#ResNetFeatures-206"><span class="linenos">206</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;feat_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="ResNetFeatures-207"><a href="#ResNetFeatures-207"><span class="linenos">207</span></a>            <span class="p">)</span>
</span><span id="ResNetFeatures-208"><a href="#ResNetFeatures-208"><span class="linenos">208</span></a>
</span><span id="ResNetFeatures-209"><a href="#ResNetFeatures-209"><span class="linenos">209</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
</span><span id="ResNetFeatures-210"><a href="#ResNetFeatures-210"><span class="linenos">210</span></a>            <span class="n">df_features</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;oldpath&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_path</span><span class="p">)</span>
</span><span id="ResNetFeatures-211"><a href="#ResNetFeatures-211"><span class="linenos">211</span></a>            <span class="n">df_features</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;dataset_name&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
</span><span id="ResNetFeatures-212"><a href="#ResNetFeatures-212"><span class="linenos">212</span></a>            
</span><span id="ResNetFeatures-213"><a href="#ResNetFeatures-213"><span class="linenos">213</span></a>            
</span><span id="ResNetFeatures-214"><a href="#ResNetFeatures-214"><span class="linenos">214</span></a>            <span class="n">df_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="ResNetFeatures-215"><a href="#ResNetFeatures-215"><span class="linenos">215</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[[</span><span class="s1">&#39;dataset_name&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;dist_to_sun[au]&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLES_NUMBER&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLING_RATE[kHz]&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLE_LENGTH[ms]&#39;</span><span class="p">]],</span> 
</span><span id="ResNetFeatures-216"><a href="#ResNetFeatures-216"><span class="linenos">216</span></a>                <span class="n">df_features</span><span class="p">,</span> 
</span><span id="ResNetFeatures-217"><a href="#ResNetFeatures-217"><span class="linenos">217</span></a>                <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;dataset_name&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures-218"><a href="#ResNetFeatures-218"><span class="linenos">218</span></a>            <span class="n">df_full</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ResNetFeatures-219"><a href="#ResNetFeatures-219"><span class="linenos">219</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Database with information about observation parameters and extracted features:&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures-220"><a href="#ResNetFeatures-220"><span class="linenos">220</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">df_full</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</span><span id="ResNetFeatures-221"><a href="#ResNetFeatures-221"><span class="linenos">221</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">df_full</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span><span id="ResNetFeatures-222"><a href="#ResNetFeatures-222"><span class="linenos">222</span></a>            <span class="k">return</span> <span class="n">df_full</span>
</span><span id="ResNetFeatures-223"><a href="#ResNetFeatures-223"><span class="linenos">223</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="ResNetFeatures-224"><a href="#ResNetFeatures-224"><span class="linenos">224</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error during the feature extraction or database creation: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures-225"><a href="#ResNetFeatures-225"><span class="linenos">225</span></a>        
</span><span id="ResNetFeatures-226"><a href="#ResNetFeatures-226"><span class="linenos">226</span></a>        
</span><span id="ResNetFeatures-227"><a href="#ResNetFeatures-227"><span class="linenos">227</span></a>
</span><span id="ResNetFeatures-228"><a href="#ResNetFeatures-228"><span class="linenos">228</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filtering_nonzerocolumns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResNetFeatures-229"><a href="#ResNetFeatures-229"><span class="linenos">229</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-230"><a href="#ResNetFeatures-230"><span class="linenos">230</span></a><span class="sd">        Removes columns in the feature matrix that contain only zeros.</span>
</span><span id="ResNetFeatures-231"><a href="#ResNetFeatures-231"><span class="linenos">231</span></a>
</span><span id="ResNetFeatures-232"><a href="#ResNetFeatures-232"><span class="linenos">232</span></a><span class="sd">        Returns</span>
</span><span id="ResNetFeatures-233"><a href="#ResNetFeatures-233"><span class="linenos">233</span></a><span class="sd">        -------</span>
</span><span id="ResNetFeatures-234"><a href="#ResNetFeatures-234"><span class="linenos">234</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="ResNetFeatures-235"><a href="#ResNetFeatures-235"><span class="linenos">235</span></a><span class="sd">            Filtered DataFrame with non-zero feature columns.</span>
</span><span id="ResNetFeatures-236"><a href="#ResNetFeatures-236"><span class="linenos">236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-237"><a href="#ResNetFeatures-237"><span class="linenos">237</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">excluded_part</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
</span><span id="ResNetFeatures-238"><a href="#ResNetFeatures-238"><span class="linenos">238</span></a>        <span class="n">non_zero_columns</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">df_features</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="ResNetFeatures-239"><a href="#ResNetFeatures-239"><span class="linenos">239</span></a>        <span class="n">filtered_features</span> <span class="o">=</span> <span class="n">df_features</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">non_zero_columns</span><span class="p">]</span>
</span><span id="ResNetFeatures-240"><a href="#ResNetFeatures-240"><span class="linenos">240</span></a>        <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">excluded_part</span><span class="p">,</span> <span class="n">filtered_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ResNetFeatures-241"><a href="#ResNetFeatures-241"><span class="linenos">241</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filtration of zero columns. Remaining size:&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures-242"><a href="#ResNetFeatures-242"><span class="linenos">242</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">final_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="ResNetFeatures-243"><a href="#ResNetFeatures-243"><span class="linenos">243</span></a>        <span class="k">return</span> <span class="n">final_df</span>
</span><span id="ResNetFeatures-244"><a href="#ResNetFeatures-244"><span class="linenos">244</span></a>    
</span><span id="ResNetFeatures-245"><a href="#ResNetFeatures-245"><span class="linenos">245</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filtering_by_variance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">5e-5</span><span class="p">):</span>
</span><span id="ResNetFeatures-246"><a href="#ResNetFeatures-246"><span class="linenos">246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-247"><a href="#ResNetFeatures-247"><span class="linenos">247</span></a><span class="sd">        Removes low-variance features from the database.</span>
</span><span id="ResNetFeatures-248"><a href="#ResNetFeatures-248"><span class="linenos">248</span></a>
</span><span id="ResNetFeatures-249"><a href="#ResNetFeatures-249"><span class="linenos">249</span></a><span class="sd">        Parameters</span>
</span><span id="ResNetFeatures-250"><a href="#ResNetFeatures-250"><span class="linenos">250</span></a><span class="sd">        ----------</span>
</span><span id="ResNetFeatures-251"><a href="#ResNetFeatures-251"><span class="linenos">251</span></a><span class="sd">        threshold : float</span>
</span><span id="ResNetFeatures-252"><a href="#ResNetFeatures-252"><span class="linenos">252</span></a><span class="sd">            Minimum variance required for a feature to be retained.</span>
</span><span id="ResNetFeatures-253"><a href="#ResNetFeatures-253"><span class="linenos">253</span></a>
</span><span id="ResNetFeatures-254"><a href="#ResNetFeatures-254"><span class="linenos">254</span></a><span class="sd">        Returns</span>
</span><span id="ResNetFeatures-255"><a href="#ResNetFeatures-255"><span class="linenos">255</span></a><span class="sd">        -------</span>
</span><span id="ResNetFeatures-256"><a href="#ResNetFeatures-256"><span class="linenos">256</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="ResNetFeatures-257"><a href="#ResNetFeatures-257"><span class="linenos">257</span></a><span class="sd">            Filtered DataFrame with high-variance features.</span>
</span><span id="ResNetFeatures-258"><a href="#ResNetFeatures-258"><span class="linenos">258</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-259"><a href="#ResNetFeatures-259"><span class="linenos">259</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">excluded_part</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
</span><span id="ResNetFeatures-260"><a href="#ResNetFeatures-260"><span class="linenos">260</span></a>        <span class="n">selector</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
</span><span id="ResNetFeatures-261"><a href="#ResNetFeatures-261"><span class="linenos">261</span></a>        <span class="n">filtered_features</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_features</span><span class="p">)</span>
</span><span id="ResNetFeatures-262"><a href="#ResNetFeatures-262"><span class="linenos">262</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="ResNetFeatures-263"><a href="#ResNetFeatures-263"><span class="linenos">263</span></a>            <span class="n">filtered_features</span><span class="p">,</span>
</span><span id="ResNetFeatures-264"><a href="#ResNetFeatures-264"><span class="linenos">264</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;feat_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">filtered_features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="ResNetFeatures-265"><a href="#ResNetFeatures-265"><span class="linenos">265</span></a>        <span class="p">)</span>
</span><span id="ResNetFeatures-266"><a href="#ResNetFeatures-266"><span class="linenos">266</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filtration by the variance threshold. Remaining size:&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures-267"><a href="#ResNetFeatures-267"><span class="linenos">267</span></a>        <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">excluded_part</span><span class="p">,</span> <span class="n">df_filtered</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ResNetFeatures-268"><a href="#ResNetFeatures-268"><span class="linenos">268</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">final_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="ResNetFeatures-269"><a href="#ResNetFeatures-269"><span class="linenos">269</span></a>        <span class="k">return</span> <span class="n">final_df</span>
</span><span id="ResNetFeatures-270"><a href="#ResNetFeatures-270"><span class="linenos">270</span></a>    
</span><span id="ResNetFeatures-271"><a href="#ResNetFeatures-271"><span class="linenos">271</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">info_on_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="ResNetFeatures-272"><a href="#ResNetFeatures-272"><span class="linenos">272</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-273"><a href="#ResNetFeatures-273"><span class="linenos">273</span></a><span class="sd">        Prints statistics on extracted features and optionally visualizes variance distribution.</span>
</span><span id="ResNetFeatures-274"><a href="#ResNetFeatures-274"><span class="linenos">274</span></a>
</span><span id="ResNetFeatures-275"><a href="#ResNetFeatures-275"><span class="linenos">275</span></a><span class="sd">        Parameters</span>
</span><span id="ResNetFeatures-276"><a href="#ResNetFeatures-276"><span class="linenos">276</span></a><span class="sd">        ----------</span>
</span><span id="ResNetFeatures-277"><a href="#ResNetFeatures-277"><span class="linenos">277</span></a><span class="sd">        visualize : bool</span>
</span><span id="ResNetFeatures-278"><a href="#ResNetFeatures-278"><span class="linenos">278</span></a><span class="sd">            If True, show a histogram of feature variances.</span>
</span><span id="ResNetFeatures-279"><a href="#ResNetFeatures-279"><span class="linenos">279</span></a><span class="sd">        title : str</span>
</span><span id="ResNetFeatures-280"><a href="#ResNetFeatures-280"><span class="linenos">280</span></a><span class="sd">            Optional title for the plot.</span>
</span><span id="ResNetFeatures-281"><a href="#ResNetFeatures-281"><span class="linenos">281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures-282"><a href="#ResNetFeatures-282"><span class="linenos">282</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
</span><span id="ResNetFeatures-283"><a href="#ResNetFeatures-283"><span class="linenos">283</span></a>
</span><span id="ResNetFeatures-284"><a href="#ResNetFeatures-284"><span class="linenos">284</span></a>        <span class="n">distances</span> <span class="o">=</span> <span class="n">pairwise_distances</span><span class="p">(</span><span class="n">df_features</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures-285"><a href="#ResNetFeatures-285"><span class="linenos">285</span></a>        <span class="n">mean_dist</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="ResNetFeatures-286"><a href="#ResNetFeatures-286"><span class="linenos">286</span></a>
</span><span id="ResNetFeatures-287"><a href="#ResNetFeatures-287"><span class="linenos">287</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average cosine distance between embeddings:&#39;</span><span class="p">,</span> <span class="n">mean_dist</span><span class="p">)</span>
</span><span id="ResNetFeatures-288"><a href="#ResNetFeatures-288"><span class="linenos">288</span></a>        <span class="n">variances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">df_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="ResNetFeatures-289"><a href="#ResNetFeatures-289"><span class="linenos">289</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Average variance: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">variances</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures-290"><a href="#ResNetFeatures-290"><span class="linenos">290</span></a>
</span><span id="ResNetFeatures-291"><a href="#ResNetFeatures-291"><span class="linenos">291</span></a>        <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
</span><span id="ResNetFeatures-292"><a href="#ResNetFeatures-292"><span class="linenos">292</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</span><span id="ResNetFeatures-293"><a href="#ResNetFeatures-293"><span class="linenos">293</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ResNetFeatures-294"><a href="#ResNetFeatures-294"><span class="linenos">294</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">variances</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures-295"><a href="#ResNetFeatures-295"><span class="linenos">295</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures-296"><a href="#ResNetFeatures-296"><span class="linenos">296</span></a>            <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
</span><span id="ResNetFeatures-297"><a href="#ResNetFeatures-297"><span class="linenos">297</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="ResNetFeatures-298"><a href="#ResNetFeatures-298"><span class="linenos">298</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ResNetFeatures-299"><a href="#ResNetFeatures-299"><span class="linenos">299</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Variance&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extracts deep features from image datasets using torchvision model ResNet50,
merges them with metadata, and provides filtering and analysis tools.</p>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>path</strong> (str):
Path to the folder containing image files.</li>
<li><strong>info_path</strong> (str):
Path to the metadata text file with observation parameters.</li>
<li><strong>flag</strong> (str):
Mode of operation: 'read' to load precomputed database, 'extract' to generate it from images.</li>
<li><strong>device</strong> (str):
Computation device to use ('cuda' or 'cpu').</li>
<li><strong>filter_mixed</strong> (bool):
Whether to filter out mixed-frequency datasets.</li>
<li><strong>name_pattern</strong> (str):
Regex pattern to extract dataset names from image filenames.</li>
<li><strong>extra_params</strong> (dict):
Additional parameters for database loading/saving.</li>
</ul>
</div>


                            <div id="ResNetFeatures.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">ResNetFeatures</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">info_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;./data/SOLO_info_rswf.txt&#39;</span>,</span><span class="param">	<span class="n">flag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;read&#39;</span>,</span><span class="param">	<span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cuda&#39;</span>,</span><span class="param">	<span class="n">filter_mixed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">name_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;(solo_L2_rpw-tds-surv-(?:r|t)swf-e_</span><span class="se">\\</span><span class="s1">d+</span><span class="se">\\</span><span class="s1">w+)&#39;</span>,</span><span class="param">	<span class="n">extra_params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">factory</span><span class="o">&gt;</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#ResNetFeatures.__init__"></a>
    
    

                            </div>
                            <div id="ResNetFeatures.path" class="classattr">
                                <div class="attr variable">
            <span class="name">path</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#ResNetFeatures.path"></a>
    
    

                            </div>
                            <div id="ResNetFeatures.info_path" class="classattr">
                                <div class="attr variable">
            <span class="name">info_path</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;./data/SOLO_info_rswf.txt&#39;</span>

        
    </div>
    <a class="headerlink" href="#ResNetFeatures.info_path"></a>
    
    

                            </div>
                            <div id="ResNetFeatures.flag" class="classattr">
                                <div class="attr variable">
            <span class="name">flag</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;read&#39;</span>

        
    </div>
    <a class="headerlink" href="#ResNetFeatures.flag"></a>
    
    

                            </div>
                            <div id="ResNetFeatures.device" class="classattr">
                                <div class="attr variable">
            <span class="name">device</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;cuda&#39;</span>

        
    </div>
    <a class="headerlink" href="#ResNetFeatures.device"></a>
    
    

                            </div>
                            <div id="ResNetFeatures.filter_mixed" class="classattr">
                                <div class="attr variable">
            <span class="name">filter_mixed</span><span class="annotation">: bool</span>        =
<span class="default_value">True</span>

        
    </div>
    <a class="headerlink" href="#ResNetFeatures.filter_mixed"></a>
    
    

                            </div>
                            <div id="ResNetFeatures.name_pattern" class="classattr">
                                <div class="attr variable">
            <span class="name">name_pattern</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;(solo_L2_rpw-tds-surv-(?:r|t)swf-e_\\d+\\w+)&#39;</span>

        
    </div>
    <a class="headerlink" href="#ResNetFeatures.name_pattern"></a>
    
    

                            </div>
                            <div id="ResNetFeatures.extra_params" class="classattr">
                                <div class="attr variable">
            <span class="name">extra_params</span><span class="annotation">: dict</span>

        
    </div>
    <a class="headerlink" href="#ResNetFeatures.extra_params"></a>
    
    

                            </div>
                            <div id="ResNetFeatures.names" class="classattr">
                                <div class="attr variable">
            <span class="name">names</span><span class="annotation">: list</span>

        
    </div>
    <a class="headerlink" href="#ResNetFeatures.names"></a>
    
    

                            </div>
                            <div id="ResNetFeatures.img_path" class="classattr">
                                <div class="attr variable">
            <span class="name">img_path</span><span class="annotation">: list</span>

        
    </div>
    <a class="headerlink" href="#ResNetFeatures.img_path"></a>
    
    

                            </div>
                            <div id="ResNetFeatures.info" class="classattr">
                                <div class="attr variable">
            <span class="name">info</span><span class="annotation">: dict</span>

        
    </div>
    <a class="headerlink" href="#ResNetFeatures.info"></a>
    
    

                            </div>
                            <div id="ResNetFeatures.database" class="classattr">
                                <div class="attr variable">
            <span class="name">database</span><span class="annotation">: object</span>

        
    </div>
    <a class="headerlink" href="#ResNetFeatures.database"></a>
    
    

                            </div>
                            <div id="ResNetFeatures.set_device" class="classattr">
                                        <input id="ResNetFeatures.set_device-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_device</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ResNetFeatures.set_device-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResNetFeatures.set_device"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResNetFeatures.set_device-92"><a href="#ResNetFeatures.set_device-92"><span class="linenos"> 92</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResNetFeatures.set_device-93"><a href="#ResNetFeatures.set_device-93"><span class="linenos"> 93</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.set_device-94"><a href="#ResNetFeatures.set_device-94"><span class="linenos"> 94</span></a><span class="sd">        Sets torch.device according to a user wish self.device if it is available</span>
</span><span id="ResNetFeatures.set_device-95"><a href="#ResNetFeatures.set_device-95"><span class="linenos"> 95</span></a><span class="sd">        or CPU if it is not.</span>
</span><span id="ResNetFeatures.set_device-96"><a href="#ResNetFeatures.set_device-96"><span class="linenos"> 96</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.set_device-97"><a href="#ResNetFeatures.set_device-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cuda&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
</span><span id="ResNetFeatures.set_device-98"><a href="#ResNetFeatures.set_device-98"><span class="linenos"> 98</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CUDA requested but not available. Falling back to CPU.&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures.set_device-99"><a href="#ResNetFeatures.set_device-99"><span class="linenos"> 99</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures.set_device-100"><a href="#ResNetFeatures.set_device-100"><span class="linenos">100</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ResNetFeatures.set_device-101"><a href="#ResNetFeatures.set_device-101"><span class="linenos">101</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="ResNetFeatures.set_device-102"><a href="#ResNetFeatures.set_device-102"><span class="linenos">102</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Using device: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sets torch.device according to a user wish self.device if it is available
or CPU if it is not.</p>
</div>


                            </div>
                            <div id="ResNetFeatures.model" class="classattr">
                                        <input id="ResNetFeatures.model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">model</span>

                <label class="view-source-button" for="ResNetFeatures.model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResNetFeatures.model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResNetFeatures.model-104"><a href="#ResNetFeatures.model-104"><span class="linenos">104</span></a>    <span class="nd">@cached_property</span>
</span><span id="ResNetFeatures.model-105"><a href="#ResNetFeatures.model-105"><span class="linenos">105</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResNetFeatures.model-106"><a href="#ResNetFeatures.model-106"><span class="linenos">106</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.model-107"><a href="#ResNetFeatures.model-107"><span class="linenos">107</span></a><span class="sd">        Loads and caches the model and input transformation.</span>
</span><span id="ResNetFeatures.model-108"><a href="#ResNetFeatures.model-108"><span class="linenos">108</span></a><span class="sd">        </span>
</span><span id="ResNetFeatures.model-109"><a href="#ResNetFeatures.model-109"><span class="linenos">109</span></a><span class="sd">        Returns</span>
</span><span id="ResNetFeatures.model-110"><a href="#ResNetFeatures.model-110"><span class="linenos">110</span></a><span class="sd">        -------</span>
</span><span id="ResNetFeatures.model-111"><a href="#ResNetFeatures.model-111"><span class="linenos">111</span></a><span class="sd">        tuple</span>
</span><span id="ResNetFeatures.model-112"><a href="#ResNetFeatures.model-112"><span class="linenos">112</span></a><span class="sd">            A tuple (model, transform) where model is a torch.nn.Module and transform is a torchvision transform pipeline.</span>
</span><span id="ResNetFeatures.model-113"><a href="#ResNetFeatures.model-113"><span class="linenos">113</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.model-114"><a href="#ResNetFeatures.model-114"><span class="linenos">114</span></a>        <span class="n">transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
</span><span id="ResNetFeatures.model-115"><a href="#ResNetFeatures.model-115"><span class="linenos">115</span></a>        <span class="n">transforms</span><span class="o">.</span><span class="n">Resize</span><span class="p">((</span><span class="mi">224</span><span class="p">)),</span>
</span><span id="ResNetFeatures.model-116"><a href="#ResNetFeatures.model-116"><span class="linenos">116</span></a>        <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
</span><span id="ResNetFeatures.model-117"><a href="#ResNetFeatures.model-117"><span class="linenos">117</span></a>        <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span>
</span><span id="ResNetFeatures.model-118"><a href="#ResNetFeatures.model-118"><span class="linenos">118</span></a>        <span class="n">mean</span><span class="o">=</span><span class="p">[</span><span class="mf">0.485</span><span class="p">,</span> <span class="mf">0.456</span><span class="p">,</span> <span class="mf">0.406</span><span class="p">],</span> 
</span><span id="ResNetFeatures.model-119"><a href="#ResNetFeatures.model-119"><span class="linenos">119</span></a>        <span class="n">std</span><span class="o">=</span><span class="p">[</span><span class="mf">0.229</span><span class="p">,</span> <span class="mf">0.224</span><span class="p">,</span> <span class="mf">0.225</span><span class="p">])</span>
</span><span id="ResNetFeatures.model-120"><a href="#ResNetFeatures.model-120"><span class="linenos">120</span></a>                                    <span class="p">])</span>
</span><span id="ResNetFeatures.model-121"><a href="#ResNetFeatures.model-121"><span class="linenos">121</span></a>
</span><span id="ResNetFeatures.model-122"><a href="#ResNetFeatures.model-122"><span class="linenos">122</span></a>        <span class="n">model_resnet50</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">resnet50</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">ResNet50_Weights</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">)</span>
</span><span id="ResNetFeatures.model-123"><a href="#ResNetFeatures.model-123"><span class="linenos">123</span></a>        <span class="n">model_resnet50</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">model_resnet50</span><span class="o">.</span><span class="n">children</span><span class="p">())[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># without the last layer</span>
</span><span id="ResNetFeatures.model-124"><a href="#ResNetFeatures.model-124"><span class="linenos">124</span></a>        <span class="n">model_resnet50</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="p">)</span>
</span><span id="ResNetFeatures.model-125"><a href="#ResNetFeatures.model-125"><span class="linenos">125</span></a>
</span><span id="ResNetFeatures.model-126"><a href="#ResNetFeatures.model-126"><span class="linenos">126</span></a>        <span class="k">return</span> <span class="n">model_resnet50</span><span class="p">,</span> <span class="n">transform</span>
</span></pre></div>


            <div class="docstring"><p>Loads and caches the model and input transformation.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tuple</strong>: A tuple (model, transform) where model is a torch.nn.Module and transform is a torchvision transform pipeline.</li>
</ul>
</div>


                            </div>
                            <div id="ResNetFeatures.find_mixed_freq" class="classattr">
                                        <input id="ResNetFeatures.find_mixed_freq-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_mixed_freq</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ResNetFeatures.find_mixed_freq-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResNetFeatures.find_mixed_freq"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResNetFeatures.find_mixed_freq-128"><a href="#ResNetFeatures.find_mixed_freq-128"><span class="linenos">128</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_mixed_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResNetFeatures.find_mixed_freq-129"><a href="#ResNetFeatures.find_mixed_freq-129"><span class="linenos">129</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.find_mixed_freq-130"><a href="#ResNetFeatures.find_mixed_freq-130"><span class="linenos">130</span></a><span class="sd">        Identifies dataset names with mixed sampling frequencies in the metadata.</span>
</span><span id="ResNetFeatures.find_mixed_freq-131"><a href="#ResNetFeatures.find_mixed_freq-131"><span class="linenos">131</span></a>
</span><span id="ResNetFeatures.find_mixed_freq-132"><a href="#ResNetFeatures.find_mixed_freq-132"><span class="linenos">132</span></a><span class="sd">        Returns</span>
</span><span id="ResNetFeatures.find_mixed_freq-133"><a href="#ResNetFeatures.find_mixed_freq-133"><span class="linenos">133</span></a><span class="sd">        -------</span>
</span><span id="ResNetFeatures.find_mixed_freq-134"><a href="#ResNetFeatures.find_mixed_freq-134"><span class="linenos">134</span></a><span class="sd">        pandas.Series</span>
</span><span id="ResNetFeatures.find_mixed_freq-135"><a href="#ResNetFeatures.find_mixed_freq-135"><span class="linenos">135</span></a><span class="sd">            Series of dataset names to exclude.</span>
</span><span id="ResNetFeatures.find_mixed_freq-136"><a href="#ResNetFeatures.find_mixed_freq-136"><span class="linenos">136</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.find_mixed_freq-137"><a href="#ResNetFeatures.find_mixed_freq-137"><span class="linenos">137</span></a>        <span class="n">high_freq</span> <span class="o">=</span> <span class="mi">524</span>
</span><span id="ResNetFeatures.find_mixed_freq-138"><a href="#ResNetFeatures.find_mixed_freq-138"><span class="linenos">138</span></a>        <span class="n">low_freq</span> <span class="o">=</span> <span class="mi">262</span>
</span><span id="ResNetFeatures.find_mixed_freq-139"><a href="#ResNetFeatures.find_mixed_freq-139"><span class="linenos">139</span></a>
</span><span id="ResNetFeatures.find_mixed_freq-140"><a href="#ResNetFeatures.find_mixed_freq-140"><span class="linenos">140</span></a>        <span class="n">tgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;SAMPLING_RATE[kHz]&#39;</span><span class="p">]</span>
</span><span id="ResNetFeatures.find_mixed_freq-141"><a href="#ResNetFeatures.find_mixed_freq-141"><span class="linenos">141</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span>
</span><span id="ResNetFeatures.find_mixed_freq-142"><a href="#ResNetFeatures.find_mixed_freq-142"><span class="linenos">142</span></a>            <span class="p">((</span><span class="n">tgt</span> <span class="o">&gt;=</span> <span class="n">low_freq</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tgt</span> <span class="o">&lt;=</span> <span class="n">low_freq</span> <span class="o">+</span> <span class="mi">5</span><span class="p">))</span> <span class="o">|</span>
</span><span id="ResNetFeatures.find_mixed_freq-143"><a href="#ResNetFeatures.find_mixed_freq-143"><span class="linenos">143</span></a>            <span class="p">((</span><span class="n">tgt</span> <span class="o">&gt;=</span> <span class="n">high_freq</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tgt</span> <span class="o">&lt;=</span> <span class="n">high_freq</span> <span class="o">+</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="ResNetFeatures.find_mixed_freq-144"><a href="#ResNetFeatures.find_mixed_freq-144"><span class="linenos">144</span></a>        <span class="p">)</span>
</span><span id="ResNetFeatures.find_mixed_freq-145"><a href="#ResNetFeatures.find_mixed_freq-145"><span class="linenos">145</span></a>        
</span><span id="ResNetFeatures.find_mixed_freq-146"><a href="#ResNetFeatures.find_mixed_freq-146"><span class="linenos">146</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="s1">&#39;dataset_name&#39;</span><span class="p">]</span>
</span><span id="ResNetFeatures.find_mixed_freq-147"><a href="#ResNetFeatures.find_mixed_freq-147"><span class="linenos">147</span></a>        <span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            <div class="docstring"><p>Identifies dataset names with mixed sampling frequencies in the metadata.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pandas.Series</strong>: Series of dataset names to exclude.</li>
</ul>
</div>


                            </div>
                            <div id="ResNetFeatures.filtering_imgs" class="classattr">
                                        <input id="ResNetFeatures.filtering_imgs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">filtering_imgs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">name_pattern</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ResNetFeatures.filtering_imgs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResNetFeatures.filtering_imgs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResNetFeatures.filtering_imgs-150"><a href="#ResNetFeatures.filtering_imgs-150"><span class="linenos">150</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filtering_imgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ResNetFeatures.filtering_imgs-151"><a href="#ResNetFeatures.filtering_imgs-151"><span class="linenos">151</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.filtering_imgs-152"><a href="#ResNetFeatures.filtering_imgs-152"><span class="linenos">152</span></a><span class="sd">        Filters out image paths (in self.img_path,self.names) corresponding to mixed-frequency datasets.</span>
</span><span id="ResNetFeatures.filtering_imgs-153"><a href="#ResNetFeatures.filtering_imgs-153"><span class="linenos">153</span></a>
</span><span id="ResNetFeatures.filtering_imgs-154"><a href="#ResNetFeatures.filtering_imgs-154"><span class="linenos">154</span></a><span class="sd">        Parameters</span>
</span><span id="ResNetFeatures.filtering_imgs-155"><a href="#ResNetFeatures.filtering_imgs-155"><span class="linenos">155</span></a><span class="sd">        ----------</span>
</span><span id="ResNetFeatures.filtering_imgs-156"><a href="#ResNetFeatures.filtering_imgs-156"><span class="linenos">156</span></a><span class="sd">        path : str</span>
</span><span id="ResNetFeatures.filtering_imgs-157"><a href="#ResNetFeatures.filtering_imgs-157"><span class="linenos">157</span></a><span class="sd">            Directory containing images.</span>
</span><span id="ResNetFeatures.filtering_imgs-158"><a href="#ResNetFeatures.filtering_imgs-158"><span class="linenos">158</span></a><span class="sd">        name_pattern : str</span>
</span><span id="ResNetFeatures.filtering_imgs-159"><a href="#ResNetFeatures.filtering_imgs-159"><span class="linenos">159</span></a><span class="sd">            Regular expression to extract dataset names from filenames.</span>
</span><span id="ResNetFeatures.filtering_imgs-160"><a href="#ResNetFeatures.filtering_imgs-160"><span class="linenos">160</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.filtering_imgs-161"><a href="#ResNetFeatures.filtering_imgs-161"><span class="linenos">161</span></a>        <span class="n">mixed_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_mixed_freq</span><span class="p">()</span>
</span><span id="ResNetFeatures.filtering_imgs-162"><a href="#ResNetFeatures.filtering_imgs-162"><span class="linenos">162</span></a>        
</span><span id="ResNetFeatures.filtering_imgs-163"><a href="#ResNetFeatures.filtering_imgs-163"><span class="linenos">163</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_path</span><span class="p">:</span>
</span><span id="ResNetFeatures.filtering_imgs-164"><a href="#ResNetFeatures.filtering_imgs-164"><span class="linenos">164</span></a>            <span class="n">dataset_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">name_pattern</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="ResNetFeatures.filtering_imgs-165"><a href="#ResNetFeatures.filtering_imgs-165"><span class="linenos">165</span></a>            <span class="k">if</span> <span class="n">dataset_name</span> <span class="ow">in</span> <span class="n">mixed_freq</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
</span><span id="ResNetFeatures.filtering_imgs-166"><a href="#ResNetFeatures.filtering_imgs-166"><span class="linenos">166</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dataset_name</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures.filtering_imgs-167"><a href="#ResNetFeatures.filtering_imgs-167"><span class="linenos">167</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">img_path</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="n">dataset_name</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Filters out image paths (in self.img_path,self.names) corresponding to mixed-frequency datasets.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>path</strong> (str):
Directory containing images.</li>
<li><strong>name_pattern</strong> (str):
Regular expression to extract dataset names from filenames.</li>
</ul>
</div>


                            </div>
                            <div id="ResNetFeatures.features" class="classattr">
                                        <input id="ResNetFeatures.features-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">features</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ResNetFeatures.features-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResNetFeatures.features"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResNetFeatures.features-169"><a href="#ResNetFeatures.features-169"><span class="linenos">169</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResNetFeatures.features-170"><a href="#ResNetFeatures.features-170"><span class="linenos">170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.features-171"><a href="#ResNetFeatures.features-171"><span class="linenos">171</span></a><span class="sd">        Extracts deep features from all images using ResNet50 model.</span>
</span><span id="ResNetFeatures.features-172"><a href="#ResNetFeatures.features-172"><span class="linenos">172</span></a>
</span><span id="ResNetFeatures.features-173"><a href="#ResNetFeatures.features-173"><span class="linenos">173</span></a><span class="sd">        Returns</span>
</span><span id="ResNetFeatures.features-174"><a href="#ResNetFeatures.features-174"><span class="linenos">174</span></a><span class="sd">        -------</span>
</span><span id="ResNetFeatures.features-175"><a href="#ResNetFeatures.features-175"><span class="linenos">175</span></a><span class="sd">        np.ndarray</span>
</span><span id="ResNetFeatures.features-176"><a href="#ResNetFeatures.features-176"><span class="linenos">176</span></a><span class="sd">            Array of feature vectors for all valid images.</span>
</span><span id="ResNetFeatures.features-177"><a href="#ResNetFeatures.features-177"><span class="linenos">177</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.features-178"><a href="#ResNetFeatures.features-178"><span class="linenos">178</span></a>        <span class="n">model</span><span class="p">,</span> <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
</span><span id="ResNetFeatures.features-179"><a href="#ResNetFeatures.features-179"><span class="linenos">179</span></a>        <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span><span id="ResNetFeatures.features-180"><a href="#ResNetFeatures.features-180"><span class="linenos">180</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ResNetFeatures.features-181"><a href="#ResNetFeatures.features-181"><span class="linenos">181</span></a>        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_path</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Extracting features&#39;</span><span class="p">):</span>
</span><span id="ResNetFeatures.features-182"><a href="#ResNetFeatures.features-182"><span class="linenos">182</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ResNetFeatures.features-183"><a href="#ResNetFeatures.features-183"><span class="linenos">183</span></a>                <span class="k">with</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">img</span><span class="p">:</span>
</span><span id="ResNetFeatures.features-184"><a href="#ResNetFeatures.features-184"><span class="linenos">184</span></a>                    <span class="n">img_tensor</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="p">)</span>
</span><span id="ResNetFeatures.features-185"><a href="#ResNetFeatures.features-185"><span class="linenos">185</span></a>                <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span><span id="ResNetFeatures.features-186"><a href="#ResNetFeatures.features-186"><span class="linenos">186</span></a>                    <span class="n">feat</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">img_tensor</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span><span id="ResNetFeatures.features-187"><a href="#ResNetFeatures.features-187"><span class="linenos">187</span></a>                <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
</span><span id="ResNetFeatures.features-188"><a href="#ResNetFeatures.features-188"><span class="linenos">188</span></a>            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="ResNetFeatures.features-189"><a href="#ResNetFeatures.features-189"><span class="linenos">189</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error while openning an image </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures.features-190"><a href="#ResNetFeatures.features-190"><span class="linenos">190</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extracts deep features from all images using ResNet50 model.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: Array of feature vectors for all valid images.</li>
</ul>
</div>


                            </div>
                            <div id="ResNetFeatures.create_database" class="classattr">
                                        <input id="ResNetFeatures.create_database-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_database</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ResNetFeatures.create_database-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResNetFeatures.create_database"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResNetFeatures.create_database-193"><a href="#ResNetFeatures.create_database-193"><span class="linenos">193</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResNetFeatures.create_database-194"><a href="#ResNetFeatures.create_database-194"><span class="linenos">194</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.create_database-195"><a href="#ResNetFeatures.create_database-195"><span class="linenos">195</span></a><span class="sd">        Extracts features, merges them with metadata, and constructs a full DataFrame.</span>
</span><span id="ResNetFeatures.create_database-196"><a href="#ResNetFeatures.create_database-196"><span class="linenos">196</span></a>
</span><span id="ResNetFeatures.create_database-197"><a href="#ResNetFeatures.create_database-197"><span class="linenos">197</span></a><span class="sd">        Returns</span>
</span><span id="ResNetFeatures.create_database-198"><a href="#ResNetFeatures.create_database-198"><span class="linenos">198</span></a><span class="sd">        -------</span>
</span><span id="ResNetFeatures.create_database-199"><a href="#ResNetFeatures.create_database-199"><span class="linenos">199</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="ResNetFeatures.create_database-200"><a href="#ResNetFeatures.create_database-200"><span class="linenos">200</span></a><span class="sd">            Feature database with metadata.</span>
</span><span id="ResNetFeatures.create_database-201"><a href="#ResNetFeatures.create_database-201"><span class="linenos">201</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.create_database-202"><a href="#ResNetFeatures.create_database-202"><span class="linenos">202</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">()</span>
</span><span id="ResNetFeatures.create_database-203"><a href="#ResNetFeatures.create_database-203"><span class="linenos">203</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ResNetFeatures.create_database-204"><a href="#ResNetFeatures.create_database-204"><span class="linenos">204</span></a>            <span class="n">df_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="ResNetFeatures.create_database-205"><a href="#ResNetFeatures.create_database-205"><span class="linenos">205</span></a>                <span class="n">features</span><span class="p">,</span>
</span><span id="ResNetFeatures.create_database-206"><a href="#ResNetFeatures.create_database-206"><span class="linenos">206</span></a>                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;feat_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="ResNetFeatures.create_database-207"><a href="#ResNetFeatures.create_database-207"><span class="linenos">207</span></a>            <span class="p">)</span>
</span><span id="ResNetFeatures.create_database-208"><a href="#ResNetFeatures.create_database-208"><span class="linenos">208</span></a>
</span><span id="ResNetFeatures.create_database-209"><a href="#ResNetFeatures.create_database-209"><span class="linenos">209</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
</span><span id="ResNetFeatures.create_database-210"><a href="#ResNetFeatures.create_database-210"><span class="linenos">210</span></a>            <span class="n">df_features</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;oldpath&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_path</span><span class="p">)</span>
</span><span id="ResNetFeatures.create_database-211"><a href="#ResNetFeatures.create_database-211"><span class="linenos">211</span></a>            <span class="n">df_features</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;dataset_name&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
</span><span id="ResNetFeatures.create_database-212"><a href="#ResNetFeatures.create_database-212"><span class="linenos">212</span></a>            
</span><span id="ResNetFeatures.create_database-213"><a href="#ResNetFeatures.create_database-213"><span class="linenos">213</span></a>            
</span><span id="ResNetFeatures.create_database-214"><a href="#ResNetFeatures.create_database-214"><span class="linenos">214</span></a>            <span class="n">df_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="ResNetFeatures.create_database-215"><a href="#ResNetFeatures.create_database-215"><span class="linenos">215</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[[</span><span class="s1">&#39;dataset_name&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;dist_to_sun[au]&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLES_NUMBER&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLING_RATE[kHz]&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLE_LENGTH[ms]&#39;</span><span class="p">]],</span> 
</span><span id="ResNetFeatures.create_database-216"><a href="#ResNetFeatures.create_database-216"><span class="linenos">216</span></a>                <span class="n">df_features</span><span class="p">,</span> 
</span><span id="ResNetFeatures.create_database-217"><a href="#ResNetFeatures.create_database-217"><span class="linenos">217</span></a>                <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;dataset_name&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures.create_database-218"><a href="#ResNetFeatures.create_database-218"><span class="linenos">218</span></a>            <span class="n">df_full</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ResNetFeatures.create_database-219"><a href="#ResNetFeatures.create_database-219"><span class="linenos">219</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Database with information about observation parameters and extracted features:&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures.create_database-220"><a href="#ResNetFeatures.create_database-220"><span class="linenos">220</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">df_full</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</span><span id="ResNetFeatures.create_database-221"><a href="#ResNetFeatures.create_database-221"><span class="linenos">221</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">df_full</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span><span id="ResNetFeatures.create_database-222"><a href="#ResNetFeatures.create_database-222"><span class="linenos">222</span></a>            <span class="k">return</span> <span class="n">df_full</span>
</span><span id="ResNetFeatures.create_database-223"><a href="#ResNetFeatures.create_database-223"><span class="linenos">223</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span id="ResNetFeatures.create_database-224"><a href="#ResNetFeatures.create_database-224"><span class="linenos">224</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error during the feature extraction or database creation: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extracts features, merges them with metadata, and constructs a full DataFrame.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pandas.DataFrame</strong>: Feature database with metadata.</li>
</ul>
</div>


                            </div>
                            <div id="ResNetFeatures.filtering_nonzerocolumns" class="classattr">
                                        <input id="ResNetFeatures.filtering_nonzerocolumns-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">filtering_nonzerocolumns</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ResNetFeatures.filtering_nonzerocolumns-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResNetFeatures.filtering_nonzerocolumns"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResNetFeatures.filtering_nonzerocolumns-228"><a href="#ResNetFeatures.filtering_nonzerocolumns-228"><span class="linenos">228</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filtering_nonzerocolumns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResNetFeatures.filtering_nonzerocolumns-229"><a href="#ResNetFeatures.filtering_nonzerocolumns-229"><span class="linenos">229</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.filtering_nonzerocolumns-230"><a href="#ResNetFeatures.filtering_nonzerocolumns-230"><span class="linenos">230</span></a><span class="sd">        Removes columns in the feature matrix that contain only zeros.</span>
</span><span id="ResNetFeatures.filtering_nonzerocolumns-231"><a href="#ResNetFeatures.filtering_nonzerocolumns-231"><span class="linenos">231</span></a>
</span><span id="ResNetFeatures.filtering_nonzerocolumns-232"><a href="#ResNetFeatures.filtering_nonzerocolumns-232"><span class="linenos">232</span></a><span class="sd">        Returns</span>
</span><span id="ResNetFeatures.filtering_nonzerocolumns-233"><a href="#ResNetFeatures.filtering_nonzerocolumns-233"><span class="linenos">233</span></a><span class="sd">        -------</span>
</span><span id="ResNetFeatures.filtering_nonzerocolumns-234"><a href="#ResNetFeatures.filtering_nonzerocolumns-234"><span class="linenos">234</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="ResNetFeatures.filtering_nonzerocolumns-235"><a href="#ResNetFeatures.filtering_nonzerocolumns-235"><span class="linenos">235</span></a><span class="sd">            Filtered DataFrame with non-zero feature columns.</span>
</span><span id="ResNetFeatures.filtering_nonzerocolumns-236"><a href="#ResNetFeatures.filtering_nonzerocolumns-236"><span class="linenos">236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.filtering_nonzerocolumns-237"><a href="#ResNetFeatures.filtering_nonzerocolumns-237"><span class="linenos">237</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">excluded_part</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
</span><span id="ResNetFeatures.filtering_nonzerocolumns-238"><a href="#ResNetFeatures.filtering_nonzerocolumns-238"><span class="linenos">238</span></a>        <span class="n">non_zero_columns</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">df_features</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="ResNetFeatures.filtering_nonzerocolumns-239"><a href="#ResNetFeatures.filtering_nonzerocolumns-239"><span class="linenos">239</span></a>        <span class="n">filtered_features</span> <span class="o">=</span> <span class="n">df_features</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">non_zero_columns</span><span class="p">]</span>
</span><span id="ResNetFeatures.filtering_nonzerocolumns-240"><a href="#ResNetFeatures.filtering_nonzerocolumns-240"><span class="linenos">240</span></a>        <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">excluded_part</span><span class="p">,</span> <span class="n">filtered_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ResNetFeatures.filtering_nonzerocolumns-241"><a href="#ResNetFeatures.filtering_nonzerocolumns-241"><span class="linenos">241</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filtration of zero columns. Remaining size:&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures.filtering_nonzerocolumns-242"><a href="#ResNetFeatures.filtering_nonzerocolumns-242"><span class="linenos">242</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">final_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="ResNetFeatures.filtering_nonzerocolumns-243"><a href="#ResNetFeatures.filtering_nonzerocolumns-243"><span class="linenos">243</span></a>        <span class="k">return</span> <span class="n">final_df</span>
</span></pre></div>


            <div class="docstring"><p>Removes columns in the feature matrix that contain only zeros.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pandas.DataFrame</strong>: Filtered DataFrame with non-zero feature columns.</li>
</ul>
</div>


                            </div>
                            <div id="ResNetFeatures.filtering_by_variance" class="classattr">
                                        <input id="ResNetFeatures.filtering_by_variance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">filtering_by_variance</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">threshold</span><span class="o">=</span><span class="mf">5e-05</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ResNetFeatures.filtering_by_variance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResNetFeatures.filtering_by_variance"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResNetFeatures.filtering_by_variance-245"><a href="#ResNetFeatures.filtering_by_variance-245"><span class="linenos">245</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filtering_by_variance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">5e-5</span><span class="p">):</span>
</span><span id="ResNetFeatures.filtering_by_variance-246"><a href="#ResNetFeatures.filtering_by_variance-246"><span class="linenos">246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.filtering_by_variance-247"><a href="#ResNetFeatures.filtering_by_variance-247"><span class="linenos">247</span></a><span class="sd">        Removes low-variance features from the database.</span>
</span><span id="ResNetFeatures.filtering_by_variance-248"><a href="#ResNetFeatures.filtering_by_variance-248"><span class="linenos">248</span></a>
</span><span id="ResNetFeatures.filtering_by_variance-249"><a href="#ResNetFeatures.filtering_by_variance-249"><span class="linenos">249</span></a><span class="sd">        Parameters</span>
</span><span id="ResNetFeatures.filtering_by_variance-250"><a href="#ResNetFeatures.filtering_by_variance-250"><span class="linenos">250</span></a><span class="sd">        ----------</span>
</span><span id="ResNetFeatures.filtering_by_variance-251"><a href="#ResNetFeatures.filtering_by_variance-251"><span class="linenos">251</span></a><span class="sd">        threshold : float</span>
</span><span id="ResNetFeatures.filtering_by_variance-252"><a href="#ResNetFeatures.filtering_by_variance-252"><span class="linenos">252</span></a><span class="sd">            Minimum variance required for a feature to be retained.</span>
</span><span id="ResNetFeatures.filtering_by_variance-253"><a href="#ResNetFeatures.filtering_by_variance-253"><span class="linenos">253</span></a>
</span><span id="ResNetFeatures.filtering_by_variance-254"><a href="#ResNetFeatures.filtering_by_variance-254"><span class="linenos">254</span></a><span class="sd">        Returns</span>
</span><span id="ResNetFeatures.filtering_by_variance-255"><a href="#ResNetFeatures.filtering_by_variance-255"><span class="linenos">255</span></a><span class="sd">        -------</span>
</span><span id="ResNetFeatures.filtering_by_variance-256"><a href="#ResNetFeatures.filtering_by_variance-256"><span class="linenos">256</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="ResNetFeatures.filtering_by_variance-257"><a href="#ResNetFeatures.filtering_by_variance-257"><span class="linenos">257</span></a><span class="sd">            Filtered DataFrame with high-variance features.</span>
</span><span id="ResNetFeatures.filtering_by_variance-258"><a href="#ResNetFeatures.filtering_by_variance-258"><span class="linenos">258</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.filtering_by_variance-259"><a href="#ResNetFeatures.filtering_by_variance-259"><span class="linenos">259</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">excluded_part</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
</span><span id="ResNetFeatures.filtering_by_variance-260"><a href="#ResNetFeatures.filtering_by_variance-260"><span class="linenos">260</span></a>        <span class="n">selector</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
</span><span id="ResNetFeatures.filtering_by_variance-261"><a href="#ResNetFeatures.filtering_by_variance-261"><span class="linenos">261</span></a>        <span class="n">filtered_features</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_features</span><span class="p">)</span>
</span><span id="ResNetFeatures.filtering_by_variance-262"><a href="#ResNetFeatures.filtering_by_variance-262"><span class="linenos">262</span></a>        <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="ResNetFeatures.filtering_by_variance-263"><a href="#ResNetFeatures.filtering_by_variance-263"><span class="linenos">263</span></a>            <span class="n">filtered_features</span><span class="p">,</span>
</span><span id="ResNetFeatures.filtering_by_variance-264"><a href="#ResNetFeatures.filtering_by_variance-264"><span class="linenos">264</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;feat_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">filtered_features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="ResNetFeatures.filtering_by_variance-265"><a href="#ResNetFeatures.filtering_by_variance-265"><span class="linenos">265</span></a>        <span class="p">)</span>
</span><span id="ResNetFeatures.filtering_by_variance-266"><a href="#ResNetFeatures.filtering_by_variance-266"><span class="linenos">266</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filtration by the variance threshold. Remaining size:&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures.filtering_by_variance-267"><a href="#ResNetFeatures.filtering_by_variance-267"><span class="linenos">267</span></a>        <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">excluded_part</span><span class="p">,</span> <span class="n">df_filtered</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ResNetFeatures.filtering_by_variance-268"><a href="#ResNetFeatures.filtering_by_variance-268"><span class="linenos">268</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">final_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="ResNetFeatures.filtering_by_variance-269"><a href="#ResNetFeatures.filtering_by_variance-269"><span class="linenos">269</span></a>        <span class="k">return</span> <span class="n">final_df</span>
</span></pre></div>


            <div class="docstring"><p>Removes low-variance features from the database.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>threshold</strong> (float):
Minimum variance required for a feature to be retained.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pandas.DataFrame</strong>: Filtered DataFrame with high-variance features.</li>
</ul>
</div>


                            </div>
                            <div id="ResNetFeatures.info_on_features" class="classattr">
                                        <input id="ResNetFeatures.info_on_features-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">info_on_features</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">visualize</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ResNetFeatures.info_on_features-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResNetFeatures.info_on_features"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResNetFeatures.info_on_features-271"><a href="#ResNetFeatures.info_on_features-271"><span class="linenos">271</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">info_on_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visualize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="ResNetFeatures.info_on_features-272"><a href="#ResNetFeatures.info_on_features-272"><span class="linenos">272</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.info_on_features-273"><a href="#ResNetFeatures.info_on_features-273"><span class="linenos">273</span></a><span class="sd">        Prints statistics on extracted features and optionally visualizes variance distribution.</span>
</span><span id="ResNetFeatures.info_on_features-274"><a href="#ResNetFeatures.info_on_features-274"><span class="linenos">274</span></a>
</span><span id="ResNetFeatures.info_on_features-275"><a href="#ResNetFeatures.info_on_features-275"><span class="linenos">275</span></a><span class="sd">        Parameters</span>
</span><span id="ResNetFeatures.info_on_features-276"><a href="#ResNetFeatures.info_on_features-276"><span class="linenos">276</span></a><span class="sd">        ----------</span>
</span><span id="ResNetFeatures.info_on_features-277"><a href="#ResNetFeatures.info_on_features-277"><span class="linenos">277</span></a><span class="sd">        visualize : bool</span>
</span><span id="ResNetFeatures.info_on_features-278"><a href="#ResNetFeatures.info_on_features-278"><span class="linenos">278</span></a><span class="sd">            If True, show a histogram of feature variances.</span>
</span><span id="ResNetFeatures.info_on_features-279"><a href="#ResNetFeatures.info_on_features-279"><span class="linenos">279</span></a><span class="sd">        title : str</span>
</span><span id="ResNetFeatures.info_on_features-280"><a href="#ResNetFeatures.info_on_features-280"><span class="linenos">280</span></a><span class="sd">            Optional title for the plot.</span>
</span><span id="ResNetFeatures.info_on_features-281"><a href="#ResNetFeatures.info_on_features-281"><span class="linenos">281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResNetFeatures.info_on_features-282"><a href="#ResNetFeatures.info_on_features-282"><span class="linenos">282</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
</span><span id="ResNetFeatures.info_on_features-283"><a href="#ResNetFeatures.info_on_features-283"><span class="linenos">283</span></a>
</span><span id="ResNetFeatures.info_on_features-284"><a href="#ResNetFeatures.info_on_features-284"><span class="linenos">284</span></a>        <span class="n">distances</span> <span class="o">=</span> <span class="n">pairwise_distances</span><span class="p">(</span><span class="n">df_features</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures.info_on_features-285"><a href="#ResNetFeatures.info_on_features-285"><span class="linenos">285</span></a>        <span class="n">mean_dist</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="ResNetFeatures.info_on_features-286"><a href="#ResNetFeatures.info_on_features-286"><span class="linenos">286</span></a>
</span><span id="ResNetFeatures.info_on_features-287"><a href="#ResNetFeatures.info_on_features-287"><span class="linenos">287</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Average cosine distance between embeddings:&#39;</span><span class="p">,</span> <span class="n">mean_dist</span><span class="p">)</span>
</span><span id="ResNetFeatures.info_on_features-288"><a href="#ResNetFeatures.info_on_features-288"><span class="linenos">288</span></a>        <span class="n">variances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">df_features</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="ResNetFeatures.info_on_features-289"><a href="#ResNetFeatures.info_on_features-289"><span class="linenos">289</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Average variance: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">variances</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures.info_on_features-290"><a href="#ResNetFeatures.info_on_features-290"><span class="linenos">290</span></a>
</span><span id="ResNetFeatures.info_on_features-291"><a href="#ResNetFeatures.info_on_features-291"><span class="linenos">291</span></a>        <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
</span><span id="ResNetFeatures.info_on_features-292"><a href="#ResNetFeatures.info_on_features-292"><span class="linenos">292</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</span><span id="ResNetFeatures.info_on_features-293"><a href="#ResNetFeatures.info_on_features-293"><span class="linenos">293</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ResNetFeatures.info_on_features-294"><a href="#ResNetFeatures.info_on_features-294"><span class="linenos">294</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">variances</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures.info_on_features-295"><a href="#ResNetFeatures.info_on_features-295"><span class="linenos">295</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
</span><span id="ResNetFeatures.info_on_features-296"><a href="#ResNetFeatures.info_on_features-296"><span class="linenos">296</span></a>            <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
</span><span id="ResNetFeatures.info_on_features-297"><a href="#ResNetFeatures.info_on_features-297"><span class="linenos">297</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="ResNetFeatures.info_on_features-298"><a href="#ResNetFeatures.info_on_features-298"><span class="linenos">298</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ResNetFeatures.info_on_features-299"><a href="#ResNetFeatures.info_on_features-299"><span class="linenos">299</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Variance&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Prints statistics on extracted features and optionally visualizes variance distribution.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>visualize</strong> (bool):
If True, show a histogram of feature variances.</li>
<li><strong>title</strong> (str):
Optional title for the plot.</li>
</ul>
</div>


                            </div>
                </section>
    </main>
</body>
</html></section><hr>
<section id="libpreprocessing">
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>libpreprocessing API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#FeaturesPreprocessing">FeaturesPreprocessing</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#FeaturesPreprocessing.__init__">FeaturesPreprocessing</a>
                        </li>
                        <li>
                                <a class="variable" href="#FeaturesPreprocessing.models">models</a>
                        </li>
                        <li>
                                <a class="function" href="#FeaturesPreprocessing.preproccessing">preproccessing</a>
                        </li>
                        <li>
                                <a class="function" href="#FeaturesPreprocessing.wrapper_preprop">wrapper_preprop</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
libpreprocessing    </h1>

                
                        <input id="mod-libpreprocessing-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-libpreprocessing-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1">#Copyright (c) 2025 Evgeniia VOLCHOK</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1">#for contacts e.p.volchok@gmail.com</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="c1">#Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="c1">#you may not use this file except in compliance with the License.</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="c1">#You may obtain a copy of the License at</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="c1">#http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.decomposition</span><span class="w"> </span><span class="kn">import</span> <span class="n">PCA</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">umap</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">libservice</span><span class="w"> </span><span class="kn">import</span> <span class="n">ServiceFuncs</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="k">class</span><span class="w"> </span><span class="nc">FeaturesPreprocessing</span><span class="p">:</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="w">    </span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">        Applies dimensionality reduction and scaling pipelines to a DataFrame of features.</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">        This class provides a flexible wrapper around common preprocessing techniques </span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">        such as PCA, StandardScaler, and UMAP. The sequence of transformations is defined </span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">        by a string-based pipeline syntax.</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">        Parameters</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">        ----------</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">            Input DataFrame containing both metadata and features.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">        copy : bool, optional</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">            If True, the input DataFrame is copied before processing.</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">            If False (default), the original DataFrame is modified in-place.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">        Attributes</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">        ----------</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">        models : dict</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">            Dictionary mapping method names (&#39;pca&#39;, &#39;scaler&#39;, &#39;umapnd&#39;, &#39;umap2d&#39;) to</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">            their corresponding scikit-learn or UMAP objects.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">            Stored copy or reference to the input DataFrame.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>            <span class="s1">&#39;pca&#39;</span><span class="p">:</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">svd_solver</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">),</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>            <span class="s1">&#39;scaler&#39;</span><span class="p">:</span> <span class="n">StandardScaler</span><span class="p">(),</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>            <span class="s1">&#39;umapnd&#39;</span><span class="p">:</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">),</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>            <span class="s1">&#39;umap2d&#39;</span><span class="p">:</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">)</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>        <span class="p">}</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">preproccessing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">pipe_str</span><span class="p">):</span> <span class="c1">#pipe_str=&#39;PCA+UMAP+..&#39;</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">        Applies a sequence of preprocessing transformations to the feature data.</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">        Parameters</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">        ----------</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">            Feature matrix (excluding metadata).</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">        pipe_str : str</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">            A string representing the sequence of transformations to apply,</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">            joined by &#39;+&#39;. For example: &#39;pca+umap2d&#39;.</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">        Returns</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">        -------</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">        numpy.ndarray or None</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">            Transformed feature array if input is non-empty; otherwise None.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">        Raises</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        ------</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">        KeyError</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">            If the pipeline string contains unknown model names.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="n">models</span> <span class="o">=</span> <span class="n">pipe_str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="n">pipes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>            <span class="n">pipes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">m</span><span class="p">]))</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>            <span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">pipes</span><span class="p">)</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>        
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">wrapper_preprop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">pipe_str</span><span class="p">):</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">        Applies preprocessing to the feature part of a DataFrame while preserving metadata.</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">        This method splits the input DataFrame into metadata and feature parts,</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">        applies the specified transformation pipeline to the features, and then</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        merges the result back with the metadata.</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">        Parameters</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">        ----------</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">            Full input DataFrame including metadata and features.</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">        pipe_str : str</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">            Pipeline string specifying preprocessing steps (e.g., &#39;scaler+pca+umap2d&#39;).</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        Returns</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">        -------</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">            New DataFrame containing preserved metadata and transformed features.</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">        Raises</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">        ------</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">        ValueError</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">            If feature transformation fails or input DataFrame is empty.</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">excluded_part</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="n">processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preproccessing</span><span class="p">(</span><span class="n">df_features</span><span class="p">,</span> <span class="n">pipe_str</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="n">df_processed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>            <span class="n">processed</span><span class="p">,</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;feat_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">processed</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>        <span class="p">)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>        <span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">excluded_part</span><span class="p">,</span> <span class="n">df_processed</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="n">df_new</span>
</span></pre></div>


            </section>
                <section id="FeaturesPreprocessing">
                            <input id="FeaturesPreprocessing-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">FeaturesPreprocessing</span>:

                <label class="view-source-button" for="FeaturesPreprocessing-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FeaturesPreprocessing"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FeaturesPreprocessing-19"><a href="#FeaturesPreprocessing-19"><span class="linenos"> 19</span></a><span class="k">class</span><span class="w"> </span><span class="nc">FeaturesPreprocessing</span><span class="p">:</span>
</span><span id="FeaturesPreprocessing-20"><a href="#FeaturesPreprocessing-20"><span class="linenos"> 20</span></a>
</span><span id="FeaturesPreprocessing-21"><a href="#FeaturesPreprocessing-21"><span class="linenos"> 21</span></a><span class="w">    </span>
</span><span id="FeaturesPreprocessing-22"><a href="#FeaturesPreprocessing-22"><span class="linenos"> 22</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FeaturesPreprocessing-23"><a href="#FeaturesPreprocessing-23"><span class="linenos"> 23</span></a><span class="sd">        Applies dimensionality reduction and scaling pipelines to a DataFrame of features.</span>
</span><span id="FeaturesPreprocessing-24"><a href="#FeaturesPreprocessing-24"><span class="linenos"> 24</span></a>
</span><span id="FeaturesPreprocessing-25"><a href="#FeaturesPreprocessing-25"><span class="linenos"> 25</span></a><span class="sd">        This class provides a flexible wrapper around common preprocessing techniques </span>
</span><span id="FeaturesPreprocessing-26"><a href="#FeaturesPreprocessing-26"><span class="linenos"> 26</span></a><span class="sd">        such as PCA, StandardScaler, and UMAP. The sequence of transformations is defined </span>
</span><span id="FeaturesPreprocessing-27"><a href="#FeaturesPreprocessing-27"><span class="linenos"> 27</span></a><span class="sd">        by a string-based pipeline syntax.</span>
</span><span id="FeaturesPreprocessing-28"><a href="#FeaturesPreprocessing-28"><span class="linenos"> 28</span></a>
</span><span id="FeaturesPreprocessing-29"><a href="#FeaturesPreprocessing-29"><span class="linenos"> 29</span></a><span class="sd">        Parameters</span>
</span><span id="FeaturesPreprocessing-30"><a href="#FeaturesPreprocessing-30"><span class="linenos"> 30</span></a><span class="sd">        ----------</span>
</span><span id="FeaturesPreprocessing-31"><a href="#FeaturesPreprocessing-31"><span class="linenos"> 31</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="FeaturesPreprocessing-32"><a href="#FeaturesPreprocessing-32"><span class="linenos"> 32</span></a><span class="sd">            Input DataFrame containing both metadata and features.</span>
</span><span id="FeaturesPreprocessing-33"><a href="#FeaturesPreprocessing-33"><span class="linenos"> 33</span></a><span class="sd">        copy : bool, optional</span>
</span><span id="FeaturesPreprocessing-34"><a href="#FeaturesPreprocessing-34"><span class="linenos"> 34</span></a><span class="sd">            If True, the input DataFrame is copied before processing.</span>
</span><span id="FeaturesPreprocessing-35"><a href="#FeaturesPreprocessing-35"><span class="linenos"> 35</span></a><span class="sd">            If False (default), the original DataFrame is modified in-place.</span>
</span><span id="FeaturesPreprocessing-36"><a href="#FeaturesPreprocessing-36"><span class="linenos"> 36</span></a>
</span><span id="FeaturesPreprocessing-37"><a href="#FeaturesPreprocessing-37"><span class="linenos"> 37</span></a><span class="sd">        Attributes</span>
</span><span id="FeaturesPreprocessing-38"><a href="#FeaturesPreprocessing-38"><span class="linenos"> 38</span></a><span class="sd">        ----------</span>
</span><span id="FeaturesPreprocessing-39"><a href="#FeaturesPreprocessing-39"><span class="linenos"> 39</span></a><span class="sd">        models : dict</span>
</span><span id="FeaturesPreprocessing-40"><a href="#FeaturesPreprocessing-40"><span class="linenos"> 40</span></a><span class="sd">            Dictionary mapping method names (&#39;pca&#39;, &#39;scaler&#39;, &#39;umapnd&#39;, &#39;umap2d&#39;) to</span>
</span><span id="FeaturesPreprocessing-41"><a href="#FeaturesPreprocessing-41"><span class="linenos"> 41</span></a><span class="sd">            their corresponding scikit-learn or UMAP objects.</span>
</span><span id="FeaturesPreprocessing-42"><a href="#FeaturesPreprocessing-42"><span class="linenos"> 42</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="FeaturesPreprocessing-43"><a href="#FeaturesPreprocessing-43"><span class="linenos"> 43</span></a><span class="sd">            Stored copy or reference to the input DataFrame.</span>
</span><span id="FeaturesPreprocessing-44"><a href="#FeaturesPreprocessing-44"><span class="linenos"> 44</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="FeaturesPreprocessing-45"><a href="#FeaturesPreprocessing-45"><span class="linenos"> 45</span></a>
</span><span id="FeaturesPreprocessing-46"><a href="#FeaturesPreprocessing-46"><span class="linenos"> 46</span></a>
</span><span id="FeaturesPreprocessing-47"><a href="#FeaturesPreprocessing-47"><span class="linenos"> 47</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="FeaturesPreprocessing-48"><a href="#FeaturesPreprocessing-48"><span class="linenos"> 48</span></a>
</span><span id="FeaturesPreprocessing-49"><a href="#FeaturesPreprocessing-49"><span class="linenos"> 49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="FeaturesPreprocessing-50"><a href="#FeaturesPreprocessing-50"><span class="linenos"> 50</span></a>            <span class="s1">&#39;pca&#39;</span><span class="p">:</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">svd_solver</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">),</span>
</span><span id="FeaturesPreprocessing-51"><a href="#FeaturesPreprocessing-51"><span class="linenos"> 51</span></a>            <span class="s1">&#39;scaler&#39;</span><span class="p">:</span> <span class="n">StandardScaler</span><span class="p">(),</span>
</span><span id="FeaturesPreprocessing-52"><a href="#FeaturesPreprocessing-52"><span class="linenos"> 52</span></a>            <span class="s1">&#39;umapnd&#39;</span><span class="p">:</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">),</span>
</span><span id="FeaturesPreprocessing-53"><a href="#FeaturesPreprocessing-53"><span class="linenos"> 53</span></a>            <span class="s1">&#39;umap2d&#39;</span><span class="p">:</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">)</span>
</span><span id="FeaturesPreprocessing-54"><a href="#FeaturesPreprocessing-54"><span class="linenos"> 54</span></a>        <span class="p">}</span>
</span><span id="FeaturesPreprocessing-55"><a href="#FeaturesPreprocessing-55"><span class="linenos"> 55</span></a>        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
</span><span id="FeaturesPreprocessing-56"><a href="#FeaturesPreprocessing-56"><span class="linenos"> 56</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="FeaturesPreprocessing-57"><a href="#FeaturesPreprocessing-57"><span class="linenos"> 57</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FeaturesPreprocessing-58"><a href="#FeaturesPreprocessing-58"><span class="linenos"> 58</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="FeaturesPreprocessing-59"><a href="#FeaturesPreprocessing-59"><span class="linenos"> 59</span></a>
</span><span id="FeaturesPreprocessing-60"><a href="#FeaturesPreprocessing-60"><span class="linenos"> 60</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">preproccessing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">pipe_str</span><span class="p">):</span> <span class="c1">#pipe_str=&#39;PCA+UMAP+..&#39;</span>
</span><span id="FeaturesPreprocessing-61"><a href="#FeaturesPreprocessing-61"><span class="linenos"> 61</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FeaturesPreprocessing-62"><a href="#FeaturesPreprocessing-62"><span class="linenos"> 62</span></a><span class="sd">        Applies a sequence of preprocessing transformations to the feature data.</span>
</span><span id="FeaturesPreprocessing-63"><a href="#FeaturesPreprocessing-63"><span class="linenos"> 63</span></a>
</span><span id="FeaturesPreprocessing-64"><a href="#FeaturesPreprocessing-64"><span class="linenos"> 64</span></a><span class="sd">        Parameters</span>
</span><span id="FeaturesPreprocessing-65"><a href="#FeaturesPreprocessing-65"><span class="linenos"> 65</span></a><span class="sd">        ----------</span>
</span><span id="FeaturesPreprocessing-66"><a href="#FeaturesPreprocessing-66"><span class="linenos"> 66</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="FeaturesPreprocessing-67"><a href="#FeaturesPreprocessing-67"><span class="linenos"> 67</span></a><span class="sd">            Feature matrix (excluding metadata).</span>
</span><span id="FeaturesPreprocessing-68"><a href="#FeaturesPreprocessing-68"><span class="linenos"> 68</span></a><span class="sd">        pipe_str : str</span>
</span><span id="FeaturesPreprocessing-69"><a href="#FeaturesPreprocessing-69"><span class="linenos"> 69</span></a><span class="sd">            A string representing the sequence of transformations to apply,</span>
</span><span id="FeaturesPreprocessing-70"><a href="#FeaturesPreprocessing-70"><span class="linenos"> 70</span></a><span class="sd">            joined by &#39;+&#39;. For example: &#39;pca+umap2d&#39;.</span>
</span><span id="FeaturesPreprocessing-71"><a href="#FeaturesPreprocessing-71"><span class="linenos"> 71</span></a>
</span><span id="FeaturesPreprocessing-72"><a href="#FeaturesPreprocessing-72"><span class="linenos"> 72</span></a><span class="sd">        Returns</span>
</span><span id="FeaturesPreprocessing-73"><a href="#FeaturesPreprocessing-73"><span class="linenos"> 73</span></a><span class="sd">        -------</span>
</span><span id="FeaturesPreprocessing-74"><a href="#FeaturesPreprocessing-74"><span class="linenos"> 74</span></a><span class="sd">        numpy.ndarray or None</span>
</span><span id="FeaturesPreprocessing-75"><a href="#FeaturesPreprocessing-75"><span class="linenos"> 75</span></a><span class="sd">            Transformed feature array if input is non-empty; otherwise None.</span>
</span><span id="FeaturesPreprocessing-76"><a href="#FeaturesPreprocessing-76"><span class="linenos"> 76</span></a>
</span><span id="FeaturesPreprocessing-77"><a href="#FeaturesPreprocessing-77"><span class="linenos"> 77</span></a><span class="sd">        Raises</span>
</span><span id="FeaturesPreprocessing-78"><a href="#FeaturesPreprocessing-78"><span class="linenos"> 78</span></a><span class="sd">        ------</span>
</span><span id="FeaturesPreprocessing-79"><a href="#FeaturesPreprocessing-79"><span class="linenos"> 79</span></a><span class="sd">        KeyError</span>
</span><span id="FeaturesPreprocessing-80"><a href="#FeaturesPreprocessing-80"><span class="linenos"> 80</span></a><span class="sd">            If the pipeline string contains unknown model names.</span>
</span><span id="FeaturesPreprocessing-81"><a href="#FeaturesPreprocessing-81"><span class="linenos"> 81</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FeaturesPreprocessing-82"><a href="#FeaturesPreprocessing-82"><span class="linenos"> 82</span></a>        
</span><span id="FeaturesPreprocessing-83"><a href="#FeaturesPreprocessing-83"><span class="linenos"> 83</span></a>        <span class="n">models</span> <span class="o">=</span> <span class="n">pipe_str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
</span><span id="FeaturesPreprocessing-84"><a href="#FeaturesPreprocessing-84"><span class="linenos"> 84</span></a>        <span class="n">pipes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FeaturesPreprocessing-85"><a href="#FeaturesPreprocessing-85"><span class="linenos"> 85</span></a>        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
</span><span id="FeaturesPreprocessing-86"><a href="#FeaturesPreprocessing-86"><span class="linenos"> 86</span></a>            <span class="n">pipes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">m</span><span class="p">]))</span>
</span><span id="FeaturesPreprocessing-87"><a href="#FeaturesPreprocessing-87"><span class="linenos"> 87</span></a>        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
</span><span id="FeaturesPreprocessing-88"><a href="#FeaturesPreprocessing-88"><span class="linenos"> 88</span></a>            <span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">pipes</span><span class="p">)</span>
</span><span id="FeaturesPreprocessing-89"><a href="#FeaturesPreprocessing-89"><span class="linenos"> 89</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="FeaturesPreprocessing-90"><a href="#FeaturesPreprocessing-90"><span class="linenos"> 90</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="FeaturesPreprocessing-91"><a href="#FeaturesPreprocessing-91"><span class="linenos"> 91</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FeaturesPreprocessing-92"><a href="#FeaturesPreprocessing-92"><span class="linenos"> 92</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="FeaturesPreprocessing-93"><a href="#FeaturesPreprocessing-93"><span class="linenos"> 93</span></a>        
</span><span id="FeaturesPreprocessing-94"><a href="#FeaturesPreprocessing-94"><span class="linenos"> 94</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">wrapper_preprop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">pipe_str</span><span class="p">):</span>
</span><span id="FeaturesPreprocessing-95"><a href="#FeaturesPreprocessing-95"><span class="linenos"> 95</span></a>
</span><span id="FeaturesPreprocessing-96"><a href="#FeaturesPreprocessing-96"><span class="linenos"> 96</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FeaturesPreprocessing-97"><a href="#FeaturesPreprocessing-97"><span class="linenos"> 97</span></a><span class="sd">        Applies preprocessing to the feature part of a DataFrame while preserving metadata.</span>
</span><span id="FeaturesPreprocessing-98"><a href="#FeaturesPreprocessing-98"><span class="linenos"> 98</span></a>
</span><span id="FeaturesPreprocessing-99"><a href="#FeaturesPreprocessing-99"><span class="linenos"> 99</span></a><span class="sd">        This method splits the input DataFrame into metadata and feature parts,</span>
</span><span id="FeaturesPreprocessing-100"><a href="#FeaturesPreprocessing-100"><span class="linenos">100</span></a><span class="sd">        applies the specified transformation pipeline to the features, and then</span>
</span><span id="FeaturesPreprocessing-101"><a href="#FeaturesPreprocessing-101"><span class="linenos">101</span></a><span class="sd">        merges the result back with the metadata.</span>
</span><span id="FeaturesPreprocessing-102"><a href="#FeaturesPreprocessing-102"><span class="linenos">102</span></a>
</span><span id="FeaturesPreprocessing-103"><a href="#FeaturesPreprocessing-103"><span class="linenos">103</span></a><span class="sd">        Parameters</span>
</span><span id="FeaturesPreprocessing-104"><a href="#FeaturesPreprocessing-104"><span class="linenos">104</span></a><span class="sd">        ----------</span>
</span><span id="FeaturesPreprocessing-105"><a href="#FeaturesPreprocessing-105"><span class="linenos">105</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="FeaturesPreprocessing-106"><a href="#FeaturesPreprocessing-106"><span class="linenos">106</span></a><span class="sd">            Full input DataFrame including metadata and features.</span>
</span><span id="FeaturesPreprocessing-107"><a href="#FeaturesPreprocessing-107"><span class="linenos">107</span></a><span class="sd">        pipe_str : str</span>
</span><span id="FeaturesPreprocessing-108"><a href="#FeaturesPreprocessing-108"><span class="linenos">108</span></a><span class="sd">            Pipeline string specifying preprocessing steps (e.g., &#39;scaler+pca+umap2d&#39;).</span>
</span><span id="FeaturesPreprocessing-109"><a href="#FeaturesPreprocessing-109"><span class="linenos">109</span></a>
</span><span id="FeaturesPreprocessing-110"><a href="#FeaturesPreprocessing-110"><span class="linenos">110</span></a><span class="sd">        Returns</span>
</span><span id="FeaturesPreprocessing-111"><a href="#FeaturesPreprocessing-111"><span class="linenos">111</span></a><span class="sd">        -------</span>
</span><span id="FeaturesPreprocessing-112"><a href="#FeaturesPreprocessing-112"><span class="linenos">112</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="FeaturesPreprocessing-113"><a href="#FeaturesPreprocessing-113"><span class="linenos">113</span></a><span class="sd">            New DataFrame containing preserved metadata and transformed features.</span>
</span><span id="FeaturesPreprocessing-114"><a href="#FeaturesPreprocessing-114"><span class="linenos">114</span></a>
</span><span id="FeaturesPreprocessing-115"><a href="#FeaturesPreprocessing-115"><span class="linenos">115</span></a><span class="sd">        Raises</span>
</span><span id="FeaturesPreprocessing-116"><a href="#FeaturesPreprocessing-116"><span class="linenos">116</span></a><span class="sd">        ------</span>
</span><span id="FeaturesPreprocessing-117"><a href="#FeaturesPreprocessing-117"><span class="linenos">117</span></a><span class="sd">        ValueError</span>
</span><span id="FeaturesPreprocessing-118"><a href="#FeaturesPreprocessing-118"><span class="linenos">118</span></a><span class="sd">            If feature transformation fails or input DataFrame is empty.</span>
</span><span id="FeaturesPreprocessing-119"><a href="#FeaturesPreprocessing-119"><span class="linenos">119</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FeaturesPreprocessing-120"><a href="#FeaturesPreprocessing-120"><span class="linenos">120</span></a>
</span><span id="FeaturesPreprocessing-121"><a href="#FeaturesPreprocessing-121"><span class="linenos">121</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">excluded_part</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="FeaturesPreprocessing-122"><a href="#FeaturesPreprocessing-122"><span class="linenos">122</span></a>        <span class="n">processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preproccessing</span><span class="p">(</span><span class="n">df_features</span><span class="p">,</span> <span class="n">pipe_str</span><span class="p">)</span>
</span><span id="FeaturesPreprocessing-123"><a href="#FeaturesPreprocessing-123"><span class="linenos">123</span></a>        <span class="n">df_processed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="FeaturesPreprocessing-124"><a href="#FeaturesPreprocessing-124"><span class="linenos">124</span></a>            <span class="n">processed</span><span class="p">,</span>
</span><span id="FeaturesPreprocessing-125"><a href="#FeaturesPreprocessing-125"><span class="linenos">125</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;feat_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">processed</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="FeaturesPreprocessing-126"><a href="#FeaturesPreprocessing-126"><span class="linenos">126</span></a>        <span class="p">)</span>
</span><span id="FeaturesPreprocessing-127"><a href="#FeaturesPreprocessing-127"><span class="linenos">127</span></a>        <span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">excluded_part</span><span class="p">,</span> <span class="n">df_processed</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="FeaturesPreprocessing-128"><a href="#FeaturesPreprocessing-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="n">df_new</span>
</span></pre></div>


            <div class="docstring"><p>Applies dimensionality reduction and scaling pipelines to a DataFrame of features.</p>

<p>This class provides a flexible wrapper around common preprocessing techniques 
such as PCA, StandardScaler, and UMAP. The sequence of transformations is defined 
by a string-based pipeline syntax.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong> (pandas.DataFrame):
Input DataFrame containing both metadata and features.</li>
<li><strong>copy</strong> (bool, optional):
If True, the input DataFrame is copied before processing.
If False (default), the original DataFrame is modified in-place.</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>models</strong> (dict):
Dictionary mapping method names ('pca', 'scaler', 'umapnd', 'umap2d') to
their corresponding scikit-learn or UMAP objects.</li>
<li><strong>df</strong> (pandas.DataFrame):
Stored copy or reference to the input DataFrame.</li>
</ul>
</div>


                            <div id="FeaturesPreprocessing.__init__" class="classattr">
                                        <input id="FeaturesPreprocessing.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">FeaturesPreprocessing</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">df</span>, </span><span class="param"><span class="n">copy</span><span class="o">=</span><span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="FeaturesPreprocessing.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FeaturesPreprocessing.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FeaturesPreprocessing.__init__-47"><a href="#FeaturesPreprocessing.__init__-47"><span class="linenos">47</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="FeaturesPreprocessing.__init__-48"><a href="#FeaturesPreprocessing.__init__-48"><span class="linenos">48</span></a>
</span><span id="FeaturesPreprocessing.__init__-49"><a href="#FeaturesPreprocessing.__init__-49"><span class="linenos">49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="FeaturesPreprocessing.__init__-50"><a href="#FeaturesPreprocessing.__init__-50"><span class="linenos">50</span></a>            <span class="s1">&#39;pca&#39;</span><span class="p">:</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">svd_solver</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">),</span>
</span><span id="FeaturesPreprocessing.__init__-51"><a href="#FeaturesPreprocessing.__init__-51"><span class="linenos">51</span></a>            <span class="s1">&#39;scaler&#39;</span><span class="p">:</span> <span class="n">StandardScaler</span><span class="p">(),</span>
</span><span id="FeaturesPreprocessing.__init__-52"><a href="#FeaturesPreprocessing.__init__-52"><span class="linenos">52</span></a>            <span class="s1">&#39;umapnd&#39;</span><span class="p">:</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">),</span>
</span><span id="FeaturesPreprocessing.__init__-53"><a href="#FeaturesPreprocessing.__init__-53"><span class="linenos">53</span></a>            <span class="s1">&#39;umap2d&#39;</span><span class="p">:</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_dist</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">)</span>
</span><span id="FeaturesPreprocessing.__init__-54"><a href="#FeaturesPreprocessing.__init__-54"><span class="linenos">54</span></a>        <span class="p">}</span>
</span><span id="FeaturesPreprocessing.__init__-55"><a href="#FeaturesPreprocessing.__init__-55"><span class="linenos">55</span></a>        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
</span><span id="FeaturesPreprocessing.__init__-56"><a href="#FeaturesPreprocessing.__init__-56"><span class="linenos">56</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="FeaturesPreprocessing.__init__-57"><a href="#FeaturesPreprocessing.__init__-57"><span class="linenos">57</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FeaturesPreprocessing.__init__-58"><a href="#FeaturesPreprocessing.__init__-58"><span class="linenos">58</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>
</span></pre></div>


    

                            </div>
                            <div id="FeaturesPreprocessing.models" class="classattr">
                                <div class="attr variable">
            <span class="name">models</span>

        
    </div>
    <a class="headerlink" href="#FeaturesPreprocessing.models"></a>
    
    

                            </div>
                            <div id="FeaturesPreprocessing.preproccessing" class="classattr">
                                        <input id="FeaturesPreprocessing.preproccessing-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">preproccessing</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span>, </span><span class="param"><span class="n">pipe_str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FeaturesPreprocessing.preproccessing-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FeaturesPreprocessing.preproccessing"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FeaturesPreprocessing.preproccessing-60"><a href="#FeaturesPreprocessing.preproccessing-60"><span class="linenos">60</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">preproccessing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">pipe_str</span><span class="p">):</span> <span class="c1">#pipe_str=&#39;PCA+UMAP+..&#39;</span>
</span><span id="FeaturesPreprocessing.preproccessing-61"><a href="#FeaturesPreprocessing.preproccessing-61"><span class="linenos">61</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FeaturesPreprocessing.preproccessing-62"><a href="#FeaturesPreprocessing.preproccessing-62"><span class="linenos">62</span></a><span class="sd">        Applies a sequence of preprocessing transformations to the feature data.</span>
</span><span id="FeaturesPreprocessing.preproccessing-63"><a href="#FeaturesPreprocessing.preproccessing-63"><span class="linenos">63</span></a>
</span><span id="FeaturesPreprocessing.preproccessing-64"><a href="#FeaturesPreprocessing.preproccessing-64"><span class="linenos">64</span></a><span class="sd">        Parameters</span>
</span><span id="FeaturesPreprocessing.preproccessing-65"><a href="#FeaturesPreprocessing.preproccessing-65"><span class="linenos">65</span></a><span class="sd">        ----------</span>
</span><span id="FeaturesPreprocessing.preproccessing-66"><a href="#FeaturesPreprocessing.preproccessing-66"><span class="linenos">66</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="FeaturesPreprocessing.preproccessing-67"><a href="#FeaturesPreprocessing.preproccessing-67"><span class="linenos">67</span></a><span class="sd">            Feature matrix (excluding metadata).</span>
</span><span id="FeaturesPreprocessing.preproccessing-68"><a href="#FeaturesPreprocessing.preproccessing-68"><span class="linenos">68</span></a><span class="sd">        pipe_str : str</span>
</span><span id="FeaturesPreprocessing.preproccessing-69"><a href="#FeaturesPreprocessing.preproccessing-69"><span class="linenos">69</span></a><span class="sd">            A string representing the sequence of transformations to apply,</span>
</span><span id="FeaturesPreprocessing.preproccessing-70"><a href="#FeaturesPreprocessing.preproccessing-70"><span class="linenos">70</span></a><span class="sd">            joined by &#39;+&#39;. For example: &#39;pca+umap2d&#39;.</span>
</span><span id="FeaturesPreprocessing.preproccessing-71"><a href="#FeaturesPreprocessing.preproccessing-71"><span class="linenos">71</span></a>
</span><span id="FeaturesPreprocessing.preproccessing-72"><a href="#FeaturesPreprocessing.preproccessing-72"><span class="linenos">72</span></a><span class="sd">        Returns</span>
</span><span id="FeaturesPreprocessing.preproccessing-73"><a href="#FeaturesPreprocessing.preproccessing-73"><span class="linenos">73</span></a><span class="sd">        -------</span>
</span><span id="FeaturesPreprocessing.preproccessing-74"><a href="#FeaturesPreprocessing.preproccessing-74"><span class="linenos">74</span></a><span class="sd">        numpy.ndarray or None</span>
</span><span id="FeaturesPreprocessing.preproccessing-75"><a href="#FeaturesPreprocessing.preproccessing-75"><span class="linenos">75</span></a><span class="sd">            Transformed feature array if input is non-empty; otherwise None.</span>
</span><span id="FeaturesPreprocessing.preproccessing-76"><a href="#FeaturesPreprocessing.preproccessing-76"><span class="linenos">76</span></a>
</span><span id="FeaturesPreprocessing.preproccessing-77"><a href="#FeaturesPreprocessing.preproccessing-77"><span class="linenos">77</span></a><span class="sd">        Raises</span>
</span><span id="FeaturesPreprocessing.preproccessing-78"><a href="#FeaturesPreprocessing.preproccessing-78"><span class="linenos">78</span></a><span class="sd">        ------</span>
</span><span id="FeaturesPreprocessing.preproccessing-79"><a href="#FeaturesPreprocessing.preproccessing-79"><span class="linenos">79</span></a><span class="sd">        KeyError</span>
</span><span id="FeaturesPreprocessing.preproccessing-80"><a href="#FeaturesPreprocessing.preproccessing-80"><span class="linenos">80</span></a><span class="sd">            If the pipeline string contains unknown model names.</span>
</span><span id="FeaturesPreprocessing.preproccessing-81"><a href="#FeaturesPreprocessing.preproccessing-81"><span class="linenos">81</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FeaturesPreprocessing.preproccessing-82"><a href="#FeaturesPreprocessing.preproccessing-82"><span class="linenos">82</span></a>        
</span><span id="FeaturesPreprocessing.preproccessing-83"><a href="#FeaturesPreprocessing.preproccessing-83"><span class="linenos">83</span></a>        <span class="n">models</span> <span class="o">=</span> <span class="n">pipe_str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
</span><span id="FeaturesPreprocessing.preproccessing-84"><a href="#FeaturesPreprocessing.preproccessing-84"><span class="linenos">84</span></a>        <span class="n">pipes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FeaturesPreprocessing.preproccessing-85"><a href="#FeaturesPreprocessing.preproccessing-85"><span class="linenos">85</span></a>        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
</span><span id="FeaturesPreprocessing.preproccessing-86"><a href="#FeaturesPreprocessing.preproccessing-86"><span class="linenos">86</span></a>            <span class="n">pipes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">m</span><span class="p">]))</span>
</span><span id="FeaturesPreprocessing.preproccessing-87"><a href="#FeaturesPreprocessing.preproccessing-87"><span class="linenos">87</span></a>        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
</span><span id="FeaturesPreprocessing.preproccessing-88"><a href="#FeaturesPreprocessing.preproccessing-88"><span class="linenos">88</span></a>            <span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">pipes</span><span class="p">)</span>
</span><span id="FeaturesPreprocessing.preproccessing-89"><a href="#FeaturesPreprocessing.preproccessing-89"><span class="linenos">89</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="FeaturesPreprocessing.preproccessing-90"><a href="#FeaturesPreprocessing.preproccessing-90"><span class="linenos">90</span></a>            <span class="k">return</span> <span class="n">results</span>
</span><span id="FeaturesPreprocessing.preproccessing-91"><a href="#FeaturesPreprocessing.preproccessing-91"><span class="linenos">91</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FeaturesPreprocessing.preproccessing-92"><a href="#FeaturesPreprocessing.preproccessing-92"><span class="linenos">92</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Applies a sequence of preprocessing transformations to the feature data.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong> (pandas.DataFrame):
Feature matrix (excluding metadata).</li>
<li><strong>pipe_str</strong> (str):
A string representing the sequence of transformations to apply,
joined by '+'. For example: 'pca+umap2d'.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>numpy.ndarray or None</strong>: Transformed feature array if input is non-empty; otherwise None.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>KeyError</strong>: If the pipeline string contains unknown model names.</li>
</ul>
</div>


                            </div>
                            <div id="FeaturesPreprocessing.wrapper_preprop" class="classattr">
                                        <input id="FeaturesPreprocessing.wrapper_preprop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wrapper_preprop</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span>, </span><span class="param"><span class="n">pipe_str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FeaturesPreprocessing.wrapper_preprop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FeaturesPreprocessing.wrapper_preprop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FeaturesPreprocessing.wrapper_preprop-94"><a href="#FeaturesPreprocessing.wrapper_preprop-94"><span class="linenos"> 94</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">wrapper_preprop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">pipe_str</span><span class="p">):</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-95"><a href="#FeaturesPreprocessing.wrapper_preprop-95"><span class="linenos"> 95</span></a>
</span><span id="FeaturesPreprocessing.wrapper_preprop-96"><a href="#FeaturesPreprocessing.wrapper_preprop-96"><span class="linenos"> 96</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-97"><a href="#FeaturesPreprocessing.wrapper_preprop-97"><span class="linenos"> 97</span></a><span class="sd">        Applies preprocessing to the feature part of a DataFrame while preserving metadata.</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-98"><a href="#FeaturesPreprocessing.wrapper_preprop-98"><span class="linenos"> 98</span></a>
</span><span id="FeaturesPreprocessing.wrapper_preprop-99"><a href="#FeaturesPreprocessing.wrapper_preprop-99"><span class="linenos"> 99</span></a><span class="sd">        This method splits the input DataFrame into metadata and feature parts,</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-100"><a href="#FeaturesPreprocessing.wrapper_preprop-100"><span class="linenos">100</span></a><span class="sd">        applies the specified transformation pipeline to the features, and then</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-101"><a href="#FeaturesPreprocessing.wrapper_preprop-101"><span class="linenos">101</span></a><span class="sd">        merges the result back with the metadata.</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-102"><a href="#FeaturesPreprocessing.wrapper_preprop-102"><span class="linenos">102</span></a>
</span><span id="FeaturesPreprocessing.wrapper_preprop-103"><a href="#FeaturesPreprocessing.wrapper_preprop-103"><span class="linenos">103</span></a><span class="sd">        Parameters</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-104"><a href="#FeaturesPreprocessing.wrapper_preprop-104"><span class="linenos">104</span></a><span class="sd">        ----------</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-105"><a href="#FeaturesPreprocessing.wrapper_preprop-105"><span class="linenos">105</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-106"><a href="#FeaturesPreprocessing.wrapper_preprop-106"><span class="linenos">106</span></a><span class="sd">            Full input DataFrame including metadata and features.</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-107"><a href="#FeaturesPreprocessing.wrapper_preprop-107"><span class="linenos">107</span></a><span class="sd">        pipe_str : str</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-108"><a href="#FeaturesPreprocessing.wrapper_preprop-108"><span class="linenos">108</span></a><span class="sd">            Pipeline string specifying preprocessing steps (e.g., &#39;scaler+pca+umap2d&#39;).</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-109"><a href="#FeaturesPreprocessing.wrapper_preprop-109"><span class="linenos">109</span></a>
</span><span id="FeaturesPreprocessing.wrapper_preprop-110"><a href="#FeaturesPreprocessing.wrapper_preprop-110"><span class="linenos">110</span></a><span class="sd">        Returns</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-111"><a href="#FeaturesPreprocessing.wrapper_preprop-111"><span class="linenos">111</span></a><span class="sd">        -------</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-112"><a href="#FeaturesPreprocessing.wrapper_preprop-112"><span class="linenos">112</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-113"><a href="#FeaturesPreprocessing.wrapper_preprop-113"><span class="linenos">113</span></a><span class="sd">            New DataFrame containing preserved metadata and transformed features.</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-114"><a href="#FeaturesPreprocessing.wrapper_preprop-114"><span class="linenos">114</span></a>
</span><span id="FeaturesPreprocessing.wrapper_preprop-115"><a href="#FeaturesPreprocessing.wrapper_preprop-115"><span class="linenos">115</span></a><span class="sd">        Raises</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-116"><a href="#FeaturesPreprocessing.wrapper_preprop-116"><span class="linenos">116</span></a><span class="sd">        ------</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-117"><a href="#FeaturesPreprocessing.wrapper_preprop-117"><span class="linenos">117</span></a><span class="sd">        ValueError</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-118"><a href="#FeaturesPreprocessing.wrapper_preprop-118"><span class="linenos">118</span></a><span class="sd">            If feature transformation fails or input DataFrame is empty.</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-119"><a href="#FeaturesPreprocessing.wrapper_preprop-119"><span class="linenos">119</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-120"><a href="#FeaturesPreprocessing.wrapper_preprop-120"><span class="linenos">120</span></a>
</span><span id="FeaturesPreprocessing.wrapper_preprop-121"><a href="#FeaturesPreprocessing.wrapper_preprop-121"><span class="linenos">121</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">excluded_part</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-122"><a href="#FeaturesPreprocessing.wrapper_preprop-122"><span class="linenos">122</span></a>        <span class="n">processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preproccessing</span><span class="p">(</span><span class="n">df_features</span><span class="p">,</span> <span class="n">pipe_str</span><span class="p">)</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-123"><a href="#FeaturesPreprocessing.wrapper_preprop-123"><span class="linenos">123</span></a>        <span class="n">df_processed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-124"><a href="#FeaturesPreprocessing.wrapper_preprop-124"><span class="linenos">124</span></a>            <span class="n">processed</span><span class="p">,</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-125"><a href="#FeaturesPreprocessing.wrapper_preprop-125"><span class="linenos">125</span></a>            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;feat_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">processed</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-126"><a href="#FeaturesPreprocessing.wrapper_preprop-126"><span class="linenos">126</span></a>        <span class="p">)</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-127"><a href="#FeaturesPreprocessing.wrapper_preprop-127"><span class="linenos">127</span></a>        <span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">excluded_part</span><span class="p">,</span> <span class="n">df_processed</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="FeaturesPreprocessing.wrapper_preprop-128"><a href="#FeaturesPreprocessing.wrapper_preprop-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="n">df_new</span>
</span></pre></div>


            <div class="docstring"><p>Applies preprocessing to the feature part of a DataFrame while preserving metadata.</p>

<p>This method splits the input DataFrame into metadata and feature parts,
applies the specified transformation pipeline to the features, and then
merges the result back with the metadata.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong> (pandas.DataFrame):
Full input DataFrame including metadata and features.</li>
<li><strong>pipe_str</strong> (str):
Pipeline string specifying preprocessing steps (e.g., 'scaler+pca+umap2d').</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pandas.DataFrame</strong>: New DataFrame containing preserved metadata and transformed features.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If feature transformation fails or input DataFrame is empty.</li>
</ul>
</div>


                            </div>
                </section>
    </main>
</body>
</html></section><hr>
<section id="libclustering">
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>libclustering API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Clustering">Clustering</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Clustering.__init__">Clustering</a>
                        </li>
                        <li>
                                <a class="variable" href="#Clustering.num_clusters">num_clusters</a>
                        </li>
                        <li>
                                <a class="variable" href="#Clustering.labels">labels</a>
                        </li>
                        <li>
                                <a class="variable" href="#Clustering.dir">dir</a>
                        </li>
                        <li>
                                <a class="function" href="#Clustering.clustering_HDBSCAN">clustering_HDBSCAN</a>
                        </li>
                        <li>
                                <a class="function" href="#Clustering.update_database">update_database</a>
                        </li>
                        <li>
                                <a class="function" href="#Clustering.create_dirs">create_dirs</a>
                        </li>
                        <li>
                                <a class="function" href="#Clustering.create_newpath">create_newpath</a>
                        </li>
                        <li>
                                <a class="function" href="#Clustering.copy_files">copy_files</a>
                        </li>
                        <li>
                                <a class="function" href="#Clustering.sort_files">sort_files</a>
                        </li>
                        <li>
                                <a class="function" href="#Clustering.visualize_HDBSCAN">visualize_HDBSCAN</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
libclustering    </h1>

                
                        <input id="mod-libclustering-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-libclustering-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1">#Copyright (c) 2025 Evgeniia VOLCHOK</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1">#for contacts e.p.volchok@gmail.com</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="c1">#Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="c1">#you may not use this file except in compliance with the License.</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="c1">#You may obtain a copy of the License at</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="c1">#http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">hdbscan</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">libservice</span><span class="w"> </span><span class="kn">import</span> <span class="n">ServiceFuncs</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">libpreprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">FeaturesPreprocessing</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;qtagg&#39;</span><span class="p">)</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">rc</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s1">&#39;serif&#39;</span><span class="p">)</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text.latex&#39;</span><span class="p">,</span> <span class="n">preamble</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\usepackage[utf8]</span><span class="si">{inputenc}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">})</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Clustering</span><span class="p">:</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">    Performs HDBSCAN clustering on a feature dataset and manages file sorting and visualization.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">    This class supports unsupervised clustering using the HDBSCAN algorithm,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">    updates the associated feature database with labels, and organizes files</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">    into directories based on cluster assignments. It also includes tools for</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    cluster visualization using PCA and UMAP.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    Parameters</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    ----------</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    df : pandas.DataFrame</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">        Input feature DataFrame containing at least &#39;oldpath&#39; and feature columns.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">    copy : bool, optional</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">        If True, the input DataFrame is copied internally. Default is False.</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    clear : bool, optional</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">        If True, the target directory &#39;./processed&#39; will be cleared before use. Default is True.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    Attributes</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    ----------</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    df : pandas.DataFrame</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">        The working DataFrame, either copied or referenced.</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">    num_clusters : int</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">        Number of clusters found (excluding noise).</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">    labels : list of int</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">        Cluster labels assigned by HDBSCAN (-1 indicates noise).</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">    dir : str</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">        Directory path where clustered files will be organized (default is &#39;./processed&#39;).</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_clusters</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="s1">&#39;./processed&#39;</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>        <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">preparing_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="n">clear</span><span class="p">)</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clustering_HDBSCAN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">        Applies HDBSCAN clustering to the given feature matrix.</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">        Parameters</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">        ----------</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        df : pandas.DataFrame or numpy.ndarray</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">            Feature matrix with shape (n_samples, n_features).</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">        Returns</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">        -------</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">        labels : numpy.ndarray</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">            Array of cluster labels for each sample (-1 indicates noise).</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">        num_clusters : int</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">            Number of clusters detected (excluding noise).</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>        
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="n">clusterer</span> <span class="o">=</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">)</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">clusterer</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_clusters</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>    
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">        Inserts the cluster labels into the internal DataFrame as a new column &#39;label&#39;.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">        Creates output directories for each cluster and a separate one for noise.</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">        The directories are created under `self.dir` if they do not already exist.</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">):</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>            <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_clusters</span><span class="p">):</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>                <span class="n">dir_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="s1">&#39;/label_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dir_name</span><span class="p">):</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="s1">&#39;/noise&#39;</span><span class="p">):</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="s1">&#39;/noise&#39;</span><span class="p">)</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_newpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">        Assigns new output paths for each sample in the DataFrame based on their cluster label.</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">        Clustered samples go to &#39;./processed/label_&lt;cluster&gt;&#39;, noise samples go to &#39;./processed/noise&#39;.</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>         
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_clusters</span><span class="p">):</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cl</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;./processed/label_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;./processed/noise&#39;</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">copy_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">        Copies image files from their original locations (&#39;oldpath&#39;) to the new cluster-assigned directories (&#39;path&#39;).</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">        Skips rows where either path is missing or not a string. Errors are printed but do not interrupt execution.</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>            <span class="n">oldpath</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;oldpath&#39;</span><span class="p">]</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>            <span class="n">newpath</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oldpath</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newpath</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>                    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;cp&#39;</span><span class="p">,</span> <span class="s1">&#39;-u&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;oldpath&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>                <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error during copying </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;oldpath&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Probably missing path </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">: oldpath=</span><span class="si">{</span><span class="n">oldpath</span><span class="si">}</span><span class="s1">, path=</span><span class="si">{</span><span class="n">newpath</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sort_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">        Organizes image files into directories by cluster.</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">        This method:</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">        - Creates cluster directories</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">        - Assigns new file paths</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">        - Copies files to new locations</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">        - Removes the &#39;oldpath&#39; column from the DataFrame</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_dirs</span><span class="p">()</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_newpath</span><span class="p">()</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">copy_files</span><span class="p">()</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;oldpath&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualize_HDBSCAN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        Reduces the feature space to 2D using PCA + UMAP, applies HDBSCAN clustering, and plots the results.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        Parameters</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">        ----------</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">            Input DataFrame containing features and metadata.</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">        Saves</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">        -----</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">        &#39;./figures/clusterization_triggered.pdf&#39; : PDF version of the cluster plot</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">        &#39;./figures/clusterization_triggered.png&#39; : PNG version (300 DPI)</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        Shows</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        -----</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">        A scatter plot of the clustered data with noise in gray and clusters in color.</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="n">features_processed</span> <span class="o">=</span> <span class="n">FeaturesPreprocessing</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">preproccessing</span><span class="p">(</span><span class="n">df_features</span><span class="p">,</span> <span class="s1">&#39;PCA+UMAP2D&#39;</span><span class="p">)</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="n">labels</span><span class="p">,</span> <span class="n">n_clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clustering_HDBSCAN</span><span class="p">(</span><span class="n">features_processed</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found </span><span class="si">{</span><span class="n">n_clusters</span><span class="si">}</span><span class="s1"> clusters (2D)&#39;</span><span class="p">)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="n">palette</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;tab10&#39;</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">labels</span> <span class="o">==</span> <span class="n">label</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span> <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">palette</span><span class="p">(</span><span class="n">label</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">features_processed</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">features_processed</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Cluster </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">label</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;Noise&#39;</span><span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PCA + UMAP2D + HDBSCAN: clustering visualization&#39;</span><span class="p">)</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;UMAP-1 component&#39;</span><span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;UMAP-2  component&#39;</span><span class="p">)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;./figures&#39;</span><span class="p">):</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;./figures&#39;</span><span class="p">)</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/clusterization_triggered.pdf&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/clusterization_triggered.png&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="Clustering">
                            <input id="Clustering-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Clustering</span>:

                <label class="view-source-button" for="Clustering-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Clustering"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Clustering-29"><a href="#Clustering-29"><span class="linenos"> 29</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Clustering</span><span class="p">:</span>
</span><span id="Clustering-30"><a href="#Clustering-30"><span class="linenos"> 30</span></a>
</span><span id="Clustering-31"><a href="#Clustering-31"><span class="linenos"> 31</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Clustering-32"><a href="#Clustering-32"><span class="linenos"> 32</span></a><span class="sd">    Performs HDBSCAN clustering on a feature dataset and manages file sorting and visualization.</span>
</span><span id="Clustering-33"><a href="#Clustering-33"><span class="linenos"> 33</span></a>
</span><span id="Clustering-34"><a href="#Clustering-34"><span class="linenos"> 34</span></a><span class="sd">    This class supports unsupervised clustering using the HDBSCAN algorithm,</span>
</span><span id="Clustering-35"><a href="#Clustering-35"><span class="linenos"> 35</span></a><span class="sd">    updates the associated feature database with labels, and organizes files</span>
</span><span id="Clustering-36"><a href="#Clustering-36"><span class="linenos"> 36</span></a><span class="sd">    into directories based on cluster assignments. It also includes tools for</span>
</span><span id="Clustering-37"><a href="#Clustering-37"><span class="linenos"> 37</span></a><span class="sd">    cluster visualization using PCA and UMAP.</span>
</span><span id="Clustering-38"><a href="#Clustering-38"><span class="linenos"> 38</span></a>
</span><span id="Clustering-39"><a href="#Clustering-39"><span class="linenos"> 39</span></a><span class="sd">    Parameters</span>
</span><span id="Clustering-40"><a href="#Clustering-40"><span class="linenos"> 40</span></a><span class="sd">    ----------</span>
</span><span id="Clustering-41"><a href="#Clustering-41"><span class="linenos"> 41</span></a><span class="sd">    df : pandas.DataFrame</span>
</span><span id="Clustering-42"><a href="#Clustering-42"><span class="linenos"> 42</span></a><span class="sd">        Input feature DataFrame containing at least &#39;oldpath&#39; and feature columns.</span>
</span><span id="Clustering-43"><a href="#Clustering-43"><span class="linenos"> 43</span></a><span class="sd">    copy : bool, optional</span>
</span><span id="Clustering-44"><a href="#Clustering-44"><span class="linenos"> 44</span></a><span class="sd">        If True, the input DataFrame is copied internally. Default is False.</span>
</span><span id="Clustering-45"><a href="#Clustering-45"><span class="linenos"> 45</span></a><span class="sd">    clear : bool, optional</span>
</span><span id="Clustering-46"><a href="#Clustering-46"><span class="linenos"> 46</span></a><span class="sd">        If True, the target directory &#39;./processed&#39; will be cleared before use. Default is True.</span>
</span><span id="Clustering-47"><a href="#Clustering-47"><span class="linenos"> 47</span></a>
</span><span id="Clustering-48"><a href="#Clustering-48"><span class="linenos"> 48</span></a><span class="sd">    Attributes</span>
</span><span id="Clustering-49"><a href="#Clustering-49"><span class="linenos"> 49</span></a><span class="sd">    ----------</span>
</span><span id="Clustering-50"><a href="#Clustering-50"><span class="linenos"> 50</span></a><span class="sd">    df : pandas.DataFrame</span>
</span><span id="Clustering-51"><a href="#Clustering-51"><span class="linenos"> 51</span></a><span class="sd">        The working DataFrame, either copied or referenced.</span>
</span><span id="Clustering-52"><a href="#Clustering-52"><span class="linenos"> 52</span></a><span class="sd">    num_clusters : int</span>
</span><span id="Clustering-53"><a href="#Clustering-53"><span class="linenos"> 53</span></a><span class="sd">        Number of clusters found (excluding noise).</span>
</span><span id="Clustering-54"><a href="#Clustering-54"><span class="linenos"> 54</span></a><span class="sd">    labels : list of int</span>
</span><span id="Clustering-55"><a href="#Clustering-55"><span class="linenos"> 55</span></a><span class="sd">        Cluster labels assigned by HDBSCAN (-1 indicates noise).</span>
</span><span id="Clustering-56"><a href="#Clustering-56"><span class="linenos"> 56</span></a><span class="sd">    dir : str</span>
</span><span id="Clustering-57"><a href="#Clustering-57"><span class="linenos"> 57</span></a><span class="sd">        Directory path where clustered files will be organized (default is &#39;./processed&#39;).</span>
</span><span id="Clustering-58"><a href="#Clustering-58"><span class="linenos"> 58</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Clustering-59"><a href="#Clustering-59"><span class="linenos"> 59</span></a>
</span><span id="Clustering-60"><a href="#Clustering-60"><span class="linenos"> 60</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Clustering-61"><a href="#Clustering-61"><span class="linenos"> 61</span></a>
</span><span id="Clustering-62"><a href="#Clustering-62"><span class="linenos"> 62</span></a>        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
</span><span id="Clustering-63"><a href="#Clustering-63"><span class="linenos"> 63</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Clustering-64"><a href="#Clustering-64"><span class="linenos"> 64</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Clustering-65"><a href="#Clustering-65"><span class="linenos"> 65</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="Clustering-66"><a href="#Clustering-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_clusters</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Clustering-67"><a href="#Clustering-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Clustering-68"><a href="#Clustering-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="s1">&#39;./processed&#39;</span>
</span><span id="Clustering-69"><a href="#Clustering-69"><span class="linenos"> 69</span></a>        <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">preparing_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="n">clear</span><span class="p">)</span>
</span><span id="Clustering-70"><a href="#Clustering-70"><span class="linenos"> 70</span></a>
</span><span id="Clustering-71"><a href="#Clustering-71"><span class="linenos"> 71</span></a>
</span><span id="Clustering-72"><a href="#Clustering-72"><span class="linenos"> 72</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clustering_HDBSCAN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="Clustering-73"><a href="#Clustering-73"><span class="linenos"> 73</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Clustering-74"><a href="#Clustering-74"><span class="linenos"> 74</span></a><span class="sd">        Applies HDBSCAN clustering to the given feature matrix.</span>
</span><span id="Clustering-75"><a href="#Clustering-75"><span class="linenos"> 75</span></a>
</span><span id="Clustering-76"><a href="#Clustering-76"><span class="linenos"> 76</span></a><span class="sd">        Parameters</span>
</span><span id="Clustering-77"><a href="#Clustering-77"><span class="linenos"> 77</span></a><span class="sd">        ----------</span>
</span><span id="Clustering-78"><a href="#Clustering-78"><span class="linenos"> 78</span></a><span class="sd">        df : pandas.DataFrame or numpy.ndarray</span>
</span><span id="Clustering-79"><a href="#Clustering-79"><span class="linenos"> 79</span></a><span class="sd">            Feature matrix with shape (n_samples, n_features).</span>
</span><span id="Clustering-80"><a href="#Clustering-80"><span class="linenos"> 80</span></a>
</span><span id="Clustering-81"><a href="#Clustering-81"><span class="linenos"> 81</span></a><span class="sd">        Returns</span>
</span><span id="Clustering-82"><a href="#Clustering-82"><span class="linenos"> 82</span></a><span class="sd">        -------</span>
</span><span id="Clustering-83"><a href="#Clustering-83"><span class="linenos"> 83</span></a><span class="sd">        labels : numpy.ndarray</span>
</span><span id="Clustering-84"><a href="#Clustering-84"><span class="linenos"> 84</span></a><span class="sd">            Array of cluster labels for each sample (-1 indicates noise).</span>
</span><span id="Clustering-85"><a href="#Clustering-85"><span class="linenos"> 85</span></a><span class="sd">        num_clusters : int</span>
</span><span id="Clustering-86"><a href="#Clustering-86"><span class="linenos"> 86</span></a><span class="sd">            Number of clusters detected (excluding noise).</span>
</span><span id="Clustering-87"><a href="#Clustering-87"><span class="linenos"> 87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Clustering-88"><a href="#Clustering-88"><span class="linenos"> 88</span></a>        
</span><span id="Clustering-89"><a href="#Clustering-89"><span class="linenos"> 89</span></a>        <span class="n">clusterer</span> <span class="o">=</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">)</span>
</span><span id="Clustering-90"><a href="#Clustering-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">clusterer</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="Clustering-91"><a href="#Clustering-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Clustering-92"><a href="#Clustering-92"><span class="linenos"> 92</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_clusters</span>
</span><span id="Clustering-93"><a href="#Clustering-93"><span class="linenos"> 93</span></a>    
</span><span id="Clustering-94"><a href="#Clustering-94"><span class="linenos"> 94</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Clustering-95"><a href="#Clustering-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Clustering-96"><a href="#Clustering-96"><span class="linenos"> 96</span></a><span class="sd">        Inserts the cluster labels into the internal DataFrame as a new column &#39;label&#39;.</span>
</span><span id="Clustering-97"><a href="#Clustering-97"><span class="linenos"> 97</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Clustering-98"><a href="#Clustering-98"><span class="linenos"> 98</span></a>
</span><span id="Clustering-99"><a href="#Clustering-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
</span><span id="Clustering-100"><a href="#Clustering-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span><span id="Clustering-101"><a href="#Clustering-101"><span class="linenos">101</span></a>
</span><span id="Clustering-102"><a href="#Clustering-102"><span class="linenos">102</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Clustering-103"><a href="#Clustering-103"><span class="linenos">103</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Clustering-104"><a href="#Clustering-104"><span class="linenos">104</span></a><span class="sd">        Creates output directories for each cluster and a separate one for noise.</span>
</span><span id="Clustering-105"><a href="#Clustering-105"><span class="linenos">105</span></a><span class="sd">        The directories are created under `self.dir` if they do not already exist.</span>
</span><span id="Clustering-106"><a href="#Clustering-106"><span class="linenos">106</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Clustering-107"><a href="#Clustering-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">):</span>
</span><span id="Clustering-108"><a href="#Clustering-108"><span class="linenos">108</span></a>            <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_clusters</span><span class="p">):</span>
</span><span id="Clustering-109"><a href="#Clustering-109"><span class="linenos">109</span></a>                <span class="n">dir_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="s1">&#39;/label_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</span><span id="Clustering-110"><a href="#Clustering-110"><span class="linenos">110</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dir_name</span><span class="p">):</span>
</span><span id="Clustering-111"><a href="#Clustering-111"><span class="linenos">111</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
</span><span id="Clustering-112"><a href="#Clustering-112"><span class="linenos">112</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="s1">&#39;/noise&#39;</span><span class="p">):</span>
</span><span id="Clustering-113"><a href="#Clustering-113"><span class="linenos">113</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="s1">&#39;/noise&#39;</span><span class="p">)</span>
</span><span id="Clustering-114"><a href="#Clustering-114"><span class="linenos">114</span></a>
</span><span id="Clustering-115"><a href="#Clustering-115"><span class="linenos">115</span></a>
</span><span id="Clustering-116"><a href="#Clustering-116"><span class="linenos">116</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_newpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Clustering-117"><a href="#Clustering-117"><span class="linenos">117</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Clustering-118"><a href="#Clustering-118"><span class="linenos">118</span></a><span class="sd">        Assigns new output paths for each sample in the DataFrame based on their cluster label.</span>
</span><span id="Clustering-119"><a href="#Clustering-119"><span class="linenos">119</span></a><span class="sd">        Clustered samples go to &#39;./processed/label_&lt;cluster&gt;&#39;, noise samples go to &#39;./processed/noise&#39;.</span>
</span><span id="Clustering-120"><a href="#Clustering-120"><span class="linenos">120</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Clustering-121"><a href="#Clustering-121"><span class="linenos">121</span></a>         
</span><span id="Clustering-122"><a href="#Clustering-122"><span class="linenos">122</span></a>        <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_clusters</span><span class="p">):</span>
</span><span id="Clustering-123"><a href="#Clustering-123"><span class="linenos">123</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cl</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;./processed/label_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</span><span id="Clustering-124"><a href="#Clustering-124"><span class="linenos">124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;./processed/noise&#39;</span>
</span><span id="Clustering-125"><a href="#Clustering-125"><span class="linenos">125</span></a>
</span><span id="Clustering-126"><a href="#Clustering-126"><span class="linenos">126</span></a>
</span><span id="Clustering-127"><a href="#Clustering-127"><span class="linenos">127</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">copy_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Clustering-128"><a href="#Clustering-128"><span class="linenos">128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Clustering-129"><a href="#Clustering-129"><span class="linenos">129</span></a><span class="sd">        Copies image files from their original locations (&#39;oldpath&#39;) to the new cluster-assigned directories (&#39;path&#39;).</span>
</span><span id="Clustering-130"><a href="#Clustering-130"><span class="linenos">130</span></a>
</span><span id="Clustering-131"><a href="#Clustering-131"><span class="linenos">131</span></a><span class="sd">        Skips rows where either path is missing or not a string. Errors are printed but do not interrupt execution.</span>
</span><span id="Clustering-132"><a href="#Clustering-132"><span class="linenos">132</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Clustering-133"><a href="#Clustering-133"><span class="linenos">133</span></a>
</span><span id="Clustering-134"><a href="#Clustering-134"><span class="linenos">134</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Clustering-135"><a href="#Clustering-135"><span class="linenos">135</span></a>            <span class="n">oldpath</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;oldpath&#39;</span><span class="p">]</span>
</span><span id="Clustering-136"><a href="#Clustering-136"><span class="linenos">136</span></a>            <span class="n">newpath</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
</span><span id="Clustering-137"><a href="#Clustering-137"><span class="linenos">137</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oldpath</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newpath</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Clustering-138"><a href="#Clustering-138"><span class="linenos">138</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Clustering-139"><a href="#Clustering-139"><span class="linenos">139</span></a>                    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;cp&#39;</span><span class="p">,</span> <span class="s1">&#39;-u&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;oldpath&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Clustering-140"><a href="#Clustering-140"><span class="linenos">140</span></a>                <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Clustering-141"><a href="#Clustering-141"><span class="linenos">141</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error during copying </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;oldpath&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Clustering-142"><a href="#Clustering-142"><span class="linenos">142</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Clustering-143"><a href="#Clustering-143"><span class="linenos">143</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Probably missing path </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">: oldpath=</span><span class="si">{</span><span class="n">oldpath</span><span class="si">}</span><span class="s1">, path=</span><span class="si">{</span><span class="n">newpath</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Clustering-144"><a href="#Clustering-144"><span class="linenos">144</span></a>        
</span><span id="Clustering-145"><a href="#Clustering-145"><span class="linenos">145</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sort_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Clustering-146"><a href="#Clustering-146"><span class="linenos">146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Clustering-147"><a href="#Clustering-147"><span class="linenos">147</span></a><span class="sd">        Organizes image files into directories by cluster.</span>
</span><span id="Clustering-148"><a href="#Clustering-148"><span class="linenos">148</span></a>
</span><span id="Clustering-149"><a href="#Clustering-149"><span class="linenos">149</span></a><span class="sd">        This method:</span>
</span><span id="Clustering-150"><a href="#Clustering-150"><span class="linenos">150</span></a><span class="sd">        - Creates cluster directories</span>
</span><span id="Clustering-151"><a href="#Clustering-151"><span class="linenos">151</span></a><span class="sd">        - Assigns new file paths</span>
</span><span id="Clustering-152"><a href="#Clustering-152"><span class="linenos">152</span></a><span class="sd">        - Copies files to new locations</span>
</span><span id="Clustering-153"><a href="#Clustering-153"><span class="linenos">153</span></a><span class="sd">        - Removes the &#39;oldpath&#39; column from the DataFrame</span>
</span><span id="Clustering-154"><a href="#Clustering-154"><span class="linenos">154</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Clustering-155"><a href="#Clustering-155"><span class="linenos">155</span></a>
</span><span id="Clustering-156"><a href="#Clustering-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_dirs</span><span class="p">()</span>
</span><span id="Clustering-157"><a href="#Clustering-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_newpath</span><span class="p">()</span>
</span><span id="Clustering-158"><a href="#Clustering-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">copy_files</span><span class="p">()</span>
</span><span id="Clustering-159"><a href="#Clustering-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;oldpath&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Clustering-160"><a href="#Clustering-160"><span class="linenos">160</span></a>
</span><span id="Clustering-161"><a href="#Clustering-161"><span class="linenos">161</span></a>
</span><span id="Clustering-162"><a href="#Clustering-162"><span class="linenos">162</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualize_HDBSCAN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="Clustering-163"><a href="#Clustering-163"><span class="linenos">163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Clustering-164"><a href="#Clustering-164"><span class="linenos">164</span></a><span class="sd">        Reduces the feature space to 2D using PCA + UMAP, applies HDBSCAN clustering, and plots the results.</span>
</span><span id="Clustering-165"><a href="#Clustering-165"><span class="linenos">165</span></a>
</span><span id="Clustering-166"><a href="#Clustering-166"><span class="linenos">166</span></a><span class="sd">        Parameters</span>
</span><span id="Clustering-167"><a href="#Clustering-167"><span class="linenos">167</span></a><span class="sd">        ----------</span>
</span><span id="Clustering-168"><a href="#Clustering-168"><span class="linenos">168</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="Clustering-169"><a href="#Clustering-169"><span class="linenos">169</span></a><span class="sd">            Input DataFrame containing features and metadata.</span>
</span><span id="Clustering-170"><a href="#Clustering-170"><span class="linenos">170</span></a>
</span><span id="Clustering-171"><a href="#Clustering-171"><span class="linenos">171</span></a><span class="sd">        Saves</span>
</span><span id="Clustering-172"><a href="#Clustering-172"><span class="linenos">172</span></a><span class="sd">        -----</span>
</span><span id="Clustering-173"><a href="#Clustering-173"><span class="linenos">173</span></a><span class="sd">        &#39;./figures/clusterization_triggered.pdf&#39; : PDF version of the cluster plot</span>
</span><span id="Clustering-174"><a href="#Clustering-174"><span class="linenos">174</span></a><span class="sd">        &#39;./figures/clusterization_triggered.png&#39; : PNG version (300 DPI)</span>
</span><span id="Clustering-175"><a href="#Clustering-175"><span class="linenos">175</span></a>
</span><span id="Clustering-176"><a href="#Clustering-176"><span class="linenos">176</span></a><span class="sd">        Shows</span>
</span><span id="Clustering-177"><a href="#Clustering-177"><span class="linenos">177</span></a><span class="sd">        -----</span>
</span><span id="Clustering-178"><a href="#Clustering-178"><span class="linenos">178</span></a><span class="sd">        A scatter plot of the clustered data with noise in gray and clusters in color.</span>
</span><span id="Clustering-179"><a href="#Clustering-179"><span class="linenos">179</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Clustering-180"><a href="#Clustering-180"><span class="linenos">180</span></a>        
</span><span id="Clustering-181"><a href="#Clustering-181"><span class="linenos">181</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="Clustering-182"><a href="#Clustering-182"><span class="linenos">182</span></a>        <span class="n">features_processed</span> <span class="o">=</span> <span class="n">FeaturesPreprocessing</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">preproccessing</span><span class="p">(</span><span class="n">df_features</span><span class="p">,</span> <span class="s1">&#39;PCA+UMAP2D&#39;</span><span class="p">)</span>
</span><span id="Clustering-183"><a href="#Clustering-183"><span class="linenos">183</span></a>        <span class="n">labels</span><span class="p">,</span> <span class="n">n_clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clustering_HDBSCAN</span><span class="p">(</span><span class="n">features_processed</span><span class="p">)</span>
</span><span id="Clustering-184"><a href="#Clustering-184"><span class="linenos">184</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found </span><span class="si">{</span><span class="n">n_clusters</span><span class="si">}</span><span class="s1"> clusters (2D)&#39;</span><span class="p">)</span>
</span><span id="Clustering-185"><a href="#Clustering-185"><span class="linenos">185</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</span><span id="Clustering-186"><a href="#Clustering-186"><span class="linenos">186</span></a>        <span class="n">palette</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;tab10&#39;</span><span class="p">)</span>
</span><span id="Clustering-187"><a href="#Clustering-187"><span class="linenos">187</span></a>
</span><span id="Clustering-188"><a href="#Clustering-188"><span class="linenos">188</span></a>        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
</span><span id="Clustering-189"><a href="#Clustering-189"><span class="linenos">189</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">labels</span> <span class="o">==</span> <span class="n">label</span>
</span><span id="Clustering-190"><a href="#Clustering-190"><span class="linenos">190</span></a>            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span> <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">palette</span><span class="p">(</span><span class="n">label</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="Clustering-191"><a href="#Clustering-191"><span class="linenos">191</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">features_processed</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">features_processed</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Cluster </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">label</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;Noise&#39;</span><span class="p">)</span>
</span><span id="Clustering-192"><a href="#Clustering-192"><span class="linenos">192</span></a>
</span><span id="Clustering-193"><a href="#Clustering-193"><span class="linenos">193</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="Clustering-194"><a href="#Clustering-194"><span class="linenos">194</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PCA + UMAP2D + HDBSCAN: clustering visualization&#39;</span><span class="p">)</span>
</span><span id="Clustering-195"><a href="#Clustering-195"><span class="linenos">195</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;UMAP-1 component&#39;</span><span class="p">)</span>
</span><span id="Clustering-196"><a href="#Clustering-196"><span class="linenos">196</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;UMAP-2  component&#39;</span><span class="p">)</span>
</span><span id="Clustering-197"><a href="#Clustering-197"><span class="linenos">197</span></a>        
</span><span id="Clustering-198"><a href="#Clustering-198"><span class="linenos">198</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;./figures&#39;</span><span class="p">):</span>
</span><span id="Clustering-199"><a href="#Clustering-199"><span class="linenos">199</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;./figures&#39;</span><span class="p">)</span>
</span><span id="Clustering-200"><a href="#Clustering-200"><span class="linenos">200</span></a>
</span><span id="Clustering-201"><a href="#Clustering-201"><span class="linenos">201</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/clusterization_triggered.pdf&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
</span><span id="Clustering-202"><a href="#Clustering-202"><span class="linenos">202</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/clusterization_triggered.png&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span><span id="Clustering-203"><a href="#Clustering-203"><span class="linenos">203</span></a>
</span><span id="Clustering-204"><a href="#Clustering-204"><span class="linenos">204</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Performs HDBSCAN clustering on a feature dataset and manages file sorting and visualization.</p>

<p>This class supports unsupervised clustering using the HDBSCAN algorithm,
updates the associated feature database with labels, and organizes files
into directories based on cluster assignments. It also includes tools for
cluster visualization using PCA and UMAP.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong> (pandas.DataFrame):
Input feature DataFrame containing at least 'oldpath' and feature columns.</li>
<li><strong>copy</strong> (bool, optional):
If True, the input DataFrame is copied internally. Default is False.</li>
<li><strong>clear</strong> (bool, optional):
If True, the target directory './processed' will be cleared before use. Default is True.</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>df</strong> (pandas.DataFrame):
The working DataFrame, either copied or referenced.</li>
<li><strong>num_clusters</strong> (int):
Number of clusters found (excluding noise).</li>
<li><strong>labels</strong> (list of int):
Cluster labels assigned by HDBSCAN (-1 indicates noise).</li>
<li><strong>dir</strong> (str):
Directory path where clustered files will be organized (default is './processed').</li>
</ul>
</div>


                            <div id="Clustering.__init__" class="classattr">
                                        <input id="Clustering.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Clustering</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">df</span>, </span><span class="param"><span class="n">copy</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="n">clear</span><span class="o">=</span><span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="Clustering.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Clustering.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Clustering.__init__-60"><a href="#Clustering.__init__-60"><span class="linenos">60</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Clustering.__init__-61"><a href="#Clustering.__init__-61"><span class="linenos">61</span></a>
</span><span id="Clustering.__init__-62"><a href="#Clustering.__init__-62"><span class="linenos">62</span></a>        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
</span><span id="Clustering.__init__-63"><a href="#Clustering.__init__-63"><span class="linenos">63</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Clustering.__init__-64"><a href="#Clustering.__init__-64"><span class="linenos">64</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Clustering.__init__-65"><a href="#Clustering.__init__-65"><span class="linenos">65</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="Clustering.__init__-66"><a href="#Clustering.__init__-66"><span class="linenos">66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_clusters</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Clustering.__init__-67"><a href="#Clustering.__init__-67"><span class="linenos">67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Clustering.__init__-68"><a href="#Clustering.__init__-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dir</span> <span class="o">=</span> <span class="s1">&#39;./processed&#39;</span>
</span><span id="Clustering.__init__-69"><a href="#Clustering.__init__-69"><span class="linenos">69</span></a>        <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">preparing_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="n">clear</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Clustering.num_clusters" class="classattr">
                                <div class="attr variable">
            <span class="name">num_clusters</span>

        
    </div>
    <a class="headerlink" href="#Clustering.num_clusters"></a>
    
    

                            </div>
                            <div id="Clustering.labels" class="classattr">
                                <div class="attr variable">
            <span class="name">labels</span>

        
    </div>
    <a class="headerlink" href="#Clustering.labels"></a>
    
    

                            </div>
                            <div id="Clustering.dir" class="classattr">
                                <div class="attr variable">
            <span class="name">dir</span>

        
    </div>
    <a class="headerlink" href="#Clustering.dir"></a>
    
    

                            </div>
                            <div id="Clustering.clustering_HDBSCAN" class="classattr">
                                        <input id="Clustering.clustering_HDBSCAN-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clustering_HDBSCAN</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Clustering.clustering_HDBSCAN-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Clustering.clustering_HDBSCAN"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Clustering.clustering_HDBSCAN-72"><a href="#Clustering.clustering_HDBSCAN-72"><span class="linenos">72</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clustering_HDBSCAN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="Clustering.clustering_HDBSCAN-73"><a href="#Clustering.clustering_HDBSCAN-73"><span class="linenos">73</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Clustering.clustering_HDBSCAN-74"><a href="#Clustering.clustering_HDBSCAN-74"><span class="linenos">74</span></a><span class="sd">        Applies HDBSCAN clustering to the given feature matrix.</span>
</span><span id="Clustering.clustering_HDBSCAN-75"><a href="#Clustering.clustering_HDBSCAN-75"><span class="linenos">75</span></a>
</span><span id="Clustering.clustering_HDBSCAN-76"><a href="#Clustering.clustering_HDBSCAN-76"><span class="linenos">76</span></a><span class="sd">        Parameters</span>
</span><span id="Clustering.clustering_HDBSCAN-77"><a href="#Clustering.clustering_HDBSCAN-77"><span class="linenos">77</span></a><span class="sd">        ----------</span>
</span><span id="Clustering.clustering_HDBSCAN-78"><a href="#Clustering.clustering_HDBSCAN-78"><span class="linenos">78</span></a><span class="sd">        df : pandas.DataFrame or numpy.ndarray</span>
</span><span id="Clustering.clustering_HDBSCAN-79"><a href="#Clustering.clustering_HDBSCAN-79"><span class="linenos">79</span></a><span class="sd">            Feature matrix with shape (n_samples, n_features).</span>
</span><span id="Clustering.clustering_HDBSCAN-80"><a href="#Clustering.clustering_HDBSCAN-80"><span class="linenos">80</span></a>
</span><span id="Clustering.clustering_HDBSCAN-81"><a href="#Clustering.clustering_HDBSCAN-81"><span class="linenos">81</span></a><span class="sd">        Returns</span>
</span><span id="Clustering.clustering_HDBSCAN-82"><a href="#Clustering.clustering_HDBSCAN-82"><span class="linenos">82</span></a><span class="sd">        -------</span>
</span><span id="Clustering.clustering_HDBSCAN-83"><a href="#Clustering.clustering_HDBSCAN-83"><span class="linenos">83</span></a><span class="sd">        labels : numpy.ndarray</span>
</span><span id="Clustering.clustering_HDBSCAN-84"><a href="#Clustering.clustering_HDBSCAN-84"><span class="linenos">84</span></a><span class="sd">            Array of cluster labels for each sample (-1 indicates noise).</span>
</span><span id="Clustering.clustering_HDBSCAN-85"><a href="#Clustering.clustering_HDBSCAN-85"><span class="linenos">85</span></a><span class="sd">        num_clusters : int</span>
</span><span id="Clustering.clustering_HDBSCAN-86"><a href="#Clustering.clustering_HDBSCAN-86"><span class="linenos">86</span></a><span class="sd">            Number of clusters detected (excluding noise).</span>
</span><span id="Clustering.clustering_HDBSCAN-87"><a href="#Clustering.clustering_HDBSCAN-87"><span class="linenos">87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Clustering.clustering_HDBSCAN-88"><a href="#Clustering.clustering_HDBSCAN-88"><span class="linenos">88</span></a>        
</span><span id="Clustering.clustering_HDBSCAN-89"><a href="#Clustering.clustering_HDBSCAN-89"><span class="linenos">89</span></a>        <span class="n">clusterer</span> <span class="o">=</span> <span class="n">hdbscan</span><span class="o">.</span><span class="n">HDBSCAN</span><span class="p">(</span><span class="n">min_cluster_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">)</span>
</span><span id="Clustering.clustering_HDBSCAN-90"><a href="#Clustering.clustering_HDBSCAN-90"><span class="linenos">90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">clusterer</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="Clustering.clustering_HDBSCAN-91"><a href="#Clustering.clustering_HDBSCAN-91"><span class="linenos">91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Clustering.clustering_HDBSCAN-92"><a href="#Clustering.clustering_HDBSCAN-92"><span class="linenos">92</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_clusters</span>
</span></pre></div>


            <div class="docstring"><p>Applies HDBSCAN clustering to the given feature matrix.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong> (pandas.DataFrame or numpy.ndarray):
Feature matrix with shape (n_samples, n_features).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>labels</strong> (numpy.ndarray):
Array of cluster labels for each sample (-1 indicates noise).</li>
<li><strong>num_clusters</strong> (int):
Number of clusters detected (excluding noise).</li>
</ul>
</div>


                            </div>
                            <div id="Clustering.update_database" class="classattr">
                                        <input id="Clustering.update_database-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_database</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Clustering.update_database-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Clustering.update_database"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Clustering.update_database-94"><a href="#Clustering.update_database-94"><span class="linenos"> 94</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Clustering.update_database-95"><a href="#Clustering.update_database-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Clustering.update_database-96"><a href="#Clustering.update_database-96"><span class="linenos"> 96</span></a><span class="sd">        Inserts the cluster labels into the internal DataFrame as a new column &#39;label&#39;.</span>
</span><span id="Clustering.update_database-97"><a href="#Clustering.update_database-97"><span class="linenos"> 97</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Clustering.update_database-98"><a href="#Clustering.update_database-98"><span class="linenos"> 98</span></a>
</span><span id="Clustering.update_database-99"><a href="#Clustering.update_database-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
</span><span id="Clustering.update_database-100"><a href="#Clustering.update_database-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Inserts the cluster labels into the internal DataFrame as a new column 'label'.</p>
</div>


                            </div>
                            <div id="Clustering.create_dirs" class="classattr">
                                        <input id="Clustering.create_dirs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_dirs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Clustering.create_dirs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Clustering.create_dirs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Clustering.create_dirs-102"><a href="#Clustering.create_dirs-102"><span class="linenos">102</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Clustering.create_dirs-103"><a href="#Clustering.create_dirs-103"><span class="linenos">103</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Clustering.create_dirs-104"><a href="#Clustering.create_dirs-104"><span class="linenos">104</span></a><span class="sd">        Creates output directories for each cluster and a separate one for noise.</span>
</span><span id="Clustering.create_dirs-105"><a href="#Clustering.create_dirs-105"><span class="linenos">105</span></a><span class="sd">        The directories are created under `self.dir` if they do not already exist.</span>
</span><span id="Clustering.create_dirs-106"><a href="#Clustering.create_dirs-106"><span class="linenos">106</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Clustering.create_dirs-107"><a href="#Clustering.create_dirs-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="p">):</span>
</span><span id="Clustering.create_dirs-108"><a href="#Clustering.create_dirs-108"><span class="linenos">108</span></a>            <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_clusters</span><span class="p">):</span>
</span><span id="Clustering.create_dirs-109"><a href="#Clustering.create_dirs-109"><span class="linenos">109</span></a>                <span class="n">dir_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="s1">&#39;/label_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</span><span id="Clustering.create_dirs-110"><a href="#Clustering.create_dirs-110"><span class="linenos">110</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dir_name</span><span class="p">):</span>
</span><span id="Clustering.create_dirs-111"><a href="#Clustering.create_dirs-111"><span class="linenos">111</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
</span><span id="Clustering.create_dirs-112"><a href="#Clustering.create_dirs-112"><span class="linenos">112</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="s1">&#39;/noise&#39;</span><span class="p">):</span>
</span><span id="Clustering.create_dirs-113"><a href="#Clustering.create_dirs-113"><span class="linenos">113</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dir</span><span class="o">+</span><span class="s1">&#39;/noise&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Creates output directories for each cluster and a separate one for noise.
The directories are created under <code>self.dir</code> if they do not already exist.</p>
</div>


                            </div>
                            <div id="Clustering.create_newpath" class="classattr">
                                        <input id="Clustering.create_newpath-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_newpath</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Clustering.create_newpath-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Clustering.create_newpath"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Clustering.create_newpath-116"><a href="#Clustering.create_newpath-116"><span class="linenos">116</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_newpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Clustering.create_newpath-117"><a href="#Clustering.create_newpath-117"><span class="linenos">117</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Clustering.create_newpath-118"><a href="#Clustering.create_newpath-118"><span class="linenos">118</span></a><span class="sd">        Assigns new output paths for each sample in the DataFrame based on their cluster label.</span>
</span><span id="Clustering.create_newpath-119"><a href="#Clustering.create_newpath-119"><span class="linenos">119</span></a><span class="sd">        Clustered samples go to &#39;./processed/label_&lt;cluster&gt;&#39;, noise samples go to &#39;./processed/noise&#39;.</span>
</span><span id="Clustering.create_newpath-120"><a href="#Clustering.create_newpath-120"><span class="linenos">120</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Clustering.create_newpath-121"><a href="#Clustering.create_newpath-121"><span class="linenos">121</span></a>         
</span><span id="Clustering.create_newpath-122"><a href="#Clustering.create_newpath-122"><span class="linenos">122</span></a>        <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_clusters</span><span class="p">):</span>
</span><span id="Clustering.create_newpath-123"><a href="#Clustering.create_newpath-123"><span class="linenos">123</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cl</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;./processed/label_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</span><span id="Clustering.create_newpath-124"><a href="#Clustering.create_newpath-124"><span class="linenos">124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;./processed/noise&#39;</span>
</span></pre></div>


            <div class="docstring"><p>Assigns new output paths for each sample in the DataFrame based on their cluster label.
Clustered samples go to './processed/label_<cluster>', noise samples go to './processed/noise'.</p>
</div>


                            </div>
                            <div id="Clustering.copy_files" class="classattr">
                                        <input id="Clustering.copy_files-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">copy_files</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Clustering.copy_files-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Clustering.copy_files"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Clustering.copy_files-127"><a href="#Clustering.copy_files-127"><span class="linenos">127</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">copy_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Clustering.copy_files-128"><a href="#Clustering.copy_files-128"><span class="linenos">128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Clustering.copy_files-129"><a href="#Clustering.copy_files-129"><span class="linenos">129</span></a><span class="sd">        Copies image files from their original locations (&#39;oldpath&#39;) to the new cluster-assigned directories (&#39;path&#39;).</span>
</span><span id="Clustering.copy_files-130"><a href="#Clustering.copy_files-130"><span class="linenos">130</span></a>
</span><span id="Clustering.copy_files-131"><a href="#Clustering.copy_files-131"><span class="linenos">131</span></a><span class="sd">        Skips rows where either path is missing or not a string. Errors are printed but do not interrupt execution.</span>
</span><span id="Clustering.copy_files-132"><a href="#Clustering.copy_files-132"><span class="linenos">132</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Clustering.copy_files-133"><a href="#Clustering.copy_files-133"><span class="linenos">133</span></a>
</span><span id="Clustering.copy_files-134"><a href="#Clustering.copy_files-134"><span class="linenos">134</span></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="Clustering.copy_files-135"><a href="#Clustering.copy_files-135"><span class="linenos">135</span></a>            <span class="n">oldpath</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;oldpath&#39;</span><span class="p">]</span>
</span><span id="Clustering.copy_files-136"><a href="#Clustering.copy_files-136"><span class="linenos">136</span></a>            <span class="n">newpath</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
</span><span id="Clustering.copy_files-137"><a href="#Clustering.copy_files-137"><span class="linenos">137</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oldpath</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">newpath</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Clustering.copy_files-138"><a href="#Clustering.copy_files-138"><span class="linenos">138</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Clustering.copy_files-139"><a href="#Clustering.copy_files-139"><span class="linenos">139</span></a>                    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;cp&#39;</span><span class="p">,</span> <span class="s1">&#39;-u&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;oldpath&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Clustering.copy_files-140"><a href="#Clustering.copy_files-140"><span class="linenos">140</span></a>                <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Clustering.copy_files-141"><a href="#Clustering.copy_files-141"><span class="linenos">141</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error during copying </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;oldpath&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Clustering.copy_files-142"><a href="#Clustering.copy_files-142"><span class="linenos">142</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Clustering.copy_files-143"><a href="#Clustering.copy_files-143"><span class="linenos">143</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Probably missing path </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">: oldpath=</span><span class="si">{</span><span class="n">oldpath</span><span class="si">}</span><span class="s1">, path=</span><span class="si">{</span><span class="n">newpath</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Copies image files from their original locations ('oldpath') to the new cluster-assigned directories ('path').</p>

<p>Skips rows where either path is missing or not a string. Errors are printed but do not interrupt execution.</p>
</div>


                            </div>
                            <div id="Clustering.sort_files" class="classattr">
                                        <input id="Clustering.sort_files-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sort_files</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Clustering.sort_files-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Clustering.sort_files"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Clustering.sort_files-145"><a href="#Clustering.sort_files-145"><span class="linenos">145</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sort_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Clustering.sort_files-146"><a href="#Clustering.sort_files-146"><span class="linenos">146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Clustering.sort_files-147"><a href="#Clustering.sort_files-147"><span class="linenos">147</span></a><span class="sd">        Organizes image files into directories by cluster.</span>
</span><span id="Clustering.sort_files-148"><a href="#Clustering.sort_files-148"><span class="linenos">148</span></a>
</span><span id="Clustering.sort_files-149"><a href="#Clustering.sort_files-149"><span class="linenos">149</span></a><span class="sd">        This method:</span>
</span><span id="Clustering.sort_files-150"><a href="#Clustering.sort_files-150"><span class="linenos">150</span></a><span class="sd">        - Creates cluster directories</span>
</span><span id="Clustering.sort_files-151"><a href="#Clustering.sort_files-151"><span class="linenos">151</span></a><span class="sd">        - Assigns new file paths</span>
</span><span id="Clustering.sort_files-152"><a href="#Clustering.sort_files-152"><span class="linenos">152</span></a><span class="sd">        - Copies files to new locations</span>
</span><span id="Clustering.sort_files-153"><a href="#Clustering.sort_files-153"><span class="linenos">153</span></a><span class="sd">        - Removes the &#39;oldpath&#39; column from the DataFrame</span>
</span><span id="Clustering.sort_files-154"><a href="#Clustering.sort_files-154"><span class="linenos">154</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Clustering.sort_files-155"><a href="#Clustering.sort_files-155"><span class="linenos">155</span></a>
</span><span id="Clustering.sort_files-156"><a href="#Clustering.sort_files-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_dirs</span><span class="p">()</span>
</span><span id="Clustering.sort_files-157"><a href="#Clustering.sort_files-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_newpath</span><span class="p">()</span>
</span><span id="Clustering.sort_files-158"><a href="#Clustering.sort_files-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">copy_files</span><span class="p">()</span>
</span><span id="Clustering.sort_files-159"><a href="#Clustering.sort_files-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;oldpath&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Organizes image files into directories by cluster.</p>

<p>This method:</p>

<ul>
<li>Creates cluster directories</li>
<li>Assigns new file paths</li>
<li>Copies files to new locations</li>
<li>Removes the 'oldpath' column from the DataFrame</li>
</ul>
</div>


                            </div>
                            <div id="Clustering.visualize_HDBSCAN" class="classattr">
                                        <input id="Clustering.visualize_HDBSCAN-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">visualize_HDBSCAN</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">df</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Clustering.visualize_HDBSCAN-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Clustering.visualize_HDBSCAN"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Clustering.visualize_HDBSCAN-162"><a href="#Clustering.visualize_HDBSCAN-162"><span class="linenos">162</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualize_HDBSCAN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="Clustering.visualize_HDBSCAN-163"><a href="#Clustering.visualize_HDBSCAN-163"><span class="linenos">163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Clustering.visualize_HDBSCAN-164"><a href="#Clustering.visualize_HDBSCAN-164"><span class="linenos">164</span></a><span class="sd">        Reduces the feature space to 2D using PCA + UMAP, applies HDBSCAN clustering, and plots the results.</span>
</span><span id="Clustering.visualize_HDBSCAN-165"><a href="#Clustering.visualize_HDBSCAN-165"><span class="linenos">165</span></a>
</span><span id="Clustering.visualize_HDBSCAN-166"><a href="#Clustering.visualize_HDBSCAN-166"><span class="linenos">166</span></a><span class="sd">        Parameters</span>
</span><span id="Clustering.visualize_HDBSCAN-167"><a href="#Clustering.visualize_HDBSCAN-167"><span class="linenos">167</span></a><span class="sd">        ----------</span>
</span><span id="Clustering.visualize_HDBSCAN-168"><a href="#Clustering.visualize_HDBSCAN-168"><span class="linenos">168</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="Clustering.visualize_HDBSCAN-169"><a href="#Clustering.visualize_HDBSCAN-169"><span class="linenos">169</span></a><span class="sd">            Input DataFrame containing features and metadata.</span>
</span><span id="Clustering.visualize_HDBSCAN-170"><a href="#Clustering.visualize_HDBSCAN-170"><span class="linenos">170</span></a>
</span><span id="Clustering.visualize_HDBSCAN-171"><a href="#Clustering.visualize_HDBSCAN-171"><span class="linenos">171</span></a><span class="sd">        Saves</span>
</span><span id="Clustering.visualize_HDBSCAN-172"><a href="#Clustering.visualize_HDBSCAN-172"><span class="linenos">172</span></a><span class="sd">        -----</span>
</span><span id="Clustering.visualize_HDBSCAN-173"><a href="#Clustering.visualize_HDBSCAN-173"><span class="linenos">173</span></a><span class="sd">        &#39;./figures/clusterization_triggered.pdf&#39; : PDF version of the cluster plot</span>
</span><span id="Clustering.visualize_HDBSCAN-174"><a href="#Clustering.visualize_HDBSCAN-174"><span class="linenos">174</span></a><span class="sd">        &#39;./figures/clusterization_triggered.png&#39; : PNG version (300 DPI)</span>
</span><span id="Clustering.visualize_HDBSCAN-175"><a href="#Clustering.visualize_HDBSCAN-175"><span class="linenos">175</span></a>
</span><span id="Clustering.visualize_HDBSCAN-176"><a href="#Clustering.visualize_HDBSCAN-176"><span class="linenos">176</span></a><span class="sd">        Shows</span>
</span><span id="Clustering.visualize_HDBSCAN-177"><a href="#Clustering.visualize_HDBSCAN-177"><span class="linenos">177</span></a><span class="sd">        -----</span>
</span><span id="Clustering.visualize_HDBSCAN-178"><a href="#Clustering.visualize_HDBSCAN-178"><span class="linenos">178</span></a><span class="sd">        A scatter plot of the clustered data with noise in gray and clusters in color.</span>
</span><span id="Clustering.visualize_HDBSCAN-179"><a href="#Clustering.visualize_HDBSCAN-179"><span class="linenos">179</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Clustering.visualize_HDBSCAN-180"><a href="#Clustering.visualize_HDBSCAN-180"><span class="linenos">180</span></a>        
</span><span id="Clustering.visualize_HDBSCAN-181"><a href="#Clustering.visualize_HDBSCAN-181"><span class="linenos">181</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="Clustering.visualize_HDBSCAN-182"><a href="#Clustering.visualize_HDBSCAN-182"><span class="linenos">182</span></a>        <span class="n">features_processed</span> <span class="o">=</span> <span class="n">FeaturesPreprocessing</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">preproccessing</span><span class="p">(</span><span class="n">df_features</span><span class="p">,</span> <span class="s1">&#39;PCA+UMAP2D&#39;</span><span class="p">)</span>
</span><span id="Clustering.visualize_HDBSCAN-183"><a href="#Clustering.visualize_HDBSCAN-183"><span class="linenos">183</span></a>        <span class="n">labels</span><span class="p">,</span> <span class="n">n_clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clustering_HDBSCAN</span><span class="p">(</span><span class="n">features_processed</span><span class="p">)</span>
</span><span id="Clustering.visualize_HDBSCAN-184"><a href="#Clustering.visualize_HDBSCAN-184"><span class="linenos">184</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found </span><span class="si">{</span><span class="n">n_clusters</span><span class="si">}</span><span class="s1"> clusters (2D)&#39;</span><span class="p">)</span>
</span><span id="Clustering.visualize_HDBSCAN-185"><a href="#Clustering.visualize_HDBSCAN-185"><span class="linenos">185</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</span><span id="Clustering.visualize_HDBSCAN-186"><a href="#Clustering.visualize_HDBSCAN-186"><span class="linenos">186</span></a>        <span class="n">palette</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;tab10&#39;</span><span class="p">)</span>
</span><span id="Clustering.visualize_HDBSCAN-187"><a href="#Clustering.visualize_HDBSCAN-187"><span class="linenos">187</span></a>
</span><span id="Clustering.visualize_HDBSCAN-188"><a href="#Clustering.visualize_HDBSCAN-188"><span class="linenos">188</span></a>        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
</span><span id="Clustering.visualize_HDBSCAN-189"><a href="#Clustering.visualize_HDBSCAN-189"><span class="linenos">189</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">labels</span> <span class="o">==</span> <span class="n">label</span>
</span><span id="Clustering.visualize_HDBSCAN-190"><a href="#Clustering.visualize_HDBSCAN-190"><span class="linenos">190</span></a>            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span> <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">palette</span><span class="p">(</span><span class="n">label</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="Clustering.visualize_HDBSCAN-191"><a href="#Clustering.visualize_HDBSCAN-191"><span class="linenos">191</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">features_processed</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">features_processed</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Cluster </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">label</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;Noise&#39;</span><span class="p">)</span>
</span><span id="Clustering.visualize_HDBSCAN-192"><a href="#Clustering.visualize_HDBSCAN-192"><span class="linenos">192</span></a>
</span><span id="Clustering.visualize_HDBSCAN-193"><a href="#Clustering.visualize_HDBSCAN-193"><span class="linenos">193</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="Clustering.visualize_HDBSCAN-194"><a href="#Clustering.visualize_HDBSCAN-194"><span class="linenos">194</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PCA + UMAP2D + HDBSCAN: clustering visualization&#39;</span><span class="p">)</span>
</span><span id="Clustering.visualize_HDBSCAN-195"><a href="#Clustering.visualize_HDBSCAN-195"><span class="linenos">195</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;UMAP-1 component&#39;</span><span class="p">)</span>
</span><span id="Clustering.visualize_HDBSCAN-196"><a href="#Clustering.visualize_HDBSCAN-196"><span class="linenos">196</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;UMAP-2  component&#39;</span><span class="p">)</span>
</span><span id="Clustering.visualize_HDBSCAN-197"><a href="#Clustering.visualize_HDBSCAN-197"><span class="linenos">197</span></a>        
</span><span id="Clustering.visualize_HDBSCAN-198"><a href="#Clustering.visualize_HDBSCAN-198"><span class="linenos">198</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;./figures&#39;</span><span class="p">):</span>
</span><span id="Clustering.visualize_HDBSCAN-199"><a href="#Clustering.visualize_HDBSCAN-199"><span class="linenos">199</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;./figures&#39;</span><span class="p">)</span>
</span><span id="Clustering.visualize_HDBSCAN-200"><a href="#Clustering.visualize_HDBSCAN-200"><span class="linenos">200</span></a>
</span><span id="Clustering.visualize_HDBSCAN-201"><a href="#Clustering.visualize_HDBSCAN-201"><span class="linenos">201</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/clusterization_triggered.pdf&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
</span><span id="Clustering.visualize_HDBSCAN-202"><a href="#Clustering.visualize_HDBSCAN-202"><span class="linenos">202</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/clusterization_triggered.png&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span><span id="Clustering.visualize_HDBSCAN-203"><a href="#Clustering.visualize_HDBSCAN-203"><span class="linenos">203</span></a>
</span><span id="Clustering.visualize_HDBSCAN-204"><a href="#Clustering.visualize_HDBSCAN-204"><span class="linenos">204</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Reduces the feature space to 2D using PCA + UMAP, applies HDBSCAN clustering, and plots the results.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong> (pandas.DataFrame):
Input DataFrame containing features and metadata.</li>
</ul>

<h6 id="saves">Saves</h6>

<p>'./figures/clusterization_triggered.pdf' : PDF version of the cluster plot
'./figures/clusterization_triggered.png' : PNG version (300 DPI)</p>

<h6 id="shows">Shows</h6>

<p>A scatter plot of the clustered data with noise in gray and clusters in color.</p>
</div>


                            </div>
                </section>
    </main>
</body>
</html></section><hr>
<section id="libinteractive">
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>libinteractive API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#InteractiveMode">InteractiveMode</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#InteractiveMode.welcome_message">welcome_message</a>
                        </li>
                        <li>
                                <a class="function" href="#InteractiveMode.preparations">preparations</a>
                        </li>
                        <li>
                                <a class="function" href="#InteractiveMode.get_bool">get_bool</a>
                        </li>
                        <li>
                                <a class="function" href="#InteractiveMode.filter_mixed_freq">filter_mixed_freq</a>
                        </li>
                        <li>
                                <a class="function" href="#InteractiveMode.get_path">get_path</a>
                        </li>
                        <li>
                                <a class="function" href="#InteractiveMode.get_features">get_features</a>
                        </li>
                        <li>
                                <a class="function" href="#InteractiveMode.extract_features">extract_features</a>
                        </li>
                        <li>
                                <a class="function" href="#InteractiveMode.read_features">read_features</a>
                        </li>
                        <li>
                                <a class="function" href="#InteractiveMode.run_processing">run_processing</a>
                        </li>
                        <li>
                                <a class="function" href="#InteractiveMode.standard_algorithm">standard_algorithm</a>
                        </li>
                        <li>
                                <a class="function" href="#InteractiveMode.filtration">filtration</a>
                        </li>
                        <li>
                                <a class="function" href="#InteractiveMode.create_name_to_save">create_name_to_save</a>
                        </li>
                        <li>
                                <a class="function" href="#InteractiveMode.saving_database">saving_database</a>
                        </li>
                        <li>
                                <a class="function" href="#InteractiveMode.run_preprocessing">run_preprocessing</a>
                        </li>
                        <li>
                                <a class="function" href="#InteractiveMode.run_clusterization">run_clusterization</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
libinteractive    </h1>

                
                        <input id="mod-libinteractive-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-libinteractive-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1">#Copyright (c) 2025 Evgeniia VOLCHOK</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1">#for contacts e.p.volchok@gmail.com</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="c1">#Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="c1">#you may not use this file except in compliance with the License.</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="c1">#You may obtain a copy of the License at</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="c1">#http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">libpreprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">FeaturesPreprocessing</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">libclustering</span><span class="w"> </span><span class="kn">import</span> <span class="n">Clustering</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">libfeatures</span><span class="w"> </span><span class="kn">import</span> <span class="n">ResNetFeatures</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">libservice</span><span class="w"> </span><span class="kn">import</span> <span class="n">ServiceFuncs</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="k">class</span><span class="w"> </span><span class="nc">InteractiveMode</span><span class="p">:</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">    Provides a user-friendly interactive interface to the full pipeline of feature extraction,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">    preprocessing, clustering, and result saving.</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">    This class serves as a high-level command-line wrapper around the functionality defined</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">    in modules like `libfeatures`, `libpreprocessing`, and `libclustering`. It guides the</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">    user through a series of prompts to configure and execute data processing operations.</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    This class is not intended to be instantiated.</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;This class can not be instantiate.&#39;</span><span class="p">)</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>    
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">welcome_message</span><span class="p">():</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">        Prints a welcome message with initial instructions for placing image data.</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Welcome to the script! </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>        <span class="s1">&#39;First place your images in a separate folder (into &quot;./images/&quot;) named according to the template: </span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="s1">        &quot;images_(your_specification)&quot;&#39;</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">preparations</span><span class="p">():</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">        Prepares required working directories and gathers the users image folder name.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">        Returns</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">        -------</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">        input_imags : str</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">            Name of the user-specified image subdirectory.</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">        default_filename : str</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">            Suggested default filename for saving feature data.</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="n">base_dir_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;./images&#39;</span><span class="p">,</span> <span class="s1">&#39;./processed&#39;</span><span class="p">,</span> <span class="s1">&#39;./figures&#39;</span><span class="p">,</span> <span class="s1">&#39;./data&#39;</span><span class="p">,</span> <span class="s1">&#39;./results&#39;</span><span class="p">]</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Use &quot;./processed&quot; folder for processed images </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>        <span class="s1">&#39;&quot;./data&quot; folder for info metadata </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>        <span class="s1">&#39;&quot;./figures&quot; and &quot;./results&quot; for graphic and data results, respectively.&#39;</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="k">for</span> <span class="n">dirname</span> <span class="ow">in</span> <span class="n">base_dir_names</span><span class="p">:</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>            <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">preparing_folder</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="n">input_imags</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Please enter the name of your working directory: &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;./, &#39;</span><span class="p">)</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="n">specification</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">input_name</span><span class="p">(</span><span class="n">input_imags</span><span class="p">)</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="n">results_dir</span> <span class="o">=</span> <span class="s1">&#39;./processed/processed_&#39;</span><span class="o">+</span><span class="n">specification</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="n">default_filename</span> <span class="o">=</span> <span class="s1">&#39;./results/pearson_diagram_data_&#39;</span><span class="o">+</span><span class="n">specification</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>        <span class="n">clear</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">get_bool</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;If folder </span><span class="si">{</span><span class="n">results_dir</span><span class="si">}</span><span class="s1"> already exists would you like to clear its contents? (True or False) &#39;</span><span class="p">)</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">preparing_folder</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="n">clear</span><span class="p">)</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>        <span class="k">return</span> <span class="n">input_imags</span><span class="p">,</span> <span class="n">default_filename</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_bool</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span> 
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">        Prompts the user for a True/False response.</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">        Parameters</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">        ----------</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">        prompt : str</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">            Prompt text for user input.</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">        Returns</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">        -------</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">        bool</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">            Boolean interpretation of the user&#39;s input.</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">        Raises</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">        ------</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">        KeyError</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">            If input is not &#39;true&#39; or &#39;false&#39; (case-insensitive).</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>            
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>                <span class="n">answ</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>                <span class="k">if</span> <span class="n">answ</span><span class="p">:</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>                        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}[</span><span class="n">answ</span><span class="p">]</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>                    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid input, please enter True or False! </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>                    <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>            
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_mixed_freq</span><span class="p">(</span><span class="n">name_pattern</span><span class="p">):</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">        Asks the user whether to filter out mixed-frequency data.</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">        Parameters</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">        ----------</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">        name_pattern : str</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">            Default regular expression used to match dataset names.</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">        Returns</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">        -------</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">        filter_mixed : bool</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">            Whether to apply frequency filtering.</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">        name_pattern : str</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">            Possibly updated regex pattern provided by the user.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="n">filter_mixed</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">get_bool</span><span class="p">(</span><span class="s1">&#39;Would you like to filter mixed frequencies? (True or False) &#39;</span><span class="p">)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>        <span class="k">if</span> <span class="n">filter_mixed</span><span class="p">:</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Check the name pattern: </span><span class="si">{</span><span class="n">name_pattern</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>            <span class="n">np_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Change if it is needed or press &quot;Enter&quot;: &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>            <span class="k">if</span> <span class="n">np_input</span><span class="p">:</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>                <span class="n">name_pattern</span> <span class="o">=</span> <span class="n">np_input</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>        <span class="k">return</span> <span class="n">filter_mixed</span><span class="p">,</span> <span class="n">name_pattern</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>    
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_path</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">default_path</span><span class="p">):</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">        Gets a file path from the user, or uses the default if none is entered.</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">        Parameters</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">        ----------</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">        message : str</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">            Prompt for the user.</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">        default_path : str</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">            Default path to return if user provides no input.</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">        Returns</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">        -------</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">        str</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">            Final path.</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span> <span class="k">if</span> <span class="n">file_path</span> <span class="k">else</span> <span class="n">default_path</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="k">return</span> <span class="n">file_path</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>    
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_features</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">info_path</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">):</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">        Asks the user whether to extract new features or read from file.</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">        Parameters</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">        ----------</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">        input_imags : str</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">            Subdirectory name with image data.</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">        info_path : str</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">            Path to the metadata file.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">        default_filename : str</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">            Default base filename for feature data.</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">        name_pattern : str</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">            Regex pattern for identifying dataset names.</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">        Returns</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">        -------</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">        ResNetFeatures</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">            An instance of the ResNetFeatures class containing the loaded/extracted features.</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;To extract features from images located in </span><span class="si">{</span><span class="n">input_imags</span><span class="si">}</span><span class="s1"> enter 1. </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>                <span class="s1">&#39;To load features from a file enter 2.&#39;</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>                <span class="n">choice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;[1/2]: &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid input. Please enter 1 or 2.&quot;</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>                <span class="k">continue</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>            <span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>                <span class="n">features</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">info_path</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">)</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>                <span class="k">break</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>            <span class="k">elif</span> <span class="n">choice</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>                
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>                <span class="n">features</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">read_features</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">info_path</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>                <span class="k">break</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Invalid input. </span><span class="se">\n</span><span class="s1"> Try again!&#39;</span><span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="k">return</span> <span class="n">features</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>    
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_features</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">info_path</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">):</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">        Initializes feature extraction and saves them to file.</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">        Parameters</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">        ----------</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">        input_imags : str</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">            Folder containing images.</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">        info_path : str</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">            Path to the metadata file.</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">        default_filename : str</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">            Default file path for saving results.</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">        name_pattern : str</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">            Regex pattern for dataset name recognition.</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">        Returns</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">        -------</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">        ResNetFeatures</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">            Object containing the extracted feature database.</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Enter a file name to write extracted features (or press &quot;Enter&quot; for default &quot;</span><span class="si">{</span><span class="n">default_filename</span><span class="si">}</span><span class="s1">&quot;): &#39;</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>        <span class="n">file_to_write</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="n">filter_mixed</span><span class="p">,</span> <span class="n">name_pattern</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">filter_mixed_freq</span><span class="p">(</span><span class="n">name_pattern</span><span class="p">)</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Features extraction&#39;</span><span class="p">)</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="n">ResNetFeatures</span><span class="p">(</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>            <span class="n">path</span><span class="o">=</span><span class="s1">&#39;./images/&#39;</span> <span class="o">+</span> <span class="n">input_imags</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>            <span class="n">flag</span><span class="o">=</span><span class="s1">&#39;extract&#39;</span><span class="p">,</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>            <span class="n">info_path</span><span class="o">=</span><span class="n">info_path</span><span class="p">,</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>            <span class="n">filter_mixed</span><span class="o">=</span><span class="n">filter_mixed</span><span class="p">,</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>            <span class="n">name_pattern</span><span class="o">=</span><span class="n">name_pattern</span><span class="p">,</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>            <span class="n">extra_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;file_to_write&#39;</span><span class="p">:</span> <span class="n">file_to_write</span><span class="p">}</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="p">)</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="k">return</span> <span class="n">features</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>    
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read_features</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">info_path</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">):</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">        Loads previously saved feature data from a file.</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">        Parameters</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">        ----------</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">        input_imags : str</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">            Folder containing images.</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">        info_path : str</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">            Path to the metadata file.</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">        default_filename : str</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">            Default file path for loading.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">        name_pattern : str</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">            Regex pattern for dataset name recognition.</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">        Returns</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">        -------</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">        ResNetFeatures</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">            Object containing the loaded feature database.</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Enter a file name to read from (or press &quot;Enter&quot; for default &quot;</span><span class="si">{</span><span class="n">default_filename</span><span class="si">}</span><span class="s1">&quot;): &#39;</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="n">file_to_read</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">)</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="n">filter_mixed</span><span class="p">,</span> <span class="n">name_pattern</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">filter_mixed_freq</span><span class="p">(</span><span class="n">name_pattern</span><span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading features&#39;</span><span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="n">ResNetFeatures</span><span class="p">(</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="n">path</span><span class="o">=</span><span class="s1">&#39;./images/&#39;</span> <span class="o">+</span> <span class="n">input_imags</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="n">flag</span><span class="o">=</span><span class="s1">&#39;read&#39;</span><span class="p">,</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="n">info_path</span><span class="o">=</span><span class="n">info_path</span><span class="p">,</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>            <span class="n">filter_mixed</span><span class="o">=</span><span class="n">filter_mixed</span><span class="p">,</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>            <span class="n">name_pattern</span><span class="o">=</span><span class="n">name_pattern</span><span class="p">,</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>            <span class="n">extra_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;file_to_read&#39;</span><span class="p">:</span> <span class="n">file_to_read</span><span class="p">}</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="p">)</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>        <span class="k">return</span> <span class="n">features</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>    
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_processing</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">):</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">        Offers the user a choice between standard pipeline execution or custom steps.</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="sd">        Parameters</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">        ----------</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">        features : ResNetFeatures</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">            Feature database.</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">        default_filename : str</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">            Base name for saving intermediate or final results.</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Would you like to launch the standard processing algorithm (1) or </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>                    <span class="s1">&#39;to call separate blocks of processing manually (2)?&#39;</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>            <span class="n">num</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter 1 or 2 (or break to stop): &#39;</span><span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>            <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="s1">&#39;break&#39;</span><span class="p">:</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>                <span class="k">break</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>                    <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">standard_algorithm</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">)</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>                <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This part has not been implemented yet. Use 1 or break.&#39;</span><span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">standard_algorithm</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">):</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">        Executes the full default processing pipeline:</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">        1. Feature filtering by variance</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="sd">        2. Dimensionality reduction with PCA and UMAP</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">        3. Clustering with HDBSCAN</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">        4. Visualization</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">        Parameters</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">        ----------</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">        features : ResNetFeatures</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">            Input feature database object.</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">        default_filename : str</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">            Base filename for saving outputs.</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;The standard algorithm: </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>            <span class="s1">&#39;1. Filtration of ResNet features by variance, thershold=1e-5 </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>            <span class="s1">&#39;2. Preprocessing of the filtered features with </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>            <span class="s1">&#39;   - PCA(n_components=0.95, svd_solver=</span><span class="se">\&#39;</span><span class="s1">full</span><span class="se">\&#39;</span><span class="s1">) </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>            <span class="s1">&#39;   - UMAP(n_components=20, min_dist=0.1, metric=</span><span class="se">\&#39;</span><span class="s1">cosine</span><span class="se">\&#39;</span><span class="s1">) </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>            <span class="s1">&#39;3. Clusterization </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>            <span class="s1">&#39;- HDBSCAN(min_cluster_size=15, min_samples=5, metric=</span><span class="se">\&#39;</span><span class="s1">euclidean</span><span class="se">\&#39;</span><span class="s1">) </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>            <span class="s1">&#39;4. Visualization with PCA+UMAP2D+HDBSCAN&#39;</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>        
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">filtration</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Enter a file name to save the filtered data (or press &quot;Enter&quot; to use default name): &#39;</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">saving_database</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">suf</span><span class="o">=</span><span class="s1">&#39;_filtered&#39;</span><span class="p">)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="n">processed</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">run_preprocessing</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="s1">&#39;PCA+UMAPND&#39;</span><span class="p">)</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>        <span class="n">clusters</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">run_clusterization</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Enter a file name to save the clustered data (or press &quot;Enter&quot; to use default name): &#39;</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>        <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">saving_database</span><span class="p">(</span><span class="n">clusters</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">suf</span><span class="o">=</span><span class="s1">&#39;_clustered&#39;</span><span class="p">)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>        <span class="c1"># Visualization</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>        <span class="n">clusters</span><span class="o">.</span><span class="n">visualize_HDBSCAN</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filtration</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">        Applies variance-based filtering to the feature set.</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="sd">        Parameters</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">        ----------</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">        features : ResNetFeatures</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">            Input feature database.</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="sd">        Returns</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">        -------</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a><span class="sd">        ResNetFeatures</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="sd">            Filtered features with updated `.database`.</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filtration&#39;</span><span class="p">)</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>        <span class="n">features</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">filtering_by_variance</span><span class="p">()</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>        <span class="n">features</span><span class="o">.</span><span class="n">info_on_features</span><span class="p">()</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>        <span class="k">return</span> <span class="n">features</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>    
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_name_to_save</span><span class="p">(</span><span class="n">default_filename</span><span class="p">,</span> <span class="n">file_to_write</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">        Constructs a filename by combining a base name with a suffix.</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a><span class="sd">        Parameters</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">        ----------</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">        default_filename : str</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="sd">            Base filename.</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="sd">        file_to_write : str, optional</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">            Custom filename provided by the user.</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="sd">        suffix : str, optional</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">            Suffix to append to the filename.</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">        Returns</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">        -------</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">        str</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">            Full filename with optional suffix.</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_to_write</span><span class="p">:</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>            <span class="n">file_to_write</span> <span class="o">=</span> <span class="n">default_filename</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="k">if</span> <span class="n">suffix</span><span class="p">:</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>            <span class="n">file_to_write</span> <span class="o">+=</span> <span class="n">suffix</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="k">return</span> <span class="n">file_to_write</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>    
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">saving_database</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">suf</span><span class="p">):</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">        Prompts the user to save the DataFrame to a file with optional suffix.</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">        Parameters</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">        ----------</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">            Data to be saved.</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">        default_filename : str</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">            Default file base name.</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">        message : str</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">            Prompt shown to the user.</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">        suf : str</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">            Default suffix to append to the filename.</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>        <span class="n">file_to_write</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>        <span class="n">suffix</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;or/and enter a suffix to the filename: &#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">suf</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>        <span class="n">file_to_write</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">create_name_to_save</span><span class="p">(</span><span class="n">default_filename</span><span class="p">,</span> <span class="n">file_to_write</span><span class="o">=</span><span class="n">file_to_write</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">save_database</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">file_to_write</span><span class="o">=</span><span class="n">file_to_write</span><span class="p">)</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_preprocessing</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">pipe_str</span><span class="o">=</span><span class="s1">&#39;PCA+UMAPND&#39;</span><span class="p">):</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">        Applies a sequence of dimensionality reduction steps to the feature matrix.</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="sd">        Parameters</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a><span class="sd">        ----------</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">        features : ResNetFeatures</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">            The extracted and optionally filtered features.</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">        pipe_str : str, optional</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">            Pipeline specification string, e.g., &#39;PCA+UMAPND&#39;.</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">        Returns</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">        -------</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="sd">            Transformed feature DataFrame with original metadata preserved.</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Preprocessing&#39;</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>        <span class="n">preprop</span> <span class="o">=</span> <span class="n">FeaturesPreprocessing</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>        <span class="n">processed</span> <span class="o">=</span> <span class="n">preprop</span><span class="o">.</span><span class="n">wrapper_preprop</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="n">pipe_str</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>        <span class="k">return</span> <span class="n">processed</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>    
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_clusterization</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="sd">        Performs HDBSCAN clustering and sorts image files into corresponding folders.</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a><span class="sd">        Parameters</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="sd">        ----------</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a><span class="sd">        features : pandas.DataFrame</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a><span class="sd">            The feature matrix with metadata.</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="sd">        Returns</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="sd">        -------</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="sd">        Clustering</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">            Clustering object with updated label assignments and organized folders.</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Clusterization&#39;</span><span class="p">)</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>        <span class="n">clusters</span> <span class="o">=</span> <span class="n">Clustering</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">num_clusters</span> <span class="o">=</span> <span class="n">clusters</span><span class="o">.</span><span class="n">clustering_HDBSCAN</span><span class="p">(</span><span class="n">df_features</span><span class="p">)</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of clusters 20D: </span><span class="si">{</span><span class="n">num_clusters</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>        <span class="n">clusters</span><span class="o">.</span><span class="n">update_database</span><span class="p">()</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>        <span class="n">clusters</span><span class="o">.</span><span class="n">sort_files</span><span class="p">()</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>        <span class="k">return</span> <span class="n">clusters</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>        
</span></pre></div>


            </section>
                <section id="InteractiveMode">
                            <input id="InteractiveMode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">InteractiveMode</span>:

                <label class="view-source-button" for="InteractiveMode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InteractiveMode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InteractiveMode-15"><a href="#InteractiveMode-15"><span class="linenos"> 15</span></a><span class="k">class</span><span class="w"> </span><span class="nc">InteractiveMode</span><span class="p">:</span>
</span><span id="InteractiveMode-16"><a href="#InteractiveMode-16"><span class="linenos"> 16</span></a>
</span><span id="InteractiveMode-17"><a href="#InteractiveMode-17"><span class="linenos"> 17</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode-18"><a href="#InteractiveMode-18"><span class="linenos"> 18</span></a><span class="sd">    Provides a user-friendly interactive interface to the full pipeline of feature extraction,</span>
</span><span id="InteractiveMode-19"><a href="#InteractiveMode-19"><span class="linenos"> 19</span></a><span class="sd">    preprocessing, clustering, and result saving.</span>
</span><span id="InteractiveMode-20"><a href="#InteractiveMode-20"><span class="linenos"> 20</span></a>
</span><span id="InteractiveMode-21"><a href="#InteractiveMode-21"><span class="linenos"> 21</span></a><span class="sd">    This class serves as a high-level command-line wrapper around the functionality defined</span>
</span><span id="InteractiveMode-22"><a href="#InteractiveMode-22"><span class="linenos"> 22</span></a><span class="sd">    in modules like `libfeatures`, `libpreprocessing`, and `libclustering`. It guides the</span>
</span><span id="InteractiveMode-23"><a href="#InteractiveMode-23"><span class="linenos"> 23</span></a><span class="sd">    user through a series of prompts to configure and execute data processing operations.</span>
</span><span id="InteractiveMode-24"><a href="#InteractiveMode-24"><span class="linenos"> 24</span></a>
</span><span id="InteractiveMode-25"><a href="#InteractiveMode-25"><span class="linenos"> 25</span></a><span class="sd">    This class is not intended to be instantiated.</span>
</span><span id="InteractiveMode-26"><a href="#InteractiveMode-26"><span class="linenos"> 26</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="InteractiveMode-27"><a href="#InteractiveMode-27"><span class="linenos"> 27</span></a>
</span><span id="InteractiveMode-28"><a href="#InteractiveMode-28"><span class="linenos"> 28</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="InteractiveMode-29"><a href="#InteractiveMode-29"><span class="linenos"> 29</span></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;This class can not be instantiate.&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-30"><a href="#InteractiveMode-30"><span class="linenos"> 30</span></a>    
</span><span id="InteractiveMode-31"><a href="#InteractiveMode-31"><span class="linenos"> 31</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode-32"><a href="#InteractiveMode-32"><span class="linenos"> 32</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">welcome_message</span><span class="p">():</span>
</span><span id="InteractiveMode-33"><a href="#InteractiveMode-33"><span class="linenos"> 33</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode-34"><a href="#InteractiveMode-34"><span class="linenos"> 34</span></a><span class="sd">        Prints a welcome message with initial instructions for placing image data.</span>
</span><span id="InteractiveMode-35"><a href="#InteractiveMode-35"><span class="linenos"> 35</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode-36"><a href="#InteractiveMode-36"><span class="linenos"> 36</span></a>
</span><span id="InteractiveMode-37"><a href="#InteractiveMode-37"><span class="linenos"> 37</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Welcome to the script! </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode-38"><a href="#InteractiveMode-38"><span class="linenos"> 38</span></a>        <span class="s1">&#39;First place your images in a separate folder (into &quot;./images/&quot;) named according to the template: </span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
</span><span id="InteractiveMode-39"><a href="#InteractiveMode-39"><span class="linenos"> 39</span></a><span class="s1">        &quot;images_(your_specification)&quot;&#39;</span>
</span><span id="InteractiveMode-40"><a href="#InteractiveMode-40"><span class="linenos"> 40</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="InteractiveMode-41"><a href="#InteractiveMode-41"><span class="linenos"> 41</span></a>
</span><span id="InteractiveMode-42"><a href="#InteractiveMode-42"><span class="linenos"> 42</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode-43"><a href="#InteractiveMode-43"><span class="linenos"> 43</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">preparations</span><span class="p">():</span>
</span><span id="InteractiveMode-44"><a href="#InteractiveMode-44"><span class="linenos"> 44</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode-45"><a href="#InteractiveMode-45"><span class="linenos"> 45</span></a><span class="sd">        Prepares required working directories and gathers the users image folder name.</span>
</span><span id="InteractiveMode-46"><a href="#InteractiveMode-46"><span class="linenos"> 46</span></a>
</span><span id="InteractiveMode-47"><a href="#InteractiveMode-47"><span class="linenos"> 47</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode-48"><a href="#InteractiveMode-48"><span class="linenos"> 48</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode-49"><a href="#InteractiveMode-49"><span class="linenos"> 49</span></a><span class="sd">        input_imags : str</span>
</span><span id="InteractiveMode-50"><a href="#InteractiveMode-50"><span class="linenos"> 50</span></a><span class="sd">            Name of the user-specified image subdirectory.</span>
</span><span id="InteractiveMode-51"><a href="#InteractiveMode-51"><span class="linenos"> 51</span></a><span class="sd">        default_filename : str</span>
</span><span id="InteractiveMode-52"><a href="#InteractiveMode-52"><span class="linenos"> 52</span></a><span class="sd">            Suggested default filename for saving feature data.</span>
</span><span id="InteractiveMode-53"><a href="#InteractiveMode-53"><span class="linenos"> 53</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode-54"><a href="#InteractiveMode-54"><span class="linenos"> 54</span></a>
</span><span id="InteractiveMode-55"><a href="#InteractiveMode-55"><span class="linenos"> 55</span></a>        <span class="n">base_dir_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;./images&#39;</span><span class="p">,</span> <span class="s1">&#39;./processed&#39;</span><span class="p">,</span> <span class="s1">&#39;./figures&#39;</span><span class="p">,</span> <span class="s1">&#39;./data&#39;</span><span class="p">,</span> <span class="s1">&#39;./results&#39;</span><span class="p">]</span>
</span><span id="InteractiveMode-56"><a href="#InteractiveMode-56"><span class="linenos"> 56</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Use &quot;./processed&quot; folder for processed images </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode-57"><a href="#InteractiveMode-57"><span class="linenos"> 57</span></a>        <span class="s1">&#39;&quot;./data&quot; folder for info metadata </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode-58"><a href="#InteractiveMode-58"><span class="linenos"> 58</span></a>        <span class="s1">&#39;&quot;./figures&quot; and &quot;./results&quot; for graphic and data results, respectively.&#39;</span>
</span><span id="InteractiveMode-59"><a href="#InteractiveMode-59"><span class="linenos"> 59</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="InteractiveMode-60"><a href="#InteractiveMode-60"><span class="linenos"> 60</span></a>
</span><span id="InteractiveMode-61"><a href="#InteractiveMode-61"><span class="linenos"> 61</span></a>        <span class="k">for</span> <span class="n">dirname</span> <span class="ow">in</span> <span class="n">base_dir_names</span><span class="p">:</span>
</span><span id="InteractiveMode-62"><a href="#InteractiveMode-62"><span class="linenos"> 62</span></a>            <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">preparing_folder</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="InteractiveMode-63"><a href="#InteractiveMode-63"><span class="linenos"> 63</span></a>
</span><span id="InteractiveMode-64"><a href="#InteractiveMode-64"><span class="linenos"> 64</span></a>        <span class="n">input_imags</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Please enter the name of your working directory: &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;./, &#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-65"><a href="#InteractiveMode-65"><span class="linenos"> 65</span></a>        <span class="n">specification</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">input_name</span><span class="p">(</span><span class="n">input_imags</span><span class="p">)</span>
</span><span id="InteractiveMode-66"><a href="#InteractiveMode-66"><span class="linenos"> 66</span></a>        <span class="n">results_dir</span> <span class="o">=</span> <span class="s1">&#39;./processed/processed_&#39;</span><span class="o">+</span><span class="n">specification</span>
</span><span id="InteractiveMode-67"><a href="#InteractiveMode-67"><span class="linenos"> 67</span></a>        <span class="n">default_filename</span> <span class="o">=</span> <span class="s1">&#39;./results/pearson_diagram_data_&#39;</span><span class="o">+</span><span class="n">specification</span>
</span><span id="InteractiveMode-68"><a href="#InteractiveMode-68"><span class="linenos"> 68</span></a>
</span><span id="InteractiveMode-69"><a href="#InteractiveMode-69"><span class="linenos"> 69</span></a>        <span class="n">clear</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">get_bool</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;If folder </span><span class="si">{</span><span class="n">results_dir</span><span class="si">}</span><span class="s1"> already exists would you like to clear its contents? (True or False) &#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-70"><a href="#InteractiveMode-70"><span class="linenos"> 70</span></a>        <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">preparing_folder</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="n">clear</span><span class="p">)</span>
</span><span id="InteractiveMode-71"><a href="#InteractiveMode-71"><span class="linenos"> 71</span></a>
</span><span id="InteractiveMode-72"><a href="#InteractiveMode-72"><span class="linenos"> 72</span></a>        <span class="k">return</span> <span class="n">input_imags</span><span class="p">,</span> <span class="n">default_filename</span>
</span><span id="InteractiveMode-73"><a href="#InteractiveMode-73"><span class="linenos"> 73</span></a>
</span><span id="InteractiveMode-74"><a href="#InteractiveMode-74"><span class="linenos"> 74</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode-75"><a href="#InteractiveMode-75"><span class="linenos"> 75</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_bool</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span> 
</span><span id="InteractiveMode-76"><a href="#InteractiveMode-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode-77"><a href="#InteractiveMode-77"><span class="linenos"> 77</span></a><span class="sd">        Prompts the user for a True/False response.</span>
</span><span id="InteractiveMode-78"><a href="#InteractiveMode-78"><span class="linenos"> 78</span></a>
</span><span id="InteractiveMode-79"><a href="#InteractiveMode-79"><span class="linenos"> 79</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode-80"><a href="#InteractiveMode-80"><span class="linenos"> 80</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode-81"><a href="#InteractiveMode-81"><span class="linenos"> 81</span></a><span class="sd">        prompt : str</span>
</span><span id="InteractiveMode-82"><a href="#InteractiveMode-82"><span class="linenos"> 82</span></a><span class="sd">            Prompt text for user input.</span>
</span><span id="InteractiveMode-83"><a href="#InteractiveMode-83"><span class="linenos"> 83</span></a>
</span><span id="InteractiveMode-84"><a href="#InteractiveMode-84"><span class="linenos"> 84</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode-85"><a href="#InteractiveMode-85"><span class="linenos"> 85</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode-86"><a href="#InteractiveMode-86"><span class="linenos"> 86</span></a><span class="sd">        bool</span>
</span><span id="InteractiveMode-87"><a href="#InteractiveMode-87"><span class="linenos"> 87</span></a><span class="sd">            Boolean interpretation of the user&#39;s input.</span>
</span><span id="InteractiveMode-88"><a href="#InteractiveMode-88"><span class="linenos"> 88</span></a>
</span><span id="InteractiveMode-89"><a href="#InteractiveMode-89"><span class="linenos"> 89</span></a><span class="sd">        Raises</span>
</span><span id="InteractiveMode-90"><a href="#InteractiveMode-90"><span class="linenos"> 90</span></a><span class="sd">        ------</span>
</span><span id="InteractiveMode-91"><a href="#InteractiveMode-91"><span class="linenos"> 91</span></a><span class="sd">        KeyError</span>
</span><span id="InteractiveMode-92"><a href="#InteractiveMode-92"><span class="linenos"> 92</span></a><span class="sd">            If input is not &#39;true&#39; or &#39;false&#39; (case-insensitive).</span>
</span><span id="InteractiveMode-93"><a href="#InteractiveMode-93"><span class="linenos"> 93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode-94"><a href="#InteractiveMode-94"><span class="linenos"> 94</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="InteractiveMode-95"><a href="#InteractiveMode-95"><span class="linenos"> 95</span></a>            
</span><span id="InteractiveMode-96"><a href="#InteractiveMode-96"><span class="linenos"> 96</span></a>                <span class="n">answ</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="InteractiveMode-97"><a href="#InteractiveMode-97"><span class="linenos"> 97</span></a>                <span class="k">if</span> <span class="n">answ</span><span class="p">:</span>
</span><span id="InteractiveMode-98"><a href="#InteractiveMode-98"><span class="linenos"> 98</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="InteractiveMode-99"><a href="#InteractiveMode-99"><span class="linenos"> 99</span></a>                        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}[</span><span class="n">answ</span><span class="p">]</span>
</span><span id="InteractiveMode-100"><a href="#InteractiveMode-100"><span class="linenos">100</span></a>                    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="InteractiveMode-101"><a href="#InteractiveMode-101"><span class="linenos">101</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid input, please enter True or False! </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-102"><a href="#InteractiveMode-102"><span class="linenos">102</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="InteractiveMode-103"><a href="#InteractiveMode-103"><span class="linenos">103</span></a>                    <span class="k">return</span> <span class="kc">True</span>
</span><span id="InteractiveMode-104"><a href="#InteractiveMode-104"><span class="linenos">104</span></a>            
</span><span id="InteractiveMode-105"><a href="#InteractiveMode-105"><span class="linenos">105</span></a>
</span><span id="InteractiveMode-106"><a href="#InteractiveMode-106"><span class="linenos">106</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode-107"><a href="#InteractiveMode-107"><span class="linenos">107</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_mixed_freq</span><span class="p">(</span><span class="n">name_pattern</span><span class="p">):</span>
</span><span id="InteractiveMode-108"><a href="#InteractiveMode-108"><span class="linenos">108</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode-109"><a href="#InteractiveMode-109"><span class="linenos">109</span></a><span class="sd">        Asks the user whether to filter out mixed-frequency data.</span>
</span><span id="InteractiveMode-110"><a href="#InteractiveMode-110"><span class="linenos">110</span></a>
</span><span id="InteractiveMode-111"><a href="#InteractiveMode-111"><span class="linenos">111</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode-112"><a href="#InteractiveMode-112"><span class="linenos">112</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode-113"><a href="#InteractiveMode-113"><span class="linenos">113</span></a><span class="sd">        name_pattern : str</span>
</span><span id="InteractiveMode-114"><a href="#InteractiveMode-114"><span class="linenos">114</span></a><span class="sd">            Default regular expression used to match dataset names.</span>
</span><span id="InteractiveMode-115"><a href="#InteractiveMode-115"><span class="linenos">115</span></a>
</span><span id="InteractiveMode-116"><a href="#InteractiveMode-116"><span class="linenos">116</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode-117"><a href="#InteractiveMode-117"><span class="linenos">117</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode-118"><a href="#InteractiveMode-118"><span class="linenos">118</span></a><span class="sd">        filter_mixed : bool</span>
</span><span id="InteractiveMode-119"><a href="#InteractiveMode-119"><span class="linenos">119</span></a><span class="sd">            Whether to apply frequency filtering.</span>
</span><span id="InteractiveMode-120"><a href="#InteractiveMode-120"><span class="linenos">120</span></a><span class="sd">        name_pattern : str</span>
</span><span id="InteractiveMode-121"><a href="#InteractiveMode-121"><span class="linenos">121</span></a><span class="sd">            Possibly updated regex pattern provided by the user.</span>
</span><span id="InteractiveMode-122"><a href="#InteractiveMode-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode-123"><a href="#InteractiveMode-123"><span class="linenos">123</span></a>
</span><span id="InteractiveMode-124"><a href="#InteractiveMode-124"><span class="linenos">124</span></a>        <span class="n">filter_mixed</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">get_bool</span><span class="p">(</span><span class="s1">&#39;Would you like to filter mixed frequencies? (True or False) &#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-125"><a href="#InteractiveMode-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="n">filter_mixed</span><span class="p">:</span>
</span><span id="InteractiveMode-126"><a href="#InteractiveMode-126"><span class="linenos">126</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Check the name pattern: </span><span class="si">{</span><span class="n">name_pattern</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-127"><a href="#InteractiveMode-127"><span class="linenos">127</span></a>            <span class="n">np_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Change if it is needed or press &quot;Enter&quot;: &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="InteractiveMode-128"><a href="#InteractiveMode-128"><span class="linenos">128</span></a>            <span class="k">if</span> <span class="n">np_input</span><span class="p">:</span>
</span><span id="InteractiveMode-129"><a href="#InteractiveMode-129"><span class="linenos">129</span></a>                <span class="n">name_pattern</span> <span class="o">=</span> <span class="n">np_input</span>
</span><span id="InteractiveMode-130"><a href="#InteractiveMode-130"><span class="linenos">130</span></a>        <span class="k">return</span> <span class="n">filter_mixed</span><span class="p">,</span> <span class="n">name_pattern</span>
</span><span id="InteractiveMode-131"><a href="#InteractiveMode-131"><span class="linenos">131</span></a>    
</span><span id="InteractiveMode-132"><a href="#InteractiveMode-132"><span class="linenos">132</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode-133"><a href="#InteractiveMode-133"><span class="linenos">133</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_path</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">default_path</span><span class="p">):</span>
</span><span id="InteractiveMode-134"><a href="#InteractiveMode-134"><span class="linenos">134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode-135"><a href="#InteractiveMode-135"><span class="linenos">135</span></a><span class="sd">        Gets a file path from the user, or uses the default if none is entered.</span>
</span><span id="InteractiveMode-136"><a href="#InteractiveMode-136"><span class="linenos">136</span></a>
</span><span id="InteractiveMode-137"><a href="#InteractiveMode-137"><span class="linenos">137</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode-138"><a href="#InteractiveMode-138"><span class="linenos">138</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode-139"><a href="#InteractiveMode-139"><span class="linenos">139</span></a><span class="sd">        message : str</span>
</span><span id="InteractiveMode-140"><a href="#InteractiveMode-140"><span class="linenos">140</span></a><span class="sd">            Prompt for the user.</span>
</span><span id="InteractiveMode-141"><a href="#InteractiveMode-141"><span class="linenos">141</span></a><span class="sd">        default_path : str</span>
</span><span id="InteractiveMode-142"><a href="#InteractiveMode-142"><span class="linenos">142</span></a><span class="sd">            Default path to return if user provides no input.</span>
</span><span id="InteractiveMode-143"><a href="#InteractiveMode-143"><span class="linenos">143</span></a>
</span><span id="InteractiveMode-144"><a href="#InteractiveMode-144"><span class="linenos">144</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode-145"><a href="#InteractiveMode-145"><span class="linenos">145</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode-146"><a href="#InteractiveMode-146"><span class="linenos">146</span></a><span class="sd">        str</span>
</span><span id="InteractiveMode-147"><a href="#InteractiveMode-147"><span class="linenos">147</span></a><span class="sd">            Final path.</span>
</span><span id="InteractiveMode-148"><a href="#InteractiveMode-148"><span class="linenos">148</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode-149"><a href="#InteractiveMode-149"><span class="linenos">149</span></a>
</span><span id="InteractiveMode-150"><a href="#InteractiveMode-150"><span class="linenos">150</span></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="InteractiveMode-151"><a href="#InteractiveMode-151"><span class="linenos">151</span></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span> <span class="k">if</span> <span class="n">file_path</span> <span class="k">else</span> <span class="n">default_path</span>
</span><span id="InteractiveMode-152"><a href="#InteractiveMode-152"><span class="linenos">152</span></a>        <span class="k">return</span> <span class="n">file_path</span>
</span><span id="InteractiveMode-153"><a href="#InteractiveMode-153"><span class="linenos">153</span></a>    
</span><span id="InteractiveMode-154"><a href="#InteractiveMode-154"><span class="linenos">154</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode-155"><a href="#InteractiveMode-155"><span class="linenos">155</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_features</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">info_path</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">):</span>
</span><span id="InteractiveMode-156"><a href="#InteractiveMode-156"><span class="linenos">156</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode-157"><a href="#InteractiveMode-157"><span class="linenos">157</span></a><span class="sd">        Asks the user whether to extract new features or read from file.</span>
</span><span id="InteractiveMode-158"><a href="#InteractiveMode-158"><span class="linenos">158</span></a>
</span><span id="InteractiveMode-159"><a href="#InteractiveMode-159"><span class="linenos">159</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode-160"><a href="#InteractiveMode-160"><span class="linenos">160</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode-161"><a href="#InteractiveMode-161"><span class="linenos">161</span></a><span class="sd">        input_imags : str</span>
</span><span id="InteractiveMode-162"><a href="#InteractiveMode-162"><span class="linenos">162</span></a><span class="sd">            Subdirectory name with image data.</span>
</span><span id="InteractiveMode-163"><a href="#InteractiveMode-163"><span class="linenos">163</span></a><span class="sd">        info_path : str</span>
</span><span id="InteractiveMode-164"><a href="#InteractiveMode-164"><span class="linenos">164</span></a><span class="sd">            Path to the metadata file.</span>
</span><span id="InteractiveMode-165"><a href="#InteractiveMode-165"><span class="linenos">165</span></a><span class="sd">        default_filename : str</span>
</span><span id="InteractiveMode-166"><a href="#InteractiveMode-166"><span class="linenos">166</span></a><span class="sd">            Default base filename for feature data.</span>
</span><span id="InteractiveMode-167"><a href="#InteractiveMode-167"><span class="linenos">167</span></a><span class="sd">        name_pattern : str</span>
</span><span id="InteractiveMode-168"><a href="#InteractiveMode-168"><span class="linenos">168</span></a><span class="sd">            Regex pattern for identifying dataset names.</span>
</span><span id="InteractiveMode-169"><a href="#InteractiveMode-169"><span class="linenos">169</span></a>
</span><span id="InteractiveMode-170"><a href="#InteractiveMode-170"><span class="linenos">170</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode-171"><a href="#InteractiveMode-171"><span class="linenos">171</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode-172"><a href="#InteractiveMode-172"><span class="linenos">172</span></a><span class="sd">        ResNetFeatures</span>
</span><span id="InteractiveMode-173"><a href="#InteractiveMode-173"><span class="linenos">173</span></a><span class="sd">            An instance of the ResNetFeatures class containing the loaded/extracted features.</span>
</span><span id="InteractiveMode-174"><a href="#InteractiveMode-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode-175"><a href="#InteractiveMode-175"><span class="linenos">175</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;To extract features from images located in </span><span class="si">{</span><span class="n">input_imags</span><span class="si">}</span><span class="s1"> enter 1. </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode-176"><a href="#InteractiveMode-176"><span class="linenos">176</span></a>                <span class="s1">&#39;To load features from a file enter 2.&#39;</span>
</span><span id="InteractiveMode-177"><a href="#InteractiveMode-177"><span class="linenos">177</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="InteractiveMode-178"><a href="#InteractiveMode-178"><span class="linenos">178</span></a>
</span><span id="InteractiveMode-179"><a href="#InteractiveMode-179"><span class="linenos">179</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="InteractiveMode-180"><a href="#InteractiveMode-180"><span class="linenos">180</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="InteractiveMode-181"><a href="#InteractiveMode-181"><span class="linenos">181</span></a>                <span class="n">choice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;[1/2]: &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="InteractiveMode-182"><a href="#InteractiveMode-182"><span class="linenos">182</span></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="InteractiveMode-183"><a href="#InteractiveMode-183"><span class="linenos">183</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid input. Please enter 1 or 2.&quot;</span><span class="p">)</span>
</span><span id="InteractiveMode-184"><a href="#InteractiveMode-184"><span class="linenos">184</span></a>                <span class="k">continue</span>
</span><span id="InteractiveMode-185"><a href="#InteractiveMode-185"><span class="linenos">185</span></a>
</span><span id="InteractiveMode-186"><a href="#InteractiveMode-186"><span class="linenos">186</span></a>            <span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="InteractiveMode-187"><a href="#InteractiveMode-187"><span class="linenos">187</span></a>                <span class="n">features</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">info_path</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">)</span>
</span><span id="InteractiveMode-188"><a href="#InteractiveMode-188"><span class="linenos">188</span></a>                <span class="k">break</span>
</span><span id="InteractiveMode-189"><a href="#InteractiveMode-189"><span class="linenos">189</span></a>
</span><span id="InteractiveMode-190"><a href="#InteractiveMode-190"><span class="linenos">190</span></a>            <span class="k">elif</span> <span class="n">choice</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="InteractiveMode-191"><a href="#InteractiveMode-191"><span class="linenos">191</span></a>                
</span><span id="InteractiveMode-192"><a href="#InteractiveMode-192"><span class="linenos">192</span></a>                <span class="n">features</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">read_features</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">info_path</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">)</span>
</span><span id="InteractiveMode-193"><a href="#InteractiveMode-193"><span class="linenos">193</span></a>                <span class="k">break</span>
</span><span id="InteractiveMode-194"><a href="#InteractiveMode-194"><span class="linenos">194</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="InteractiveMode-195"><a href="#InteractiveMode-195"><span class="linenos">195</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Invalid input. </span><span class="se">\n</span><span class="s1"> Try again!&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-196"><a href="#InteractiveMode-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="n">features</span>
</span><span id="InteractiveMode-197"><a href="#InteractiveMode-197"><span class="linenos">197</span></a>    
</span><span id="InteractiveMode-198"><a href="#InteractiveMode-198"><span class="linenos">198</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode-199"><a href="#InteractiveMode-199"><span class="linenos">199</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_features</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">info_path</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">):</span>
</span><span id="InteractiveMode-200"><a href="#InteractiveMode-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode-201"><a href="#InteractiveMode-201"><span class="linenos">201</span></a><span class="sd">        Initializes feature extraction and saves them to file.</span>
</span><span id="InteractiveMode-202"><a href="#InteractiveMode-202"><span class="linenos">202</span></a>
</span><span id="InteractiveMode-203"><a href="#InteractiveMode-203"><span class="linenos">203</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode-204"><a href="#InteractiveMode-204"><span class="linenos">204</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode-205"><a href="#InteractiveMode-205"><span class="linenos">205</span></a><span class="sd">        input_imags : str</span>
</span><span id="InteractiveMode-206"><a href="#InteractiveMode-206"><span class="linenos">206</span></a><span class="sd">            Folder containing images.</span>
</span><span id="InteractiveMode-207"><a href="#InteractiveMode-207"><span class="linenos">207</span></a><span class="sd">        info_path : str</span>
</span><span id="InteractiveMode-208"><a href="#InteractiveMode-208"><span class="linenos">208</span></a><span class="sd">            Path to the metadata file.</span>
</span><span id="InteractiveMode-209"><a href="#InteractiveMode-209"><span class="linenos">209</span></a><span class="sd">        default_filename : str</span>
</span><span id="InteractiveMode-210"><a href="#InteractiveMode-210"><span class="linenos">210</span></a><span class="sd">            Default file path for saving results.</span>
</span><span id="InteractiveMode-211"><a href="#InteractiveMode-211"><span class="linenos">211</span></a><span class="sd">        name_pattern : str</span>
</span><span id="InteractiveMode-212"><a href="#InteractiveMode-212"><span class="linenos">212</span></a><span class="sd">            Regex pattern for dataset name recognition.</span>
</span><span id="InteractiveMode-213"><a href="#InteractiveMode-213"><span class="linenos">213</span></a>
</span><span id="InteractiveMode-214"><a href="#InteractiveMode-214"><span class="linenos">214</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode-215"><a href="#InteractiveMode-215"><span class="linenos">215</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode-216"><a href="#InteractiveMode-216"><span class="linenos">216</span></a><span class="sd">        ResNetFeatures</span>
</span><span id="InteractiveMode-217"><a href="#InteractiveMode-217"><span class="linenos">217</span></a><span class="sd">            Object containing the extracted feature database.</span>
</span><span id="InteractiveMode-218"><a href="#InteractiveMode-218"><span class="linenos">218</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode-219"><a href="#InteractiveMode-219"><span class="linenos">219</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Enter a file name to write extracted features (or press &quot;Enter&quot; for default &quot;</span><span class="si">{</span><span class="n">default_filename</span><span class="si">}</span><span class="s1">&quot;): &#39;</span>
</span><span id="InteractiveMode-220"><a href="#InteractiveMode-220"><span class="linenos">220</span></a>        <span class="n">file_to_write</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">)</span>
</span><span id="InteractiveMode-221"><a href="#InteractiveMode-221"><span class="linenos">221</span></a>        <span class="n">filter_mixed</span><span class="p">,</span> <span class="n">name_pattern</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">filter_mixed_freq</span><span class="p">(</span><span class="n">name_pattern</span><span class="p">)</span>
</span><span id="InteractiveMode-222"><a href="#InteractiveMode-222"><span class="linenos">222</span></a>
</span><span id="InteractiveMode-223"><a href="#InteractiveMode-223"><span class="linenos">223</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Features extraction&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-224"><a href="#InteractiveMode-224"><span class="linenos">224</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="n">ResNetFeatures</span><span class="p">(</span>
</span><span id="InteractiveMode-225"><a href="#InteractiveMode-225"><span class="linenos">225</span></a>            <span class="n">path</span><span class="o">=</span><span class="s1">&#39;./images/&#39;</span> <span class="o">+</span> <span class="n">input_imags</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
</span><span id="InteractiveMode-226"><a href="#InteractiveMode-226"><span class="linenos">226</span></a>            <span class="n">flag</span><span class="o">=</span><span class="s1">&#39;extract&#39;</span><span class="p">,</span>
</span><span id="InteractiveMode-227"><a href="#InteractiveMode-227"><span class="linenos">227</span></a>            <span class="n">info_path</span><span class="o">=</span><span class="n">info_path</span><span class="p">,</span>
</span><span id="InteractiveMode-228"><a href="#InteractiveMode-228"><span class="linenos">228</span></a>            <span class="n">filter_mixed</span><span class="o">=</span><span class="n">filter_mixed</span><span class="p">,</span>
</span><span id="InteractiveMode-229"><a href="#InteractiveMode-229"><span class="linenos">229</span></a>            <span class="n">name_pattern</span><span class="o">=</span><span class="n">name_pattern</span><span class="p">,</span>
</span><span id="InteractiveMode-230"><a href="#InteractiveMode-230"><span class="linenos">230</span></a>            <span class="n">extra_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;file_to_write&#39;</span><span class="p">:</span> <span class="n">file_to_write</span><span class="p">}</span>
</span><span id="InteractiveMode-231"><a href="#InteractiveMode-231"><span class="linenos">231</span></a>        <span class="p">)</span>
</span><span id="InteractiveMode-232"><a href="#InteractiveMode-232"><span class="linenos">232</span></a>        <span class="k">return</span> <span class="n">features</span>
</span><span id="InteractiveMode-233"><a href="#InteractiveMode-233"><span class="linenos">233</span></a>    
</span><span id="InteractiveMode-234"><a href="#InteractiveMode-234"><span class="linenos">234</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode-235"><a href="#InteractiveMode-235"><span class="linenos">235</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read_features</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">info_path</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">):</span>
</span><span id="InteractiveMode-236"><a href="#InteractiveMode-236"><span class="linenos">236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode-237"><a href="#InteractiveMode-237"><span class="linenos">237</span></a><span class="sd">        Loads previously saved feature data from a file.</span>
</span><span id="InteractiveMode-238"><a href="#InteractiveMode-238"><span class="linenos">238</span></a>
</span><span id="InteractiveMode-239"><a href="#InteractiveMode-239"><span class="linenos">239</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode-240"><a href="#InteractiveMode-240"><span class="linenos">240</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode-241"><a href="#InteractiveMode-241"><span class="linenos">241</span></a><span class="sd">        input_imags : str</span>
</span><span id="InteractiveMode-242"><a href="#InteractiveMode-242"><span class="linenos">242</span></a><span class="sd">            Folder containing images.</span>
</span><span id="InteractiveMode-243"><a href="#InteractiveMode-243"><span class="linenos">243</span></a><span class="sd">        info_path : str</span>
</span><span id="InteractiveMode-244"><a href="#InteractiveMode-244"><span class="linenos">244</span></a><span class="sd">            Path to the metadata file.</span>
</span><span id="InteractiveMode-245"><a href="#InteractiveMode-245"><span class="linenos">245</span></a><span class="sd">        default_filename : str</span>
</span><span id="InteractiveMode-246"><a href="#InteractiveMode-246"><span class="linenos">246</span></a><span class="sd">            Default file path for loading.</span>
</span><span id="InteractiveMode-247"><a href="#InteractiveMode-247"><span class="linenos">247</span></a><span class="sd">        name_pattern : str</span>
</span><span id="InteractiveMode-248"><a href="#InteractiveMode-248"><span class="linenos">248</span></a><span class="sd">            Regex pattern for dataset name recognition.</span>
</span><span id="InteractiveMode-249"><a href="#InteractiveMode-249"><span class="linenos">249</span></a>
</span><span id="InteractiveMode-250"><a href="#InteractiveMode-250"><span class="linenos">250</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode-251"><a href="#InteractiveMode-251"><span class="linenos">251</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode-252"><a href="#InteractiveMode-252"><span class="linenos">252</span></a><span class="sd">        ResNetFeatures</span>
</span><span id="InteractiveMode-253"><a href="#InteractiveMode-253"><span class="linenos">253</span></a><span class="sd">            Object containing the loaded feature database.</span>
</span><span id="InteractiveMode-254"><a href="#InteractiveMode-254"><span class="linenos">254</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode-255"><a href="#InteractiveMode-255"><span class="linenos">255</span></a>
</span><span id="InteractiveMode-256"><a href="#InteractiveMode-256"><span class="linenos">256</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Enter a file name to read from (or press &quot;Enter&quot; for default &quot;</span><span class="si">{</span><span class="n">default_filename</span><span class="si">}</span><span class="s1">&quot;): &#39;</span>
</span><span id="InteractiveMode-257"><a href="#InteractiveMode-257"><span class="linenos">257</span></a>        <span class="n">file_to_read</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">)</span>
</span><span id="InteractiveMode-258"><a href="#InteractiveMode-258"><span class="linenos">258</span></a>        <span class="n">filter_mixed</span><span class="p">,</span> <span class="n">name_pattern</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">filter_mixed_freq</span><span class="p">(</span><span class="n">name_pattern</span><span class="p">)</span>
</span><span id="InteractiveMode-259"><a href="#InteractiveMode-259"><span class="linenos">259</span></a>
</span><span id="InteractiveMode-260"><a href="#InteractiveMode-260"><span class="linenos">260</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading features&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-261"><a href="#InteractiveMode-261"><span class="linenos">261</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="n">ResNetFeatures</span><span class="p">(</span>
</span><span id="InteractiveMode-262"><a href="#InteractiveMode-262"><span class="linenos">262</span></a>            <span class="n">path</span><span class="o">=</span><span class="s1">&#39;./images/&#39;</span> <span class="o">+</span> <span class="n">input_imags</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
</span><span id="InteractiveMode-263"><a href="#InteractiveMode-263"><span class="linenos">263</span></a>            <span class="n">flag</span><span class="o">=</span><span class="s1">&#39;read&#39;</span><span class="p">,</span>
</span><span id="InteractiveMode-264"><a href="#InteractiveMode-264"><span class="linenos">264</span></a>            <span class="n">info_path</span><span class="o">=</span><span class="n">info_path</span><span class="p">,</span>
</span><span id="InteractiveMode-265"><a href="#InteractiveMode-265"><span class="linenos">265</span></a>            <span class="n">filter_mixed</span><span class="o">=</span><span class="n">filter_mixed</span><span class="p">,</span>
</span><span id="InteractiveMode-266"><a href="#InteractiveMode-266"><span class="linenos">266</span></a>            <span class="n">name_pattern</span><span class="o">=</span><span class="n">name_pattern</span><span class="p">,</span>
</span><span id="InteractiveMode-267"><a href="#InteractiveMode-267"><span class="linenos">267</span></a>            <span class="n">extra_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;file_to_read&#39;</span><span class="p">:</span> <span class="n">file_to_read</span><span class="p">}</span>
</span><span id="InteractiveMode-268"><a href="#InteractiveMode-268"><span class="linenos">268</span></a>        <span class="p">)</span>
</span><span id="InteractiveMode-269"><a href="#InteractiveMode-269"><span class="linenos">269</span></a>        <span class="k">return</span> <span class="n">features</span>
</span><span id="InteractiveMode-270"><a href="#InteractiveMode-270"><span class="linenos">270</span></a>    
</span><span id="InteractiveMode-271"><a href="#InteractiveMode-271"><span class="linenos">271</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode-272"><a href="#InteractiveMode-272"><span class="linenos">272</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_processing</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">):</span>
</span><span id="InteractiveMode-273"><a href="#InteractiveMode-273"><span class="linenos">273</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode-274"><a href="#InteractiveMode-274"><span class="linenos">274</span></a><span class="sd">        Offers the user a choice between standard pipeline execution or custom steps.</span>
</span><span id="InteractiveMode-275"><a href="#InteractiveMode-275"><span class="linenos">275</span></a>
</span><span id="InteractiveMode-276"><a href="#InteractiveMode-276"><span class="linenos">276</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode-277"><a href="#InteractiveMode-277"><span class="linenos">277</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode-278"><a href="#InteractiveMode-278"><span class="linenos">278</span></a><span class="sd">        features : ResNetFeatures</span>
</span><span id="InteractiveMode-279"><a href="#InteractiveMode-279"><span class="linenos">279</span></a><span class="sd">            Feature database.</span>
</span><span id="InteractiveMode-280"><a href="#InteractiveMode-280"><span class="linenos">280</span></a><span class="sd">        default_filename : str</span>
</span><span id="InteractiveMode-281"><a href="#InteractiveMode-281"><span class="linenos">281</span></a><span class="sd">            Base name for saving intermediate or final results.</span>
</span><span id="InteractiveMode-282"><a href="#InteractiveMode-282"><span class="linenos">282</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode-283"><a href="#InteractiveMode-283"><span class="linenos">283</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Would you like to launch the standard processing algorithm (1) or </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode-284"><a href="#InteractiveMode-284"><span class="linenos">284</span></a>                    <span class="s1">&#39;to call separate blocks of processing manually (2)?&#39;</span>
</span><span id="InteractiveMode-285"><a href="#InteractiveMode-285"><span class="linenos">285</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="InteractiveMode-286"><a href="#InteractiveMode-286"><span class="linenos">286</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="InteractiveMode-287"><a href="#InteractiveMode-287"><span class="linenos">287</span></a>            <span class="n">num</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter 1 or 2 (or break to stop): &#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-288"><a href="#InteractiveMode-288"><span class="linenos">288</span></a>            <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="s1">&#39;break&#39;</span><span class="p">:</span>
</span><span id="InteractiveMode-289"><a href="#InteractiveMode-289"><span class="linenos">289</span></a>                <span class="k">break</span>
</span><span id="InteractiveMode-290"><a href="#InteractiveMode-290"><span class="linenos">290</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="InteractiveMode-291"><a href="#InteractiveMode-291"><span class="linenos">291</span></a>                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="InteractiveMode-292"><a href="#InteractiveMode-292"><span class="linenos">292</span></a>                    <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">standard_algorithm</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">)</span>
</span><span id="InteractiveMode-293"><a href="#InteractiveMode-293"><span class="linenos">293</span></a>                <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="InteractiveMode-294"><a href="#InteractiveMode-294"><span class="linenos">294</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This part has not been implemented yet. Use 1 or break.&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-295"><a href="#InteractiveMode-295"><span class="linenos">295</span></a>
</span><span id="InteractiveMode-296"><a href="#InteractiveMode-296"><span class="linenos">296</span></a>
</span><span id="InteractiveMode-297"><a href="#InteractiveMode-297"><span class="linenos">297</span></a>
</span><span id="InteractiveMode-298"><a href="#InteractiveMode-298"><span class="linenos">298</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode-299"><a href="#InteractiveMode-299"><span class="linenos">299</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">standard_algorithm</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">):</span>
</span><span id="InteractiveMode-300"><a href="#InteractiveMode-300"><span class="linenos">300</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode-301"><a href="#InteractiveMode-301"><span class="linenos">301</span></a><span class="sd">        Executes the full default processing pipeline:</span>
</span><span id="InteractiveMode-302"><a href="#InteractiveMode-302"><span class="linenos">302</span></a><span class="sd">        1. Feature filtering by variance</span>
</span><span id="InteractiveMode-303"><a href="#InteractiveMode-303"><span class="linenos">303</span></a><span class="sd">        2. Dimensionality reduction with PCA and UMAP</span>
</span><span id="InteractiveMode-304"><a href="#InteractiveMode-304"><span class="linenos">304</span></a><span class="sd">        3. Clustering with HDBSCAN</span>
</span><span id="InteractiveMode-305"><a href="#InteractiveMode-305"><span class="linenos">305</span></a><span class="sd">        4. Visualization</span>
</span><span id="InteractiveMode-306"><a href="#InteractiveMode-306"><span class="linenos">306</span></a>
</span><span id="InteractiveMode-307"><a href="#InteractiveMode-307"><span class="linenos">307</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode-308"><a href="#InteractiveMode-308"><span class="linenos">308</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode-309"><a href="#InteractiveMode-309"><span class="linenos">309</span></a><span class="sd">        features : ResNetFeatures</span>
</span><span id="InteractiveMode-310"><a href="#InteractiveMode-310"><span class="linenos">310</span></a><span class="sd">            Input feature database object.</span>
</span><span id="InteractiveMode-311"><a href="#InteractiveMode-311"><span class="linenos">311</span></a><span class="sd">        default_filename : str</span>
</span><span id="InteractiveMode-312"><a href="#InteractiveMode-312"><span class="linenos">312</span></a><span class="sd">            Base filename for saving outputs.</span>
</span><span id="InteractiveMode-313"><a href="#InteractiveMode-313"><span class="linenos">313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode-314"><a href="#InteractiveMode-314"><span class="linenos">314</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;The standard algorithm: </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode-315"><a href="#InteractiveMode-315"><span class="linenos">315</span></a>            <span class="s1">&#39;1. Filtration of ResNet features by variance, thershold=1e-5 </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode-316"><a href="#InteractiveMode-316"><span class="linenos">316</span></a>            <span class="s1">&#39;2. Preprocessing of the filtered features with </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode-317"><a href="#InteractiveMode-317"><span class="linenos">317</span></a>            <span class="s1">&#39;   - PCA(n_components=0.95, svd_solver=</span><span class="se">\&#39;</span><span class="s1">full</span><span class="se">\&#39;</span><span class="s1">) </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode-318"><a href="#InteractiveMode-318"><span class="linenos">318</span></a>            <span class="s1">&#39;   - UMAP(n_components=20, min_dist=0.1, metric=</span><span class="se">\&#39;</span><span class="s1">cosine</span><span class="se">\&#39;</span><span class="s1">) </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode-319"><a href="#InteractiveMode-319"><span class="linenos">319</span></a>            <span class="s1">&#39;3. Clusterization </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode-320"><a href="#InteractiveMode-320"><span class="linenos">320</span></a>            <span class="s1">&#39;- HDBSCAN(min_cluster_size=15, min_samples=5, metric=</span><span class="se">\&#39;</span><span class="s1">euclidean</span><span class="se">\&#39;</span><span class="s1">) </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode-321"><a href="#InteractiveMode-321"><span class="linenos">321</span></a>            <span class="s1">&#39;4. Visualization with PCA+UMAP2D+HDBSCAN&#39;</span>
</span><span id="InteractiveMode-322"><a href="#InteractiveMode-322"><span class="linenos">322</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="InteractiveMode-323"><a href="#InteractiveMode-323"><span class="linenos">323</span></a>        
</span><span id="InteractiveMode-324"><a href="#InteractiveMode-324"><span class="linenos">324</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">filtration</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</span><span id="InteractiveMode-325"><a href="#InteractiveMode-325"><span class="linenos">325</span></a>
</span><span id="InteractiveMode-326"><a href="#InteractiveMode-326"><span class="linenos">326</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Enter a file name to save the filtered data (or press &quot;Enter&quot; to use default name): &#39;</span>
</span><span id="InteractiveMode-327"><a href="#InteractiveMode-327"><span class="linenos">327</span></a>        <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">saving_database</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">suf</span><span class="o">=</span><span class="s1">&#39;_filtered&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-328"><a href="#InteractiveMode-328"><span class="linenos">328</span></a>
</span><span id="InteractiveMode-329"><a href="#InteractiveMode-329"><span class="linenos">329</span></a>        <span class="n">processed</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">run_preprocessing</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="s1">&#39;PCA+UMAPND&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-330"><a href="#InteractiveMode-330"><span class="linenos">330</span></a>
</span><span id="InteractiveMode-331"><a href="#InteractiveMode-331"><span class="linenos">331</span></a>        <span class="n">clusters</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">run_clusterization</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>
</span><span id="InteractiveMode-332"><a href="#InteractiveMode-332"><span class="linenos">332</span></a>
</span><span id="InteractiveMode-333"><a href="#InteractiveMode-333"><span class="linenos">333</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Enter a file name to save the clustered data (or press &quot;Enter&quot; to use default name): &#39;</span>
</span><span id="InteractiveMode-334"><a href="#InteractiveMode-334"><span class="linenos">334</span></a>        <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">saving_database</span><span class="p">(</span><span class="n">clusters</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">suf</span><span class="o">=</span><span class="s1">&#39;_clustered&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-335"><a href="#InteractiveMode-335"><span class="linenos">335</span></a>
</span><span id="InteractiveMode-336"><a href="#InteractiveMode-336"><span class="linenos">336</span></a>        <span class="c1"># Visualization</span>
</span><span id="InteractiveMode-337"><a href="#InteractiveMode-337"><span class="linenos">337</span></a>        <span class="n">clusters</span><span class="o">.</span><span class="n">visualize_HDBSCAN</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
</span><span id="InteractiveMode-338"><a href="#InteractiveMode-338"><span class="linenos">338</span></a>
</span><span id="InteractiveMode-339"><a href="#InteractiveMode-339"><span class="linenos">339</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode-340"><a href="#InteractiveMode-340"><span class="linenos">340</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filtration</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
</span><span id="InteractiveMode-341"><a href="#InteractiveMode-341"><span class="linenos">341</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode-342"><a href="#InteractiveMode-342"><span class="linenos">342</span></a><span class="sd">        Applies variance-based filtering to the feature set.</span>
</span><span id="InteractiveMode-343"><a href="#InteractiveMode-343"><span class="linenos">343</span></a>
</span><span id="InteractiveMode-344"><a href="#InteractiveMode-344"><span class="linenos">344</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode-345"><a href="#InteractiveMode-345"><span class="linenos">345</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode-346"><a href="#InteractiveMode-346"><span class="linenos">346</span></a><span class="sd">        features : ResNetFeatures</span>
</span><span id="InteractiveMode-347"><a href="#InteractiveMode-347"><span class="linenos">347</span></a><span class="sd">            Input feature database.</span>
</span><span id="InteractiveMode-348"><a href="#InteractiveMode-348"><span class="linenos">348</span></a>
</span><span id="InteractiveMode-349"><a href="#InteractiveMode-349"><span class="linenos">349</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode-350"><a href="#InteractiveMode-350"><span class="linenos">350</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode-351"><a href="#InteractiveMode-351"><span class="linenos">351</span></a><span class="sd">        ResNetFeatures</span>
</span><span id="InteractiveMode-352"><a href="#InteractiveMode-352"><span class="linenos">352</span></a><span class="sd">            Filtered features with updated `.database`.</span>
</span><span id="InteractiveMode-353"><a href="#InteractiveMode-353"><span class="linenos">353</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode-354"><a href="#InteractiveMode-354"><span class="linenos">354</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filtration&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-355"><a href="#InteractiveMode-355"><span class="linenos">355</span></a>        <span class="n">features</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">filtering_by_variance</span><span class="p">()</span>
</span><span id="InteractiveMode-356"><a href="#InteractiveMode-356"><span class="linenos">356</span></a>        <span class="n">features</span><span class="o">.</span><span class="n">info_on_features</span><span class="p">()</span>
</span><span id="InteractiveMode-357"><a href="#InteractiveMode-357"><span class="linenos">357</span></a>        <span class="k">return</span> <span class="n">features</span>
</span><span id="InteractiveMode-358"><a href="#InteractiveMode-358"><span class="linenos">358</span></a>    
</span><span id="InteractiveMode-359"><a href="#InteractiveMode-359"><span class="linenos">359</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode-360"><a href="#InteractiveMode-360"><span class="linenos">360</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_name_to_save</span><span class="p">(</span><span class="n">default_filename</span><span class="p">,</span> <span class="n">file_to_write</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="InteractiveMode-361"><a href="#InteractiveMode-361"><span class="linenos">361</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode-362"><a href="#InteractiveMode-362"><span class="linenos">362</span></a><span class="sd">        Constructs a filename by combining a base name with a suffix.</span>
</span><span id="InteractiveMode-363"><a href="#InteractiveMode-363"><span class="linenos">363</span></a>
</span><span id="InteractiveMode-364"><a href="#InteractiveMode-364"><span class="linenos">364</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode-365"><a href="#InteractiveMode-365"><span class="linenos">365</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode-366"><a href="#InteractiveMode-366"><span class="linenos">366</span></a><span class="sd">        default_filename : str</span>
</span><span id="InteractiveMode-367"><a href="#InteractiveMode-367"><span class="linenos">367</span></a><span class="sd">            Base filename.</span>
</span><span id="InteractiveMode-368"><a href="#InteractiveMode-368"><span class="linenos">368</span></a><span class="sd">        file_to_write : str, optional</span>
</span><span id="InteractiveMode-369"><a href="#InteractiveMode-369"><span class="linenos">369</span></a><span class="sd">            Custom filename provided by the user.</span>
</span><span id="InteractiveMode-370"><a href="#InteractiveMode-370"><span class="linenos">370</span></a><span class="sd">        suffix : str, optional</span>
</span><span id="InteractiveMode-371"><a href="#InteractiveMode-371"><span class="linenos">371</span></a><span class="sd">            Suffix to append to the filename.</span>
</span><span id="InteractiveMode-372"><a href="#InteractiveMode-372"><span class="linenos">372</span></a>
</span><span id="InteractiveMode-373"><a href="#InteractiveMode-373"><span class="linenos">373</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode-374"><a href="#InteractiveMode-374"><span class="linenos">374</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode-375"><a href="#InteractiveMode-375"><span class="linenos">375</span></a><span class="sd">        str</span>
</span><span id="InteractiveMode-376"><a href="#InteractiveMode-376"><span class="linenos">376</span></a><span class="sd">            Full filename with optional suffix.</span>
</span><span id="InteractiveMode-377"><a href="#InteractiveMode-377"><span class="linenos">377</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode-378"><a href="#InteractiveMode-378"><span class="linenos">378</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_to_write</span><span class="p">:</span>
</span><span id="InteractiveMode-379"><a href="#InteractiveMode-379"><span class="linenos">379</span></a>            <span class="n">file_to_write</span> <span class="o">=</span> <span class="n">default_filename</span>
</span><span id="InteractiveMode-380"><a href="#InteractiveMode-380"><span class="linenos">380</span></a>        <span class="k">if</span> <span class="n">suffix</span><span class="p">:</span>
</span><span id="InteractiveMode-381"><a href="#InteractiveMode-381"><span class="linenos">381</span></a>            <span class="n">file_to_write</span> <span class="o">+=</span> <span class="n">suffix</span>
</span><span id="InteractiveMode-382"><a href="#InteractiveMode-382"><span class="linenos">382</span></a>        <span class="k">return</span> <span class="n">file_to_write</span>
</span><span id="InteractiveMode-383"><a href="#InteractiveMode-383"><span class="linenos">383</span></a>    
</span><span id="InteractiveMode-384"><a href="#InteractiveMode-384"><span class="linenos">384</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode-385"><a href="#InteractiveMode-385"><span class="linenos">385</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">saving_database</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">suf</span><span class="p">):</span>
</span><span id="InteractiveMode-386"><a href="#InteractiveMode-386"><span class="linenos">386</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode-387"><a href="#InteractiveMode-387"><span class="linenos">387</span></a><span class="sd">        Prompts the user to save the DataFrame to a file with optional suffix.</span>
</span><span id="InteractiveMode-388"><a href="#InteractiveMode-388"><span class="linenos">388</span></a>
</span><span id="InteractiveMode-389"><a href="#InteractiveMode-389"><span class="linenos">389</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode-390"><a href="#InteractiveMode-390"><span class="linenos">390</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode-391"><a href="#InteractiveMode-391"><span class="linenos">391</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="InteractiveMode-392"><a href="#InteractiveMode-392"><span class="linenos">392</span></a><span class="sd">            Data to be saved.</span>
</span><span id="InteractiveMode-393"><a href="#InteractiveMode-393"><span class="linenos">393</span></a><span class="sd">        default_filename : str</span>
</span><span id="InteractiveMode-394"><a href="#InteractiveMode-394"><span class="linenos">394</span></a><span class="sd">            Default file base name.</span>
</span><span id="InteractiveMode-395"><a href="#InteractiveMode-395"><span class="linenos">395</span></a><span class="sd">        message : str</span>
</span><span id="InteractiveMode-396"><a href="#InteractiveMode-396"><span class="linenos">396</span></a><span class="sd">            Prompt shown to the user.</span>
</span><span id="InteractiveMode-397"><a href="#InteractiveMode-397"><span class="linenos">397</span></a><span class="sd">        suf : str</span>
</span><span id="InteractiveMode-398"><a href="#InteractiveMode-398"><span class="linenos">398</span></a><span class="sd">            Default suffix to append to the filename.</span>
</span><span id="InteractiveMode-399"><a href="#InteractiveMode-399"><span class="linenos">399</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode-400"><a href="#InteractiveMode-400"><span class="linenos">400</span></a>        <span class="n">file_to_write</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="InteractiveMode-401"><a href="#InteractiveMode-401"><span class="linenos">401</span></a>        <span class="n">suffix</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;or/and enter a suffix to the filename: &#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">suf</span>
</span><span id="InteractiveMode-402"><a href="#InteractiveMode-402"><span class="linenos">402</span></a>        <span class="n">file_to_write</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">create_name_to_save</span><span class="p">(</span><span class="n">default_filename</span><span class="p">,</span> <span class="n">file_to_write</span><span class="o">=</span><span class="n">file_to_write</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>
</span><span id="InteractiveMode-403"><a href="#InteractiveMode-403"><span class="linenos">403</span></a>        <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">save_database</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">file_to_write</span><span class="o">=</span><span class="n">file_to_write</span><span class="p">)</span>
</span><span id="InteractiveMode-404"><a href="#InteractiveMode-404"><span class="linenos">404</span></a>
</span><span id="InteractiveMode-405"><a href="#InteractiveMode-405"><span class="linenos">405</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode-406"><a href="#InteractiveMode-406"><span class="linenos">406</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_preprocessing</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">pipe_str</span><span class="o">=</span><span class="s1">&#39;PCA+UMAPND&#39;</span><span class="p">):</span>
</span><span id="InteractiveMode-407"><a href="#InteractiveMode-407"><span class="linenos">407</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode-408"><a href="#InteractiveMode-408"><span class="linenos">408</span></a><span class="sd">        Applies a sequence of dimensionality reduction steps to the feature matrix.</span>
</span><span id="InteractiveMode-409"><a href="#InteractiveMode-409"><span class="linenos">409</span></a>
</span><span id="InteractiveMode-410"><a href="#InteractiveMode-410"><span class="linenos">410</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode-411"><a href="#InteractiveMode-411"><span class="linenos">411</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode-412"><a href="#InteractiveMode-412"><span class="linenos">412</span></a><span class="sd">        features : ResNetFeatures</span>
</span><span id="InteractiveMode-413"><a href="#InteractiveMode-413"><span class="linenos">413</span></a><span class="sd">            The extracted and optionally filtered features.</span>
</span><span id="InteractiveMode-414"><a href="#InteractiveMode-414"><span class="linenos">414</span></a><span class="sd">        pipe_str : str, optional</span>
</span><span id="InteractiveMode-415"><a href="#InteractiveMode-415"><span class="linenos">415</span></a><span class="sd">            Pipeline specification string, e.g., &#39;PCA+UMAPND&#39;.</span>
</span><span id="InteractiveMode-416"><a href="#InteractiveMode-416"><span class="linenos">416</span></a>
</span><span id="InteractiveMode-417"><a href="#InteractiveMode-417"><span class="linenos">417</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode-418"><a href="#InteractiveMode-418"><span class="linenos">418</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode-419"><a href="#InteractiveMode-419"><span class="linenos">419</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="InteractiveMode-420"><a href="#InteractiveMode-420"><span class="linenos">420</span></a><span class="sd">            Transformed feature DataFrame with original metadata preserved.</span>
</span><span id="InteractiveMode-421"><a href="#InteractiveMode-421"><span class="linenos">421</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode-422"><a href="#InteractiveMode-422"><span class="linenos">422</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Preprocessing&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-423"><a href="#InteractiveMode-423"><span class="linenos">423</span></a>        <span class="n">preprop</span> <span class="o">=</span> <span class="n">FeaturesPreprocessing</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</span><span id="InteractiveMode-424"><a href="#InteractiveMode-424"><span class="linenos">424</span></a>        <span class="n">processed</span> <span class="o">=</span> <span class="n">preprop</span><span class="o">.</span><span class="n">wrapper_preprop</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="n">pipe_str</span><span class="p">)</span>
</span><span id="InteractiveMode-425"><a href="#InteractiveMode-425"><span class="linenos">425</span></a>        <span class="k">return</span> <span class="n">processed</span>
</span><span id="InteractiveMode-426"><a href="#InteractiveMode-426"><span class="linenos">426</span></a>    
</span><span id="InteractiveMode-427"><a href="#InteractiveMode-427"><span class="linenos">427</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode-428"><a href="#InteractiveMode-428"><span class="linenos">428</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_clusterization</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
</span><span id="InteractiveMode-429"><a href="#InteractiveMode-429"><span class="linenos">429</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode-430"><a href="#InteractiveMode-430"><span class="linenos">430</span></a><span class="sd">        Performs HDBSCAN clustering and sorts image files into corresponding folders.</span>
</span><span id="InteractiveMode-431"><a href="#InteractiveMode-431"><span class="linenos">431</span></a>
</span><span id="InteractiveMode-432"><a href="#InteractiveMode-432"><span class="linenos">432</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode-433"><a href="#InteractiveMode-433"><span class="linenos">433</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode-434"><a href="#InteractiveMode-434"><span class="linenos">434</span></a><span class="sd">        features : pandas.DataFrame</span>
</span><span id="InteractiveMode-435"><a href="#InteractiveMode-435"><span class="linenos">435</span></a><span class="sd">            The feature matrix with metadata.</span>
</span><span id="InteractiveMode-436"><a href="#InteractiveMode-436"><span class="linenos">436</span></a>
</span><span id="InteractiveMode-437"><a href="#InteractiveMode-437"><span class="linenos">437</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode-438"><a href="#InteractiveMode-438"><span class="linenos">438</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode-439"><a href="#InteractiveMode-439"><span class="linenos">439</span></a><span class="sd">        Clustering</span>
</span><span id="InteractiveMode-440"><a href="#InteractiveMode-440"><span class="linenos">440</span></a><span class="sd">            Clustering object with updated label assignments and organized folders.</span>
</span><span id="InteractiveMode-441"><a href="#InteractiveMode-441"><span class="linenos">441</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode-442"><a href="#InteractiveMode-442"><span class="linenos">442</span></a>
</span><span id="InteractiveMode-443"><a href="#InteractiveMode-443"><span class="linenos">443</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Clusterization&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-444"><a href="#InteractiveMode-444"><span class="linenos">444</span></a>        <span class="n">clusters</span> <span class="o">=</span> <span class="n">Clustering</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</span><span id="InteractiveMode-445"><a href="#InteractiveMode-445"><span class="linenos">445</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</span><span id="InteractiveMode-446"><a href="#InteractiveMode-446"><span class="linenos">446</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">num_clusters</span> <span class="o">=</span> <span class="n">clusters</span><span class="o">.</span><span class="n">clustering_HDBSCAN</span><span class="p">(</span><span class="n">df_features</span><span class="p">)</span>
</span><span id="InteractiveMode-447"><a href="#InteractiveMode-447"><span class="linenos">447</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of clusters 20D: </span><span class="si">{</span><span class="n">num_clusters</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode-448"><a href="#InteractiveMode-448"><span class="linenos">448</span></a>        <span class="n">clusters</span><span class="o">.</span><span class="n">update_database</span><span class="p">()</span>
</span><span id="InteractiveMode-449"><a href="#InteractiveMode-449"><span class="linenos">449</span></a>        <span class="n">clusters</span><span class="o">.</span><span class="n">sort_files</span><span class="p">()</span>
</span><span id="InteractiveMode-450"><a href="#InteractiveMode-450"><span class="linenos">450</span></a>        <span class="k">return</span> <span class="n">clusters</span>
</span></pre></div>


            <div class="docstring"><p>Provides a user-friendly interactive interface to the full pipeline of feature extraction,
preprocessing, clustering, and result saving.</p>

<p>This class serves as a high-level command-line wrapper around the functionality defined
in modules like <code>libfeatures</code>, <code>libpreprocessing</code>, and <code>libclustering</code>. It guides the
user through a series of prompts to configure and execute data processing operations.</p>

<p>This class is not intended to be instantiated.</p>
</div>


                            <div id="InteractiveMode.welcome_message" class="classattr">
                                        <input id="InteractiveMode.welcome_message-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">welcome_message</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InteractiveMode.welcome_message-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InteractiveMode.welcome_message"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InteractiveMode.welcome_message-31"><a href="#InteractiveMode.welcome_message-31"><span class="linenos">31</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode.welcome_message-32"><a href="#InteractiveMode.welcome_message-32"><span class="linenos">32</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">welcome_message</span><span class="p">():</span>
</span><span id="InteractiveMode.welcome_message-33"><a href="#InteractiveMode.welcome_message-33"><span class="linenos">33</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode.welcome_message-34"><a href="#InteractiveMode.welcome_message-34"><span class="linenos">34</span></a><span class="sd">        Prints a welcome message with initial instructions for placing image data.</span>
</span><span id="InteractiveMode.welcome_message-35"><a href="#InteractiveMode.welcome_message-35"><span class="linenos">35</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode.welcome_message-36"><a href="#InteractiveMode.welcome_message-36"><span class="linenos">36</span></a>
</span><span id="InteractiveMode.welcome_message-37"><a href="#InteractiveMode.welcome_message-37"><span class="linenos">37</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Welcome to the script! </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode.welcome_message-38"><a href="#InteractiveMode.welcome_message-38"><span class="linenos">38</span></a>        <span class="s1">&#39;First place your images in a separate folder (into &quot;./images/&quot;) named according to the template: </span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
</span><span id="InteractiveMode.welcome_message-39"><a href="#InteractiveMode.welcome_message-39"><span class="linenos">39</span></a><span class="s1">        &quot;images_(your_specification)&quot;&#39;</span>
</span><span id="InteractiveMode.welcome_message-40"><a href="#InteractiveMode.welcome_message-40"><span class="linenos">40</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Prints a welcome message with initial instructions for placing image data.</p>
</div>


                            </div>
                            <div id="InteractiveMode.preparations" class="classattr">
                                        <input id="InteractiveMode.preparations-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">preparations</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InteractiveMode.preparations-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InteractiveMode.preparations"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InteractiveMode.preparations-42"><a href="#InteractiveMode.preparations-42"><span class="linenos">42</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode.preparations-43"><a href="#InteractiveMode.preparations-43"><span class="linenos">43</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">preparations</span><span class="p">():</span>
</span><span id="InteractiveMode.preparations-44"><a href="#InteractiveMode.preparations-44"><span class="linenos">44</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode.preparations-45"><a href="#InteractiveMode.preparations-45"><span class="linenos">45</span></a><span class="sd">        Prepares required working directories and gathers the users image folder name.</span>
</span><span id="InteractiveMode.preparations-46"><a href="#InteractiveMode.preparations-46"><span class="linenos">46</span></a>
</span><span id="InteractiveMode.preparations-47"><a href="#InteractiveMode.preparations-47"><span class="linenos">47</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode.preparations-48"><a href="#InteractiveMode.preparations-48"><span class="linenos">48</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode.preparations-49"><a href="#InteractiveMode.preparations-49"><span class="linenos">49</span></a><span class="sd">        input_imags : str</span>
</span><span id="InteractiveMode.preparations-50"><a href="#InteractiveMode.preparations-50"><span class="linenos">50</span></a><span class="sd">            Name of the user-specified image subdirectory.</span>
</span><span id="InteractiveMode.preparations-51"><a href="#InteractiveMode.preparations-51"><span class="linenos">51</span></a><span class="sd">        default_filename : str</span>
</span><span id="InteractiveMode.preparations-52"><a href="#InteractiveMode.preparations-52"><span class="linenos">52</span></a><span class="sd">            Suggested default filename for saving feature data.</span>
</span><span id="InteractiveMode.preparations-53"><a href="#InteractiveMode.preparations-53"><span class="linenos">53</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode.preparations-54"><a href="#InteractiveMode.preparations-54"><span class="linenos">54</span></a>
</span><span id="InteractiveMode.preparations-55"><a href="#InteractiveMode.preparations-55"><span class="linenos">55</span></a>        <span class="n">base_dir_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;./images&#39;</span><span class="p">,</span> <span class="s1">&#39;./processed&#39;</span><span class="p">,</span> <span class="s1">&#39;./figures&#39;</span><span class="p">,</span> <span class="s1">&#39;./data&#39;</span><span class="p">,</span> <span class="s1">&#39;./results&#39;</span><span class="p">]</span>
</span><span id="InteractiveMode.preparations-56"><a href="#InteractiveMode.preparations-56"><span class="linenos">56</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Use &quot;./processed&quot; folder for processed images </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode.preparations-57"><a href="#InteractiveMode.preparations-57"><span class="linenos">57</span></a>        <span class="s1">&#39;&quot;./data&quot; folder for info metadata </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode.preparations-58"><a href="#InteractiveMode.preparations-58"><span class="linenos">58</span></a>        <span class="s1">&#39;&quot;./figures&quot; and &quot;./results&quot; for graphic and data results, respectively.&#39;</span>
</span><span id="InteractiveMode.preparations-59"><a href="#InteractiveMode.preparations-59"><span class="linenos">59</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="InteractiveMode.preparations-60"><a href="#InteractiveMode.preparations-60"><span class="linenos">60</span></a>
</span><span id="InteractiveMode.preparations-61"><a href="#InteractiveMode.preparations-61"><span class="linenos">61</span></a>        <span class="k">for</span> <span class="n">dirname</span> <span class="ow">in</span> <span class="n">base_dir_names</span><span class="p">:</span>
</span><span id="InteractiveMode.preparations-62"><a href="#InteractiveMode.preparations-62"><span class="linenos">62</span></a>            <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">preparing_folder</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="InteractiveMode.preparations-63"><a href="#InteractiveMode.preparations-63"><span class="linenos">63</span></a>
</span><span id="InteractiveMode.preparations-64"><a href="#InteractiveMode.preparations-64"><span class="linenos">64</span></a>        <span class="n">input_imags</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Please enter the name of your working directory: &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;./, &#39;</span><span class="p">)</span>
</span><span id="InteractiveMode.preparations-65"><a href="#InteractiveMode.preparations-65"><span class="linenos">65</span></a>        <span class="n">specification</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">input_name</span><span class="p">(</span><span class="n">input_imags</span><span class="p">)</span>
</span><span id="InteractiveMode.preparations-66"><a href="#InteractiveMode.preparations-66"><span class="linenos">66</span></a>        <span class="n">results_dir</span> <span class="o">=</span> <span class="s1">&#39;./processed/processed_&#39;</span><span class="o">+</span><span class="n">specification</span>
</span><span id="InteractiveMode.preparations-67"><a href="#InteractiveMode.preparations-67"><span class="linenos">67</span></a>        <span class="n">default_filename</span> <span class="o">=</span> <span class="s1">&#39;./results/pearson_diagram_data_&#39;</span><span class="o">+</span><span class="n">specification</span>
</span><span id="InteractiveMode.preparations-68"><a href="#InteractiveMode.preparations-68"><span class="linenos">68</span></a>
</span><span id="InteractiveMode.preparations-69"><a href="#InteractiveMode.preparations-69"><span class="linenos">69</span></a>        <span class="n">clear</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">get_bool</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;If folder </span><span class="si">{</span><span class="n">results_dir</span><span class="si">}</span><span class="s1"> already exists would you like to clear its contents? (True or False) &#39;</span><span class="p">)</span>
</span><span id="InteractiveMode.preparations-70"><a href="#InteractiveMode.preparations-70"><span class="linenos">70</span></a>        <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">preparing_folder</span><span class="p">(</span><span class="n">results_dir</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="n">clear</span><span class="p">)</span>
</span><span id="InteractiveMode.preparations-71"><a href="#InteractiveMode.preparations-71"><span class="linenos">71</span></a>
</span><span id="InteractiveMode.preparations-72"><a href="#InteractiveMode.preparations-72"><span class="linenos">72</span></a>        <span class="k">return</span> <span class="n">input_imags</span><span class="p">,</span> <span class="n">default_filename</span>
</span></pre></div>


            <div class="docstring"><p>Prepares required working directories and gathers the users image folder name.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>input_imags</strong> (str):
Name of the user-specified image subdirectory.</li>
<li><strong>default_filename</strong> (str):
Suggested default filename for saving feature data.</li>
</ul>
</div>


                            </div>
                            <div id="InteractiveMode.get_bool" class="classattr">
                                        <input id="InteractiveMode.get_bool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_bool</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="InteractiveMode.get_bool-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InteractiveMode.get_bool"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InteractiveMode.get_bool-74"><a href="#InteractiveMode.get_bool-74"><span class="linenos"> 74</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode.get_bool-75"><a href="#InteractiveMode.get_bool-75"><span class="linenos"> 75</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_bool</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span> 
</span><span id="InteractiveMode.get_bool-76"><a href="#InteractiveMode.get_bool-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode.get_bool-77"><a href="#InteractiveMode.get_bool-77"><span class="linenos"> 77</span></a><span class="sd">        Prompts the user for a True/False response.</span>
</span><span id="InteractiveMode.get_bool-78"><a href="#InteractiveMode.get_bool-78"><span class="linenos"> 78</span></a>
</span><span id="InteractiveMode.get_bool-79"><a href="#InteractiveMode.get_bool-79"><span class="linenos"> 79</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode.get_bool-80"><a href="#InteractiveMode.get_bool-80"><span class="linenos"> 80</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode.get_bool-81"><a href="#InteractiveMode.get_bool-81"><span class="linenos"> 81</span></a><span class="sd">        prompt : str</span>
</span><span id="InteractiveMode.get_bool-82"><a href="#InteractiveMode.get_bool-82"><span class="linenos"> 82</span></a><span class="sd">            Prompt text for user input.</span>
</span><span id="InteractiveMode.get_bool-83"><a href="#InteractiveMode.get_bool-83"><span class="linenos"> 83</span></a>
</span><span id="InteractiveMode.get_bool-84"><a href="#InteractiveMode.get_bool-84"><span class="linenos"> 84</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode.get_bool-85"><a href="#InteractiveMode.get_bool-85"><span class="linenos"> 85</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode.get_bool-86"><a href="#InteractiveMode.get_bool-86"><span class="linenos"> 86</span></a><span class="sd">        bool</span>
</span><span id="InteractiveMode.get_bool-87"><a href="#InteractiveMode.get_bool-87"><span class="linenos"> 87</span></a><span class="sd">            Boolean interpretation of the user&#39;s input.</span>
</span><span id="InteractiveMode.get_bool-88"><a href="#InteractiveMode.get_bool-88"><span class="linenos"> 88</span></a>
</span><span id="InteractiveMode.get_bool-89"><a href="#InteractiveMode.get_bool-89"><span class="linenos"> 89</span></a><span class="sd">        Raises</span>
</span><span id="InteractiveMode.get_bool-90"><a href="#InteractiveMode.get_bool-90"><span class="linenos"> 90</span></a><span class="sd">        ------</span>
</span><span id="InteractiveMode.get_bool-91"><a href="#InteractiveMode.get_bool-91"><span class="linenos"> 91</span></a><span class="sd">        KeyError</span>
</span><span id="InteractiveMode.get_bool-92"><a href="#InteractiveMode.get_bool-92"><span class="linenos"> 92</span></a><span class="sd">            If input is not &#39;true&#39; or &#39;false&#39; (case-insensitive).</span>
</span><span id="InteractiveMode.get_bool-93"><a href="#InteractiveMode.get_bool-93"><span class="linenos"> 93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode.get_bool-94"><a href="#InteractiveMode.get_bool-94"><span class="linenos"> 94</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="InteractiveMode.get_bool-95"><a href="#InteractiveMode.get_bool-95"><span class="linenos"> 95</span></a>            
</span><span id="InteractiveMode.get_bool-96"><a href="#InteractiveMode.get_bool-96"><span class="linenos"> 96</span></a>                <span class="n">answ</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="InteractiveMode.get_bool-97"><a href="#InteractiveMode.get_bool-97"><span class="linenos"> 97</span></a>                <span class="k">if</span> <span class="n">answ</span><span class="p">:</span>
</span><span id="InteractiveMode.get_bool-98"><a href="#InteractiveMode.get_bool-98"><span class="linenos"> 98</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="InteractiveMode.get_bool-99"><a href="#InteractiveMode.get_bool-99"><span class="linenos"> 99</span></a>                        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}[</span><span class="n">answ</span><span class="p">]</span>
</span><span id="InteractiveMode.get_bool-100"><a href="#InteractiveMode.get_bool-100"><span class="linenos">100</span></a>                    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="InteractiveMode.get_bool-101"><a href="#InteractiveMode.get_bool-101"><span class="linenos">101</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid input, please enter True or False! </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode.get_bool-102"><a href="#InteractiveMode.get_bool-102"><span class="linenos">102</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="InteractiveMode.get_bool-103"><a href="#InteractiveMode.get_bool-103"><span class="linenos">103</span></a>                    <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Prompts the user for a True/False response.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>prompt</strong> (str):
Prompt text for user input.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>bool</strong>: Boolean interpretation of the user's input.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>KeyError</strong>: If input is not 'true' or 'false' (case-insensitive).</li>
</ul>
</div>


                            </div>
                            <div id="InteractiveMode.filter_mixed_freq" class="classattr">
                                        <input id="InteractiveMode.filter_mixed_freq-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">filter_mixed_freq</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name_pattern</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InteractiveMode.filter_mixed_freq-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InteractiveMode.filter_mixed_freq"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InteractiveMode.filter_mixed_freq-106"><a href="#InteractiveMode.filter_mixed_freq-106"><span class="linenos">106</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode.filter_mixed_freq-107"><a href="#InteractiveMode.filter_mixed_freq-107"><span class="linenos">107</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_mixed_freq</span><span class="p">(</span><span class="n">name_pattern</span><span class="p">):</span>
</span><span id="InteractiveMode.filter_mixed_freq-108"><a href="#InteractiveMode.filter_mixed_freq-108"><span class="linenos">108</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode.filter_mixed_freq-109"><a href="#InteractiveMode.filter_mixed_freq-109"><span class="linenos">109</span></a><span class="sd">        Asks the user whether to filter out mixed-frequency data.</span>
</span><span id="InteractiveMode.filter_mixed_freq-110"><a href="#InteractiveMode.filter_mixed_freq-110"><span class="linenos">110</span></a>
</span><span id="InteractiveMode.filter_mixed_freq-111"><a href="#InteractiveMode.filter_mixed_freq-111"><span class="linenos">111</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode.filter_mixed_freq-112"><a href="#InteractiveMode.filter_mixed_freq-112"><span class="linenos">112</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode.filter_mixed_freq-113"><a href="#InteractiveMode.filter_mixed_freq-113"><span class="linenos">113</span></a><span class="sd">        name_pattern : str</span>
</span><span id="InteractiveMode.filter_mixed_freq-114"><a href="#InteractiveMode.filter_mixed_freq-114"><span class="linenos">114</span></a><span class="sd">            Default regular expression used to match dataset names.</span>
</span><span id="InteractiveMode.filter_mixed_freq-115"><a href="#InteractiveMode.filter_mixed_freq-115"><span class="linenos">115</span></a>
</span><span id="InteractiveMode.filter_mixed_freq-116"><a href="#InteractiveMode.filter_mixed_freq-116"><span class="linenos">116</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode.filter_mixed_freq-117"><a href="#InteractiveMode.filter_mixed_freq-117"><span class="linenos">117</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode.filter_mixed_freq-118"><a href="#InteractiveMode.filter_mixed_freq-118"><span class="linenos">118</span></a><span class="sd">        filter_mixed : bool</span>
</span><span id="InteractiveMode.filter_mixed_freq-119"><a href="#InteractiveMode.filter_mixed_freq-119"><span class="linenos">119</span></a><span class="sd">            Whether to apply frequency filtering.</span>
</span><span id="InteractiveMode.filter_mixed_freq-120"><a href="#InteractiveMode.filter_mixed_freq-120"><span class="linenos">120</span></a><span class="sd">        name_pattern : str</span>
</span><span id="InteractiveMode.filter_mixed_freq-121"><a href="#InteractiveMode.filter_mixed_freq-121"><span class="linenos">121</span></a><span class="sd">            Possibly updated regex pattern provided by the user.</span>
</span><span id="InteractiveMode.filter_mixed_freq-122"><a href="#InteractiveMode.filter_mixed_freq-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode.filter_mixed_freq-123"><a href="#InteractiveMode.filter_mixed_freq-123"><span class="linenos">123</span></a>
</span><span id="InteractiveMode.filter_mixed_freq-124"><a href="#InteractiveMode.filter_mixed_freq-124"><span class="linenos">124</span></a>        <span class="n">filter_mixed</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">get_bool</span><span class="p">(</span><span class="s1">&#39;Would you like to filter mixed frequencies? (True or False) &#39;</span><span class="p">)</span>
</span><span id="InteractiveMode.filter_mixed_freq-125"><a href="#InteractiveMode.filter_mixed_freq-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="n">filter_mixed</span><span class="p">:</span>
</span><span id="InteractiveMode.filter_mixed_freq-126"><a href="#InteractiveMode.filter_mixed_freq-126"><span class="linenos">126</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Check the name pattern: </span><span class="si">{</span><span class="n">name_pattern</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode.filter_mixed_freq-127"><a href="#InteractiveMode.filter_mixed_freq-127"><span class="linenos">127</span></a>            <span class="n">np_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Change if it is needed or press &quot;Enter&quot;: &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="InteractiveMode.filter_mixed_freq-128"><a href="#InteractiveMode.filter_mixed_freq-128"><span class="linenos">128</span></a>            <span class="k">if</span> <span class="n">np_input</span><span class="p">:</span>
</span><span id="InteractiveMode.filter_mixed_freq-129"><a href="#InteractiveMode.filter_mixed_freq-129"><span class="linenos">129</span></a>                <span class="n">name_pattern</span> <span class="o">=</span> <span class="n">np_input</span>
</span><span id="InteractiveMode.filter_mixed_freq-130"><a href="#InteractiveMode.filter_mixed_freq-130"><span class="linenos">130</span></a>        <span class="k">return</span> <span class="n">filter_mixed</span><span class="p">,</span> <span class="n">name_pattern</span>
</span></pre></div>


            <div class="docstring"><p>Asks the user whether to filter out mixed-frequency data.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>name_pattern</strong> (str):
Default regular expression used to match dataset names.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>filter_mixed</strong> (bool):
Whether to apply frequency filtering.</li>
<li><strong>name_pattern</strong> (str):
Possibly updated regex pattern provided by the user.</li>
</ul>
</div>


                            </div>
                            <div id="InteractiveMode.get_path" class="classattr">
                                        <input id="InteractiveMode.get_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_path</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">message</span>, </span><span class="param"><span class="n">default_path</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InteractiveMode.get_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InteractiveMode.get_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InteractiveMode.get_path-132"><a href="#InteractiveMode.get_path-132"><span class="linenos">132</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode.get_path-133"><a href="#InteractiveMode.get_path-133"><span class="linenos">133</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_path</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">default_path</span><span class="p">):</span>
</span><span id="InteractiveMode.get_path-134"><a href="#InteractiveMode.get_path-134"><span class="linenos">134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode.get_path-135"><a href="#InteractiveMode.get_path-135"><span class="linenos">135</span></a><span class="sd">        Gets a file path from the user, or uses the default if none is entered.</span>
</span><span id="InteractiveMode.get_path-136"><a href="#InteractiveMode.get_path-136"><span class="linenos">136</span></a>
</span><span id="InteractiveMode.get_path-137"><a href="#InteractiveMode.get_path-137"><span class="linenos">137</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode.get_path-138"><a href="#InteractiveMode.get_path-138"><span class="linenos">138</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode.get_path-139"><a href="#InteractiveMode.get_path-139"><span class="linenos">139</span></a><span class="sd">        message : str</span>
</span><span id="InteractiveMode.get_path-140"><a href="#InteractiveMode.get_path-140"><span class="linenos">140</span></a><span class="sd">            Prompt for the user.</span>
</span><span id="InteractiveMode.get_path-141"><a href="#InteractiveMode.get_path-141"><span class="linenos">141</span></a><span class="sd">        default_path : str</span>
</span><span id="InteractiveMode.get_path-142"><a href="#InteractiveMode.get_path-142"><span class="linenos">142</span></a><span class="sd">            Default path to return if user provides no input.</span>
</span><span id="InteractiveMode.get_path-143"><a href="#InteractiveMode.get_path-143"><span class="linenos">143</span></a>
</span><span id="InteractiveMode.get_path-144"><a href="#InteractiveMode.get_path-144"><span class="linenos">144</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode.get_path-145"><a href="#InteractiveMode.get_path-145"><span class="linenos">145</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode.get_path-146"><a href="#InteractiveMode.get_path-146"><span class="linenos">146</span></a><span class="sd">        str</span>
</span><span id="InteractiveMode.get_path-147"><a href="#InteractiveMode.get_path-147"><span class="linenos">147</span></a><span class="sd">            Final path.</span>
</span><span id="InteractiveMode.get_path-148"><a href="#InteractiveMode.get_path-148"><span class="linenos">148</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode.get_path-149"><a href="#InteractiveMode.get_path-149"><span class="linenos">149</span></a>
</span><span id="InteractiveMode.get_path-150"><a href="#InteractiveMode.get_path-150"><span class="linenos">150</span></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="InteractiveMode.get_path-151"><a href="#InteractiveMode.get_path-151"><span class="linenos">151</span></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span> <span class="k">if</span> <span class="n">file_path</span> <span class="k">else</span> <span class="n">default_path</span>
</span><span id="InteractiveMode.get_path-152"><a href="#InteractiveMode.get_path-152"><span class="linenos">152</span></a>        <span class="k">return</span> <span class="n">file_path</span>
</span></pre></div>


            <div class="docstring"><p>Gets a file path from the user, or uses the default if none is entered.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>message</strong> (str):
Prompt for the user.</li>
<li><strong>default_path</strong> (str):
Default path to return if user provides no input.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>str</strong>: Final path.</li>
</ul>
</div>


                            </div>
                            <div id="InteractiveMode.get_features" class="classattr">
                                        <input id="InteractiveMode.get_features-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_features</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">input_imags</span>, </span><span class="param"><span class="n">info_path</span>, </span><span class="param"><span class="n">default_filename</span>, </span><span class="param"><span class="n">name_pattern</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InteractiveMode.get_features-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InteractiveMode.get_features"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InteractiveMode.get_features-154"><a href="#InteractiveMode.get_features-154"><span class="linenos">154</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode.get_features-155"><a href="#InteractiveMode.get_features-155"><span class="linenos">155</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_features</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">info_path</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">):</span>
</span><span id="InteractiveMode.get_features-156"><a href="#InteractiveMode.get_features-156"><span class="linenos">156</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode.get_features-157"><a href="#InteractiveMode.get_features-157"><span class="linenos">157</span></a><span class="sd">        Asks the user whether to extract new features or read from file.</span>
</span><span id="InteractiveMode.get_features-158"><a href="#InteractiveMode.get_features-158"><span class="linenos">158</span></a>
</span><span id="InteractiveMode.get_features-159"><a href="#InteractiveMode.get_features-159"><span class="linenos">159</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode.get_features-160"><a href="#InteractiveMode.get_features-160"><span class="linenos">160</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode.get_features-161"><a href="#InteractiveMode.get_features-161"><span class="linenos">161</span></a><span class="sd">        input_imags : str</span>
</span><span id="InteractiveMode.get_features-162"><a href="#InteractiveMode.get_features-162"><span class="linenos">162</span></a><span class="sd">            Subdirectory name with image data.</span>
</span><span id="InteractiveMode.get_features-163"><a href="#InteractiveMode.get_features-163"><span class="linenos">163</span></a><span class="sd">        info_path : str</span>
</span><span id="InteractiveMode.get_features-164"><a href="#InteractiveMode.get_features-164"><span class="linenos">164</span></a><span class="sd">            Path to the metadata file.</span>
</span><span id="InteractiveMode.get_features-165"><a href="#InteractiveMode.get_features-165"><span class="linenos">165</span></a><span class="sd">        default_filename : str</span>
</span><span id="InteractiveMode.get_features-166"><a href="#InteractiveMode.get_features-166"><span class="linenos">166</span></a><span class="sd">            Default base filename for feature data.</span>
</span><span id="InteractiveMode.get_features-167"><a href="#InteractiveMode.get_features-167"><span class="linenos">167</span></a><span class="sd">        name_pattern : str</span>
</span><span id="InteractiveMode.get_features-168"><a href="#InteractiveMode.get_features-168"><span class="linenos">168</span></a><span class="sd">            Regex pattern for identifying dataset names.</span>
</span><span id="InteractiveMode.get_features-169"><a href="#InteractiveMode.get_features-169"><span class="linenos">169</span></a>
</span><span id="InteractiveMode.get_features-170"><a href="#InteractiveMode.get_features-170"><span class="linenos">170</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode.get_features-171"><a href="#InteractiveMode.get_features-171"><span class="linenos">171</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode.get_features-172"><a href="#InteractiveMode.get_features-172"><span class="linenos">172</span></a><span class="sd">        ResNetFeatures</span>
</span><span id="InteractiveMode.get_features-173"><a href="#InteractiveMode.get_features-173"><span class="linenos">173</span></a><span class="sd">            An instance of the ResNetFeatures class containing the loaded/extracted features.</span>
</span><span id="InteractiveMode.get_features-174"><a href="#InteractiveMode.get_features-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode.get_features-175"><a href="#InteractiveMode.get_features-175"><span class="linenos">175</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;To extract features from images located in </span><span class="si">{</span><span class="n">input_imags</span><span class="si">}</span><span class="s1"> enter 1. </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode.get_features-176"><a href="#InteractiveMode.get_features-176"><span class="linenos">176</span></a>                <span class="s1">&#39;To load features from a file enter 2.&#39;</span>
</span><span id="InteractiveMode.get_features-177"><a href="#InteractiveMode.get_features-177"><span class="linenos">177</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="InteractiveMode.get_features-178"><a href="#InteractiveMode.get_features-178"><span class="linenos">178</span></a>
</span><span id="InteractiveMode.get_features-179"><a href="#InteractiveMode.get_features-179"><span class="linenos">179</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="InteractiveMode.get_features-180"><a href="#InteractiveMode.get_features-180"><span class="linenos">180</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="InteractiveMode.get_features-181"><a href="#InteractiveMode.get_features-181"><span class="linenos">181</span></a>                <span class="n">choice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;[1/2]: &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="InteractiveMode.get_features-182"><a href="#InteractiveMode.get_features-182"><span class="linenos">182</span></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="InteractiveMode.get_features-183"><a href="#InteractiveMode.get_features-183"><span class="linenos">183</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid input. Please enter 1 or 2.&quot;</span><span class="p">)</span>
</span><span id="InteractiveMode.get_features-184"><a href="#InteractiveMode.get_features-184"><span class="linenos">184</span></a>                <span class="k">continue</span>
</span><span id="InteractiveMode.get_features-185"><a href="#InteractiveMode.get_features-185"><span class="linenos">185</span></a>
</span><span id="InteractiveMode.get_features-186"><a href="#InteractiveMode.get_features-186"><span class="linenos">186</span></a>            <span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="InteractiveMode.get_features-187"><a href="#InteractiveMode.get_features-187"><span class="linenos">187</span></a>                <span class="n">features</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">info_path</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">)</span>
</span><span id="InteractiveMode.get_features-188"><a href="#InteractiveMode.get_features-188"><span class="linenos">188</span></a>                <span class="k">break</span>
</span><span id="InteractiveMode.get_features-189"><a href="#InteractiveMode.get_features-189"><span class="linenos">189</span></a>
</span><span id="InteractiveMode.get_features-190"><a href="#InteractiveMode.get_features-190"><span class="linenos">190</span></a>            <span class="k">elif</span> <span class="n">choice</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="InteractiveMode.get_features-191"><a href="#InteractiveMode.get_features-191"><span class="linenos">191</span></a>                
</span><span id="InteractiveMode.get_features-192"><a href="#InteractiveMode.get_features-192"><span class="linenos">192</span></a>                <span class="n">features</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">read_features</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">info_path</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">)</span>
</span><span id="InteractiveMode.get_features-193"><a href="#InteractiveMode.get_features-193"><span class="linenos">193</span></a>                <span class="k">break</span>
</span><span id="InteractiveMode.get_features-194"><a href="#InteractiveMode.get_features-194"><span class="linenos">194</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="InteractiveMode.get_features-195"><a href="#InteractiveMode.get_features-195"><span class="linenos">195</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Invalid input. </span><span class="se">\n</span><span class="s1"> Try again!&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode.get_features-196"><a href="#InteractiveMode.get_features-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="n">features</span>
</span></pre></div>


            <div class="docstring"><p>Asks the user whether to extract new features or read from file.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>input_imags</strong> (str):
Subdirectory name with image data.</li>
<li><strong>info_path</strong> (str):
Path to the metadata file.</li>
<li><strong>default_filename</strong> (str):
Default base filename for feature data.</li>
<li><strong>name_pattern</strong> (str):
Regex pattern for identifying dataset names.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>ResNetFeatures</strong>: An instance of the ResNetFeatures class containing the loaded/extracted features.</li>
</ul>
</div>


                            </div>
                            <div id="InteractiveMode.extract_features" class="classattr">
                                        <input id="InteractiveMode.extract_features-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">extract_features</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">input_imags</span>, </span><span class="param"><span class="n">info_path</span>, </span><span class="param"><span class="n">default_filename</span>, </span><span class="param"><span class="n">name_pattern</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InteractiveMode.extract_features-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InteractiveMode.extract_features"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InteractiveMode.extract_features-198"><a href="#InteractiveMode.extract_features-198"><span class="linenos">198</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode.extract_features-199"><a href="#InteractiveMode.extract_features-199"><span class="linenos">199</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_features</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">info_path</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">):</span>
</span><span id="InteractiveMode.extract_features-200"><a href="#InteractiveMode.extract_features-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode.extract_features-201"><a href="#InteractiveMode.extract_features-201"><span class="linenos">201</span></a><span class="sd">        Initializes feature extraction and saves them to file.</span>
</span><span id="InteractiveMode.extract_features-202"><a href="#InteractiveMode.extract_features-202"><span class="linenos">202</span></a>
</span><span id="InteractiveMode.extract_features-203"><a href="#InteractiveMode.extract_features-203"><span class="linenos">203</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode.extract_features-204"><a href="#InteractiveMode.extract_features-204"><span class="linenos">204</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode.extract_features-205"><a href="#InteractiveMode.extract_features-205"><span class="linenos">205</span></a><span class="sd">        input_imags : str</span>
</span><span id="InteractiveMode.extract_features-206"><a href="#InteractiveMode.extract_features-206"><span class="linenos">206</span></a><span class="sd">            Folder containing images.</span>
</span><span id="InteractiveMode.extract_features-207"><a href="#InteractiveMode.extract_features-207"><span class="linenos">207</span></a><span class="sd">        info_path : str</span>
</span><span id="InteractiveMode.extract_features-208"><a href="#InteractiveMode.extract_features-208"><span class="linenos">208</span></a><span class="sd">            Path to the metadata file.</span>
</span><span id="InteractiveMode.extract_features-209"><a href="#InteractiveMode.extract_features-209"><span class="linenos">209</span></a><span class="sd">        default_filename : str</span>
</span><span id="InteractiveMode.extract_features-210"><a href="#InteractiveMode.extract_features-210"><span class="linenos">210</span></a><span class="sd">            Default file path for saving results.</span>
</span><span id="InteractiveMode.extract_features-211"><a href="#InteractiveMode.extract_features-211"><span class="linenos">211</span></a><span class="sd">        name_pattern : str</span>
</span><span id="InteractiveMode.extract_features-212"><a href="#InteractiveMode.extract_features-212"><span class="linenos">212</span></a><span class="sd">            Regex pattern for dataset name recognition.</span>
</span><span id="InteractiveMode.extract_features-213"><a href="#InteractiveMode.extract_features-213"><span class="linenos">213</span></a>
</span><span id="InteractiveMode.extract_features-214"><a href="#InteractiveMode.extract_features-214"><span class="linenos">214</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode.extract_features-215"><a href="#InteractiveMode.extract_features-215"><span class="linenos">215</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode.extract_features-216"><a href="#InteractiveMode.extract_features-216"><span class="linenos">216</span></a><span class="sd">        ResNetFeatures</span>
</span><span id="InteractiveMode.extract_features-217"><a href="#InteractiveMode.extract_features-217"><span class="linenos">217</span></a><span class="sd">            Object containing the extracted feature database.</span>
</span><span id="InteractiveMode.extract_features-218"><a href="#InteractiveMode.extract_features-218"><span class="linenos">218</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode.extract_features-219"><a href="#InteractiveMode.extract_features-219"><span class="linenos">219</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Enter a file name to write extracted features (or press &quot;Enter&quot; for default &quot;</span><span class="si">{</span><span class="n">default_filename</span><span class="si">}</span><span class="s1">&quot;): &#39;</span>
</span><span id="InteractiveMode.extract_features-220"><a href="#InteractiveMode.extract_features-220"><span class="linenos">220</span></a>        <span class="n">file_to_write</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">)</span>
</span><span id="InteractiveMode.extract_features-221"><a href="#InteractiveMode.extract_features-221"><span class="linenos">221</span></a>        <span class="n">filter_mixed</span><span class="p">,</span> <span class="n">name_pattern</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">filter_mixed_freq</span><span class="p">(</span><span class="n">name_pattern</span><span class="p">)</span>
</span><span id="InteractiveMode.extract_features-222"><a href="#InteractiveMode.extract_features-222"><span class="linenos">222</span></a>
</span><span id="InteractiveMode.extract_features-223"><a href="#InteractiveMode.extract_features-223"><span class="linenos">223</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Features extraction&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode.extract_features-224"><a href="#InteractiveMode.extract_features-224"><span class="linenos">224</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="n">ResNetFeatures</span><span class="p">(</span>
</span><span id="InteractiveMode.extract_features-225"><a href="#InteractiveMode.extract_features-225"><span class="linenos">225</span></a>            <span class="n">path</span><span class="o">=</span><span class="s1">&#39;./images/&#39;</span> <span class="o">+</span> <span class="n">input_imags</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
</span><span id="InteractiveMode.extract_features-226"><a href="#InteractiveMode.extract_features-226"><span class="linenos">226</span></a>            <span class="n">flag</span><span class="o">=</span><span class="s1">&#39;extract&#39;</span><span class="p">,</span>
</span><span id="InteractiveMode.extract_features-227"><a href="#InteractiveMode.extract_features-227"><span class="linenos">227</span></a>            <span class="n">info_path</span><span class="o">=</span><span class="n">info_path</span><span class="p">,</span>
</span><span id="InteractiveMode.extract_features-228"><a href="#InteractiveMode.extract_features-228"><span class="linenos">228</span></a>            <span class="n">filter_mixed</span><span class="o">=</span><span class="n">filter_mixed</span><span class="p">,</span>
</span><span id="InteractiveMode.extract_features-229"><a href="#InteractiveMode.extract_features-229"><span class="linenos">229</span></a>            <span class="n">name_pattern</span><span class="o">=</span><span class="n">name_pattern</span><span class="p">,</span>
</span><span id="InteractiveMode.extract_features-230"><a href="#InteractiveMode.extract_features-230"><span class="linenos">230</span></a>            <span class="n">extra_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;file_to_write&#39;</span><span class="p">:</span> <span class="n">file_to_write</span><span class="p">}</span>
</span><span id="InteractiveMode.extract_features-231"><a href="#InteractiveMode.extract_features-231"><span class="linenos">231</span></a>        <span class="p">)</span>
</span><span id="InteractiveMode.extract_features-232"><a href="#InteractiveMode.extract_features-232"><span class="linenos">232</span></a>        <span class="k">return</span> <span class="n">features</span>
</span></pre></div>


            <div class="docstring"><p>Initializes feature extraction and saves them to file.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>input_imags</strong> (str):
Folder containing images.</li>
<li><strong>info_path</strong> (str):
Path to the metadata file.</li>
<li><strong>default_filename</strong> (str):
Default file path for saving results.</li>
<li><strong>name_pattern</strong> (str):
Regex pattern for dataset name recognition.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>ResNetFeatures</strong>: Object containing the extracted feature database.</li>
</ul>
</div>


                            </div>
                            <div id="InteractiveMode.read_features" class="classattr">
                                        <input id="InteractiveMode.read_features-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">read_features</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">input_imags</span>, </span><span class="param"><span class="n">info_path</span>, </span><span class="param"><span class="n">default_filename</span>, </span><span class="param"><span class="n">name_pattern</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InteractiveMode.read_features-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InteractiveMode.read_features"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InteractiveMode.read_features-234"><a href="#InteractiveMode.read_features-234"><span class="linenos">234</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode.read_features-235"><a href="#InteractiveMode.read_features-235"><span class="linenos">235</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read_features</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">info_path</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">):</span>
</span><span id="InteractiveMode.read_features-236"><a href="#InteractiveMode.read_features-236"><span class="linenos">236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode.read_features-237"><a href="#InteractiveMode.read_features-237"><span class="linenos">237</span></a><span class="sd">        Loads previously saved feature data from a file.</span>
</span><span id="InteractiveMode.read_features-238"><a href="#InteractiveMode.read_features-238"><span class="linenos">238</span></a>
</span><span id="InteractiveMode.read_features-239"><a href="#InteractiveMode.read_features-239"><span class="linenos">239</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode.read_features-240"><a href="#InteractiveMode.read_features-240"><span class="linenos">240</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode.read_features-241"><a href="#InteractiveMode.read_features-241"><span class="linenos">241</span></a><span class="sd">        input_imags : str</span>
</span><span id="InteractiveMode.read_features-242"><a href="#InteractiveMode.read_features-242"><span class="linenos">242</span></a><span class="sd">            Folder containing images.</span>
</span><span id="InteractiveMode.read_features-243"><a href="#InteractiveMode.read_features-243"><span class="linenos">243</span></a><span class="sd">        info_path : str</span>
</span><span id="InteractiveMode.read_features-244"><a href="#InteractiveMode.read_features-244"><span class="linenos">244</span></a><span class="sd">            Path to the metadata file.</span>
</span><span id="InteractiveMode.read_features-245"><a href="#InteractiveMode.read_features-245"><span class="linenos">245</span></a><span class="sd">        default_filename : str</span>
</span><span id="InteractiveMode.read_features-246"><a href="#InteractiveMode.read_features-246"><span class="linenos">246</span></a><span class="sd">            Default file path for loading.</span>
</span><span id="InteractiveMode.read_features-247"><a href="#InteractiveMode.read_features-247"><span class="linenos">247</span></a><span class="sd">        name_pattern : str</span>
</span><span id="InteractiveMode.read_features-248"><a href="#InteractiveMode.read_features-248"><span class="linenos">248</span></a><span class="sd">            Regex pattern for dataset name recognition.</span>
</span><span id="InteractiveMode.read_features-249"><a href="#InteractiveMode.read_features-249"><span class="linenos">249</span></a>
</span><span id="InteractiveMode.read_features-250"><a href="#InteractiveMode.read_features-250"><span class="linenos">250</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode.read_features-251"><a href="#InteractiveMode.read_features-251"><span class="linenos">251</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode.read_features-252"><a href="#InteractiveMode.read_features-252"><span class="linenos">252</span></a><span class="sd">        ResNetFeatures</span>
</span><span id="InteractiveMode.read_features-253"><a href="#InteractiveMode.read_features-253"><span class="linenos">253</span></a><span class="sd">            Object containing the loaded feature database.</span>
</span><span id="InteractiveMode.read_features-254"><a href="#InteractiveMode.read_features-254"><span class="linenos">254</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode.read_features-255"><a href="#InteractiveMode.read_features-255"><span class="linenos">255</span></a>
</span><span id="InteractiveMode.read_features-256"><a href="#InteractiveMode.read_features-256"><span class="linenos">256</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Enter a file name to read from (or press &quot;Enter&quot; for default &quot;</span><span class="si">{</span><span class="n">default_filename</span><span class="si">}</span><span class="s1">&quot;): &#39;</span>
</span><span id="InteractiveMode.read_features-257"><a href="#InteractiveMode.read_features-257"><span class="linenos">257</span></a>        <span class="n">file_to_read</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">)</span>
</span><span id="InteractiveMode.read_features-258"><a href="#InteractiveMode.read_features-258"><span class="linenos">258</span></a>        <span class="n">filter_mixed</span><span class="p">,</span> <span class="n">name_pattern</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">filter_mixed_freq</span><span class="p">(</span><span class="n">name_pattern</span><span class="p">)</span>
</span><span id="InteractiveMode.read_features-259"><a href="#InteractiveMode.read_features-259"><span class="linenos">259</span></a>
</span><span id="InteractiveMode.read_features-260"><a href="#InteractiveMode.read_features-260"><span class="linenos">260</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading features&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode.read_features-261"><a href="#InteractiveMode.read_features-261"><span class="linenos">261</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="n">ResNetFeatures</span><span class="p">(</span>
</span><span id="InteractiveMode.read_features-262"><a href="#InteractiveMode.read_features-262"><span class="linenos">262</span></a>            <span class="n">path</span><span class="o">=</span><span class="s1">&#39;./images/&#39;</span> <span class="o">+</span> <span class="n">input_imags</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
</span><span id="InteractiveMode.read_features-263"><a href="#InteractiveMode.read_features-263"><span class="linenos">263</span></a>            <span class="n">flag</span><span class="o">=</span><span class="s1">&#39;read&#39;</span><span class="p">,</span>
</span><span id="InteractiveMode.read_features-264"><a href="#InteractiveMode.read_features-264"><span class="linenos">264</span></a>            <span class="n">info_path</span><span class="o">=</span><span class="n">info_path</span><span class="p">,</span>
</span><span id="InteractiveMode.read_features-265"><a href="#InteractiveMode.read_features-265"><span class="linenos">265</span></a>            <span class="n">filter_mixed</span><span class="o">=</span><span class="n">filter_mixed</span><span class="p">,</span>
</span><span id="InteractiveMode.read_features-266"><a href="#InteractiveMode.read_features-266"><span class="linenos">266</span></a>            <span class="n">name_pattern</span><span class="o">=</span><span class="n">name_pattern</span><span class="p">,</span>
</span><span id="InteractiveMode.read_features-267"><a href="#InteractiveMode.read_features-267"><span class="linenos">267</span></a>            <span class="n">extra_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;file_to_read&#39;</span><span class="p">:</span> <span class="n">file_to_read</span><span class="p">}</span>
</span><span id="InteractiveMode.read_features-268"><a href="#InteractiveMode.read_features-268"><span class="linenos">268</span></a>        <span class="p">)</span>
</span><span id="InteractiveMode.read_features-269"><a href="#InteractiveMode.read_features-269"><span class="linenos">269</span></a>        <span class="k">return</span> <span class="n">features</span>
</span></pre></div>


            <div class="docstring"><p>Loads previously saved feature data from a file.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>input_imags</strong> (str):
Folder containing images.</li>
<li><strong>info_path</strong> (str):
Path to the metadata file.</li>
<li><strong>default_filename</strong> (str):
Default file path for loading.</li>
<li><strong>name_pattern</strong> (str):
Regex pattern for dataset name recognition.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>ResNetFeatures</strong>: Object containing the loaded feature database.</li>
</ul>
</div>


                            </div>
                            <div id="InteractiveMode.run_processing" class="classattr">
                                        <input id="InteractiveMode.run_processing-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">run_processing</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">features</span>, </span><span class="param"><span class="n">default_filename</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InteractiveMode.run_processing-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InteractiveMode.run_processing"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InteractiveMode.run_processing-271"><a href="#InteractiveMode.run_processing-271"><span class="linenos">271</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode.run_processing-272"><a href="#InteractiveMode.run_processing-272"><span class="linenos">272</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_processing</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">):</span>
</span><span id="InteractiveMode.run_processing-273"><a href="#InteractiveMode.run_processing-273"><span class="linenos">273</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode.run_processing-274"><a href="#InteractiveMode.run_processing-274"><span class="linenos">274</span></a><span class="sd">        Offers the user a choice between standard pipeline execution or custom steps.</span>
</span><span id="InteractiveMode.run_processing-275"><a href="#InteractiveMode.run_processing-275"><span class="linenos">275</span></a>
</span><span id="InteractiveMode.run_processing-276"><a href="#InteractiveMode.run_processing-276"><span class="linenos">276</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode.run_processing-277"><a href="#InteractiveMode.run_processing-277"><span class="linenos">277</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode.run_processing-278"><a href="#InteractiveMode.run_processing-278"><span class="linenos">278</span></a><span class="sd">        features : ResNetFeatures</span>
</span><span id="InteractiveMode.run_processing-279"><a href="#InteractiveMode.run_processing-279"><span class="linenos">279</span></a><span class="sd">            Feature database.</span>
</span><span id="InteractiveMode.run_processing-280"><a href="#InteractiveMode.run_processing-280"><span class="linenos">280</span></a><span class="sd">        default_filename : str</span>
</span><span id="InteractiveMode.run_processing-281"><a href="#InteractiveMode.run_processing-281"><span class="linenos">281</span></a><span class="sd">            Base name for saving intermediate or final results.</span>
</span><span id="InteractiveMode.run_processing-282"><a href="#InteractiveMode.run_processing-282"><span class="linenos">282</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode.run_processing-283"><a href="#InteractiveMode.run_processing-283"><span class="linenos">283</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Would you like to launch the standard processing algorithm (1) or </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode.run_processing-284"><a href="#InteractiveMode.run_processing-284"><span class="linenos">284</span></a>                    <span class="s1">&#39;to call separate blocks of processing manually (2)?&#39;</span>
</span><span id="InteractiveMode.run_processing-285"><a href="#InteractiveMode.run_processing-285"><span class="linenos">285</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="InteractiveMode.run_processing-286"><a href="#InteractiveMode.run_processing-286"><span class="linenos">286</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="InteractiveMode.run_processing-287"><a href="#InteractiveMode.run_processing-287"><span class="linenos">287</span></a>            <span class="n">num</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter 1 or 2 (or break to stop): &#39;</span><span class="p">)</span>
</span><span id="InteractiveMode.run_processing-288"><a href="#InteractiveMode.run_processing-288"><span class="linenos">288</span></a>            <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="s1">&#39;break&#39;</span><span class="p">:</span>
</span><span id="InteractiveMode.run_processing-289"><a href="#InteractiveMode.run_processing-289"><span class="linenos">289</span></a>                <span class="k">break</span>
</span><span id="InteractiveMode.run_processing-290"><a href="#InteractiveMode.run_processing-290"><span class="linenos">290</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="InteractiveMode.run_processing-291"><a href="#InteractiveMode.run_processing-291"><span class="linenos">291</span></a>                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="InteractiveMode.run_processing-292"><a href="#InteractiveMode.run_processing-292"><span class="linenos">292</span></a>                    <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">standard_algorithm</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">)</span>
</span><span id="InteractiveMode.run_processing-293"><a href="#InteractiveMode.run_processing-293"><span class="linenos">293</span></a>                <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="InteractiveMode.run_processing-294"><a href="#InteractiveMode.run_processing-294"><span class="linenos">294</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This part has not been implemented yet. Use 1 or break.&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Offers the user a choice between standard pipeline execution or custom steps.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>features</strong> (ResNetFeatures):
Feature database.</li>
<li><strong>default_filename</strong> (str):
Base name for saving intermediate or final results.</li>
</ul>
</div>


                            </div>
                            <div id="InteractiveMode.standard_algorithm" class="classattr">
                                        <input id="InteractiveMode.standard_algorithm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">standard_algorithm</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">features</span>, </span><span class="param"><span class="n">default_filename</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InteractiveMode.standard_algorithm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InteractiveMode.standard_algorithm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InteractiveMode.standard_algorithm-298"><a href="#InteractiveMode.standard_algorithm-298"><span class="linenos">298</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode.standard_algorithm-299"><a href="#InteractiveMode.standard_algorithm-299"><span class="linenos">299</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">standard_algorithm</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">):</span>
</span><span id="InteractiveMode.standard_algorithm-300"><a href="#InteractiveMode.standard_algorithm-300"><span class="linenos">300</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode.standard_algorithm-301"><a href="#InteractiveMode.standard_algorithm-301"><span class="linenos">301</span></a><span class="sd">        Executes the full default processing pipeline:</span>
</span><span id="InteractiveMode.standard_algorithm-302"><a href="#InteractiveMode.standard_algorithm-302"><span class="linenos">302</span></a><span class="sd">        1. Feature filtering by variance</span>
</span><span id="InteractiveMode.standard_algorithm-303"><a href="#InteractiveMode.standard_algorithm-303"><span class="linenos">303</span></a><span class="sd">        2. Dimensionality reduction with PCA and UMAP</span>
</span><span id="InteractiveMode.standard_algorithm-304"><a href="#InteractiveMode.standard_algorithm-304"><span class="linenos">304</span></a><span class="sd">        3. Clustering with HDBSCAN</span>
</span><span id="InteractiveMode.standard_algorithm-305"><a href="#InteractiveMode.standard_algorithm-305"><span class="linenos">305</span></a><span class="sd">        4. Visualization</span>
</span><span id="InteractiveMode.standard_algorithm-306"><a href="#InteractiveMode.standard_algorithm-306"><span class="linenos">306</span></a>
</span><span id="InteractiveMode.standard_algorithm-307"><a href="#InteractiveMode.standard_algorithm-307"><span class="linenos">307</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode.standard_algorithm-308"><a href="#InteractiveMode.standard_algorithm-308"><span class="linenos">308</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode.standard_algorithm-309"><a href="#InteractiveMode.standard_algorithm-309"><span class="linenos">309</span></a><span class="sd">        features : ResNetFeatures</span>
</span><span id="InteractiveMode.standard_algorithm-310"><a href="#InteractiveMode.standard_algorithm-310"><span class="linenos">310</span></a><span class="sd">            Input feature database object.</span>
</span><span id="InteractiveMode.standard_algorithm-311"><a href="#InteractiveMode.standard_algorithm-311"><span class="linenos">311</span></a><span class="sd">        default_filename : str</span>
</span><span id="InteractiveMode.standard_algorithm-312"><a href="#InteractiveMode.standard_algorithm-312"><span class="linenos">312</span></a><span class="sd">            Base filename for saving outputs.</span>
</span><span id="InteractiveMode.standard_algorithm-313"><a href="#InteractiveMode.standard_algorithm-313"><span class="linenos">313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode.standard_algorithm-314"><a href="#InteractiveMode.standard_algorithm-314"><span class="linenos">314</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;The standard algorithm: </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode.standard_algorithm-315"><a href="#InteractiveMode.standard_algorithm-315"><span class="linenos">315</span></a>            <span class="s1">&#39;1. Filtration of ResNet features by variance, thershold=1e-5 </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode.standard_algorithm-316"><a href="#InteractiveMode.standard_algorithm-316"><span class="linenos">316</span></a>            <span class="s1">&#39;2. Preprocessing of the filtered features with </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode.standard_algorithm-317"><a href="#InteractiveMode.standard_algorithm-317"><span class="linenos">317</span></a>            <span class="s1">&#39;   - PCA(n_components=0.95, svd_solver=</span><span class="se">\&#39;</span><span class="s1">full</span><span class="se">\&#39;</span><span class="s1">) </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode.standard_algorithm-318"><a href="#InteractiveMode.standard_algorithm-318"><span class="linenos">318</span></a>            <span class="s1">&#39;   - UMAP(n_components=20, min_dist=0.1, metric=</span><span class="se">\&#39;</span><span class="s1">cosine</span><span class="se">\&#39;</span><span class="s1">) </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode.standard_algorithm-319"><a href="#InteractiveMode.standard_algorithm-319"><span class="linenos">319</span></a>            <span class="s1">&#39;3. Clusterization </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode.standard_algorithm-320"><a href="#InteractiveMode.standard_algorithm-320"><span class="linenos">320</span></a>            <span class="s1">&#39;- HDBSCAN(min_cluster_size=15, min_samples=5, metric=</span><span class="se">\&#39;</span><span class="s1">euclidean</span><span class="se">\&#39;</span><span class="s1">) </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
</span><span id="InteractiveMode.standard_algorithm-321"><a href="#InteractiveMode.standard_algorithm-321"><span class="linenos">321</span></a>            <span class="s1">&#39;4. Visualization with PCA+UMAP2D+HDBSCAN&#39;</span>
</span><span id="InteractiveMode.standard_algorithm-322"><a href="#InteractiveMode.standard_algorithm-322"><span class="linenos">322</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="InteractiveMode.standard_algorithm-323"><a href="#InteractiveMode.standard_algorithm-323"><span class="linenos">323</span></a>        
</span><span id="InteractiveMode.standard_algorithm-324"><a href="#InteractiveMode.standard_algorithm-324"><span class="linenos">324</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">filtration</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</span><span id="InteractiveMode.standard_algorithm-325"><a href="#InteractiveMode.standard_algorithm-325"><span class="linenos">325</span></a>
</span><span id="InteractiveMode.standard_algorithm-326"><a href="#InteractiveMode.standard_algorithm-326"><span class="linenos">326</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Enter a file name to save the filtered data (or press &quot;Enter&quot; to use default name): &#39;</span>
</span><span id="InteractiveMode.standard_algorithm-327"><a href="#InteractiveMode.standard_algorithm-327"><span class="linenos">327</span></a>        <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">saving_database</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">suf</span><span class="o">=</span><span class="s1">&#39;_filtered&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode.standard_algorithm-328"><a href="#InteractiveMode.standard_algorithm-328"><span class="linenos">328</span></a>
</span><span id="InteractiveMode.standard_algorithm-329"><a href="#InteractiveMode.standard_algorithm-329"><span class="linenos">329</span></a>        <span class="n">processed</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">run_preprocessing</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="s1">&#39;PCA+UMAPND&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode.standard_algorithm-330"><a href="#InteractiveMode.standard_algorithm-330"><span class="linenos">330</span></a>
</span><span id="InteractiveMode.standard_algorithm-331"><a href="#InteractiveMode.standard_algorithm-331"><span class="linenos">331</span></a>        <span class="n">clusters</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">run_clusterization</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>
</span><span id="InteractiveMode.standard_algorithm-332"><a href="#InteractiveMode.standard_algorithm-332"><span class="linenos">332</span></a>
</span><span id="InteractiveMode.standard_algorithm-333"><a href="#InteractiveMode.standard_algorithm-333"><span class="linenos">333</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Enter a file name to save the clustered data (or press &quot;Enter&quot; to use default name): &#39;</span>
</span><span id="InteractiveMode.standard_algorithm-334"><a href="#InteractiveMode.standard_algorithm-334"><span class="linenos">334</span></a>        <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">saving_database</span><span class="p">(</span><span class="n">clusters</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">suf</span><span class="o">=</span><span class="s1">&#39;_clustered&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode.standard_algorithm-335"><a href="#InteractiveMode.standard_algorithm-335"><span class="linenos">335</span></a>
</span><span id="InteractiveMode.standard_algorithm-336"><a href="#InteractiveMode.standard_algorithm-336"><span class="linenos">336</span></a>        <span class="c1"># Visualization</span>
</span><span id="InteractiveMode.standard_algorithm-337"><a href="#InteractiveMode.standard_algorithm-337"><span class="linenos">337</span></a>        <span class="n">clusters</span><span class="o">.</span><span class="n">visualize_HDBSCAN</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Executes the full default processing pipeline:</p>

<ol>
<li>Feature filtering by variance</li>
<li>Dimensionality reduction with PCA and UMAP</li>
<li>Clustering with HDBSCAN</li>
<li>Visualization</li>
</ol>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>features</strong> (ResNetFeatures):
Input feature database object.</li>
<li><strong>default_filename</strong> (str):
Base filename for saving outputs.</li>
</ul>
</div>


                            </div>
                            <div id="InteractiveMode.filtration" class="classattr">
                                        <input id="InteractiveMode.filtration-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">filtration</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">features</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InteractiveMode.filtration-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InteractiveMode.filtration"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InteractiveMode.filtration-339"><a href="#InteractiveMode.filtration-339"><span class="linenos">339</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode.filtration-340"><a href="#InteractiveMode.filtration-340"><span class="linenos">340</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filtration</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
</span><span id="InteractiveMode.filtration-341"><a href="#InteractiveMode.filtration-341"><span class="linenos">341</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode.filtration-342"><a href="#InteractiveMode.filtration-342"><span class="linenos">342</span></a><span class="sd">        Applies variance-based filtering to the feature set.</span>
</span><span id="InteractiveMode.filtration-343"><a href="#InteractiveMode.filtration-343"><span class="linenos">343</span></a>
</span><span id="InteractiveMode.filtration-344"><a href="#InteractiveMode.filtration-344"><span class="linenos">344</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode.filtration-345"><a href="#InteractiveMode.filtration-345"><span class="linenos">345</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode.filtration-346"><a href="#InteractiveMode.filtration-346"><span class="linenos">346</span></a><span class="sd">        features : ResNetFeatures</span>
</span><span id="InteractiveMode.filtration-347"><a href="#InteractiveMode.filtration-347"><span class="linenos">347</span></a><span class="sd">            Input feature database.</span>
</span><span id="InteractiveMode.filtration-348"><a href="#InteractiveMode.filtration-348"><span class="linenos">348</span></a>
</span><span id="InteractiveMode.filtration-349"><a href="#InteractiveMode.filtration-349"><span class="linenos">349</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode.filtration-350"><a href="#InteractiveMode.filtration-350"><span class="linenos">350</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode.filtration-351"><a href="#InteractiveMode.filtration-351"><span class="linenos">351</span></a><span class="sd">        ResNetFeatures</span>
</span><span id="InteractiveMode.filtration-352"><a href="#InteractiveMode.filtration-352"><span class="linenos">352</span></a><span class="sd">            Filtered features with updated `.database`.</span>
</span><span id="InteractiveMode.filtration-353"><a href="#InteractiveMode.filtration-353"><span class="linenos">353</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode.filtration-354"><a href="#InteractiveMode.filtration-354"><span class="linenos">354</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filtration&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode.filtration-355"><a href="#InteractiveMode.filtration-355"><span class="linenos">355</span></a>        <span class="n">features</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">filtering_by_variance</span><span class="p">()</span>
</span><span id="InteractiveMode.filtration-356"><a href="#InteractiveMode.filtration-356"><span class="linenos">356</span></a>        <span class="n">features</span><span class="o">.</span><span class="n">info_on_features</span><span class="p">()</span>
</span><span id="InteractiveMode.filtration-357"><a href="#InteractiveMode.filtration-357"><span class="linenos">357</span></a>        <span class="k">return</span> <span class="n">features</span>
</span></pre></div>


            <div class="docstring"><p>Applies variance-based filtering to the feature set.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>features</strong> (ResNetFeatures):
Input feature database.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>ResNetFeatures</strong>: Filtered features with updated <code>.database</code>.</li>
</ul>
</div>


                            </div>
                            <div id="InteractiveMode.create_name_to_save" class="classattr">
                                        <input id="InteractiveMode.create_name_to_save-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">create_name_to_save</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">default_filename</span>, </span><span class="param"><span class="n">file_to_write</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">suffix</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InteractiveMode.create_name_to_save-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InteractiveMode.create_name_to_save"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InteractiveMode.create_name_to_save-359"><a href="#InteractiveMode.create_name_to_save-359"><span class="linenos">359</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode.create_name_to_save-360"><a href="#InteractiveMode.create_name_to_save-360"><span class="linenos">360</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_name_to_save</span><span class="p">(</span><span class="n">default_filename</span><span class="p">,</span> <span class="n">file_to_write</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="InteractiveMode.create_name_to_save-361"><a href="#InteractiveMode.create_name_to_save-361"><span class="linenos">361</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode.create_name_to_save-362"><a href="#InteractiveMode.create_name_to_save-362"><span class="linenos">362</span></a><span class="sd">        Constructs a filename by combining a base name with a suffix.</span>
</span><span id="InteractiveMode.create_name_to_save-363"><a href="#InteractiveMode.create_name_to_save-363"><span class="linenos">363</span></a>
</span><span id="InteractiveMode.create_name_to_save-364"><a href="#InteractiveMode.create_name_to_save-364"><span class="linenos">364</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode.create_name_to_save-365"><a href="#InteractiveMode.create_name_to_save-365"><span class="linenos">365</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode.create_name_to_save-366"><a href="#InteractiveMode.create_name_to_save-366"><span class="linenos">366</span></a><span class="sd">        default_filename : str</span>
</span><span id="InteractiveMode.create_name_to_save-367"><a href="#InteractiveMode.create_name_to_save-367"><span class="linenos">367</span></a><span class="sd">            Base filename.</span>
</span><span id="InteractiveMode.create_name_to_save-368"><a href="#InteractiveMode.create_name_to_save-368"><span class="linenos">368</span></a><span class="sd">        file_to_write : str, optional</span>
</span><span id="InteractiveMode.create_name_to_save-369"><a href="#InteractiveMode.create_name_to_save-369"><span class="linenos">369</span></a><span class="sd">            Custom filename provided by the user.</span>
</span><span id="InteractiveMode.create_name_to_save-370"><a href="#InteractiveMode.create_name_to_save-370"><span class="linenos">370</span></a><span class="sd">        suffix : str, optional</span>
</span><span id="InteractiveMode.create_name_to_save-371"><a href="#InteractiveMode.create_name_to_save-371"><span class="linenos">371</span></a><span class="sd">            Suffix to append to the filename.</span>
</span><span id="InteractiveMode.create_name_to_save-372"><a href="#InteractiveMode.create_name_to_save-372"><span class="linenos">372</span></a>
</span><span id="InteractiveMode.create_name_to_save-373"><a href="#InteractiveMode.create_name_to_save-373"><span class="linenos">373</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode.create_name_to_save-374"><a href="#InteractiveMode.create_name_to_save-374"><span class="linenos">374</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode.create_name_to_save-375"><a href="#InteractiveMode.create_name_to_save-375"><span class="linenos">375</span></a><span class="sd">        str</span>
</span><span id="InteractiveMode.create_name_to_save-376"><a href="#InteractiveMode.create_name_to_save-376"><span class="linenos">376</span></a><span class="sd">            Full filename with optional suffix.</span>
</span><span id="InteractiveMode.create_name_to_save-377"><a href="#InteractiveMode.create_name_to_save-377"><span class="linenos">377</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode.create_name_to_save-378"><a href="#InteractiveMode.create_name_to_save-378"><span class="linenos">378</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_to_write</span><span class="p">:</span>
</span><span id="InteractiveMode.create_name_to_save-379"><a href="#InteractiveMode.create_name_to_save-379"><span class="linenos">379</span></a>            <span class="n">file_to_write</span> <span class="o">=</span> <span class="n">default_filename</span>
</span><span id="InteractiveMode.create_name_to_save-380"><a href="#InteractiveMode.create_name_to_save-380"><span class="linenos">380</span></a>        <span class="k">if</span> <span class="n">suffix</span><span class="p">:</span>
</span><span id="InteractiveMode.create_name_to_save-381"><a href="#InteractiveMode.create_name_to_save-381"><span class="linenos">381</span></a>            <span class="n">file_to_write</span> <span class="o">+=</span> <span class="n">suffix</span>
</span><span id="InteractiveMode.create_name_to_save-382"><a href="#InteractiveMode.create_name_to_save-382"><span class="linenos">382</span></a>        <span class="k">return</span> <span class="n">file_to_write</span>
</span></pre></div>


            <div class="docstring"><p>Constructs a filename by combining a base name with a suffix.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>default_filename</strong> (str):
Base filename.</li>
<li><strong>file_to_write</strong> (str, optional):
Custom filename provided by the user.</li>
<li><strong>suffix</strong> (str, optional):
Suffix to append to the filename.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>str</strong>: Full filename with optional suffix.</li>
</ul>
</div>


                            </div>
                            <div id="InteractiveMode.saving_database" class="classattr">
                                        <input id="InteractiveMode.saving_database-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">saving_database</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">df</span>, </span><span class="param"><span class="n">default_filename</span>, </span><span class="param"><span class="n">message</span>, </span><span class="param"><span class="n">suf</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InteractiveMode.saving_database-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InteractiveMode.saving_database"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InteractiveMode.saving_database-384"><a href="#InteractiveMode.saving_database-384"><span class="linenos">384</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode.saving_database-385"><a href="#InteractiveMode.saving_database-385"><span class="linenos">385</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">saving_database</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">suf</span><span class="p">):</span>
</span><span id="InteractiveMode.saving_database-386"><a href="#InteractiveMode.saving_database-386"><span class="linenos">386</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode.saving_database-387"><a href="#InteractiveMode.saving_database-387"><span class="linenos">387</span></a><span class="sd">        Prompts the user to save the DataFrame to a file with optional suffix.</span>
</span><span id="InteractiveMode.saving_database-388"><a href="#InteractiveMode.saving_database-388"><span class="linenos">388</span></a>
</span><span id="InteractiveMode.saving_database-389"><a href="#InteractiveMode.saving_database-389"><span class="linenos">389</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode.saving_database-390"><a href="#InteractiveMode.saving_database-390"><span class="linenos">390</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode.saving_database-391"><a href="#InteractiveMode.saving_database-391"><span class="linenos">391</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="InteractiveMode.saving_database-392"><a href="#InteractiveMode.saving_database-392"><span class="linenos">392</span></a><span class="sd">            Data to be saved.</span>
</span><span id="InteractiveMode.saving_database-393"><a href="#InteractiveMode.saving_database-393"><span class="linenos">393</span></a><span class="sd">        default_filename : str</span>
</span><span id="InteractiveMode.saving_database-394"><a href="#InteractiveMode.saving_database-394"><span class="linenos">394</span></a><span class="sd">            Default file base name.</span>
</span><span id="InteractiveMode.saving_database-395"><a href="#InteractiveMode.saving_database-395"><span class="linenos">395</span></a><span class="sd">        message : str</span>
</span><span id="InteractiveMode.saving_database-396"><a href="#InteractiveMode.saving_database-396"><span class="linenos">396</span></a><span class="sd">            Prompt shown to the user.</span>
</span><span id="InteractiveMode.saving_database-397"><a href="#InteractiveMode.saving_database-397"><span class="linenos">397</span></a><span class="sd">        suf : str</span>
</span><span id="InteractiveMode.saving_database-398"><a href="#InteractiveMode.saving_database-398"><span class="linenos">398</span></a><span class="sd">            Default suffix to append to the filename.</span>
</span><span id="InteractiveMode.saving_database-399"><a href="#InteractiveMode.saving_database-399"><span class="linenos">399</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode.saving_database-400"><a href="#InteractiveMode.saving_database-400"><span class="linenos">400</span></a>        <span class="n">file_to_write</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="InteractiveMode.saving_database-401"><a href="#InteractiveMode.saving_database-401"><span class="linenos">401</span></a>        <span class="n">suffix</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;or/and enter a suffix to the filename: &#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">suf</span>
</span><span id="InteractiveMode.saving_database-402"><a href="#InteractiveMode.saving_database-402"><span class="linenos">402</span></a>        <span class="n">file_to_write</span> <span class="o">=</span> <span class="n">InteractiveMode</span><span class="o">.</span><span class="n">create_name_to_save</span><span class="p">(</span><span class="n">default_filename</span><span class="p">,</span> <span class="n">file_to_write</span><span class="o">=</span><span class="n">file_to_write</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>
</span><span id="InteractiveMode.saving_database-403"><a href="#InteractiveMode.saving_database-403"><span class="linenos">403</span></a>        <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">save_database</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">file_to_write</span><span class="o">=</span><span class="n">file_to_write</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Prompts the user to save the DataFrame to a file with optional suffix.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong> (pandas.DataFrame):
Data to be saved.</li>
<li><strong>default_filename</strong> (str):
Default file base name.</li>
<li><strong>message</strong> (str):
Prompt shown to the user.</li>
<li><strong>suf</strong> (str):
Default suffix to append to the filename.</li>
</ul>
</div>


                            </div>
                            <div id="InteractiveMode.run_preprocessing" class="classattr">
                                        <input id="InteractiveMode.run_preprocessing-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">run_preprocessing</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">features</span>, </span><span class="param"><span class="n">pipe_str</span><span class="o">=</span><span class="s1">&#39;PCA+UMAPND&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InteractiveMode.run_preprocessing-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InteractiveMode.run_preprocessing"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InteractiveMode.run_preprocessing-405"><a href="#InteractiveMode.run_preprocessing-405"><span class="linenos">405</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode.run_preprocessing-406"><a href="#InteractiveMode.run_preprocessing-406"><span class="linenos">406</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_preprocessing</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">pipe_str</span><span class="o">=</span><span class="s1">&#39;PCA+UMAPND&#39;</span><span class="p">):</span>
</span><span id="InteractiveMode.run_preprocessing-407"><a href="#InteractiveMode.run_preprocessing-407"><span class="linenos">407</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode.run_preprocessing-408"><a href="#InteractiveMode.run_preprocessing-408"><span class="linenos">408</span></a><span class="sd">        Applies a sequence of dimensionality reduction steps to the feature matrix.</span>
</span><span id="InteractiveMode.run_preprocessing-409"><a href="#InteractiveMode.run_preprocessing-409"><span class="linenos">409</span></a>
</span><span id="InteractiveMode.run_preprocessing-410"><a href="#InteractiveMode.run_preprocessing-410"><span class="linenos">410</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode.run_preprocessing-411"><a href="#InteractiveMode.run_preprocessing-411"><span class="linenos">411</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode.run_preprocessing-412"><a href="#InteractiveMode.run_preprocessing-412"><span class="linenos">412</span></a><span class="sd">        features : ResNetFeatures</span>
</span><span id="InteractiveMode.run_preprocessing-413"><a href="#InteractiveMode.run_preprocessing-413"><span class="linenos">413</span></a><span class="sd">            The extracted and optionally filtered features.</span>
</span><span id="InteractiveMode.run_preprocessing-414"><a href="#InteractiveMode.run_preprocessing-414"><span class="linenos">414</span></a><span class="sd">        pipe_str : str, optional</span>
</span><span id="InteractiveMode.run_preprocessing-415"><a href="#InteractiveMode.run_preprocessing-415"><span class="linenos">415</span></a><span class="sd">            Pipeline specification string, e.g., &#39;PCA+UMAPND&#39;.</span>
</span><span id="InteractiveMode.run_preprocessing-416"><a href="#InteractiveMode.run_preprocessing-416"><span class="linenos">416</span></a>
</span><span id="InteractiveMode.run_preprocessing-417"><a href="#InteractiveMode.run_preprocessing-417"><span class="linenos">417</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode.run_preprocessing-418"><a href="#InteractiveMode.run_preprocessing-418"><span class="linenos">418</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode.run_preprocessing-419"><a href="#InteractiveMode.run_preprocessing-419"><span class="linenos">419</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="InteractiveMode.run_preprocessing-420"><a href="#InteractiveMode.run_preprocessing-420"><span class="linenos">420</span></a><span class="sd">            Transformed feature DataFrame with original metadata preserved.</span>
</span><span id="InteractiveMode.run_preprocessing-421"><a href="#InteractiveMode.run_preprocessing-421"><span class="linenos">421</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode.run_preprocessing-422"><a href="#InteractiveMode.run_preprocessing-422"><span class="linenos">422</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Preprocessing&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode.run_preprocessing-423"><a href="#InteractiveMode.run_preprocessing-423"><span class="linenos">423</span></a>        <span class="n">preprop</span> <span class="o">=</span> <span class="n">FeaturesPreprocessing</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</span><span id="InteractiveMode.run_preprocessing-424"><a href="#InteractiveMode.run_preprocessing-424"><span class="linenos">424</span></a>        <span class="n">processed</span> <span class="o">=</span> <span class="n">preprop</span><span class="o">.</span><span class="n">wrapper_preprop</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="n">pipe_str</span><span class="p">)</span>
</span><span id="InteractiveMode.run_preprocessing-425"><a href="#InteractiveMode.run_preprocessing-425"><span class="linenos">425</span></a>        <span class="k">return</span> <span class="n">processed</span>
</span></pre></div>


            <div class="docstring"><p>Applies a sequence of dimensionality reduction steps to the feature matrix.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>features</strong> (ResNetFeatures):
The extracted and optionally filtered features.</li>
<li><strong>pipe_str</strong> (str, optional):
Pipeline specification string, e.g., 'PCA+UMAPND'.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pandas.DataFrame</strong>: Transformed feature DataFrame with original metadata preserved.</li>
</ul>
</div>


                            </div>
                            <div id="InteractiveMode.run_clusterization" class="classattr">
                                        <input id="InteractiveMode.run_clusterization-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">run_clusterization</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">features</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="InteractiveMode.run_clusterization-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InteractiveMode.run_clusterization"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InteractiveMode.run_clusterization-427"><a href="#InteractiveMode.run_clusterization-427"><span class="linenos">427</span></a>    <span class="nd">@staticmethod</span>
</span><span id="InteractiveMode.run_clusterization-428"><a href="#InteractiveMode.run_clusterization-428"><span class="linenos">428</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_clusterization</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
</span><span id="InteractiveMode.run_clusterization-429"><a href="#InteractiveMode.run_clusterization-429"><span class="linenos">429</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="InteractiveMode.run_clusterization-430"><a href="#InteractiveMode.run_clusterization-430"><span class="linenos">430</span></a><span class="sd">        Performs HDBSCAN clustering and sorts image files into corresponding folders.</span>
</span><span id="InteractiveMode.run_clusterization-431"><a href="#InteractiveMode.run_clusterization-431"><span class="linenos">431</span></a>
</span><span id="InteractiveMode.run_clusterization-432"><a href="#InteractiveMode.run_clusterization-432"><span class="linenos">432</span></a><span class="sd">        Parameters</span>
</span><span id="InteractiveMode.run_clusterization-433"><a href="#InteractiveMode.run_clusterization-433"><span class="linenos">433</span></a><span class="sd">        ----------</span>
</span><span id="InteractiveMode.run_clusterization-434"><a href="#InteractiveMode.run_clusterization-434"><span class="linenos">434</span></a><span class="sd">        features : pandas.DataFrame</span>
</span><span id="InteractiveMode.run_clusterization-435"><a href="#InteractiveMode.run_clusterization-435"><span class="linenos">435</span></a><span class="sd">            The feature matrix with metadata.</span>
</span><span id="InteractiveMode.run_clusterization-436"><a href="#InteractiveMode.run_clusterization-436"><span class="linenos">436</span></a>
</span><span id="InteractiveMode.run_clusterization-437"><a href="#InteractiveMode.run_clusterization-437"><span class="linenos">437</span></a><span class="sd">        Returns</span>
</span><span id="InteractiveMode.run_clusterization-438"><a href="#InteractiveMode.run_clusterization-438"><span class="linenos">438</span></a><span class="sd">        -------</span>
</span><span id="InteractiveMode.run_clusterization-439"><a href="#InteractiveMode.run_clusterization-439"><span class="linenos">439</span></a><span class="sd">        Clustering</span>
</span><span id="InteractiveMode.run_clusterization-440"><a href="#InteractiveMode.run_clusterization-440"><span class="linenos">440</span></a><span class="sd">            Clustering object with updated label assignments and organized folders.</span>
</span><span id="InteractiveMode.run_clusterization-441"><a href="#InteractiveMode.run_clusterization-441"><span class="linenos">441</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="InteractiveMode.run_clusterization-442"><a href="#InteractiveMode.run_clusterization-442"><span class="linenos">442</span></a>
</span><span id="InteractiveMode.run_clusterization-443"><a href="#InteractiveMode.run_clusterization-443"><span class="linenos">443</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Clusterization&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode.run_clusterization-444"><a href="#InteractiveMode.run_clusterization-444"><span class="linenos">444</span></a>        <span class="n">clusters</span> <span class="o">=</span> <span class="n">Clustering</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</span><span id="InteractiveMode.run_clusterization-445"><a href="#InteractiveMode.run_clusterization-445"><span class="linenos">445</span></a>        <span class="n">df_features</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ServiceFuncs</span><span class="o">.</span><span class="n">split_into_two</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</span><span id="InteractiveMode.run_clusterization-446"><a href="#InteractiveMode.run_clusterization-446"><span class="linenos">446</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">num_clusters</span> <span class="o">=</span> <span class="n">clusters</span><span class="o">.</span><span class="n">clustering_HDBSCAN</span><span class="p">(</span><span class="n">df_features</span><span class="p">)</span>
</span><span id="InteractiveMode.run_clusterization-447"><a href="#InteractiveMode.run_clusterization-447"><span class="linenos">447</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of clusters 20D: </span><span class="si">{</span><span class="n">num_clusters</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="InteractiveMode.run_clusterization-448"><a href="#InteractiveMode.run_clusterization-448"><span class="linenos">448</span></a>        <span class="n">clusters</span><span class="o">.</span><span class="n">update_database</span><span class="p">()</span>
</span><span id="InteractiveMode.run_clusterization-449"><a href="#InteractiveMode.run_clusterization-449"><span class="linenos">449</span></a>        <span class="n">clusters</span><span class="o">.</span><span class="n">sort_files</span><span class="p">()</span>
</span><span id="InteractiveMode.run_clusterization-450"><a href="#InteractiveMode.run_clusterization-450"><span class="linenos">450</span></a>        <span class="k">return</span> <span class="n">clusters</span>
</span></pre></div>


            <div class="docstring"><p>Performs HDBSCAN clustering and sorts image files into corresponding folders.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>features</strong> (pandas.DataFrame):
The feature matrix with metadata.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Clustering</strong>: Clustering object with updated label assignments and organized folders.</li>
</ul>
</div>


                            </div>
                </section>
    </main>
</body>
</html></section><hr>
<section id="libservice">
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>libservice API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#ServiceFuncs">ServiceFuncs</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ServiceFuncs.check_extension">check_extension</a>
                        </li>
                        <li>
                                <a class="function" href="#ServiceFuncs.load_info">load_info</a>
                        </li>
                        <li>
                                <a class="function" href="#ServiceFuncs.extract_observ_data">extract_observ_data</a>
                        </li>
                        <li>
                                <a class="function" href="#ServiceFuncs.save_database">save_database</a>
                        </li>
                        <li>
                                <a class="function" href="#ServiceFuncs.read_database">read_database</a>
                        </li>
                        <li>
                                <a class="function" href="#ServiceFuncs.preparing_folder">preparing_folder</a>
                        </li>
                        <li>
                                <a class="function" href="#ServiceFuncs.split_into_two">split_into_two</a>
                        </li>
                        <li>
                                <a class="function" href="#ServiceFuncs.input_name">input_name</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
libservice    </h1>

                
                        <input id="mod-libservice-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-libservice-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1">#Copyright (c) 2025 Evgeniia VOLCHOK</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1">#for contacts e.p.volchok@gmail.com</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="c1">#Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="c1">#you may not use this file except in compliance with the License.</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="c1">#You may obtain a copy of the License at</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="c1">#http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ServiceFuncs</span><span class="p">:</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">    A static utility class providing helper functions for file handling, </span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">    image validation, metadata processing, database I/O, and folder management.</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    This class is not meant to be instantiated.</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    Methods</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    -------</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">    check_extension(file_path, allowed_extensions)</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">        Validates the file extension against allowed types.</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">    load_info(info_path)</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">        Loads and processes observation metadata from a text file.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">    extract_observ_data(path, pattern)</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">        Extracts observation type and date from a file path using regex.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    save_database(df, file_to_write, kind)</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">        Saves a pandas DataFrame to a file in pickle or JSON format.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    read_database(file_to_read, kind)</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">        Reads a pandas DataFrame from a file.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    preparing_folder(dir_name, clear)</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">        Prepares a directory, optionally clearing its contents.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">    split_into_two(df, excluded_columns)</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">        Splits a DataFrame into features and metadata parts.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    input_name(input_path, pattern)</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">        Extracts a name ID from a path using regex.</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;This class can not be instantiate.&#39;</span><span class="p">)</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>    
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_extension</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">allowed_extensions</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="s1">&#39;.bmp&#39;</span><span class="p">,</span> <span class="s1">&#39;.tiff&#39;</span><span class="p">)):</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        Check if a file has one of the allowed extensions.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">        Parameters</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">        ----------</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">        file_path : str</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">            Path to the file.</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">        allowed_extensions : tuple of str, optional</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">            Tuple of allowed file extensions.</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">        Returns</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">        -------</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">        bool</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">            True if the file has an allowed extension, False otherwise.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">allowed_extensions</span><span class="p">):</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>    
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_info</span><span class="p">(</span><span class="n">info_path</span><span class="p">):</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">        Load and preprocess metadata from a space-delimited text file.</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">        Parameters</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">        ----------</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">        info_path : str</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">            Path to the metadata file.</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">        Returns</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">        -------</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">            Parsed and enriched metadata, including date and sampling rate in kHz.</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">info_path</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">info</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">]])</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;SAMPLING_RATE[kHz]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;SAMPLING_RATE[Hz]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>        <span class="n">info</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;SAMPLING_RATE[Hz]&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>        <span class="k">return</span> <span class="n">info</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>    
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_observ_data</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;(?:r|t)swf-e_(\d</span><span class="si">{4}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)&#39;</span><span class="p">):</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">        Extracts observation type and date from the filename using regex.</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">        Parameters</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">        ----------</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">        path : str</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">            File path or name.</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">        Returns</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        -------</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">        tuple</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">            (observation_type, datetime.date)</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">        </span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">        Raises</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">        ------</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">        ValueError</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">            If the pattern is not found.</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="n">search</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">search</span><span class="p">:</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not extract observation data from: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="n">obs_type</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="n">obs_type</span><span class="p">,</span> <span class="n">date</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>    
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_database</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">file_to_write</span><span class="o">=</span><span class="s1">&#39;./results/pearson_diagram_data&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;pickle&#39;</span><span class="p">):</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">        Save a pandas DataFrame to disk.</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">        Parameters</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">        ----------</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">            Data to save.</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">        file_to_write : str</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">            Base filename without extension.</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">        kind : {&#39;pickle&#39;, &#39;json&#39;}</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">            Format to save the file in.</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">        save_dir : str</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">            Directory to save the file to.</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">        Raises</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">        ------</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">        Exception</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">            If saving fails.</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saving the database to </span><span class="si">{</span><span class="n">file_to_write</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>            <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">file_to_write</span><span class="o">+</span><span class="s1">&#39;.pkl&#39;</span><span class="p">)</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>            <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">file_to_write</span><span class="o">+</span><span class="s1">&#39;.json&#39;</span><span class="p">)</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed to save the database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read_database</span><span class="p">(</span><span class="n">file_to_read</span><span class="o">=</span><span class="s1">&#39;./results/pearson_diagram_data&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;pickle&#39;</span><span class="p">,</span> 
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>                <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;obsertype&#39;</span><span class="p">:</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="s1">&#39;datetime&#39;</span><span class="p">}):</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">        Read a pandas DataFrame from a file.</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">        Parameters</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">        ----------</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        file_to_read : str</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">            Base filename without extension.</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        kind : {&#39;pickle&#39;, &#39;json&#39;}</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">            Format of the file.</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">        dtype : dict</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">            To set types of columns in the database.</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">        Returns</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">        -------</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">        pandas.DataFrame or None</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">            The loaded DataFrame, or None if reading failed.</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reading a database from a file </span><span class="si">{</span><span class="n">file_to_read</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>            <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">file_to_read</span><span class="o">+</span><span class="s1">&#39;.pkl&#39;</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>            <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">file_to_read</span><span class="o">+</span><span class="s1">&#39;.json&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>            <span class="k">return</span> <span class="n">df</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error during reading a database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">preparing_folder</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">clear</span><span class="p">):</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">        Prepare a directory for output, optionally clearing its contents.</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">        Parameters</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">        ----------</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">        dir_name : str</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="sd">            Path to the target directory.</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">        clear : bool, optional</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">            If True, the directory will be deleted and recreated.</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">        Raises</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">        ------</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">        Exception</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">            If directory manipulation fails.</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dir_name</span><span class="p">):</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>            <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error during deleting files in </span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">split_into_two</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">excluded_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">        Split a DataFrame into features and metadata columns.</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">        Parameters</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">        ----------</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">            Input DataFrame.</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">        excluded_columns : list of str, optional</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">            Columns to exclude from the features set.</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">        Returns</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">        -------</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">        tuple of pandas.DataFrame</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">            (features_df, metadata_df)</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="k">if</span> <span class="n">excluded_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>            <span class="n">excluded_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dataset_name&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;dist_to_sun[au]&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLES_NUMBER&#39;</span><span class="p">,</span> 
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>                          <span class="s1">&#39;SAMPLING_RATE[kHz]&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLE_LENGTH[ms]&#39;</span><span class="p">,</span> <span class="s1">&#39;oldpath&#39;</span><span class="p">]</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="p">[</span><span class="n">cols</span> <span class="k">for</span> <span class="n">cols</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">cols</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_columns</span><span class="p">]</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="n">df_features</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">]</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="n">excluded_part</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">excluded_columns</span><span class="p">]</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="k">return</span> <span class="n">df_features</span><span class="p">,</span> <span class="n">excluded_part</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">input_name</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;images_(\w+)&#39;</span><span class="p">):</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">        Extract an identifier from a file path using a regular expression.</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">        Parameters</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">        ----------</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">        input_path : str</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">            File path or name.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">        pattern : str</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">            Regular expression to extract the identifier.</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">        Returns</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">        -------</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">        str</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">            Extracted identifier or the original input if no match found.</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="n">search</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">input_imags</span><span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="k">if</span> <span class="n">search</span><span class="p">:</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>            <span class="k">return</span> <span class="n">search</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="k">return</span> <span class="n">input_imags</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        
</span></pre></div>


            </section>
                <section id="ServiceFuncs">
                            <input id="ServiceFuncs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ServiceFuncs</span>:

                <label class="view-source-button" for="ServiceFuncs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ServiceFuncs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ServiceFuncs-19"><a href="#ServiceFuncs-19"><span class="linenos"> 19</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ServiceFuncs</span><span class="p">:</span>
</span><span id="ServiceFuncs-20"><a href="#ServiceFuncs-20"><span class="linenos"> 20</span></a>
</span><span id="ServiceFuncs-21"><a href="#ServiceFuncs-21"><span class="linenos"> 21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-22"><a href="#ServiceFuncs-22"><span class="linenos"> 22</span></a><span class="sd">    A static utility class providing helper functions for file handling, </span>
</span><span id="ServiceFuncs-23"><a href="#ServiceFuncs-23"><span class="linenos"> 23</span></a><span class="sd">    image validation, metadata processing, database I/O, and folder management.</span>
</span><span id="ServiceFuncs-24"><a href="#ServiceFuncs-24"><span class="linenos"> 24</span></a>
</span><span id="ServiceFuncs-25"><a href="#ServiceFuncs-25"><span class="linenos"> 25</span></a><span class="sd">    This class is not meant to be instantiated.</span>
</span><span id="ServiceFuncs-26"><a href="#ServiceFuncs-26"><span class="linenos"> 26</span></a>
</span><span id="ServiceFuncs-27"><a href="#ServiceFuncs-27"><span class="linenos"> 27</span></a><span class="sd">    Methods</span>
</span><span id="ServiceFuncs-28"><a href="#ServiceFuncs-28"><span class="linenos"> 28</span></a><span class="sd">    -------</span>
</span><span id="ServiceFuncs-29"><a href="#ServiceFuncs-29"><span class="linenos"> 29</span></a><span class="sd">    check_extension(file_path, allowed_extensions)</span>
</span><span id="ServiceFuncs-30"><a href="#ServiceFuncs-30"><span class="linenos"> 30</span></a><span class="sd">        Validates the file extension against allowed types.</span>
</span><span id="ServiceFuncs-31"><a href="#ServiceFuncs-31"><span class="linenos"> 31</span></a>
</span><span id="ServiceFuncs-32"><a href="#ServiceFuncs-32"><span class="linenos"> 32</span></a><span class="sd">    load_info(info_path)</span>
</span><span id="ServiceFuncs-33"><a href="#ServiceFuncs-33"><span class="linenos"> 33</span></a><span class="sd">        Loads and processes observation metadata from a text file.</span>
</span><span id="ServiceFuncs-34"><a href="#ServiceFuncs-34"><span class="linenos"> 34</span></a>
</span><span id="ServiceFuncs-35"><a href="#ServiceFuncs-35"><span class="linenos"> 35</span></a><span class="sd">    extract_observ_data(path, pattern)</span>
</span><span id="ServiceFuncs-36"><a href="#ServiceFuncs-36"><span class="linenos"> 36</span></a><span class="sd">        Extracts observation type and date from a file path using regex.</span>
</span><span id="ServiceFuncs-37"><a href="#ServiceFuncs-37"><span class="linenos"> 37</span></a>
</span><span id="ServiceFuncs-38"><a href="#ServiceFuncs-38"><span class="linenos"> 38</span></a><span class="sd">    save_database(df, file_to_write, kind)</span>
</span><span id="ServiceFuncs-39"><a href="#ServiceFuncs-39"><span class="linenos"> 39</span></a><span class="sd">        Saves a pandas DataFrame to a file in pickle or JSON format.</span>
</span><span id="ServiceFuncs-40"><a href="#ServiceFuncs-40"><span class="linenos"> 40</span></a>
</span><span id="ServiceFuncs-41"><a href="#ServiceFuncs-41"><span class="linenos"> 41</span></a><span class="sd">    read_database(file_to_read, kind)</span>
</span><span id="ServiceFuncs-42"><a href="#ServiceFuncs-42"><span class="linenos"> 42</span></a><span class="sd">        Reads a pandas DataFrame from a file.</span>
</span><span id="ServiceFuncs-43"><a href="#ServiceFuncs-43"><span class="linenos"> 43</span></a>
</span><span id="ServiceFuncs-44"><a href="#ServiceFuncs-44"><span class="linenos"> 44</span></a><span class="sd">    preparing_folder(dir_name, clear)</span>
</span><span id="ServiceFuncs-45"><a href="#ServiceFuncs-45"><span class="linenos"> 45</span></a><span class="sd">        Prepares a directory, optionally clearing its contents.</span>
</span><span id="ServiceFuncs-46"><a href="#ServiceFuncs-46"><span class="linenos"> 46</span></a>
</span><span id="ServiceFuncs-47"><a href="#ServiceFuncs-47"><span class="linenos"> 47</span></a><span class="sd">    split_into_two(df, excluded_columns)</span>
</span><span id="ServiceFuncs-48"><a href="#ServiceFuncs-48"><span class="linenos"> 48</span></a><span class="sd">        Splits a DataFrame into features and metadata parts.</span>
</span><span id="ServiceFuncs-49"><a href="#ServiceFuncs-49"><span class="linenos"> 49</span></a>
</span><span id="ServiceFuncs-50"><a href="#ServiceFuncs-50"><span class="linenos"> 50</span></a><span class="sd">    input_name(input_path, pattern)</span>
</span><span id="ServiceFuncs-51"><a href="#ServiceFuncs-51"><span class="linenos"> 51</span></a><span class="sd">        Extracts a name ID from a path using regex.</span>
</span><span id="ServiceFuncs-52"><a href="#ServiceFuncs-52"><span class="linenos"> 52</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-53"><a href="#ServiceFuncs-53"><span class="linenos"> 53</span></a>
</span><span id="ServiceFuncs-54"><a href="#ServiceFuncs-54"><span class="linenos"> 54</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ServiceFuncs-55"><a href="#ServiceFuncs-55"><span class="linenos"> 55</span></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;This class can not be instantiate.&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs-56"><a href="#ServiceFuncs-56"><span class="linenos"> 56</span></a>    
</span><span id="ServiceFuncs-57"><a href="#ServiceFuncs-57"><span class="linenos"> 57</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ServiceFuncs-58"><a href="#ServiceFuncs-58"><span class="linenos"> 58</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_extension</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">allowed_extensions</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="s1">&#39;.bmp&#39;</span><span class="p">,</span> <span class="s1">&#39;.tiff&#39;</span><span class="p">)):</span>
</span><span id="ServiceFuncs-59"><a href="#ServiceFuncs-59"><span class="linenos"> 59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-60"><a href="#ServiceFuncs-60"><span class="linenos"> 60</span></a><span class="sd">        Check if a file has one of the allowed extensions.</span>
</span><span id="ServiceFuncs-61"><a href="#ServiceFuncs-61"><span class="linenos"> 61</span></a>
</span><span id="ServiceFuncs-62"><a href="#ServiceFuncs-62"><span class="linenos"> 62</span></a><span class="sd">        Parameters</span>
</span><span id="ServiceFuncs-63"><a href="#ServiceFuncs-63"><span class="linenos"> 63</span></a><span class="sd">        ----------</span>
</span><span id="ServiceFuncs-64"><a href="#ServiceFuncs-64"><span class="linenos"> 64</span></a><span class="sd">        file_path : str</span>
</span><span id="ServiceFuncs-65"><a href="#ServiceFuncs-65"><span class="linenos"> 65</span></a><span class="sd">            Path to the file.</span>
</span><span id="ServiceFuncs-66"><a href="#ServiceFuncs-66"><span class="linenos"> 66</span></a><span class="sd">        allowed_extensions : tuple of str, optional</span>
</span><span id="ServiceFuncs-67"><a href="#ServiceFuncs-67"><span class="linenos"> 67</span></a><span class="sd">            Tuple of allowed file extensions.</span>
</span><span id="ServiceFuncs-68"><a href="#ServiceFuncs-68"><span class="linenos"> 68</span></a>
</span><span id="ServiceFuncs-69"><a href="#ServiceFuncs-69"><span class="linenos"> 69</span></a><span class="sd">        Returns</span>
</span><span id="ServiceFuncs-70"><a href="#ServiceFuncs-70"><span class="linenos"> 70</span></a><span class="sd">        -------</span>
</span><span id="ServiceFuncs-71"><a href="#ServiceFuncs-71"><span class="linenos"> 71</span></a><span class="sd">        bool</span>
</span><span id="ServiceFuncs-72"><a href="#ServiceFuncs-72"><span class="linenos"> 72</span></a><span class="sd">            True if the file has an allowed extension, False otherwise.</span>
</span><span id="ServiceFuncs-73"><a href="#ServiceFuncs-73"><span class="linenos"> 73</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-74"><a href="#ServiceFuncs-74"><span class="linenos"> 74</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">allowed_extensions</span><span class="p">):</span>
</span><span id="ServiceFuncs-75"><a href="#ServiceFuncs-75"><span class="linenos"> 75</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ServiceFuncs-76"><a href="#ServiceFuncs-76"><span class="linenos"> 76</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="ServiceFuncs-77"><a href="#ServiceFuncs-77"><span class="linenos"> 77</span></a>    
</span><span id="ServiceFuncs-78"><a href="#ServiceFuncs-78"><span class="linenos"> 78</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ServiceFuncs-79"><a href="#ServiceFuncs-79"><span class="linenos"> 79</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_info</span><span class="p">(</span><span class="n">info_path</span><span class="p">):</span>
</span><span id="ServiceFuncs-80"><a href="#ServiceFuncs-80"><span class="linenos"> 80</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-81"><a href="#ServiceFuncs-81"><span class="linenos"> 81</span></a><span class="sd">        Load and preprocess metadata from a space-delimited text file.</span>
</span><span id="ServiceFuncs-82"><a href="#ServiceFuncs-82"><span class="linenos"> 82</span></a>
</span><span id="ServiceFuncs-83"><a href="#ServiceFuncs-83"><span class="linenos"> 83</span></a><span class="sd">        Parameters</span>
</span><span id="ServiceFuncs-84"><a href="#ServiceFuncs-84"><span class="linenos"> 84</span></a><span class="sd">        ----------</span>
</span><span id="ServiceFuncs-85"><a href="#ServiceFuncs-85"><span class="linenos"> 85</span></a><span class="sd">        info_path : str</span>
</span><span id="ServiceFuncs-86"><a href="#ServiceFuncs-86"><span class="linenos"> 86</span></a><span class="sd">            Path to the metadata file.</span>
</span><span id="ServiceFuncs-87"><a href="#ServiceFuncs-87"><span class="linenos"> 87</span></a>
</span><span id="ServiceFuncs-88"><a href="#ServiceFuncs-88"><span class="linenos"> 88</span></a><span class="sd">        Returns</span>
</span><span id="ServiceFuncs-89"><a href="#ServiceFuncs-89"><span class="linenos"> 89</span></a><span class="sd">        -------</span>
</span><span id="ServiceFuncs-90"><a href="#ServiceFuncs-90"><span class="linenos"> 90</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="ServiceFuncs-91"><a href="#ServiceFuncs-91"><span class="linenos"> 91</span></a><span class="sd">            Parsed and enriched metadata, including date and sampling rate in kHz.</span>
</span><span id="ServiceFuncs-92"><a href="#ServiceFuncs-92"><span class="linenos"> 92</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-93"><a href="#ServiceFuncs-93"><span class="linenos"> 93</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">info_path</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs-94"><a href="#ServiceFuncs-94"><span class="linenos"> 94</span></a>        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">info</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">]])</span>
</span><span id="ServiceFuncs-95"><a href="#ServiceFuncs-95"><span class="linenos"> 95</span></a>        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;SAMPLING_RATE[kHz]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;SAMPLING_RATE[Hz]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</span><span id="ServiceFuncs-96"><a href="#ServiceFuncs-96"><span class="linenos"> 96</span></a>        <span class="n">info</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;SAMPLING_RATE[Hz]&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ServiceFuncs-97"><a href="#ServiceFuncs-97"><span class="linenos"> 97</span></a>        <span class="k">return</span> <span class="n">info</span>
</span><span id="ServiceFuncs-98"><a href="#ServiceFuncs-98"><span class="linenos"> 98</span></a>    
</span><span id="ServiceFuncs-99"><a href="#ServiceFuncs-99"><span class="linenos"> 99</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ServiceFuncs-100"><a href="#ServiceFuncs-100"><span class="linenos">100</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_observ_data</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;(?:r|t)swf-e_(\d</span><span class="si">{4}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)&#39;</span><span class="p">):</span>
</span><span id="ServiceFuncs-101"><a href="#ServiceFuncs-101"><span class="linenos">101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-102"><a href="#ServiceFuncs-102"><span class="linenos">102</span></a><span class="sd">        Extracts observation type and date from the filename using regex.</span>
</span><span id="ServiceFuncs-103"><a href="#ServiceFuncs-103"><span class="linenos">103</span></a>
</span><span id="ServiceFuncs-104"><a href="#ServiceFuncs-104"><span class="linenos">104</span></a><span class="sd">        Parameters</span>
</span><span id="ServiceFuncs-105"><a href="#ServiceFuncs-105"><span class="linenos">105</span></a><span class="sd">        ----------</span>
</span><span id="ServiceFuncs-106"><a href="#ServiceFuncs-106"><span class="linenos">106</span></a><span class="sd">        path : str</span>
</span><span id="ServiceFuncs-107"><a href="#ServiceFuncs-107"><span class="linenos">107</span></a><span class="sd">            File path or name.</span>
</span><span id="ServiceFuncs-108"><a href="#ServiceFuncs-108"><span class="linenos">108</span></a>
</span><span id="ServiceFuncs-109"><a href="#ServiceFuncs-109"><span class="linenos">109</span></a><span class="sd">        Returns</span>
</span><span id="ServiceFuncs-110"><a href="#ServiceFuncs-110"><span class="linenos">110</span></a><span class="sd">        -------</span>
</span><span id="ServiceFuncs-111"><a href="#ServiceFuncs-111"><span class="linenos">111</span></a><span class="sd">        tuple</span>
</span><span id="ServiceFuncs-112"><a href="#ServiceFuncs-112"><span class="linenos">112</span></a><span class="sd">            (observation_type, datetime.date)</span>
</span><span id="ServiceFuncs-113"><a href="#ServiceFuncs-113"><span class="linenos">113</span></a><span class="sd">        </span>
</span><span id="ServiceFuncs-114"><a href="#ServiceFuncs-114"><span class="linenos">114</span></a><span class="sd">        Raises</span>
</span><span id="ServiceFuncs-115"><a href="#ServiceFuncs-115"><span class="linenos">115</span></a><span class="sd">        ------</span>
</span><span id="ServiceFuncs-116"><a href="#ServiceFuncs-116"><span class="linenos">116</span></a><span class="sd">        ValueError</span>
</span><span id="ServiceFuncs-117"><a href="#ServiceFuncs-117"><span class="linenos">117</span></a><span class="sd">            If the pattern is not found.</span>
</span><span id="ServiceFuncs-118"><a href="#ServiceFuncs-118"><span class="linenos">118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-119"><a href="#ServiceFuncs-119"><span class="linenos">119</span></a>        <span class="n">search</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="ServiceFuncs-120"><a href="#ServiceFuncs-120"><span class="linenos">120</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">search</span><span class="p">:</span>
</span><span id="ServiceFuncs-121"><a href="#ServiceFuncs-121"><span class="linenos">121</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not extract observation data from: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs-122"><a href="#ServiceFuncs-122"><span class="linenos">122</span></a>        <span class="n">obs_type</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ServiceFuncs-123"><a href="#ServiceFuncs-123"><span class="linenos">123</span></a>        <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
</span><span id="ServiceFuncs-124"><a href="#ServiceFuncs-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="n">obs_type</span><span class="p">,</span> <span class="n">date</span>
</span><span id="ServiceFuncs-125"><a href="#ServiceFuncs-125"><span class="linenos">125</span></a>    
</span><span id="ServiceFuncs-126"><a href="#ServiceFuncs-126"><span class="linenos">126</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ServiceFuncs-127"><a href="#ServiceFuncs-127"><span class="linenos">127</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_database</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">file_to_write</span><span class="o">=</span><span class="s1">&#39;./results/pearson_diagram_data&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;pickle&#39;</span><span class="p">):</span>
</span><span id="ServiceFuncs-128"><a href="#ServiceFuncs-128"><span class="linenos">128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-129"><a href="#ServiceFuncs-129"><span class="linenos">129</span></a><span class="sd">        Save a pandas DataFrame to disk.</span>
</span><span id="ServiceFuncs-130"><a href="#ServiceFuncs-130"><span class="linenos">130</span></a>
</span><span id="ServiceFuncs-131"><a href="#ServiceFuncs-131"><span class="linenos">131</span></a><span class="sd">        Parameters</span>
</span><span id="ServiceFuncs-132"><a href="#ServiceFuncs-132"><span class="linenos">132</span></a><span class="sd">        ----------</span>
</span><span id="ServiceFuncs-133"><a href="#ServiceFuncs-133"><span class="linenos">133</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="ServiceFuncs-134"><a href="#ServiceFuncs-134"><span class="linenos">134</span></a><span class="sd">            Data to save.</span>
</span><span id="ServiceFuncs-135"><a href="#ServiceFuncs-135"><span class="linenos">135</span></a><span class="sd">        file_to_write : str</span>
</span><span id="ServiceFuncs-136"><a href="#ServiceFuncs-136"><span class="linenos">136</span></a><span class="sd">            Base filename without extension.</span>
</span><span id="ServiceFuncs-137"><a href="#ServiceFuncs-137"><span class="linenos">137</span></a><span class="sd">        kind : {&#39;pickle&#39;, &#39;json&#39;}</span>
</span><span id="ServiceFuncs-138"><a href="#ServiceFuncs-138"><span class="linenos">138</span></a><span class="sd">            Format to save the file in.</span>
</span><span id="ServiceFuncs-139"><a href="#ServiceFuncs-139"><span class="linenos">139</span></a><span class="sd">        save_dir : str</span>
</span><span id="ServiceFuncs-140"><a href="#ServiceFuncs-140"><span class="linenos">140</span></a><span class="sd">            Directory to save the file to.</span>
</span><span id="ServiceFuncs-141"><a href="#ServiceFuncs-141"><span class="linenos">141</span></a>
</span><span id="ServiceFuncs-142"><a href="#ServiceFuncs-142"><span class="linenos">142</span></a><span class="sd">        Raises</span>
</span><span id="ServiceFuncs-143"><a href="#ServiceFuncs-143"><span class="linenos">143</span></a><span class="sd">        ------</span>
</span><span id="ServiceFuncs-144"><a href="#ServiceFuncs-144"><span class="linenos">144</span></a><span class="sd">        Exception</span>
</span><span id="ServiceFuncs-145"><a href="#ServiceFuncs-145"><span class="linenos">145</span></a><span class="sd">            If saving fails.</span>
</span><span id="ServiceFuncs-146"><a href="#ServiceFuncs-146"><span class="linenos">146</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-147"><a href="#ServiceFuncs-147"><span class="linenos">147</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saving the database to </span><span class="si">{</span><span class="n">file_to_write</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs-148"><a href="#ServiceFuncs-148"><span class="linenos">148</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ServiceFuncs-149"><a href="#ServiceFuncs-149"><span class="linenos">149</span></a>            <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
</span><span id="ServiceFuncs-150"><a href="#ServiceFuncs-150"><span class="linenos">150</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">file_to_write</span><span class="o">+</span><span class="s1">&#39;.pkl&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs-151"><a href="#ServiceFuncs-151"><span class="linenos">151</span></a>            <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
</span><span id="ServiceFuncs-152"><a href="#ServiceFuncs-152"><span class="linenos">152</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">file_to_write</span><span class="o">+</span><span class="s1">&#39;.json&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs-153"><a href="#ServiceFuncs-153"><span class="linenos">153</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ServiceFuncs-154"><a href="#ServiceFuncs-154"><span class="linenos">154</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed to save the database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs-155"><a href="#ServiceFuncs-155"><span class="linenos">155</span></a>
</span><span id="ServiceFuncs-156"><a href="#ServiceFuncs-156"><span class="linenos">156</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ServiceFuncs-157"><a href="#ServiceFuncs-157"><span class="linenos">157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read_database</span><span class="p">(</span><span class="n">file_to_read</span><span class="o">=</span><span class="s1">&#39;./results/pearson_diagram_data&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;pickle&#39;</span><span class="p">,</span> 
</span><span id="ServiceFuncs-158"><a href="#ServiceFuncs-158"><span class="linenos">158</span></a>                <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;obsertype&#39;</span><span class="p">:</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="s1">&#39;datetime&#39;</span><span class="p">}):</span>
</span><span id="ServiceFuncs-159"><a href="#ServiceFuncs-159"><span class="linenos">159</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-160"><a href="#ServiceFuncs-160"><span class="linenos">160</span></a><span class="sd">        Read a pandas DataFrame from a file.</span>
</span><span id="ServiceFuncs-161"><a href="#ServiceFuncs-161"><span class="linenos">161</span></a>
</span><span id="ServiceFuncs-162"><a href="#ServiceFuncs-162"><span class="linenos">162</span></a><span class="sd">        Parameters</span>
</span><span id="ServiceFuncs-163"><a href="#ServiceFuncs-163"><span class="linenos">163</span></a><span class="sd">        ----------</span>
</span><span id="ServiceFuncs-164"><a href="#ServiceFuncs-164"><span class="linenos">164</span></a><span class="sd">        file_to_read : str</span>
</span><span id="ServiceFuncs-165"><a href="#ServiceFuncs-165"><span class="linenos">165</span></a><span class="sd">            Base filename without extension.</span>
</span><span id="ServiceFuncs-166"><a href="#ServiceFuncs-166"><span class="linenos">166</span></a><span class="sd">        kind : {&#39;pickle&#39;, &#39;json&#39;}</span>
</span><span id="ServiceFuncs-167"><a href="#ServiceFuncs-167"><span class="linenos">167</span></a><span class="sd">            Format of the file.</span>
</span><span id="ServiceFuncs-168"><a href="#ServiceFuncs-168"><span class="linenos">168</span></a><span class="sd">        dtype : dict</span>
</span><span id="ServiceFuncs-169"><a href="#ServiceFuncs-169"><span class="linenos">169</span></a><span class="sd">            To set types of columns in the database.</span>
</span><span id="ServiceFuncs-170"><a href="#ServiceFuncs-170"><span class="linenos">170</span></a>
</span><span id="ServiceFuncs-171"><a href="#ServiceFuncs-171"><span class="linenos">171</span></a><span class="sd">        Returns</span>
</span><span id="ServiceFuncs-172"><a href="#ServiceFuncs-172"><span class="linenos">172</span></a><span class="sd">        -------</span>
</span><span id="ServiceFuncs-173"><a href="#ServiceFuncs-173"><span class="linenos">173</span></a><span class="sd">        pandas.DataFrame or None</span>
</span><span id="ServiceFuncs-174"><a href="#ServiceFuncs-174"><span class="linenos">174</span></a><span class="sd">            The loaded DataFrame, or None if reading failed.</span>
</span><span id="ServiceFuncs-175"><a href="#ServiceFuncs-175"><span class="linenos">175</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-176"><a href="#ServiceFuncs-176"><span class="linenos">176</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reading a database from a file </span><span class="si">{</span><span class="n">file_to_read</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs-177"><a href="#ServiceFuncs-177"><span class="linenos">177</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ServiceFuncs-178"><a href="#ServiceFuncs-178"><span class="linenos">178</span></a>            <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
</span><span id="ServiceFuncs-179"><a href="#ServiceFuncs-179"><span class="linenos">179</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">file_to_read</span><span class="o">+</span><span class="s1">&#39;.pkl&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs-180"><a href="#ServiceFuncs-180"><span class="linenos">180</span></a>            <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
</span><span id="ServiceFuncs-181"><a href="#ServiceFuncs-181"><span class="linenos">181</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">file_to_read</span><span class="o">+</span><span class="s1">&#39;.json&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="ServiceFuncs-182"><a href="#ServiceFuncs-182"><span class="linenos">182</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span><span id="ServiceFuncs-183"><a href="#ServiceFuncs-183"><span class="linenos">183</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</span><span id="ServiceFuncs-184"><a href="#ServiceFuncs-184"><span class="linenos">184</span></a>            <span class="k">return</span> <span class="n">df</span>
</span><span id="ServiceFuncs-185"><a href="#ServiceFuncs-185"><span class="linenos">185</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ServiceFuncs-186"><a href="#ServiceFuncs-186"><span class="linenos">186</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error during reading a database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs-187"><a href="#ServiceFuncs-187"><span class="linenos">187</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="ServiceFuncs-188"><a href="#ServiceFuncs-188"><span class="linenos">188</span></a>        
</span><span id="ServiceFuncs-189"><a href="#ServiceFuncs-189"><span class="linenos">189</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ServiceFuncs-190"><a href="#ServiceFuncs-190"><span class="linenos">190</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">preparing_folder</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">clear</span><span class="p">):</span>
</span><span id="ServiceFuncs-191"><a href="#ServiceFuncs-191"><span class="linenos">191</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-192"><a href="#ServiceFuncs-192"><span class="linenos">192</span></a><span class="sd">        Prepare a directory for output, optionally clearing its contents.</span>
</span><span id="ServiceFuncs-193"><a href="#ServiceFuncs-193"><span class="linenos">193</span></a>
</span><span id="ServiceFuncs-194"><a href="#ServiceFuncs-194"><span class="linenos">194</span></a><span class="sd">        Parameters</span>
</span><span id="ServiceFuncs-195"><a href="#ServiceFuncs-195"><span class="linenos">195</span></a><span class="sd">        ----------</span>
</span><span id="ServiceFuncs-196"><a href="#ServiceFuncs-196"><span class="linenos">196</span></a><span class="sd">        dir_name : str</span>
</span><span id="ServiceFuncs-197"><a href="#ServiceFuncs-197"><span class="linenos">197</span></a><span class="sd">            Path to the target directory.</span>
</span><span id="ServiceFuncs-198"><a href="#ServiceFuncs-198"><span class="linenos">198</span></a><span class="sd">        clear : bool, optional</span>
</span><span id="ServiceFuncs-199"><a href="#ServiceFuncs-199"><span class="linenos">199</span></a><span class="sd">            If True, the directory will be deleted and recreated.</span>
</span><span id="ServiceFuncs-200"><a href="#ServiceFuncs-200"><span class="linenos">200</span></a>
</span><span id="ServiceFuncs-201"><a href="#ServiceFuncs-201"><span class="linenos">201</span></a><span class="sd">        Raises</span>
</span><span id="ServiceFuncs-202"><a href="#ServiceFuncs-202"><span class="linenos">202</span></a><span class="sd">        ------</span>
</span><span id="ServiceFuncs-203"><a href="#ServiceFuncs-203"><span class="linenos">203</span></a><span class="sd">        Exception</span>
</span><span id="ServiceFuncs-204"><a href="#ServiceFuncs-204"><span class="linenos">204</span></a><span class="sd">            If directory manipulation fails.</span>
</span><span id="ServiceFuncs-205"><a href="#ServiceFuncs-205"><span class="linenos">205</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-206"><a href="#ServiceFuncs-206"><span class="linenos">206</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dir_name</span><span class="p">):</span>
</span><span id="ServiceFuncs-207"><a href="#ServiceFuncs-207"><span class="linenos">207</span></a>            <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
</span><span id="ServiceFuncs-208"><a href="#ServiceFuncs-208"><span class="linenos">208</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="ServiceFuncs-209"><a href="#ServiceFuncs-209"><span class="linenos">209</span></a>                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
</span><span id="ServiceFuncs-210"><a href="#ServiceFuncs-210"><span class="linenos">210</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
</span><span id="ServiceFuncs-211"><a href="#ServiceFuncs-211"><span class="linenos">211</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ServiceFuncs-212"><a href="#ServiceFuncs-212"><span class="linenos">212</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error during deleting files in </span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs-213"><a href="#ServiceFuncs-213"><span class="linenos">213</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ServiceFuncs-214"><a href="#ServiceFuncs-214"><span class="linenos">214</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
</span><span id="ServiceFuncs-215"><a href="#ServiceFuncs-215"><span class="linenos">215</span></a>
</span><span id="ServiceFuncs-216"><a href="#ServiceFuncs-216"><span class="linenos">216</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ServiceFuncs-217"><a href="#ServiceFuncs-217"><span class="linenos">217</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">split_into_two</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">excluded_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="ServiceFuncs-218"><a href="#ServiceFuncs-218"><span class="linenos">218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-219"><a href="#ServiceFuncs-219"><span class="linenos">219</span></a><span class="sd">        Split a DataFrame into features and metadata columns.</span>
</span><span id="ServiceFuncs-220"><a href="#ServiceFuncs-220"><span class="linenos">220</span></a>
</span><span id="ServiceFuncs-221"><a href="#ServiceFuncs-221"><span class="linenos">221</span></a><span class="sd">        Parameters</span>
</span><span id="ServiceFuncs-222"><a href="#ServiceFuncs-222"><span class="linenos">222</span></a><span class="sd">        ----------</span>
</span><span id="ServiceFuncs-223"><a href="#ServiceFuncs-223"><span class="linenos">223</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="ServiceFuncs-224"><a href="#ServiceFuncs-224"><span class="linenos">224</span></a><span class="sd">            Input DataFrame.</span>
</span><span id="ServiceFuncs-225"><a href="#ServiceFuncs-225"><span class="linenos">225</span></a><span class="sd">        excluded_columns : list of str, optional</span>
</span><span id="ServiceFuncs-226"><a href="#ServiceFuncs-226"><span class="linenos">226</span></a><span class="sd">            Columns to exclude from the features set.</span>
</span><span id="ServiceFuncs-227"><a href="#ServiceFuncs-227"><span class="linenos">227</span></a>
</span><span id="ServiceFuncs-228"><a href="#ServiceFuncs-228"><span class="linenos">228</span></a><span class="sd">        Returns</span>
</span><span id="ServiceFuncs-229"><a href="#ServiceFuncs-229"><span class="linenos">229</span></a><span class="sd">        -------</span>
</span><span id="ServiceFuncs-230"><a href="#ServiceFuncs-230"><span class="linenos">230</span></a><span class="sd">        tuple of pandas.DataFrame</span>
</span><span id="ServiceFuncs-231"><a href="#ServiceFuncs-231"><span class="linenos">231</span></a><span class="sd">            (features_df, metadata_df)</span>
</span><span id="ServiceFuncs-232"><a href="#ServiceFuncs-232"><span class="linenos">232</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-233"><a href="#ServiceFuncs-233"><span class="linenos">233</span></a>        <span class="k">if</span> <span class="n">excluded_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ServiceFuncs-234"><a href="#ServiceFuncs-234"><span class="linenos">234</span></a>            <span class="n">excluded_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dataset_name&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;dist_to_sun[au]&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLES_NUMBER&#39;</span><span class="p">,</span> 
</span><span id="ServiceFuncs-235"><a href="#ServiceFuncs-235"><span class="linenos">235</span></a>                          <span class="s1">&#39;SAMPLING_RATE[kHz]&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLE_LENGTH[ms]&#39;</span><span class="p">,</span> <span class="s1">&#39;oldpath&#39;</span><span class="p">]</span>
</span><span id="ServiceFuncs-236"><a href="#ServiceFuncs-236"><span class="linenos">236</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="p">[</span><span class="n">cols</span> <span class="k">for</span> <span class="n">cols</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">cols</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_columns</span><span class="p">]</span>
</span><span id="ServiceFuncs-237"><a href="#ServiceFuncs-237"><span class="linenos">237</span></a>        <span class="n">df_features</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">]</span>
</span><span id="ServiceFuncs-238"><a href="#ServiceFuncs-238"><span class="linenos">238</span></a>        <span class="n">excluded_part</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">excluded_columns</span><span class="p">]</span>
</span><span id="ServiceFuncs-239"><a href="#ServiceFuncs-239"><span class="linenos">239</span></a>        <span class="k">return</span> <span class="n">df_features</span><span class="p">,</span> <span class="n">excluded_part</span>
</span><span id="ServiceFuncs-240"><a href="#ServiceFuncs-240"><span class="linenos">240</span></a>
</span><span id="ServiceFuncs-241"><a href="#ServiceFuncs-241"><span class="linenos">241</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ServiceFuncs-242"><a href="#ServiceFuncs-242"><span class="linenos">242</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">input_name</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;images_(\w+)&#39;</span><span class="p">):</span>
</span><span id="ServiceFuncs-243"><a href="#ServiceFuncs-243"><span class="linenos">243</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-244"><a href="#ServiceFuncs-244"><span class="linenos">244</span></a><span class="sd">        Extract an identifier from a file path using a regular expression.</span>
</span><span id="ServiceFuncs-245"><a href="#ServiceFuncs-245"><span class="linenos">245</span></a>
</span><span id="ServiceFuncs-246"><a href="#ServiceFuncs-246"><span class="linenos">246</span></a><span class="sd">        Parameters</span>
</span><span id="ServiceFuncs-247"><a href="#ServiceFuncs-247"><span class="linenos">247</span></a><span class="sd">        ----------</span>
</span><span id="ServiceFuncs-248"><a href="#ServiceFuncs-248"><span class="linenos">248</span></a><span class="sd">        input_path : str</span>
</span><span id="ServiceFuncs-249"><a href="#ServiceFuncs-249"><span class="linenos">249</span></a><span class="sd">            File path or name.</span>
</span><span id="ServiceFuncs-250"><a href="#ServiceFuncs-250"><span class="linenos">250</span></a><span class="sd">        pattern : str</span>
</span><span id="ServiceFuncs-251"><a href="#ServiceFuncs-251"><span class="linenos">251</span></a><span class="sd">            Regular expression to extract the identifier.</span>
</span><span id="ServiceFuncs-252"><a href="#ServiceFuncs-252"><span class="linenos">252</span></a>
</span><span id="ServiceFuncs-253"><a href="#ServiceFuncs-253"><span class="linenos">253</span></a><span class="sd">        Returns</span>
</span><span id="ServiceFuncs-254"><a href="#ServiceFuncs-254"><span class="linenos">254</span></a><span class="sd">        -------</span>
</span><span id="ServiceFuncs-255"><a href="#ServiceFuncs-255"><span class="linenos">255</span></a><span class="sd">        str</span>
</span><span id="ServiceFuncs-256"><a href="#ServiceFuncs-256"><span class="linenos">256</span></a><span class="sd">            Extracted identifier or the original input if no match found.</span>
</span><span id="ServiceFuncs-257"><a href="#ServiceFuncs-257"><span class="linenos">257</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ServiceFuncs-258"><a href="#ServiceFuncs-258"><span class="linenos">258</span></a>        <span class="n">search</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">input_imags</span><span class="p">)</span>
</span><span id="ServiceFuncs-259"><a href="#ServiceFuncs-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="n">search</span><span class="p">:</span>
</span><span id="ServiceFuncs-260"><a href="#ServiceFuncs-260"><span class="linenos">260</span></a>            <span class="k">return</span> <span class="n">search</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ServiceFuncs-261"><a href="#ServiceFuncs-261"><span class="linenos">261</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ServiceFuncs-262"><a href="#ServiceFuncs-262"><span class="linenos">262</span></a>            <span class="k">return</span> <span class="n">input_imags</span>
</span></pre></div>


            <div class="docstring"><p>A static utility class providing helper functions for file handling, 
image validation, metadata processing, database I/O, and folder management.</p>

<p>This class is not meant to be instantiated.</p>

<h6 id="methods">Methods</h6>

<p>check_extension(file_path, allowed_extensions)
    Validates the file extension against allowed types.</p>

<p>load_info(info_path)
    Loads and processes observation metadata from a text file.</p>

<p>extract_observ_data(path, pattern)
    Extracts observation type and date from a file path using regex.</p>

<p>save_database(df, file_to_write, kind)
    Saves a pandas DataFrame to a file in pickle or JSON format.</p>

<p>read_database(file_to_read, kind)
    Reads a pandas DataFrame from a file.</p>

<p>preparing_folder(dir_name, clear)
    Prepares a directory, optionally clearing its contents.</p>

<p>split_into_two(df, excluded_columns)
    Splits a DataFrame into features and metadata parts.</p>

<p>input_name(input_path, pattern)
    Extracts a name ID from a path using regex.</p>
</div>


                            <div id="ServiceFuncs.check_extension" class="classattr">
                                        <input id="ServiceFuncs.check_extension-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">check_extension</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">file_path</span>,</span><span class="param">	<span class="n">allowed_extensions</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="s1">&#39;.bmp&#39;</span><span class="p">,</span> <span class="s1">&#39;.tiff&#39;</span><span class="p">)</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ServiceFuncs.check_extension-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ServiceFuncs.check_extension"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ServiceFuncs.check_extension-57"><a href="#ServiceFuncs.check_extension-57"><span class="linenos">57</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ServiceFuncs.check_extension-58"><a href="#ServiceFuncs.check_extension-58"><span class="linenos">58</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_extension</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">allowed_extensions</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="s1">&#39;.bmp&#39;</span><span class="p">,</span> <span class="s1">&#39;.tiff&#39;</span><span class="p">)):</span>
</span><span id="ServiceFuncs.check_extension-59"><a href="#ServiceFuncs.check_extension-59"><span class="linenos">59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ServiceFuncs.check_extension-60"><a href="#ServiceFuncs.check_extension-60"><span class="linenos">60</span></a><span class="sd">        Check if a file has one of the allowed extensions.</span>
</span><span id="ServiceFuncs.check_extension-61"><a href="#ServiceFuncs.check_extension-61"><span class="linenos">61</span></a>
</span><span id="ServiceFuncs.check_extension-62"><a href="#ServiceFuncs.check_extension-62"><span class="linenos">62</span></a><span class="sd">        Parameters</span>
</span><span id="ServiceFuncs.check_extension-63"><a href="#ServiceFuncs.check_extension-63"><span class="linenos">63</span></a><span class="sd">        ----------</span>
</span><span id="ServiceFuncs.check_extension-64"><a href="#ServiceFuncs.check_extension-64"><span class="linenos">64</span></a><span class="sd">        file_path : str</span>
</span><span id="ServiceFuncs.check_extension-65"><a href="#ServiceFuncs.check_extension-65"><span class="linenos">65</span></a><span class="sd">            Path to the file.</span>
</span><span id="ServiceFuncs.check_extension-66"><a href="#ServiceFuncs.check_extension-66"><span class="linenos">66</span></a><span class="sd">        allowed_extensions : tuple of str, optional</span>
</span><span id="ServiceFuncs.check_extension-67"><a href="#ServiceFuncs.check_extension-67"><span class="linenos">67</span></a><span class="sd">            Tuple of allowed file extensions.</span>
</span><span id="ServiceFuncs.check_extension-68"><a href="#ServiceFuncs.check_extension-68"><span class="linenos">68</span></a>
</span><span id="ServiceFuncs.check_extension-69"><a href="#ServiceFuncs.check_extension-69"><span class="linenos">69</span></a><span class="sd">        Returns</span>
</span><span id="ServiceFuncs.check_extension-70"><a href="#ServiceFuncs.check_extension-70"><span class="linenos">70</span></a><span class="sd">        -------</span>
</span><span id="ServiceFuncs.check_extension-71"><a href="#ServiceFuncs.check_extension-71"><span class="linenos">71</span></a><span class="sd">        bool</span>
</span><span id="ServiceFuncs.check_extension-72"><a href="#ServiceFuncs.check_extension-72"><span class="linenos">72</span></a><span class="sd">            True if the file has an allowed extension, False otherwise.</span>
</span><span id="ServiceFuncs.check_extension-73"><a href="#ServiceFuncs.check_extension-73"><span class="linenos">73</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ServiceFuncs.check_extension-74"><a href="#ServiceFuncs.check_extension-74"><span class="linenos">74</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">allowed_extensions</span><span class="p">):</span>
</span><span id="ServiceFuncs.check_extension-75"><a href="#ServiceFuncs.check_extension-75"><span class="linenos">75</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ServiceFuncs.check_extension-76"><a href="#ServiceFuncs.check_extension-76"><span class="linenos">76</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Check if a file has one of the allowed extensions.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>file_path</strong> (str):
Path to the file.</li>
<li><strong>allowed_extensions</strong> (tuple of str, optional):
Tuple of allowed file extensions.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>bool</strong>: True if the file has an allowed extension, False otherwise.</li>
</ul>
</div>


                            </div>
                            <div id="ServiceFuncs.load_info" class="classattr">
                                        <input id="ServiceFuncs.load_info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">load_info</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">info_path</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ServiceFuncs.load_info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ServiceFuncs.load_info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ServiceFuncs.load_info-78"><a href="#ServiceFuncs.load_info-78"><span class="linenos">78</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ServiceFuncs.load_info-79"><a href="#ServiceFuncs.load_info-79"><span class="linenos">79</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_info</span><span class="p">(</span><span class="n">info_path</span><span class="p">):</span>
</span><span id="ServiceFuncs.load_info-80"><a href="#ServiceFuncs.load_info-80"><span class="linenos">80</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ServiceFuncs.load_info-81"><a href="#ServiceFuncs.load_info-81"><span class="linenos">81</span></a><span class="sd">        Load and preprocess metadata from a space-delimited text file.</span>
</span><span id="ServiceFuncs.load_info-82"><a href="#ServiceFuncs.load_info-82"><span class="linenos">82</span></a>
</span><span id="ServiceFuncs.load_info-83"><a href="#ServiceFuncs.load_info-83"><span class="linenos">83</span></a><span class="sd">        Parameters</span>
</span><span id="ServiceFuncs.load_info-84"><a href="#ServiceFuncs.load_info-84"><span class="linenos">84</span></a><span class="sd">        ----------</span>
</span><span id="ServiceFuncs.load_info-85"><a href="#ServiceFuncs.load_info-85"><span class="linenos">85</span></a><span class="sd">        info_path : str</span>
</span><span id="ServiceFuncs.load_info-86"><a href="#ServiceFuncs.load_info-86"><span class="linenos">86</span></a><span class="sd">            Path to the metadata file.</span>
</span><span id="ServiceFuncs.load_info-87"><a href="#ServiceFuncs.load_info-87"><span class="linenos">87</span></a>
</span><span id="ServiceFuncs.load_info-88"><a href="#ServiceFuncs.load_info-88"><span class="linenos">88</span></a><span class="sd">        Returns</span>
</span><span id="ServiceFuncs.load_info-89"><a href="#ServiceFuncs.load_info-89"><span class="linenos">89</span></a><span class="sd">        -------</span>
</span><span id="ServiceFuncs.load_info-90"><a href="#ServiceFuncs.load_info-90"><span class="linenos">90</span></a><span class="sd">        pandas.DataFrame</span>
</span><span id="ServiceFuncs.load_info-91"><a href="#ServiceFuncs.load_info-91"><span class="linenos">91</span></a><span class="sd">            Parsed and enriched metadata, including date and sampling rate in kHz.</span>
</span><span id="ServiceFuncs.load_info-92"><a href="#ServiceFuncs.load_info-92"><span class="linenos">92</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ServiceFuncs.load_info-93"><a href="#ServiceFuncs.load_info-93"><span class="linenos">93</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">info_path</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs.load_info-94"><a href="#ServiceFuncs.load_info-94"><span class="linenos">94</span></a>        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">info</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">]])</span>
</span><span id="ServiceFuncs.load_info-95"><a href="#ServiceFuncs.load_info-95"><span class="linenos">95</span></a>        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;SAMPLING_RATE[kHz]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;SAMPLING_RATE[Hz]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</span><span id="ServiceFuncs.load_info-96"><a href="#ServiceFuncs.load_info-96"><span class="linenos">96</span></a>        <span class="n">info</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;SAMPLING_RATE[Hz]&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ServiceFuncs.load_info-97"><a href="#ServiceFuncs.load_info-97"><span class="linenos">97</span></a>        <span class="k">return</span> <span class="n">info</span>
</span></pre></div>


            <div class="docstring"><p>Load and preprocess metadata from a space-delimited text file.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>info_path</strong> (str):
Path to the metadata file.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pandas.DataFrame</strong>: Parsed and enriched metadata, including date and sampling rate in kHz.</li>
</ul>
</div>


                            </div>
                            <div id="ServiceFuncs.extract_observ_data" class="classattr">
                                        <input id="ServiceFuncs.extract_observ_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">extract_observ_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">path</span>, </span><span class="param"><span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;(?:r|t)swf-e_(</span><span class="se">\\</span><span class="s1">d</span><span class="si">{4}</span><span class="s1">)(</span><span class="se">\\</span><span class="s1">d</span><span class="si">{2}</span><span class="s1">)(</span><span class="se">\\</span><span class="s1">d</span><span class="si">{2}</span><span class="s1">)&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ServiceFuncs.extract_observ_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ServiceFuncs.extract_observ_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ServiceFuncs.extract_observ_data-99"><a href="#ServiceFuncs.extract_observ_data-99"><span class="linenos"> 99</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ServiceFuncs.extract_observ_data-100"><a href="#ServiceFuncs.extract_observ_data-100"><span class="linenos">100</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_observ_data</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;(?:r|t)swf-e_(\d</span><span class="si">{4}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)(\d</span><span class="si">{2}</span><span class="s1">)&#39;</span><span class="p">):</span>
</span><span id="ServiceFuncs.extract_observ_data-101"><a href="#ServiceFuncs.extract_observ_data-101"><span class="linenos">101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ServiceFuncs.extract_observ_data-102"><a href="#ServiceFuncs.extract_observ_data-102"><span class="linenos">102</span></a><span class="sd">        Extracts observation type and date from the filename using regex.</span>
</span><span id="ServiceFuncs.extract_observ_data-103"><a href="#ServiceFuncs.extract_observ_data-103"><span class="linenos">103</span></a>
</span><span id="ServiceFuncs.extract_observ_data-104"><a href="#ServiceFuncs.extract_observ_data-104"><span class="linenos">104</span></a><span class="sd">        Parameters</span>
</span><span id="ServiceFuncs.extract_observ_data-105"><a href="#ServiceFuncs.extract_observ_data-105"><span class="linenos">105</span></a><span class="sd">        ----------</span>
</span><span id="ServiceFuncs.extract_observ_data-106"><a href="#ServiceFuncs.extract_observ_data-106"><span class="linenos">106</span></a><span class="sd">        path : str</span>
</span><span id="ServiceFuncs.extract_observ_data-107"><a href="#ServiceFuncs.extract_observ_data-107"><span class="linenos">107</span></a><span class="sd">            File path or name.</span>
</span><span id="ServiceFuncs.extract_observ_data-108"><a href="#ServiceFuncs.extract_observ_data-108"><span class="linenos">108</span></a>
</span><span id="ServiceFuncs.extract_observ_data-109"><a href="#ServiceFuncs.extract_observ_data-109"><span class="linenos">109</span></a><span class="sd">        Returns</span>
</span><span id="ServiceFuncs.extract_observ_data-110"><a href="#ServiceFuncs.extract_observ_data-110"><span class="linenos">110</span></a><span class="sd">        -------</span>
</span><span id="ServiceFuncs.extract_observ_data-111"><a href="#ServiceFuncs.extract_observ_data-111"><span class="linenos">111</span></a><span class="sd">        tuple</span>
</span><span id="ServiceFuncs.extract_observ_data-112"><a href="#ServiceFuncs.extract_observ_data-112"><span class="linenos">112</span></a><span class="sd">            (observation_type, datetime.date)</span>
</span><span id="ServiceFuncs.extract_observ_data-113"><a href="#ServiceFuncs.extract_observ_data-113"><span class="linenos">113</span></a><span class="sd">        </span>
</span><span id="ServiceFuncs.extract_observ_data-114"><a href="#ServiceFuncs.extract_observ_data-114"><span class="linenos">114</span></a><span class="sd">        Raises</span>
</span><span id="ServiceFuncs.extract_observ_data-115"><a href="#ServiceFuncs.extract_observ_data-115"><span class="linenos">115</span></a><span class="sd">        ------</span>
</span><span id="ServiceFuncs.extract_observ_data-116"><a href="#ServiceFuncs.extract_observ_data-116"><span class="linenos">116</span></a><span class="sd">        ValueError</span>
</span><span id="ServiceFuncs.extract_observ_data-117"><a href="#ServiceFuncs.extract_observ_data-117"><span class="linenos">117</span></a><span class="sd">            If the pattern is not found.</span>
</span><span id="ServiceFuncs.extract_observ_data-118"><a href="#ServiceFuncs.extract_observ_data-118"><span class="linenos">118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ServiceFuncs.extract_observ_data-119"><a href="#ServiceFuncs.extract_observ_data-119"><span class="linenos">119</span></a>        <span class="n">search</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="ServiceFuncs.extract_observ_data-120"><a href="#ServiceFuncs.extract_observ_data-120"><span class="linenos">120</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">search</span><span class="p">:</span>
</span><span id="ServiceFuncs.extract_observ_data-121"><a href="#ServiceFuncs.extract_observ_data-121"><span class="linenos">121</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not extract observation data from: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs.extract_observ_data-122"><a href="#ServiceFuncs.extract_observ_data-122"><span class="linenos">122</span></a>        <span class="n">obs_type</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ServiceFuncs.extract_observ_data-123"><a href="#ServiceFuncs.extract_observ_data-123"><span class="linenos">123</span></a>        <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">search</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
</span><span id="ServiceFuncs.extract_observ_data-124"><a href="#ServiceFuncs.extract_observ_data-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="n">obs_type</span><span class="p">,</span> <span class="n">date</span>
</span></pre></div>


            <div class="docstring"><p>Extracts observation type and date from the filename using regex.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>path</strong> (str):
File path or name.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tuple</strong>: (observation_type, datetime.date)</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If the pattern is not found.</li>
</ul>
</div>


                            </div>
                            <div id="ServiceFuncs.save_database" class="classattr">
                                        <input id="ServiceFuncs.save_database-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">save_database</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">df</span>, </span><span class="param"><span class="n">file_to_write</span><span class="o">=</span><span class="s1">&#39;./results/pearson_diagram_data&#39;</span>, </span><span class="param"><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;pickle&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ServiceFuncs.save_database-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ServiceFuncs.save_database"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ServiceFuncs.save_database-126"><a href="#ServiceFuncs.save_database-126"><span class="linenos">126</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ServiceFuncs.save_database-127"><a href="#ServiceFuncs.save_database-127"><span class="linenos">127</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_database</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">file_to_write</span><span class="o">=</span><span class="s1">&#39;./results/pearson_diagram_data&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;pickle&#39;</span><span class="p">):</span>
</span><span id="ServiceFuncs.save_database-128"><a href="#ServiceFuncs.save_database-128"><span class="linenos">128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ServiceFuncs.save_database-129"><a href="#ServiceFuncs.save_database-129"><span class="linenos">129</span></a><span class="sd">        Save a pandas DataFrame to disk.</span>
</span><span id="ServiceFuncs.save_database-130"><a href="#ServiceFuncs.save_database-130"><span class="linenos">130</span></a>
</span><span id="ServiceFuncs.save_database-131"><a href="#ServiceFuncs.save_database-131"><span class="linenos">131</span></a><span class="sd">        Parameters</span>
</span><span id="ServiceFuncs.save_database-132"><a href="#ServiceFuncs.save_database-132"><span class="linenos">132</span></a><span class="sd">        ----------</span>
</span><span id="ServiceFuncs.save_database-133"><a href="#ServiceFuncs.save_database-133"><span class="linenos">133</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="ServiceFuncs.save_database-134"><a href="#ServiceFuncs.save_database-134"><span class="linenos">134</span></a><span class="sd">            Data to save.</span>
</span><span id="ServiceFuncs.save_database-135"><a href="#ServiceFuncs.save_database-135"><span class="linenos">135</span></a><span class="sd">        file_to_write : str</span>
</span><span id="ServiceFuncs.save_database-136"><a href="#ServiceFuncs.save_database-136"><span class="linenos">136</span></a><span class="sd">            Base filename without extension.</span>
</span><span id="ServiceFuncs.save_database-137"><a href="#ServiceFuncs.save_database-137"><span class="linenos">137</span></a><span class="sd">        kind : {&#39;pickle&#39;, &#39;json&#39;}</span>
</span><span id="ServiceFuncs.save_database-138"><a href="#ServiceFuncs.save_database-138"><span class="linenos">138</span></a><span class="sd">            Format to save the file in.</span>
</span><span id="ServiceFuncs.save_database-139"><a href="#ServiceFuncs.save_database-139"><span class="linenos">139</span></a><span class="sd">        save_dir : str</span>
</span><span id="ServiceFuncs.save_database-140"><a href="#ServiceFuncs.save_database-140"><span class="linenos">140</span></a><span class="sd">            Directory to save the file to.</span>
</span><span id="ServiceFuncs.save_database-141"><a href="#ServiceFuncs.save_database-141"><span class="linenos">141</span></a>
</span><span id="ServiceFuncs.save_database-142"><a href="#ServiceFuncs.save_database-142"><span class="linenos">142</span></a><span class="sd">        Raises</span>
</span><span id="ServiceFuncs.save_database-143"><a href="#ServiceFuncs.save_database-143"><span class="linenos">143</span></a><span class="sd">        ------</span>
</span><span id="ServiceFuncs.save_database-144"><a href="#ServiceFuncs.save_database-144"><span class="linenos">144</span></a><span class="sd">        Exception</span>
</span><span id="ServiceFuncs.save_database-145"><a href="#ServiceFuncs.save_database-145"><span class="linenos">145</span></a><span class="sd">            If saving fails.</span>
</span><span id="ServiceFuncs.save_database-146"><a href="#ServiceFuncs.save_database-146"><span class="linenos">146</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ServiceFuncs.save_database-147"><a href="#ServiceFuncs.save_database-147"><span class="linenos">147</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saving the database to </span><span class="si">{</span><span class="n">file_to_write</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs.save_database-148"><a href="#ServiceFuncs.save_database-148"><span class="linenos">148</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ServiceFuncs.save_database-149"><a href="#ServiceFuncs.save_database-149"><span class="linenos">149</span></a>            <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
</span><span id="ServiceFuncs.save_database-150"><a href="#ServiceFuncs.save_database-150"><span class="linenos">150</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">file_to_write</span><span class="o">+</span><span class="s1">&#39;.pkl&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs.save_database-151"><a href="#ServiceFuncs.save_database-151"><span class="linenos">151</span></a>            <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
</span><span id="ServiceFuncs.save_database-152"><a href="#ServiceFuncs.save_database-152"><span class="linenos">152</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">file_to_write</span><span class="o">+</span><span class="s1">&#39;.json&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs.save_database-153"><a href="#ServiceFuncs.save_database-153"><span class="linenos">153</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ServiceFuncs.save_database-154"><a href="#ServiceFuncs.save_database-154"><span class="linenos">154</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed to save the database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Save a pandas DataFrame to disk.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong> (pandas.DataFrame):
Data to save.</li>
<li><strong>file_to_write</strong> (str):
Base filename without extension.</li>
<li><strong>kind</strong> ({'pickle', 'json'}):
Format to save the file in.</li>
<li><strong>save_dir</strong> (str):
Directory to save the file to.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>Exception</strong>: If saving fails.</li>
</ul>
</div>


                            </div>
                            <div id="ServiceFuncs.read_database" class="classattr">
                                        <input id="ServiceFuncs.read_database-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">read_database</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">file_to_read</span><span class="o">=</span><span class="s1">&#39;./results/pearson_diagram_data&#39;</span>,</span><span class="param">	<span class="n">kind</span><span class="o">=</span><span class="s1">&#39;pickle&#39;</span>,</span><span class="param">	<span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;obsertype&#39;</span><span class="p">:</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="s1">&#39;datetime&#39;</span><span class="p">}</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ServiceFuncs.read_database-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ServiceFuncs.read_database"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ServiceFuncs.read_database-156"><a href="#ServiceFuncs.read_database-156"><span class="linenos">156</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ServiceFuncs.read_database-157"><a href="#ServiceFuncs.read_database-157"><span class="linenos">157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read_database</span><span class="p">(</span><span class="n">file_to_read</span><span class="o">=</span><span class="s1">&#39;./results/pearson_diagram_data&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;pickle&#39;</span><span class="p">,</span> 
</span><span id="ServiceFuncs.read_database-158"><a href="#ServiceFuncs.read_database-158"><span class="linenos">158</span></a>                <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;obsertype&#39;</span><span class="p">:</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="s1">&#39;datetime&#39;</span><span class="p">}):</span>
</span><span id="ServiceFuncs.read_database-159"><a href="#ServiceFuncs.read_database-159"><span class="linenos">159</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ServiceFuncs.read_database-160"><a href="#ServiceFuncs.read_database-160"><span class="linenos">160</span></a><span class="sd">        Read a pandas DataFrame from a file.</span>
</span><span id="ServiceFuncs.read_database-161"><a href="#ServiceFuncs.read_database-161"><span class="linenos">161</span></a>
</span><span id="ServiceFuncs.read_database-162"><a href="#ServiceFuncs.read_database-162"><span class="linenos">162</span></a><span class="sd">        Parameters</span>
</span><span id="ServiceFuncs.read_database-163"><a href="#ServiceFuncs.read_database-163"><span class="linenos">163</span></a><span class="sd">        ----------</span>
</span><span id="ServiceFuncs.read_database-164"><a href="#ServiceFuncs.read_database-164"><span class="linenos">164</span></a><span class="sd">        file_to_read : str</span>
</span><span id="ServiceFuncs.read_database-165"><a href="#ServiceFuncs.read_database-165"><span class="linenos">165</span></a><span class="sd">            Base filename without extension.</span>
</span><span id="ServiceFuncs.read_database-166"><a href="#ServiceFuncs.read_database-166"><span class="linenos">166</span></a><span class="sd">        kind : {&#39;pickle&#39;, &#39;json&#39;}</span>
</span><span id="ServiceFuncs.read_database-167"><a href="#ServiceFuncs.read_database-167"><span class="linenos">167</span></a><span class="sd">            Format of the file.</span>
</span><span id="ServiceFuncs.read_database-168"><a href="#ServiceFuncs.read_database-168"><span class="linenos">168</span></a><span class="sd">        dtype : dict</span>
</span><span id="ServiceFuncs.read_database-169"><a href="#ServiceFuncs.read_database-169"><span class="linenos">169</span></a><span class="sd">            To set types of columns in the database.</span>
</span><span id="ServiceFuncs.read_database-170"><a href="#ServiceFuncs.read_database-170"><span class="linenos">170</span></a>
</span><span id="ServiceFuncs.read_database-171"><a href="#ServiceFuncs.read_database-171"><span class="linenos">171</span></a><span class="sd">        Returns</span>
</span><span id="ServiceFuncs.read_database-172"><a href="#ServiceFuncs.read_database-172"><span class="linenos">172</span></a><span class="sd">        -------</span>
</span><span id="ServiceFuncs.read_database-173"><a href="#ServiceFuncs.read_database-173"><span class="linenos">173</span></a><span class="sd">        pandas.DataFrame or None</span>
</span><span id="ServiceFuncs.read_database-174"><a href="#ServiceFuncs.read_database-174"><span class="linenos">174</span></a><span class="sd">            The loaded DataFrame, or None if reading failed.</span>
</span><span id="ServiceFuncs.read_database-175"><a href="#ServiceFuncs.read_database-175"><span class="linenos">175</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ServiceFuncs.read_database-176"><a href="#ServiceFuncs.read_database-176"><span class="linenos">176</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reading a database from a file </span><span class="si">{</span><span class="n">file_to_read</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs.read_database-177"><a href="#ServiceFuncs.read_database-177"><span class="linenos">177</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ServiceFuncs.read_database-178"><a href="#ServiceFuncs.read_database-178"><span class="linenos">178</span></a>            <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
</span><span id="ServiceFuncs.read_database-179"><a href="#ServiceFuncs.read_database-179"><span class="linenos">179</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">file_to_read</span><span class="o">+</span><span class="s1">&#39;.pkl&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs.read_database-180"><a href="#ServiceFuncs.read_database-180"><span class="linenos">180</span></a>            <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
</span><span id="ServiceFuncs.read_database-181"><a href="#ServiceFuncs.read_database-181"><span class="linenos">181</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">file_to_read</span><span class="o">+</span><span class="s1">&#39;.json&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="ServiceFuncs.read_database-182"><a href="#ServiceFuncs.read_database-182"><span class="linenos">182</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</span><span id="ServiceFuncs.read_database-183"><a href="#ServiceFuncs.read_database-183"><span class="linenos">183</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</span><span id="ServiceFuncs.read_database-184"><a href="#ServiceFuncs.read_database-184"><span class="linenos">184</span></a>            <span class="k">return</span> <span class="n">df</span>
</span><span id="ServiceFuncs.read_database-185"><a href="#ServiceFuncs.read_database-185"><span class="linenos">185</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ServiceFuncs.read_database-186"><a href="#ServiceFuncs.read_database-186"><span class="linenos">186</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error during reading a database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs.read_database-187"><a href="#ServiceFuncs.read_database-187"><span class="linenos">187</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Read a pandas DataFrame from a file.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>file_to_read</strong> (str):
Base filename without extension.</li>
<li><strong>kind</strong> ({'pickle', 'json'}):
Format of the file.</li>
<li><strong>dtype</strong> (dict):
To set types of columns in the database.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pandas.DataFrame or None</strong>: The loaded DataFrame, or None if reading failed.</li>
</ul>
</div>


                            </div>
                            <div id="ServiceFuncs.preparing_folder" class="classattr">
                                        <input id="ServiceFuncs.preparing_folder-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">preparing_folder</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">dir_name</span>, </span><span class="param"><span class="n">clear</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ServiceFuncs.preparing_folder-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ServiceFuncs.preparing_folder"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ServiceFuncs.preparing_folder-189"><a href="#ServiceFuncs.preparing_folder-189"><span class="linenos">189</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ServiceFuncs.preparing_folder-190"><a href="#ServiceFuncs.preparing_folder-190"><span class="linenos">190</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">preparing_folder</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">clear</span><span class="p">):</span>
</span><span id="ServiceFuncs.preparing_folder-191"><a href="#ServiceFuncs.preparing_folder-191"><span class="linenos">191</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ServiceFuncs.preparing_folder-192"><a href="#ServiceFuncs.preparing_folder-192"><span class="linenos">192</span></a><span class="sd">        Prepare a directory for output, optionally clearing its contents.</span>
</span><span id="ServiceFuncs.preparing_folder-193"><a href="#ServiceFuncs.preparing_folder-193"><span class="linenos">193</span></a>
</span><span id="ServiceFuncs.preparing_folder-194"><a href="#ServiceFuncs.preparing_folder-194"><span class="linenos">194</span></a><span class="sd">        Parameters</span>
</span><span id="ServiceFuncs.preparing_folder-195"><a href="#ServiceFuncs.preparing_folder-195"><span class="linenos">195</span></a><span class="sd">        ----------</span>
</span><span id="ServiceFuncs.preparing_folder-196"><a href="#ServiceFuncs.preparing_folder-196"><span class="linenos">196</span></a><span class="sd">        dir_name : str</span>
</span><span id="ServiceFuncs.preparing_folder-197"><a href="#ServiceFuncs.preparing_folder-197"><span class="linenos">197</span></a><span class="sd">            Path to the target directory.</span>
</span><span id="ServiceFuncs.preparing_folder-198"><a href="#ServiceFuncs.preparing_folder-198"><span class="linenos">198</span></a><span class="sd">        clear : bool, optional</span>
</span><span id="ServiceFuncs.preparing_folder-199"><a href="#ServiceFuncs.preparing_folder-199"><span class="linenos">199</span></a><span class="sd">            If True, the directory will be deleted and recreated.</span>
</span><span id="ServiceFuncs.preparing_folder-200"><a href="#ServiceFuncs.preparing_folder-200"><span class="linenos">200</span></a>
</span><span id="ServiceFuncs.preparing_folder-201"><a href="#ServiceFuncs.preparing_folder-201"><span class="linenos">201</span></a><span class="sd">        Raises</span>
</span><span id="ServiceFuncs.preparing_folder-202"><a href="#ServiceFuncs.preparing_folder-202"><span class="linenos">202</span></a><span class="sd">        ------</span>
</span><span id="ServiceFuncs.preparing_folder-203"><a href="#ServiceFuncs.preparing_folder-203"><span class="linenos">203</span></a><span class="sd">        Exception</span>
</span><span id="ServiceFuncs.preparing_folder-204"><a href="#ServiceFuncs.preparing_folder-204"><span class="linenos">204</span></a><span class="sd">            If directory manipulation fails.</span>
</span><span id="ServiceFuncs.preparing_folder-205"><a href="#ServiceFuncs.preparing_folder-205"><span class="linenos">205</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ServiceFuncs.preparing_folder-206"><a href="#ServiceFuncs.preparing_folder-206"><span class="linenos">206</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dir_name</span><span class="p">):</span>
</span><span id="ServiceFuncs.preparing_folder-207"><a href="#ServiceFuncs.preparing_folder-207"><span class="linenos">207</span></a>            <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
</span><span id="ServiceFuncs.preparing_folder-208"><a href="#ServiceFuncs.preparing_folder-208"><span class="linenos">208</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="ServiceFuncs.preparing_folder-209"><a href="#ServiceFuncs.preparing_folder-209"><span class="linenos">209</span></a>                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
</span><span id="ServiceFuncs.preparing_folder-210"><a href="#ServiceFuncs.preparing_folder-210"><span class="linenos">210</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
</span><span id="ServiceFuncs.preparing_folder-211"><a href="#ServiceFuncs.preparing_folder-211"><span class="linenos">211</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="ServiceFuncs.preparing_folder-212"><a href="#ServiceFuncs.preparing_folder-212"><span class="linenos">212</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error during deleting files in </span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="ServiceFuncs.preparing_folder-213"><a href="#ServiceFuncs.preparing_folder-213"><span class="linenos">213</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ServiceFuncs.preparing_folder-214"><a href="#ServiceFuncs.preparing_folder-214"><span class="linenos">214</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Prepare a directory for output, optionally clearing its contents.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dir_name</strong> (str):
Path to the target directory.</li>
<li><strong>clear</strong> (bool, optional):
If True, the directory will be deleted and recreated.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>Exception</strong>: If directory manipulation fails.</li>
</ul>
</div>


                            </div>
                            <div id="ServiceFuncs.split_into_two" class="classattr">
                                        <input id="ServiceFuncs.split_into_two-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">split_into_two</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">df</span>, </span><span class="param"><span class="n">excluded_columns</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ServiceFuncs.split_into_two-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ServiceFuncs.split_into_two"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ServiceFuncs.split_into_two-216"><a href="#ServiceFuncs.split_into_two-216"><span class="linenos">216</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ServiceFuncs.split_into_two-217"><a href="#ServiceFuncs.split_into_two-217"><span class="linenos">217</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">split_into_two</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">excluded_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="ServiceFuncs.split_into_two-218"><a href="#ServiceFuncs.split_into_two-218"><span class="linenos">218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ServiceFuncs.split_into_two-219"><a href="#ServiceFuncs.split_into_two-219"><span class="linenos">219</span></a><span class="sd">        Split a DataFrame into features and metadata columns.</span>
</span><span id="ServiceFuncs.split_into_two-220"><a href="#ServiceFuncs.split_into_two-220"><span class="linenos">220</span></a>
</span><span id="ServiceFuncs.split_into_two-221"><a href="#ServiceFuncs.split_into_two-221"><span class="linenos">221</span></a><span class="sd">        Parameters</span>
</span><span id="ServiceFuncs.split_into_two-222"><a href="#ServiceFuncs.split_into_two-222"><span class="linenos">222</span></a><span class="sd">        ----------</span>
</span><span id="ServiceFuncs.split_into_two-223"><a href="#ServiceFuncs.split_into_two-223"><span class="linenos">223</span></a><span class="sd">        df : pandas.DataFrame</span>
</span><span id="ServiceFuncs.split_into_two-224"><a href="#ServiceFuncs.split_into_two-224"><span class="linenos">224</span></a><span class="sd">            Input DataFrame.</span>
</span><span id="ServiceFuncs.split_into_two-225"><a href="#ServiceFuncs.split_into_two-225"><span class="linenos">225</span></a><span class="sd">        excluded_columns : list of str, optional</span>
</span><span id="ServiceFuncs.split_into_two-226"><a href="#ServiceFuncs.split_into_two-226"><span class="linenos">226</span></a><span class="sd">            Columns to exclude from the features set.</span>
</span><span id="ServiceFuncs.split_into_two-227"><a href="#ServiceFuncs.split_into_two-227"><span class="linenos">227</span></a>
</span><span id="ServiceFuncs.split_into_two-228"><a href="#ServiceFuncs.split_into_two-228"><span class="linenos">228</span></a><span class="sd">        Returns</span>
</span><span id="ServiceFuncs.split_into_two-229"><a href="#ServiceFuncs.split_into_two-229"><span class="linenos">229</span></a><span class="sd">        -------</span>
</span><span id="ServiceFuncs.split_into_two-230"><a href="#ServiceFuncs.split_into_two-230"><span class="linenos">230</span></a><span class="sd">        tuple of pandas.DataFrame</span>
</span><span id="ServiceFuncs.split_into_two-231"><a href="#ServiceFuncs.split_into_two-231"><span class="linenos">231</span></a><span class="sd">            (features_df, metadata_df)</span>
</span><span id="ServiceFuncs.split_into_two-232"><a href="#ServiceFuncs.split_into_two-232"><span class="linenos">232</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ServiceFuncs.split_into_two-233"><a href="#ServiceFuncs.split_into_two-233"><span class="linenos">233</span></a>        <span class="k">if</span> <span class="n">excluded_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ServiceFuncs.split_into_two-234"><a href="#ServiceFuncs.split_into_two-234"><span class="linenos">234</span></a>            <span class="n">excluded_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dataset_name&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;dist_to_sun[au]&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLES_NUMBER&#39;</span><span class="p">,</span> 
</span><span id="ServiceFuncs.split_into_two-235"><a href="#ServiceFuncs.split_into_two-235"><span class="linenos">235</span></a>                          <span class="s1">&#39;SAMPLING_RATE[kHz]&#39;</span><span class="p">,</span> <span class="s1">&#39;SAMPLE_LENGTH[ms]&#39;</span><span class="p">,</span> <span class="s1">&#39;oldpath&#39;</span><span class="p">]</span>
</span><span id="ServiceFuncs.split_into_two-236"><a href="#ServiceFuncs.split_into_two-236"><span class="linenos">236</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="p">[</span><span class="n">cols</span> <span class="k">for</span> <span class="n">cols</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">cols</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_columns</span><span class="p">]</span>
</span><span id="ServiceFuncs.split_into_two-237"><a href="#ServiceFuncs.split_into_two-237"><span class="linenos">237</span></a>        <span class="n">df_features</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">]</span>
</span><span id="ServiceFuncs.split_into_two-238"><a href="#ServiceFuncs.split_into_two-238"><span class="linenos">238</span></a>        <span class="n">excluded_part</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">excluded_columns</span><span class="p">]</span>
</span><span id="ServiceFuncs.split_into_two-239"><a href="#ServiceFuncs.split_into_two-239"><span class="linenos">239</span></a>        <span class="k">return</span> <span class="n">df_features</span><span class="p">,</span> <span class="n">excluded_part</span>
</span></pre></div>


            <div class="docstring"><p>Split a DataFrame into features and metadata columns.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>df</strong> (pandas.DataFrame):
Input DataFrame.</li>
<li><strong>excluded_columns</strong> (list of str, optional):
Columns to exclude from the features set.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tuple of pandas.DataFrame</strong>: (features_df, metadata_df)</li>
</ul>
</div>


                            </div>
                            <div id="ServiceFuncs.input_name" class="classattr">
                                        <input id="ServiceFuncs.input_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">input_name</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">input_imags</span>, </span><span class="param"><span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;images_(</span><span class="se">\\</span><span class="s1">w+)&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ServiceFuncs.input_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ServiceFuncs.input_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ServiceFuncs.input_name-241"><a href="#ServiceFuncs.input_name-241"><span class="linenos">241</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ServiceFuncs.input_name-242"><a href="#ServiceFuncs.input_name-242"><span class="linenos">242</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">input_name</span><span class="p">(</span><span class="n">input_imags</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;images_(\w+)&#39;</span><span class="p">):</span>
</span><span id="ServiceFuncs.input_name-243"><a href="#ServiceFuncs.input_name-243"><span class="linenos">243</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ServiceFuncs.input_name-244"><a href="#ServiceFuncs.input_name-244"><span class="linenos">244</span></a><span class="sd">        Extract an identifier from a file path using a regular expression.</span>
</span><span id="ServiceFuncs.input_name-245"><a href="#ServiceFuncs.input_name-245"><span class="linenos">245</span></a>
</span><span id="ServiceFuncs.input_name-246"><a href="#ServiceFuncs.input_name-246"><span class="linenos">246</span></a><span class="sd">        Parameters</span>
</span><span id="ServiceFuncs.input_name-247"><a href="#ServiceFuncs.input_name-247"><span class="linenos">247</span></a><span class="sd">        ----------</span>
</span><span id="ServiceFuncs.input_name-248"><a href="#ServiceFuncs.input_name-248"><span class="linenos">248</span></a><span class="sd">        input_path : str</span>
</span><span id="ServiceFuncs.input_name-249"><a href="#ServiceFuncs.input_name-249"><span class="linenos">249</span></a><span class="sd">            File path or name.</span>
</span><span id="ServiceFuncs.input_name-250"><a href="#ServiceFuncs.input_name-250"><span class="linenos">250</span></a><span class="sd">        pattern : str</span>
</span><span id="ServiceFuncs.input_name-251"><a href="#ServiceFuncs.input_name-251"><span class="linenos">251</span></a><span class="sd">            Regular expression to extract the identifier.</span>
</span><span id="ServiceFuncs.input_name-252"><a href="#ServiceFuncs.input_name-252"><span class="linenos">252</span></a>
</span><span id="ServiceFuncs.input_name-253"><a href="#ServiceFuncs.input_name-253"><span class="linenos">253</span></a><span class="sd">        Returns</span>
</span><span id="ServiceFuncs.input_name-254"><a href="#ServiceFuncs.input_name-254"><span class="linenos">254</span></a><span class="sd">        -------</span>
</span><span id="ServiceFuncs.input_name-255"><a href="#ServiceFuncs.input_name-255"><span class="linenos">255</span></a><span class="sd">        str</span>
</span><span id="ServiceFuncs.input_name-256"><a href="#ServiceFuncs.input_name-256"><span class="linenos">256</span></a><span class="sd">            Extracted identifier or the original input if no match found.</span>
</span><span id="ServiceFuncs.input_name-257"><a href="#ServiceFuncs.input_name-257"><span class="linenos">257</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ServiceFuncs.input_name-258"><a href="#ServiceFuncs.input_name-258"><span class="linenos">258</span></a>        <span class="n">search</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">input_imags</span><span class="p">)</span>
</span><span id="ServiceFuncs.input_name-259"><a href="#ServiceFuncs.input_name-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="n">search</span><span class="p">:</span>
</span><span id="ServiceFuncs.input_name-260"><a href="#ServiceFuncs.input_name-260"><span class="linenos">260</span></a>            <span class="k">return</span> <span class="n">search</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="ServiceFuncs.input_name-261"><a href="#ServiceFuncs.input_name-261"><span class="linenos">261</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ServiceFuncs.input_name-262"><a href="#ServiceFuncs.input_name-262"><span class="linenos">262</span></a>            <span class="k">return</span> <span class="n">input_imags</span>
</span></pre></div>


            <div class="docstring"><p>Extract an identifier from a file path using a regular expression.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>input_path</strong> (str):
File path or name.</li>
<li><strong>pattern</strong> (str):
Regular expression to extract the identifier.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>str</strong>: Extracted identifier or the original input if no match found.</li>
</ul>
</div>


                            </div>
                </section>
    </main>
</body>
</html></section><hr>
</body></html>
